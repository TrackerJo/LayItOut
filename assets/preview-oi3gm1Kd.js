import{c as ye,j as g,r}from"./index-QIV6qY6h.js";import{A as Y,S as xe,D as pe}from"./section-ADRdvFWR.js";import{S as q,C as S,I as v,j as Se,k as K,l as Le}from"./firestore-BzzbFXtm.js";import{F as Q,B as Te}from"./booth_item-CdXLEtyq.js";ye.createRoot(document.getElementById("root")).render(g.jsx(we,{}));function we(){const[f,ve]=r.useState(!1),[U,X]=r.useState(0),[$,Z]=r.useState(0),[L,T]=r.useState([]),[O,b]=r.useState([]),[_,C]=r.useState(0),[w,R]=r.useState(null),[B,E]=r.useState([]),y=10,[k,M]=r.useState([]);r.useRef(null);const[Ee,be]=r.useState(!1),[Ae,Oe]=r.useState([]),[d,N]=r.useState([]),[Ne,je]=r.useState([]),[De,Re]=r.useState(!1);r.useRef(null);const[ee,te]=r.useState([]),[x,j]=r.useState([]),[m,P]=r.useState(null),[ke,Me]=r.useState(!1),[Pe,qe]=r.useState(!1),[le,Ue]=r.useState(!1),[$e,Be]=r.useState(!1),[Fe,We]=r.useState(!1),[He,Ve]=r.useState(!1),[ze,Ge]=r.useState(""),[Je,Ye]=r.useState(""),[Ke,Qe]=r.useState(""),[Xe,Ze]=r.useState(""),[_e,Ce]=r.useState(""),[ne,D]=r.useState(!0),[et,tt]=r.useState(null),[F,W]=r.useState(!1),[lt,oe]=r.useState(!1),[se,ie]=r.useState([]);r.useRef(null);function A(e,l){for(const s of l)if(e.x>=s.cellId.x&&e.x<s.cellId.x+s.cellsLong&&e.y>=s.cellId.y&&e.y<s.cellId.y+s.cellsTall)return s;return null}function ce(e){let l=U,s=$;if(f){let o=0;const c=[],i=[];for(const t of e){const n=[],a={width:t.cellsLong*y,height:t.cellsTall*y,sectionName:t.name};a.height>o&&(o=a.height),te(I=>[...I,a]),t.cellId.x=0,t.cellId.y=0,[...Array(a.height/y).keys()].map(I=>{const h=[];[...Array(a.width/y).keys()].map(u=>{h.push({id:new S({x:u,y:I}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:y})}),n.push(h)}),c.push({sectionName:t.name,cells:[...n]}),i.push(t)}j(c),N(i),C(o),P(e[0]?e[0].name:null),setTimeout(()=>{D(!1)},500)}else{const o=[];for(const c of e)console.log("Generating cells for section",c.name,"at",c.cellId,"with size",c.cellsLong,"x",c.cellsTall),console.log("Needed section Width:",c.cellsLong+c.cellId.x,"Current width:",l),c.cellsLong+c.cellId.x>l&&(console.log("Added section Width:",c.cellsLong+c.cellId.x),l+=c.cellsLong+c.cellId.x-l),console.log("Needed section Height:",c.cellsTall+c.cellId.y,"Current height:",s),c.cellsTall+c.cellId.y>s&&(console.log("Added section Height:",c.cellsTall+c.cellId.y),s+=c.cellsTall+c.cellId.y-s);X(l),Z(s),[...Array(s).keys()].map(c=>{const i=[];[...Array(l).keys()].map(t=>{i.push({id:new S({x:t,y:c}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:A(new S({x:t,y:c}),e)!=null,size:y})}),o.push(i)}),T([...o]),setTimeout(()=>{const c=[],i=[],t=[...e];for(const n of t)n.cellElement=document.querySelector(`.App #${n.cellId.toId()}.cell:not(.cell-border)`),c.push(...n.startingItems.map(a=>new K({cell:new S({x:n.cellId.x+a.cell.x,y:n.cellId.y+a.cell.y}),item:new v({...a.item,initialElement:document.querySelector(`.App #${a.cell.toId()}.cell:not(.cell-border)`),starterItem:!0})}))),c.push(...n.modifierItems.map(a=>new K({cell:new S({x:n.cellId.x+a.cell.x,y:n.cellId.y+a.cell.y}),item:new v({...a.item,initialElement:document.querySelector(`.App #${a.cell.toId()}.cell:not(.cell-border)`),starterItem:!0})}))),i.push(...n.booths.map(a=>new Le({...a,initialElement:document.querySelector(`.App #${a.cell.toId()}.cell:not(.cell-border)`)})));N([...t]);for(const n of c){const a=u=>{const p=u%2===1;return{cellsLong:p?n.item.cellsTall:n.item.cellsLong,cellsTall:p?n.item.cellsLong:n.item.cellsTall}},I=n.item.rotation||0,h=a(I);for(let u=0;u<h.cellsTall;u++)for(let p=0;p<h.cellsLong;p++)o[n.cell.y+u][n.cell.x+p].hasItem=!0,o[n.cell.y+u][n.cell.x+p].itemId=n.item.id;n.item.initialElement=document.querySelector(`.App #${n.cell.toId()}.cell:not(.cell-border)`),b(u=>[...u,n.item])}for(const n of i){for(let a=0;a<n.cellsTall;a++)for(let I=0;I<n.cellsLong;I++)o[n.cell.y+a][n.cell.x+I].hasItem=!0,o[n.cell.y+a][n.cell.x+I].itemId=n.id;n.initialElement=document.querySelector(`.App #${n.cell.toId()}.cell:not(.cell-border)`),ie(a=>[...a,n])}T([...o]),setTimeout(()=>{D(!1),ae()},500)},100)}}async function ae(e,l){D(!0),W(!0),setTimeout(async()=>{const s=document.getElementById("capture"),o=await domtoimage.toPng(s);W(!1),localStorage.setItem("screenshot",o),oe(!0),D(!1)},500)}async function re(){new URLSearchParams(window.location.search);const e=[];let l=localStorage.getItem("screenshotSections");console.log("Screenshot sections from localStorage",l),l=l?.split("LAYOUTSEPARATOR")||"";const s=[];for(const o of l)console.log("Section string",o),s.push(q.fromJSON(o));N([...s.map(o=>new q({name:o.name,cellId:new S({x:o.cellId.x,y:o.cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,startingItems:o.startingItems,modifierItems:o.modifierItems,booths:o.booths,items:o.startingItems.map(c=>new v({...c.item}))}))]),e.push(...s.map(o=>new q({name:o.name,cellId:new S({x:o.cellId.x,y:o.cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,startingItems:o.startingItems,modifierItems:o.modifierItems,booths:o.booths,items:o.startingItems.map(c=>new v({...c.item}))}))),console.log("SECTIONS TO GENERATE",e),ce(e)}r.useEffect(()=>{re()},[]);function me(e,l,s){if(!f||e==null)return;const o=[...s],c=[],i=s.find(t=>t.name==e);console.log("NEW SECTION",i),console.log("Adding section",i.name,i.cellId),console.log("MOBILE CELLS",l),i.cellElement=document.querySelector(`.App #${i.name.split(" ").join("-")} #${i.name.split(" ").join("")}${i.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",i.cellElement);for(const t of i.startingItems){console.log("Placing starting item",t.item.name,t.cell);const n=h=>{const u=h%2===1;return{cellsLong:u?t.item.cellsTall:t.item.cellsLong,cellsTall:u?t.item.cellsLong:t.item.cellsTall}},a=t.item.rotation||0,I=n(a);for(let h=0;h<I.cellsTall;h++)for(let u=0;u<I.cellsLong;u++){const p=l.find(he=>he.sectionName===i.name);p.cells[t.cell.y+h][t.cell.x+u].hasItem=!0,p.cells[t.cell.y+h][t.cell.x+u].itemId=t.item.id}t.item.initialElement=document.querySelector(`.App #${i.name.split(" ").join("-")} #${i.name.split(" ").join("")}${t.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",t.item.initialElement),c.push(new v({...t.item,starterItem:!0}))}console.log("Setting sections",o),N([...o]),console.log("ITEMS",c),b(t=>[...t.filter(a=>!c.some(I=>I.id===a.id)),...c.map(a=>new v({...a,starterItem:!0}))])}function H(e){let l=[];return e.map(s=>l=[...l,...s]),l}function V(e,l){console.log(e);const s=f?x.find(t=>t.sectionName===m).cells:L,o=s[e.y].length,c=s.length;if(console.log(o,c),e.x+l.cellsLong>o||e.y+l.cellsTall>c)return!1;const i=A(e,d);if(!i&&!f)return console.log("Item is out of bounds of any section"),!1;for(let t=0;t<l.cellsTall;t++)for(let n=0;n<l.cellsLong;n++){if(!f){const a=A(new S({x:e.x+n,y:e.y+t}),d);if(!a)return console.log("Item is out of bounds of any section"),!1;if(a.name!=i.name)return console.log("Item is crossing section boundaries"),!1}if(s[e.y+t][e.x+n].hasItem&&s[e.y+t][e.x+n].itemId!=l.id)return console.log("Something is already here"),!1}return!0}function de(e,l,s){const o=Array.from(f?x.find(t=>t.sectionName===m).cells:L);if(s!=null){console.log("Removing item");const t=f?d.find(n=>n.name===m):A(s,d);t.items=t.items.filter(n=>n.id!=l.id);for(let n=0;n<l.cellsTall;n++)for(let a=0;a<l.cellsLong;a++)o[s.y+n][s.x+a].hasItem=!1,o[s.y+n][s.x+a].itemId=""}const c=f?d.find(t=>t.name===m):A(e,d),i=new S({x:e.x-c.cellId.x,y:e.y-c.cellId.y});l.sectionCell=i,c.items.push(l);for(let t=0;t<l.cellsTall;t++)for(let n=0;n<l.cellsLong;n++)o[e.y+t][e.x+n].hasItem=!0,o[e.y+t][e.x+n].itemId=l.id;if(console.log(o),f){const t=x.find(n=>n.sectionName===m);t&&(t.cells=o.map(n=>n.map(a=>({...a}))),j([...x]))}else T(o);if(console.log("Removing item from inventory",l.name),!l.hasMoved){const t=k.findIndex(n=>n.item.name==l.name&&!n.item.hasMoved);if(t!==-1){const n=[...k];n[t].quantity-=1,n[t].quantity<=0&&n.splice(t,1),M(n)}else M(k)}b(t=>(console.log("Placing item",l.id),console.log("Updating item",l.id),t.find(n=>n.id==l.id).hasMoved||(t.find(n=>n.id==l.id).hasMoved=!0),t))}function ue(e){console.log("Removing item",e.id),b(l=>l.filter(s=>s.id!=e.id))}function ge(e,l){const s=Array.from(L),o=t=>{const n=t%2===1;return{cellsWide:n?e.cellsTall:e.cellsLong,cellsTall:n?e.cellsLong:e.cellsTall}},c=e.rotation||0,i=o(c);for(let t=0;t<i.cellsTall;t++)for(let n=0;n<i.cellsWide;n++)s[l.y+t][l.x+n].hasItem=!1,s[l.y+t][l.x+n].itemId="";T(s),console.log("DELETING ITEM",e.id),b(t=>(console.log(),t.filter(n=>n.id!=e.id))),M(t=>{const n=t.findIndex(a=>a.item.name==e.name&&!a.item.hasMoved);if(n!==-1){const a=[...t];return a[n].quantity+=1,a}else return[...t,new Se({item:new v({...e}),quantity:1})]})}function fe(e,l){const s=Array.from(f?x.find(t=>t.sectionName===m).cells:L);console.log("DELETING ITEM ROTATE",e.id,e.rotation);const o=t=>{const n=t%2===1;return{cellsWide:n?e.cellsTall:e.cellsLong,cellsTall:n?e.cellsLong:e.cellsTall}},c=e.rotation||0,i=o(c);for(let t=0;t<i.cellsTall;t++)for(let n=0;n<i.cellsWide;n++)console.log("Deleting cell",l.y+t,l.x+n),s[l.y+t][l.x+n].hasItem=!1,s[l.y+t][l.x+n].itemId="";T([...s]),console.log("DELETING ITEM",e.id)}function Ie(e,l){const s=f?x.find(i=>i.sectionName===m).cells:L,o=Array.from(s);if(s[e.y]==null){z();return}const c=V(e,l);o.forEach(i=>i.forEach(t=>{t.mouseOver=!1,t.canPlaceItem=!1,t.mouseOverLocation=""}));for(let i=0;i<l.cellsTall;i++)for(let t=0;t<l.cellsLong;t++)e.y+i<o.length&&e.x+t<o[e.y+i].length&&(l.cellsLong===1&&l.cellsTall===1?o[e.y+i][e.x+t].mouseOverLocation="single":l.cellsTall===1?t===0?o[e.y+i][e.x+t].mouseOverLocation="leftFull":t===l.cellsLong-1?o[e.y+i][e.x+t].mouseOverLocation="rightFull":o[e.y+i][e.x+t].mouseOverLocation="middleFull":l.cellsLong===1?i===0?o[e.y+i][e.x+t].mouseOverLocation="topFull":i===l.cellsTall-1?o[e.y+i][e.x+t].mouseOverLocation="bottomFull":o[e.y+i][e.x+t].mouseOverLocation="middleVFull":i===0&&t===0?o[e.y+i][e.x+t].mouseOverLocation="topLeftCorner":i===0&&t===l.cellsLong-1?o[e.y+i][e.x+t].mouseOverLocation="topRightCorner":i===l.cellsTall-1&&t===0?o[e.y+i][e.x+t].mouseOverLocation="bottomLeftCorner":i===l.cellsTall-1&&t===l.cellsLong-1?o[e.y+i][e.x+t].mouseOverLocation="bottomRightCorner":i===0?o[e.y+i][e.x+t].mouseOverLocation="top":i===l.cellsTall-1?o[e.y+i][e.x+t].mouseOverLocation="bottom":t===0?o[e.y+i][e.x+t].mouseOverLocation="left":t===l.cellsLong-1?o[e.y+i][e.x+t].mouseOverLocation="right":o[e.y+i][e.x+t].mouseOverLocation="middle",o[e.y+i][e.x+t].mouseOver=!0,o[e.y+i][e.x+t].canPlaceItem=c);if(f){const i=x.find(t=>t.sectionName===m);i&&(i.cells=o.map(t=>t.map(n=>({...n}))),j([...x])),j(t=>t.map(n=>n.sectionName===m?{...n,cells:o}:n))}else T(o)}function z(){const e=Array.from(f?x.find(l=>l.sectionName===m).cells:L);e.forEach(l=>l.forEach(s=>{s.mouseOver=!1,s.canPlaceItem=!1,s.mouseOverLocation=""})),T(e)}r.useEffect(()=>{me(m,x,d)},[m]),r.useEffect(()=>{const e=()=>{const l=O.find(s=>s.id===w);console.log("Unselecting item",w),R(null),l&&(E(s=>[...s,l.id]),console.log("Unselecting item",l.id),setTimeout(()=>{E(s=>s.filter(o=>o!==l.id))},300))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[w,O]);function G(e){R(null),E(l=>[...l,e]),console.log("Unselecting item",e),setTimeout(()=>{E(l=>l.filter(s=>s!==e))},300)}function J(e){const l=O.find(s=>s.id===w);console.log("Unselecting item",w),R(e),l&&(E(s=>[...s,l.id]),console.log("Unselecting item",l.id),setTimeout(()=>{E(s=>s.filter(o=>o!==l.id))},300))}return g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"App",children:[ne&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"loader-backdrop"}),g.jsx("div",{className:"loader"})]})," ",g.jsx("div",{className:"layout",children:f?g.jsxs("div",{className:"mobile-areas",style:{height:_+"px"},children:[g.jsx("img",{src:Q,onClick:()=>{const e=d.findIndex(s=>s.name==m);if(e===-1)return;const l=(e-1+d.length)%d.length;P(d[l].name),console.log("Changing viewing section to",d[l].name)},className:"back-mobile-areas"}),ee.map((e,l)=>g.jsx(Y,{width:e.width,height:e.height,cells:H(x.find(s=>s.sectionName==e.sectionName).cells),id:e.sectionName,visibile:m==null?!0:e.sectionName==m,section:e.sectionName},l)),g.jsx("img",{src:Q,onClick:()=>{const e=d.findIndex(s=>s.name==m);if(e===-1)return;const l=(e+1)%d.length;P(d[l].name),console.log("Changing viewing section to",d[l].name)},className:"forward-mobile-areas"})]}):g.jsx(Y,{width:U*y,height:$*y,cells:H(L)})})]}),g.jsxs("div",{id:F?"capture":"",children:[d.map(e=>g.jsx(xe,{takingPhoto:F,section:e,visible:m==null?!0:e.name==m,cellSize:y},e.cellId.toId())),O.map(e=>g.jsx(pe,{isCreatingArea:!1,isCreatingTemplate:!1,cellSize:y,isViewingDesign:le,removeItem:ue,visible:f?!e.hasMoved&&!e.starterItem?!0:m==null?!1:e.starterItem?d.find(l=>l.name==m)?.startingItems.some(l=>l.item.id===e.id):d.find(l=>l.name==m)?.items.some(l=>l.id===e.id):!0,item:e,canPlaceItem:V,placeItem:de,deleteItemRotate:fe,highlightCells:Ie,unHighlightCells:z,deleteItem:ge,isSelected:w===e.id,onSelect:J,isUnselecting:B.includes(e.id),onDeselect:()=>G(e.id)},e.id)),se.map(e=>g.jsx(Te,{visible:f?m==null?!1:d.find(l=>l.name==m)?.booths.some(l=>l.id===e.id)??!1:!0,booth:e,isViewingBooth:!1,isSelected:w==e.id,cellSize:y,onSelect:J,isUnselecting:B.includes(e.id),onDeselect:()=>G(e.id),onPickBooth:async l=>{}},e.id))]})]})}
