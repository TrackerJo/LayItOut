import{r as d,j as t,c as Dn}from"./index-BNCXs9B3.js";import{A as Ut,S as Pn,D as Bn,B as Wn}from"./booth_item-BAf2Q2gR.js";import{I,E as qe,G as ue,z as On,H as f,V as Ht,J as B,K as z,T as xe,D as jt,L as Tt,B as ke,M as je,N as De,k as Gn,n as Fn,O as Vn,P as it,Q as Zn,R as Jn,U as Yn,W as Un,A as Hn,X as Xn}from"./firestore-DnikGjYO.js";import{F as at}from"./forward-An_qFV6V.js";import{I as Qn,L as zn,T as qn}from"./inventory_item_tile-dj6osfPl.js";function $n({inventoryItem:c,addDraggingItem:G,removeItem:V,setSelectedItem:T,tapAndPlaceMode:j}){const R=d.useRef(null),C=d.useRef(null),[L,F]=d.useState(12),[A,E]=d.useState(c.item),[N,O]=d.useState(!1);function x(y){const v=C.current,H=window.getComputedStyle(v),q=document.createElement("span");q.style.font=H.font,q.style.fontSize=y+"px",q.style.fontFamily=H.fontFamily,q.style.fontWeight=H.fontWeight,q.style.position="absolute",q.style.visibility="hidden",q.style.whiteSpace="nowrap",q.textContent=v.textContent,document.body.appendChild(q);const D=q.offsetWidth;return document.body.removeChild(q),D}function U(y){if(C.current){const v=C.current;return x(y-1)>v.offsetWidth&&y-1>8?U(y-1):y-1}return y}d.useEffect(()=>{setTimeout(()=>{C.current&&F(U(L))},100)},[]);const k=d.useCallback(()=>{if(console.log("MOUSE MOVE",N),N){if(O(!1),j)return;c.item.initialElement=R.current,c.item.id=c.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",c.item.id,"to initialElement",c.item.initialElement),E(new I({...c.item})),G(c.item),window.removeEventListener("mousemove",k),window.removeEventListener("touchmove",k)}},[N,j]);return d.useEffect(()=>(N?(window.addEventListener("touchmove",k),window.addEventListener("mousemove",k)):(window.removeEventListener("touchmove",k),window.removeEventListener("mousemove",k)),()=>{window.removeEventListener("touchmove",k),window.removeEventListener("mousemove",k)}),[N,k]),t.jsxs("div",{className:"display",children:[t.jsx("div",{ref:R,id:c.item.id,className:c.item.isSectionItem?"display-section":`display-item ${c.item.isSectionModifier?c.item.sectionModifierType.toString():""}`,style:{width:`${c.item.cellsLong*10}px`,height:`${c.item.cellsTall*10}px`},onMouseDown:y=>{O(!0)},onMouseUp:()=>{console.log("MOUSE UP"),O(!1)},onClick:y=>{if(!j){y.preventDefault(),y.stopPropagation();return}console.log("CLICKED ON ITEM",c.item.id,"with tap and place mode"),y.preventDefault(),y.stopPropagation(),c.item.initialElement=R.current,c.item.id=c.item.name+(Math.random()*1e4).toString(),T(c.item)},onTouchStart:y=>{j||(y.preventDefault(),y.stopPropagation(),c.item.initialElement=R.current,c.item.id=c.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",c.item.id,"to initialElement",c.item.initialElement),E(new I({...c.item})),G(c.item))},children:c.item.isSectionModifier?c.item.sectionModifierType==="LeftDoor"||c.item.sectionModifierType==="RightDoor"?t.jsx("img",{src:c.item.icon,alt:"icon"}):null:c.item.icon.includes("custom-")?t.jsx("div",{className:c.item.isSectionItem?"custom-section":"custom-icon",children:t.jsx("div",{children:t.jsx("p",{ref:C,style:{fontSize:`${L}px`},children:c.item.icon.split("custom-")[1]})})}):t.jsx("img",{src:c.item.icon,alt:"icon"})}),t.jsx("p",{children:c.item.name}),c.quantity>0&&t.jsxs("p",{className:"quantity",children:["x",c.quantity]})]})}const Xt="/assets/plus.circle-Ce3xm00a.png";function Kn({inventoryItems:c,addDraggingItem:G,maxHeight:V,removeItem:T,showAddCustomItem:j,isCreatingTemplate:R,isEditingTemplate:C,isViewingDesign:L,tapAndPlaceMode:F,setSelectedItem:A,isModifyingSections:E}){return t.jsxs("div",{className:"toolbox",style:{maxHeight:V?`${V}px`:"200px"},children:[c.map(N=>t.jsx($n,{setSelectedItem:A,tapAndPlaceMode:F,inventoryItem:N,addDraggingItem:G,removeItem:T})),!(R||C||L||E)&&t.jsx("div",{className:"add-item",onClick:()=>{j()},children:t.jsx("img",{src:Xt,alt:"Add Item"})})]})}function _n({dialogRef:c,closeDialog:G,areaPreview:V}){return t.jsx("dialog",{ref:c,className:"layout-dialog",children:t.jsxs("div",{className:"layout-dialog-div",children:[t.jsx("h2",{children:"Layout"}),t.jsx("img",{src:V,alt:"Layout preview",className:"layout-dialog-preview"}),t.jsx("br",{}),t.jsx("button",{className:"layout-dialog-close",onClick:G,children:"Close"})]})})}const el="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",tl="/assets/template-Cjj8EPhc.png";function nl({dialogRef:c,closeDialog:G,templates:V,isOpen:T,isViewingArea:j,selectTemplate:R,duplicateTemplate:C}){const[L,F]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[A,E]=d.useState([]),[N,O]=d.useState(!1),[x,U]=d.useState([]);return d.useEffect(()=>{U(V)},[V]),d.useEffect(()=>{if(T&&(console.log("Layout dialog opened, generating cells and sections",x),x.length!==0)){if(x.length==1){E([x[0].name]);return}E(L?[x[0].name]:[x[0].name,x[1].name])}},[T,x]),d.useEffect(()=>{const k=x.filter(y=>A.includes(y.name));console.log("Viewing templates:",A),k.sort((y,v)=>A.indexOf(y.name)-A.indexOf(v.name)),console.log("Generating templates for",k.map(y=>y.name))},[A,x]),t.jsx(t.Fragment,{children:t.jsx("dialog",{ref:c,className:"template-dialog",children:t.jsxs("div",{className:"template-dialog-div",children:[t.jsx("h2",{children:"Templates"}),t.jsxs("div",{className:"templates",children:[x.length>1&&x.filter(k=>!A.includes(k.name)).length>0&&t.jsx("img",{src:at,onClick:()=>{if(L){const y=(x.findIndex(v=>v.name===A[0])-1+x.length)%x.length;E([x[y].name])}else E(k=>{const v=(x.findIndex(H=>H.name===k[0])-1+x.length)%x.length;return[x[v].name,k[0]]})},className:"back-mobile-areas"}),A.length===0&&t.jsx("div",{className:"no-templates",children:"No templates available"}),A.map(k=>t.jsxs("div",{className:"template",children:[t.jsx("img",{src:x.find(y=>y.name===k).previewImage,alt:k,className:"template-preview"}),t.jsx("h3",{children:k}),t.jsxs("div",{className:"template-actions",children:[t.jsx("button",{className:"template-select-btn",onClick:()=>{if(j){const y=new URLSearchParams(window.location.search),v=y.get("companyId"),H=y.get("areaId");window.location.href=`/Layout/?companyId=${v}&areaId=${H}&type=edit-template&templateId=${x.find(q=>q.name==k).id}`}else G(),R&&R(x.find(y=>y.name===k))},children:j?"Edit":"Select"}),j&&t.jsx("button",{className:"action-btn",onClick:()=>{N||(O(!0),C&&C(x.find(y=>y.name===k)))},children:"Duplicate"}),j&&t.jsx("button",{className:"action-btn",onClick:()=>{if(N)return;O(!0);const y=x.filter(D=>D.name!==k);U(y),y.length==1?E([y[0].name]):y.length==0?E([]):E(L?[y[0].name]:[y[0].name,y[1].name]);const v=new URLSearchParams(window.location.search),H=v.get("companyId"),q=v.get("areaId");qe(H,q,y).then(()=>{O(!1)})},children:"Delete"})]})]})),x.length>1&&x.filter(k=>!A.includes(k.name)).length>0&&t.jsx("img",{src:at,onClick:()=>{if(L){const y=(x.findIndex(v=>v.name===A[0])+1)%x.length;E([x[y].name])}else E(k=>{const v=(x.findIndex(H=>H.name===k[k.length-1])+1)%x.length;return[k[1],x[v].name]})},className:"forward-mobile-areas"})]}),j&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"action-btn",onClick:()=>{const k=new URLSearchParams(window.location.search),y=k.get("companyId"),v=k.get("areaId");window.location.href=`/Layout/?companyId=${y}&areaId=${v}&type=create-template`},children:"Create new Template"})," ",t.jsx("br",{})]}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:G,children:"Close"}),N&&T&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader"})})]})})})}function ll({dialogRef:c,closeDialog:G,addInventoryItem:V,canBeBooth:T}){const[j,R]=d.useState(""),[C,L]=d.useState(1),[F,A]=d.useState(1),[E,N]=d.useState(1),[O,x]=d.useState(!1);return t.jsx("dialog",{ref:c,className:"custom-item-dialog",children:t.jsxs("div",{className:"custom-item-dialog-div",children:[t.jsx("h2",{children:"Add Custom Item"}),t.jsxs("div",{className:"custom-item-row",children:[t.jsx("label",{htmlFor:"item-name",children:"Name:"}),t.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:U=>R(U.target.value??""),value:j})]}),t.jsxs("div",{className:"custom-item-row",children:[t.jsx("label",{htmlFor:"item-icon",children:"Count:"}),t.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:C,onChange:U=>L(parseInt(U.target.value)??1)})]}),t.jsxs("div",{className:"custom-item-row custom-item-size",children:[t.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),t.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:F,onChange:U=>A(parseFloat(U.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:E,onChange:U=>N(parseFloat(U.target.value)??1)})]}),T?t.jsxs("div",{className:"custom-item-row",children:[t.jsx("label",{htmlFor:"is-booth",children:"Is Booth:"}),t.jsx("input",{type:"checkbox",id:"is-booth",name:"is-booth",checked:O,onChange:U=>x(U.target.checked)})]}):null,t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{if(j.trim()===""){alert("Item name cannot be empty");return}const U=new ue({quantity:C,item:new I({id:j+(Math.random()*1e4).toString(),name:j,icon:`custom-${j}`,cellsLong:Math.ceil(F),cellsTall:Math.ceil(E),moveable:!0,starterItem:!1,displayItem:!0,isBooth:O})});V(U),R(""),L(1),A(1),N(1),x(!1),G()},children:"Add Item"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{G(),R(""),L(1),A(1),N(1),x(!1)},children:"Close"})]})})}function ol({dialogRef:c,closeDialog:G,addSection:V}){const[T,j]=d.useState(""),[R,C]=d.useState(1),[L,F]=d.useState(1);return t.jsx("dialog",{ref:c,className:"section-dialog",children:t.jsxs("div",{className:"section-dialog-div",children:[t.jsx("h2",{children:"Add Section"}),t.jsxs("div",{className:"section-row",children:[t.jsx("label",{htmlFor:"section-name",children:"Name:"}),t.jsx("input",{type:"text",id:"section-name",name:"section-name",onChange:A=>j(A.target.value??""),value:T})]}),t.jsxs("div",{className:"section-row section-size",children:[t.jsx("label",{htmlFor:"section-width",children:"Size (in feet):"}),t.jsx("input",{type:"number",id:"section-width",name:"section-width",min:"1",value:R,onChange:A=>C(parseFloat(A.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"section-height",name:"section-height",min:"1",value:L,onChange:A=>F(parseFloat(A.target.value)??1)})]}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{if(T.trim()===""){alert("Section name cannot be empty");return}const A=new ue({quantity:1,item:new I({id:T+(Math.random()*1e4).toString(),name:T,icon:`custom-${T}`,cellsLong:Math.ceil(R),cellsTall:Math.ceil(L),moveable:!0,starterItem:!1,displayItem:!0,isSectionItem:!0})});V(A),j(""),C(1),F(1),G()},children:"Add Section"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:G,children:"Close"})]})})}function sl({dialogRef:c,closeDialog:G,addInventoryItem:V}){const[T,j]=d.useState(null),[R,C]=d.useState(""),[L,F]=d.useState(1),[A,E]=d.useState(1),[N,O]=d.useState(1),[x,U]=d.useState(!0),[k,y]=d.useState([]);return d.useEffect(()=>{On(localStorage.getItem("companyId")||"").then(v=>{y(v)})},[]),t.jsx("dialog",{ref:c,className:"inventory-item-dialog",children:t.jsxs("div",{className:"inventory-item-dialog-div",children:[t.jsx("h2",{children:"Add Inventory Item"}),T==null?t.jsxs(t.Fragment,{children:["  ",t.jsx("label",{htmlFor:"",children:"Premade Items:"}),t.jsx("div",{className:"inventory-item-list",children:k.map(v=>t.jsx(Qn,{item:v,onSelect:()=>{const H=new ue({quantity:1,item:new I({id:v.name+(Math.random()*1e4).toString(),name:v.name,icon:v.icon,cellsLong:v.cellsLong,cellsTall:v.cellsTall,moveable:!0,starterItem:!1,displayItem:!0})});j(H)}},v.id))}),t.jsx("label",{htmlFor:"",children:"Or:"}),t.jsx("label",{htmlFor:"",children:"Custom Item:"}),t.jsxs("div",{className:"inventory-item-row",children:[t.jsx("label",{htmlFor:"item-name",children:"Name:"}),t.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:v=>C(v.target.value??""),value:R})]}),t.jsxs("div",{className:"inventory-item-row",children:[t.jsx("label",{htmlFor:"item-icon",children:"Count:"}),t.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:L,onChange:v=>F(parseInt(v.target.value)??1)})]}),t.jsxs("div",{className:"inventory-item-row inventory-item-size",children:[t.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),t.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:A,onChange:v=>E(parseFloat(v.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:N,onChange:v=>O(parseFloat(v.target.value)??1)})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),t.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:x,onChange:v=>U(v.target.checked)})]}),t.jsx("br",{})]}):t.jsxs(t.Fragment,{children:[t.jsxs("label",{htmlFor:"",children:["Item: ",T.item.name]}),t.jsxs("div",{className:"inventory-item-row",children:[t.jsx("label",{htmlFor:"item-icon",children:"Count:"}),t.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:L,onChange:v=>F(parseInt(v.target.value)??1)})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),t.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:x,onChange:v=>U(v.target.checked)})]})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{if(R.trim()===""&&T==null){alert("Item name cannot be empty");return}if(L<=0){alert("Item count must be greater than zero");return}let v=T;v==null?v=new ue({quantity:L,item:new I({id:R+(Math.random()*1e4).toString(),name:R,icon:`inventory-${R}`,cellsLong:Math.ceil(A),cellsTall:Math.ceil(N),moveable:x,starterItem:!1,displayItem:!0})}):(v.quantity=L,v.item.moveable=x),V(v),U(!0),j(null),C(""),F(1),E(1),O(1),G()},children:"Add Item"}),t.jsx("button",{className:"action-btn",onClick:()=>{U(!0),j(null),C(""),F(1),E(1),O(1),G()},children:"Close"})]})})}function il({item:c,setSelectingItem:G,addHighlightedCell:V,canPlaceItem:T,placeItem:j,highlightCells:R,unHighlightCells:C,cellSize:L,placeMultiItem:F}){const[A,E]=d.useState(0),[N,O]=d.useState(0),x=d.useRef(null),[U,k]=d.useState(0),[y,v]=d.useState(0),[H,q]=d.useState(!1),[D,oe]=d.useState(0),[se,Ae]=d.useState(null),[Lt,he]=d.useState(!0),[Ne,$e]=d.useState(12),[Me,Ke]=d.useState(null),_e=d.useRef(null),[Ze,At]=d.useState(!0),[Je,$]=d.useState(!1),[re,S]=d.useState(!1),ce=d.useCallback(M=>{const w=M%2===1;return{width:w?c.cellsTall*L:c.cellsLong*L,height:w?c.cellsLong*L:c.cellsTall*L,cellsWide:w?c.cellsTall:c.cellsLong,cellsTall:w?c.cellsLong:c.cellsTall}},[c,L]);function ct(M){const w=x.current,te=window.getComputedStyle(w),W=document.createElement("span");W.style.font=te.font,W.style.fontSize=M+"px",W.style.fontFamily=te.fontFamily,W.style.fontWeight=te.fontWeight,W.style.position="absolute",W.style.visibility="hidden",W.style.whiteSpace="nowrap",W.textContent=w.textContent,document.body.appendChild(W);const de=W.offsetWidth;return document.body.removeChild(W),de}function Ye(M){if(x.current){const w=x.current;return ct(M-1)>w.offsetWidth&&M-1>8?Ye(M-1):M-1}return M}const ve=()=>{$(!0)},Pe=()=>{$(!1)};d.useEffect(()=>(setTimeout(()=>{x.current&&$e(Ye(Ne))},100),window.addEventListener("mousedown",ve),window.addEventListener("mouseup",Pe),()=>{window.removeEventListener("mousedown",ve),window.removeEventListener("mouseup",Pe)}),[]),d.useEffect(()=>{if(c){q(!0);const M=_e.current?.getBoundingClientRect();Ke({x:M?M.left-A:0,y:M?M.top-N:0})}else console.log("No item to place, stopping dragging"),q(!1),Ke(null),E(0),O(0),k(0),v(0),oe(0),Ae(null),he(!0),$e(12),At(!0)},[c]);const Te=M=>{M.preventDefault()},Le=d.useCallback((M,w,te)=>{if(c==null||!H||!Me)return;console.log("PLACING MOVE",c);const W=te.target,de=ce(D),X=I.fromDoc(c.toDoc());X.cellsLong=de.cellsWide,X.cellsTall=de.cellsTall,X.initialElement=c.initialElement,X.rotation=D,X.hasMoved=c.hasMoved,X.id=c.id;let we=W;if(!we||!we.classList?.contains("cell")){const pe=document.elementFromPoint(M,w);pe?.classList?.contains("cell")&&(we=pe)}we?.classList?.contains("cell")&&!re?R(f.fromString(we.id),X):we?.classList?.contains("section-modifier")&&!re?R(f.fromString(we.dataset.cell),X):re||C(),E(M-Me.x),O(w-Me.y+(c.sectionModifierType?.includes("Door")?10:5)),Je&&(re||C(),S(!0),V(f.fromString(we.id)))},[c,H,A,N,re,Je,Me,T,j,ce,D,R,C,_e]),Ie=d.useCallback(M=>{if(c==null)return;const w=M.clientX,te=M.clientY;console.log("Drag ended"),C(),document.body.removeEventListener("touchmove",Te);const W=document.elementFromPoint(w,te);if(!W?.classList?.contains("cell")&&!W?.classList?.contains("section-modifier")){const de=ce(D),X={...c,cellsLong:de.cellsWide,cellsTall:de.cellsTall};re?(S(!1),F(X)):G()}else if(W?.classList?.contains("section-modifier")){if(console.log("Placing item on section modifier cell"),console.log("Target element:",W.dataset.cell),W.dataset.cell=="")return;const de=ce(D),X={...c,cellsLong:de.cellsWide,cellsTall:de.cellsTall};if(re)S(!1),F(X);else{if(!T(f.fromString(W.dataset.cell),X))return;j(f.fromString(W.dataset.cell),X,se!=null?f.fromString(se.id):null)}console.log("Placed item at cell:",W)}else{const de=ce(D),X={...c,cellsLong:de.cellsWide,cellsTall:de.cellsTall};if(re)S(!1),F(X);else{if(!T(f.fromString(W.id),X))return;j(f.fromString(W.id),X,se!=null?f.fromString(se.id):null)}console.log("Placed item at cell:",W)}},[c,D,G,re,T,j,se,C,U,y]),Ue=d.useCallback(M=>{const w=M.clientX,te=M.clientY;Le(w,te,M)},[Le]),He=d.useCallback(M=>{const w=M.touches[0],te=w.clientX,W=w.clientY;Le(te,W,M)},[Le]),J=d.useCallback(M=>{const w=M.changedTouches[0],te=w.clientX,W=w.clientY;Ie({clientX:te,clientY:W}),document.body.removeEventListener("touchmove",Te)},[Ie,Te]);return d.useEffect(()=>{if(H)return document.body.addEventListener("touchmove",Te,{passive:!1}),document.addEventListener("mousemove",Ue),document.addEventListener("mouseup",Ie),document.addEventListener("touchmove",He),document.addEventListener("touchend",J),()=>{document.body.removeEventListener("touchmove",Te),document.removeEventListener("mousemove",Ue),document.removeEventListener("mouseup",Ie),document.removeEventListener("touchmove",He),document.removeEventListener("touchend",J)}},[H,Ue,Ie,He,J,Te]),A==0||N==0||!Ze||c==null?t.jsx(t.Fragment,{}):t.jsx(t.Fragment,{children:t.jsx("div",{id:c.id,ref:_e,className:`draggable-item ${c.isSectionModifier&&!c.moveable?"placed-modifier":""} ${c.isSectionModifier?c.sectionModifierType?.toString():""} ${H?"dragging":""} ${c.moveable?"":"not-moveable"}`,style:{top:`${N}px`,left:`${A}px`,width:`${c.cellsLong*(c.isDisplayItem&&!H&&!c.hasMoved?10:L)-(c.sectionModifierType=="LeftWall"||c.sectionModifierType=="RightWall"||c.sectionModifierType?.includes("Corner")?1:0)}px`,height:`${c.cellsTall*(c.isDisplayItem&&!H&&!c.hasMoved?10:L)-(c.sectionModifierType=="TopWall"||c.sectionModifierType=="BottomWall"||c.sectionModifierType?.includes("Corner")?1:0)}px`,rotate:`${D*90}deg`,transformOrigin:"center center",fontSize:`${Ne}px`,zIndex:H?1e3:1},children:c.isSectionModifier?null:c.icon.includes("custom-")?t.jsx("div",{className:c.isSectionItem?"custom-section":"custom-icon",children:t.jsx("div",{children:t.jsx("p",{ref:x,children:c.icon.split("custom-")[1]})})}):t.jsx("img",{src:c.icon,alt:"icon"})})})}const al="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE02lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTE2PC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmRiZTM1YTM5LWE0MDUtNDM2MC04YzRjLWI3NmJmMTY3Mjc1YjwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5hZGQtaXRlbSAtIDc8L3JkZjpsaT4KICAgPC9yZGY6QWx0PgogIDwvZGM6dGl0bGU+CiA8L3JkZjpEZXNjcmlwdGlvbj4KCiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogIHhtbG5zOnBkZj0naHR0cDovL25zLmFkb2JlLmNvbS9wZGYvMS4zLyc+CiAgPHBkZjpBdXRob3I+U2FyYWggS2VtbWVOYXNoPC9wZGY6QXV0aG9yPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp4bXA9J2h0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8nPgogIDx4bXA6Q3JlYXRvclRvb2w+Q2FudmEgKFJlbmRlcmVyKSBkb2M9REFHdTJ5dUVOWkEgdXNlcj1VQUZqR1c2eHRDUSBicmFuZD1bQVJDSElWRURdIEZvcnQgV2F5bmUgQ29tbXVuaXR5IFNjaG9vbHMgdGVtcGxhdGU9PC94bXA6Q3JlYXRvclRvb2w+CiA8L3JkZjpEZXNjcmlwdGlvbj4KPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0ncic/PupmVZwAAAT8SURBVHic7d1PaBxVHMDxX41Wh6DsE1FcweGltiAUpE7Vanm9BGzGqvGgJ9e/bRSliHrwkIueiif/gShkVFRGLCbR4p8ulSBMEEul7+rJF6jgXqQTFSEiK15m4yTZze7MvJn3m5nf95p9+xv4MLOZycxmB1Co2mF6A6iNEQiyCARZBIIsAkEWgSCLQJBFIMgiEGQRCLIIBFkEgiwCGVCDi7GJydnjbOLQEQC4AQBUqAJfeu6nec4lkD41uLjcmWl/AQBTm38WquAd6bnP5jV7LK83LmsRxucA4Pb7ucXs2xgX13ek/1Ue8wkk1jCMXhaz9zMurutI/2vd20AgUQ0udkaHqW0xekV7yrUd6X+jczsIBNYxFgDgSJJ1Eco1Hemf1rUttQeJYdybZr3F7NsZF1d3pN/WsT21BmlwcZkz016ElBi9LGbfwbhgOlBqDXLwpZ8WAeB+He9lMfsA4+KqjvTPZHmfWoMwLpoWsw/rej+L2XcyLq7MglJrkI70f2Bc/KkZ5S7GxXhH+t+mWV9rEIB1lD80oxxkXFzsSP9c0rW1BwEA6Ej/LOPid4vZWy6VpM1i9oFQLb+2tnrh3yTrLtG1AZhrcLFz8sRfLze4sAa9RnruG6EKXtQ4lrEJsTfposqDROcZ8wDwijPT/rLBxRWDXis99/VQBc9rHP930gWVvto74KTvzPm5qenVleW1QetuPXb6OTZx6M2M439Zmh2/Memiyu4hsT1j80nf3c5M+9SQPeWtUAUvZJmf9vBXyQ/12J5x34CX7Go6rf2hWp5fW73Q7feC6IP+osXskS42xgtV8LT03I+TrgOoIEiCa1M3NZ2WMwTlHOPiN4vZ94w6P1TBU9Jz55Jsc7xKgaS4ULh7BJQfR0UJVXBUeu57SbZ5c5UByXDVdnfTae3LihKq4EnpuR8knL2lSoBkvYQOAHsilIUUKN1QBY9Jz/0o5ewNlR5EA0avNCjdUAWPSs/1M85er9QgGjF67Wk6rVsilL6XPGIoh0MVPKz7tqDSnhjGzjMG/WqbpVPn56YeWl1Z/mfQC/jk7K6VpRM/6x5cSpAc9ox+DUXJo9KdqReEAQAw7cy0Tza4uDTnORsq1WdIgRi9bm46rb2hWl5Mehk9baU5ZEU3JMyDpr+BJ2xhaXb8wSIGleKQFWF8BmYwIFTBd0XNQr+HxDCmTcwPVXBceu7bRc1DDVI3DADEIHXEAEAKUlcMAIQgdcYAQAZSdwwARCAIMJ6RnvuuidnxUIAQxv8ZByGMjRkFIYytGQMhjP4ZASGMwRUOQhjbVygIAoxMN7EVUWEghDFahYAQxujlDkIYycoVhDCSlxsIYaQrFxDCSJ92EAQYx7I+EmAyrSAIMI5Kz33fxGxdaQMhDD1pASEMfWUGIQy9ZQIhDP2lBiGMfEoFggBDywOWGEsM0uBiLLoL/YEctmdooQoel577oYnZRZT47nc2IfaBOYwnqowBAJDm6SAjjzBUfc/oVYrnQ+qCAVACkDphACAHqRsGAF6QbqiCR+qGAZDuQz3vel9X8YnpDTERtj2k1hgAuEBqjwGAB4QwojCAEEYs0yCEsSmTv2V1QxW08v43dGXLFEg3+vKvk4bmo83EIYswtinNHvIrALyadmCogu+l5+byPwCrkPGHPqmNEQiyCARZBIIsAkEWgSCLQJBFIMgiEGQRCLIIBFkEgqz/ADvdpRk/dmKqAAAAAElFTkSuQmCC";function cl({vendor:c,onDelete:G,onEdit:V,boothMap:T}){return t.jsxs("div",{className:"vendor-display-tile",children:[t.jsxs("div",{className:"vendor-info",children:[t.jsx("h3",{className:"vendor-business-name",children:c.businessName}),t.jsxs("p",{className:"vendor-plot-size",children:[c.plotWidth,"ft x ",c.plotHeight,"ft"]})]}),t.jsxs("div",{className:"vendor-actions",children:[t.jsx("img",{src:zn,alt:"Share",className:"vendor-link",onClick:async j=>{j.stopPropagation();const R=localStorage.getItem("companyId"),C=window.location.origin+`/Layout/?companyId=${R}&areaId=${T.areaId}&type=pick-booth&boothMapId=${T.id}&boothMapName=${T.name}&vendorId=${c.id}`;await navigator.clipboard.writeText(C),alert("BoothMap link copied to clipboard!")}}),t.jsx("img",{src:al,alt:"Edit",className:"vendor-edit",onClick:j=>{j.stopPropagation(),V(c.id)}}),t.jsx("img",{src:qn,alt:"Delete",className:"vendor-delete",onClick:j=>{j.stopPropagation(),window.confirm("Are you sure you want to delete this vendor?")&&G(c.id)}})]})]})}function rl({maxHeight:c,vendors:G,onAddVendor:V,boothMap:T,onDeleteVendor:j,onEditVendor:R}){return t.jsxs("div",{className:"vendors-tile",style:{maxHeight:c?`${c}px`:"200px"},children:[t.jsx("h2",{children:"Vendors"}),t.jsx("div",{className:"vendors-divider"}),t.jsxs("div",{className:"vendors-tile-content",children:[G.map(C=>t.jsx(cl,{vendor:C,boothMap:T,onDelete:L=>{j(L)},onEdit:L=>{R(C)}},C.id)),t.jsx("div",{className:"add-vendor",onClick:V,children:t.jsx("img",{src:Xt,alt:"Add vendor"})})]})]})}function dl({dialogRef:c,closeDialog:G,addVendor:V}){const[T,j]=d.useState(""),[R,C]=d.useState(1),[L,F]=d.useState(1),[A,E]=d.useState(!1);return t.jsxs("dialog",{ref:c,className:"add-vendor-dialog",children:[t.jsxs("div",{className:"add-vendor-dialog-div",children:[t.jsx("h2",{children:"Add Vendor"}),t.jsxs("div",{className:"add-vendor-row",children:[t.jsx("label",{htmlFor:"business-name",children:"Business Name:"}),t.jsx("input",{type:"text",id:"business-name",name:"business-name",onChange:N=>j(N.target.value??""),value:T})]}),t.jsxs("div",{className:"add-vendor-row add-vendor-size",children:[t.jsx("label",{htmlFor:"item-width",children:"Booth Size (in feet):"}),t.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:R,onChange:N=>C(parseFloat(N.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:L,onChange:N=>F(parseFloat(N.target.value)??1)})]}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:async()=>{if(T.trim()===""){alert("Business name cannot be empty");return}const N=new Ht({id:T+(Math.random()*1e4).toString(),businessName:T,plotWidth:Math.ceil(R),plotHeight:Math.ceil(L)});E(!0),await V(N),j(""),C(1),F(1),E(!1),G()},children:"Add Vendor"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{G(),j(""),C(1),F(1)},children:"Close"})]}),A&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader"})})]})}function ml({dialogRef:c,closeDialog:G,editVendor:V,oldVendor:T}){const[j,R]=d.useState(""),[C,L]=d.useState(1),[F,A]=d.useState(1),[E,N]=d.useState(!1);return d.useEffect(()=>{T&&(R(T.businessName),L(T.plotWidth),A(T.plotHeight))},[T]),t.jsxs("dialog",{ref:c,className:"edit-vendor-dialog",children:[t.jsxs("div",{className:"edit-vendor-dialog-div",children:[t.jsx("h2",{children:"Edit Vendor"}),t.jsxs("div",{className:"edit-vendor-row",children:[t.jsx("label",{htmlFor:"business-name",children:"Business Name:"}),t.jsx("input",{type:"text",id:"business-name",name:"business-name",onChange:O=>R(O.target.value??""),value:j})]}),t.jsxs("div",{className:"edit-vendor-row edit-vendor-size",children:[t.jsx("label",{htmlFor:"item-width",children:"Booth Size (in feet):"}),t.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:C,onChange:O=>L(parseFloat(O.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:F,onChange:O=>A(parseFloat(O.target.value)??1)})]}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:async()=>{if(j.trim()===""){alert("Business name cannot be empty");return}const O=new Ht({id:T.id,businessName:j,plotWidth:Math.ceil(C),plotHeight:Math.ceil(F)});N(!0),await V(O),R(""),L(1),A(1),N(!1),G()},children:"Save Vendor"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{G(),R(T.businessName),L(T.plotWidth),A(T.plotHeight)},children:"Close"})]}),E&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader"})})]})}function gl({maxHeight:c}){return t.jsxs("div",{className:"key-tile",children:[t.jsx("h2",{children:"Key"}),t.jsx("div",{className:"key-divider"}),t.jsxs("div",{className:"key-tile-content",children:[t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"cell cell-border"}),t.jsx("p",{children:"1ft x 1ft"})]}),t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"container",children:t.jsx("div",{className:"wall"})}),t.jsx("p",{children:"Wall"})]}),t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"window-container",children:t.jsx("div",{className:"window"})}),t.jsx("p",{children:"Window"})]}),t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"container",children:t.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fright_door.png?alt=media&token=8c6f3b4d-5e7a-4b9c-8d2f-0a3b5e6f7c8d",alt:"",className:"door"})}),t.jsx("p",{children:"Door"})]}),t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"window-container",children:t.jsx("div",{className:"section-divider"})}),t.jsx("p",{children:"Section Divider"})]})]})]})}function ul({dialogRef:c,closeDialog:G,vendors:V,addVendorToBooth:T}){const[j,R]=d.useState(!1),[C,L]=d.useState(null);return t.jsxs("dialog",{ref:c,className:"add-vendor-dialog",children:[t.jsxs("div",{className:"add-vendor-dialog-div",children:[t.jsx("h2",{children:"Select Vendor"}),t.jsxs("div",{className:"add-vendor-row",children:[t.jsx("label",{htmlFor:"boothMap-area",children:"Vendor:"}),t.jsxs("select",{id:"boothMap-area",name:"boothMap-area",onChange:F=>{const A=F.target.value,E=V.find(N=>N.id===A)||null;L(E)},value:C?.id||"",children:[t.jsx("option",{value:"",children:"Select a Vendor"}),V.map(F=>t.jsx("option",{value:F.id,children:F.businessName},F.id))]})]}),t.jsx("button",{className:"action-btn",onClick:()=>{if(!C){alert("Please select a vendor");return}R(!0),T(C)},children:"Select"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{G(),L(null)},children:"Close"})]}),j&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader"})})]})}Dn.createRoot(document.getElementById("root")).render(t.jsx(fl,{}));function fl(){const[c,G]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[V,T]=d.useState(0),[j,R]=d.useState(0),[C,L]=d.useState(0),[F,A]=d.useState(0),[E,N]=d.useState([]),[O,x]=d.useState([]),[U,k]=d.useState(0),[y,v]=d.useState(null),[H,q]=d.useState([]),D=/Mobi|Android/i.test(navigator.userAgent)?5:10,[oe,se]=d.useState([]),[Ae,Lt]=d.useState(!1),[he,Ne]=d.useState(null),[$e,Me]=d.useState(null),[Ke,_e]=d.useState([new I({id:"left-wall",name:"Left Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWall"}),new I({id:"right-wall",name:"Right Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWall"}),new I({id:"top-wall",name:"Top Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWall"}),new I({id:"bottom-wall",name:"Bottom Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWall"}),new I({id:"left-door",name:"Left Door",cellsLong:1,cellsTall:1,icon:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fleft_door.png?alt=media&token=91fde31c-ebc6-4807-9670-f846c8d75cb6",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftDoor"}),new I({id:"right-door",name:"Right Door",cellsLong:1,cellsTall:1,icon:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fright_door.png?alt=media&token=8c6f3b4d-5e7a-4b9c-8d2f-0a3b5e6f7c8d",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightDoor"}),new I({id:"left-window",name:"Left Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWindow"}),new I({id:"right-window",name:"Right Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWindow"}),new I({id:"top-window",name:"Top Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWindow"}),new I({id:"bottom-window",name:"Bottom Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWindow"})]),Ze=d.useRef(null),[At,Je]=d.useState(!1),[$,re]=d.useState([]),[S,ce]=d.useState([]),[ct,Ye]=d.useState([]),[ve,Pe]=d.useState([]),[Te,Le]=d.useState(!1),Ie=d.useRef(null),[Ue,He]=d.useState([]),[J,M]=d.useState([]),[w,te]=d.useState(null),[W,de]=d.useState(!1),[X,we]=d.useState(!1),[pe,Qt]=d.useState(!1),[Xe,zt]=d.useState(!1),[ne,qt]=d.useState(!1),[K,rt]=d.useState("placing-sections"),[hl,$t]=d.useState(!1),[dt,Kt]=d.useState(!1),[Se,_t]=d.useState(!1),[et,en]=d.useState(!1),[Qe,tn]=d.useState(!1),[Be,nn]=d.useState(!1),[We,Nt]=d.useState(!1),[Oe,ze]=d.useState(""),[tt,ln]=d.useState(null),[Ge,Mt]=d.useState(""),[Z,on]=d.useState(""),[sn,an]=d.useState(null),[Q,cn]=d.useState(""),[nt,rn]=d.useState(null),[lt,ot]=d.useState(""),[Ct,st]=d.useState(""),[le,Ce]=d.useState(null),[mt,Y]=d.useState(!0),[Et,dn]=d.useState(null),[gt,fe]=d.useState(!1),[mn,gn]=d.useState(null),[un,Rt]=d.useState([]),[fn,Ee]=d.useState(!1),[be,hn]=d.useState(null),[ut,pn]=d.useState(!1),[In,wn]=d.useState(null),[ft,yn]=d.useState(null),[kt,Dt]=d.useState(null),[Re,Pt]=d.useState(!1),ht=d.useRef(null),pt=d.useRef(null),It=d.useRef(null),wt=d.useRef(null),yt=d.useRef(null),xt=d.useRef(null);function ye(n,e){for(const s of e)if(n.x>=s.cellId.x&&n.x<s.cellId.x+s.cellsLong&&n.y>=s.cellId.y&&n.y<s.cellId.y+s.cellsTall)return s;return null}function xn(n,e,s,a){re([...n.map(o=>new B({name:o.name,cellId:new f({x:o.cellId.x,y:o.cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,modifierItems:o.modifierItems.map(l=>new z({cell:new f({x:l.cell.x,y:l.cell.y}),item:new I({...l.item,starterItem:!0})})),startingItems:[]}))]);let i=V,r=j;if(c){for(const u of n)console.log("Generating cells for section",u.name,"at",u.cellId,"with size",u.cellsLong,"x",u.cellsTall),console.log("Needed section Width:",(u.cellsLong+u.cellId.x)*D,"Current width:",i),(u.cellsLong+u.cellId.x)*D>i&&(console.log("Added section Width:",u.cellsLong*D+u.cellId.x),i+=(u.cellsLong+u.cellId.x)*D-i),console.log("Needed section Height:",(u.cellsTall+u.cellId.y)*D,"Current height:",r),(u.cellsTall+u.cellId.y)*D>r&&(console.log("Added section Height:",u.cellsTall*D+u.cellId.y),r+=(u.cellsTall+u.cellId.y)*D-r);A(r/D*2),L(i/D*2);let o=0;const l=[],g=[];for(const u of n){const h=[],b={width:u.cellsLong*D,height:u.cellsTall*D,sectionName:u.name};b.height>o&&(o=b.height),He(P=>[...P,b]),u.cellId.x=0,u.cellId.y=0,[...Array(b.height/D).keys()].map(P=>{const me=[];[...Array(b.width/D).keys()].map(ie=>{me.push({id:new f({x:ie,y:P}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:D})}),h.push(me)}),l.push({sectionName:u.name,cells:[...h]}),g.push(u)}M(l),ce(g),k(o),te(n[0]?n[0].name:null),setTimeout(()=>{Y(!1)},500)}else{const o=[];for(const l of n)console.log("Generating cells for section",l.name,"at",l.cellId,"with size",l.cellsLong,"x",l.cellsTall),console.log("Needed section Width:",l.cellsLong+l.cellId.x,"Current width:",i),l.cellsLong+l.cellId.x>i&&(console.log("Added section Width:",l.cellsLong+l.cellId.x),i+=l.cellsLong+l.cellId.x-i),console.log("Needed section Height:",l.cellsTall+l.cellId.y,"Current height:",r),l.cellsTall+l.cellId.y>r&&(console.log("Added section Height:",l.cellsTall+l.cellId.y),r+=l.cellsTall+l.cellId.y-r);T(e.width),R(e.height),L(e.width),A(e.height),console.log("Final width:",i,"Final height:",r),[...Array(e.height).keys()].map(l=>{const g=[];[...Array(e.width).keys()].map(u=>{console.log("Creating cell at",u,l,"with size",D,s),g.push({id:new f({x:u,y:l}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:s&&a=="placing-sections"?!0:ye(new f({x:u,y:l}),n)!=null,size:D})}),o.push(g)}),N([...o]),setTimeout(()=>{const l=[],g=[...n],u=[];for(const h of g)h.cellElement=document.querySelector(`.App #${h.cellId.toId()}.cell:not(.cell-border)`),l.push(...h.startingItems.map(b=>new z({cell:new f({x:h.cellId.x+b.cell.x,y:h.cellId.y+b.cell.y}),item:new I({...b.item,initialElement:document.querySelector(`.App #${b.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,hasMoved:!0})}))),l.push(...h.modifierItems.map(b=>new z({cell:new f({x:h.cellId.x+b.cell.x,y:h.cellId.y+b.cell.y}),item:new I({...b.item,initialElement:document.querySelector(`.App #${b.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1})}))),u.push(...h.booths.map(b=>new je({...b,cell:new f({x:h.cellId.x+b.cell.x,y:h.cellId.y+b.cell.y}),initialElement:document.querySelector(`.App #${b.cell.toId()}.cell:not(.cell-border)`)})));ce([...g]);for(const h of l){const b=ie=>{const ge=ie%2===1;return{cellsLong:ge?h.item.cellsTall:h.item.cellsLong,cellsTall:ge?h.item.cellsLong:h.item.cellsTall}},P=h.item.rotation||0,me=b(P);for(let ie=0;ie<me.cellsTall;ie++)for(let ge=0;ge<me.cellsLong;ge++)o[h.cell.y+ie][h.cell.x+ge].hasItem=!0,o[h.cell.y+ie][h.cell.x+ge].itemId=h.item.id;h.item.initialElement=document.querySelector(`.App #${h.cell.toId()}.cell:not(.cell-border)`),x(ie=>[...ie,h.item])}for(const h of u){for(let b=0;b<h.cellsTall;b++)for(let P=0;P<h.cellsLong;P++)o[h.cell.y+b][h.cell.x+P].hasItem=!0,o[h.cell.y+b][h.cell.x+P].itemId=h.id;h.initialElement=document.querySelector(`.App #${h.cell.toId()}.cell:not(.cell-border)`),Ye(b=>[...b,h])}N([...o]),setTimeout(()=>{Y(!1)},500)},100)}}async function vn(){const n=new URLSearchParams(window.location.search),e=n.get("companyId"),s=n.get("areaId"),a=n.get("areaId")||"",i=n.get("companyId")||"",r=n.get("templateId")||"",o=await Vn(i,a);if(o===null){window.location.href="/DNF/";return}rn(o),gn(o.previewImage||null);const l=n.get("type")||"";let g=!1,u=!1,h="modify-sections",b=!1,P=null;if(l==="public-preview"){Nt(!0);const m=n.get("designName")||"";ze(m);const p=n.get("designId")||"";ot(p)}else if(l==="create-template")de(!0);else if(l==="edit-area")Kt(!0);else if(l==="edit-template"){we(!0);const m=o.templates.find(p=>p.id===r);m&&(dn(m),Mt(m.name))}else if(l==="view-design"){g=!0,Qt(!0);const m=n.get("designName")||"";ze(m);const p=n.get("designId")||"";ot(p)}else if(l==="view-area")zt(!0);else if(l==="edit-design"){g=!0,$t(!0);const m=n.get("designName")||"";ze(m);const p=n.get("designId")||"";ot(p)}else if(l==="client-edit-design"){g=!0,nn(!0);const m=n.get("designName")||"";ze(m);const p=n.get("designId")||"";ot(p)}else if(l==="create-area"){u=!0,qt(!0);const m=n.get("stage");m==="placing-sections"?(h="placing-sections",rt("placing-sections")):m==="modify-sections"?(rt("modify-sections"),h="modify-sections",se(Ke.map(p=>new ue({item:new I({...p,displayItem:!0}),quantity:-1})))):m==="placing-items"&&(rt("placing-items"),h="placing-items",se(o.inventoryItems.map(p=>new ue({item:new I({...p.item,displayItem:!0}),quantity:p.quantity}))))}else if(l==="view-boothMap"){b=!0,_t(!0);const m=n.get("boothMapId")||"";st(m);const p=await it(i,a,m);if(p===null){window.location.href="/DNF/";return}Ce(p),P=p}else if(l==="pick-booth"){b=!0,tn(!0);const m=n.get("boothMapId")||"";st(m);const p=await it(i,a,m);if(p===null){window.location.href="/DNF/";return}Ce(p),P=p;const ae=n.get("vendorId")||"";if(ae!==""){const ee=p.vendors.find(_=>_.id===ae);if(ee){hn(ee),console.log("Vendor found",ee);let _=!1;P.sections.forEach(Rn=>{Rn.booths.forEach(kn=>{kn.user?.id===ee.id&&(_=!0)})}),pn(_);const Yt=await Zn(i);if(Yt===null){window.location.href="/DNF/";return}an(Yt)}else{window.location.href="/DNF/";return}}}else if(l==="create-boothMap"){b=!0,en(!0);const m=n.get("boothMapId")||"";st(m);const p=await it(i,a,m);if(p===null){window.location.href="/DNF/";return}Ce(p),P=p}else if(l==="public-preview-boothMap"){b=!0,Nt(!0);const m=n.get("boothMapId")||"";st(m);const p=n.get("designName")||"";ze(p);const ae=await it(i,a,m);if(ae===null){window.location.href="/DNF/";return}Ce(ae),P=ae}e&&on(e),s&&cn(s),u||se(o.inventoryItems.map(m=>new ue({item:new I({...m.item,displayItem:!0}),quantity:m.quantity})));const me=[],ie=[];for(const m of o.templates){const p=[],ae=[];for(const ee of m.sections)p.push(new B({name:ee.name,cellId:new f({x:ee.cellId.x,y:ee.cellId.y}),cellsLong:ee.cellsLong,cellsTall:ee.cellsTall,modifierItems:ee.modifierItems.map(_=>new z({cell:new f({x:_.cell.x,y:_.cell.y}),item:new I({..._.item,starterItem:!0})})),startingItems:ee.startingItems.map(_=>new z({cell:new f({x:_.cell.x,y:_.cell.y}),item:new I({..._.item,starterItem:!0})}))})),ae.push(new B({name:ee.name,cellId:new f({x:ee.cellId.x,y:ee.cellId.y}),cellsLong:ee.cellsLong,cellsTall:ee.cellsTall,modifierItems:ee.modifierItems.map(_=>new z({cell:new f({x:_.cell.x,y:_.cell.y}),item:new I({..._.item,starterItem:!0})})),startingItems:ee.startingItems.map(_=>new z({cell:new f({x:_.cell.x,y:_.cell.y}),item:new I({..._.item,starterItem:!0})}))}));me.push(new xe({name:m.name,sections:p,inventoryItems:m.inventoryItems,id:m.id,previewImage:m.previewImage})),ie.push(new xe({name:m.name,sections:ae,id:m.id,previewImage:m.previewImage,inventoryItems:m.inventoryItems}))}Pe([...me]);const ge=[],Ve=r===""?void 0:ie.find(m=>m.id===r);if(console.log("TEMPLATE",Ve,"AREA",o),b&&P)se(P.inventoryItems.map(m=>new ue({item:new I({...m.item,displayItem:!0}),quantity:m.quantity}))),re([...P.sections]),ce([...P.sections.map(m=>new B({name:m.name,cellId:new f({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,booths:m.booths,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new I({...p.item,sectionCell:new f({x:p.cell.x,y:p.cell.y})}))}))]),ge.push(...P.sections.map(m=>new B({name:m.name,cellId:new f({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,booths:m.booths,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new I({...p.item,sectionCell:new f({x:p.cell.x,y:p.cell.y})}))})));else if(g){const m=await Jn(i,a,n.get("designId")||"");if(m===null){window.location.href="/DNF/";return}Pt(m.submitted),Dt(m.dateSubmitted?new Date(m.dateSubmitted):null),ln(m),se(m.inventoryItems.map(p=>new ue({item:new I({...p.item,displayItem:!0}),quantity:p.quantity}))),re([...m.sections]),ce([...m.sections.map(p=>new B({name:p.name,cellId:new f({x:p.cellId.x,y:p.cellId.y}),cellsLong:p.cellsLong,cellsTall:p.cellsTall,startingItems:p.startingItems,modifierItems:p.modifierItems,items:p.startingItems.map(ae=>new I({...ae.item,sectionCell:new f({x:ae.cell.x,y:ae.cell.y})}))}))]),ge.push(...m.sections.map(p=>new B({name:p.name,cellId:new f({x:p.cellId.x,y:p.cellId.y}),cellsLong:p.cellsLong,cellsTall:p.cellsTall,startingItems:p.startingItems,modifierItems:p.modifierItems,items:p.startingItems.map(ae=>new I({...ae.item,sectionCell:new f({x:ae.cell.x,y:ae.cell.y})}))})))}else Ve!==void 0?(se(Ve.inventoryItems.map(m=>new ue({item:new I({...m.item,displayItem:!0}),quantity:m.quantity}))),re([...Ve.sections]),ce([...Ve.sections.map(m=>new B({name:m.name,cellId:new f({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new I({...p.item,sectionCell:new f({x:p.cell.x,y:p.cell.y})}))}))]),ge.push(...Ve.sections.map(m=>new B({name:m.name,cellId:new f({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,modifierItems:m.modifierItems,startingItems:m.startingItems,items:m.startingItems.map(p=>new I({...p.item,sectionCell:new f({x:p.cell.x,y:p.cell.y})}))})))):(re([...o.sections]),ce([...o.sections.map(m=>new B({name:m.name,cellId:new f({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,modifierItems:m.modifierItems,startingItems:m.startingItems,items:m.startingItems.map(p=>new I({...p.item,sectionCell:new f({x:p.cell.x,y:p.cell.y})}))}))]),ge.push(...o.sections.map(m=>new B({name:m.name,cellId:new f({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new I({...p.item,sectionCell:new f({x:p.cell.x,y:p.cell.y})}))}))));console.log("SECTIONS TO GENERATE",ge),xn(ge,o,l==="create-area",h)}d.useEffect(()=>{vn()},[]);function Sn(n,e,s){if(!c||n==null)return;const a=[...s],i=[],r=[],o=s.find(l=>l.name==n);console.log("NEW SECTION",o),console.log("Adding section",o.name,o.cellId),console.log("MOBILE CELLS",e),o.cellElement=document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${o.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",o.cellElement);for(const l of o.startingItems){console.log("Placing starting item",l.item.name,l.cell);const g=b=>{const P=b%2===1;return{cellsLong:P?l.item.cellsTall:l.item.cellsLong,cellsTall:P?l.item.cellsLong:l.item.cellsTall}},u=l.item.rotation||0,h=g(u);for(let b=0;b<h.cellsTall;b++)for(let P=0;P<h.cellsLong;P++){const me=e.find(ie=>ie.sectionName===o.name);me.cells[l.cell.y+b][l.cell.x+P].hasItem=!0,me.cells[l.cell.y+b][l.cell.x+P].itemId=l.item.id}l.item.initialElement=document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",l.item.initialElement),i.push(new I({...l.item,hasMoved:!0}))}for(const l of o.modifierItems){console.log("Placing starting item",l.item.name,l.cell);const g=b=>{const P=b%2===1;return{cellsLong:P?l.item.cellsTall:l.item.cellsLong,cellsTall:P?l.item.cellsLong:l.item.cellsTall}},u=l.item.rotation||0,h=g(u);for(let b=0;b<h.cellsTall;b++)for(let P=0;P<h.cellsLong;P++){const me=e.find(ie=>ie.sectionName===o.name);me.cells[l.cell.y+b][l.cell.x+P].hasItem=!0,me.cells[l.cell.y+b][l.cell.x+P].itemId=l.item.id}console.log("Adding item to items",document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`)),i.push(new I({...l.item,initialElement:document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1}))}console.log("Setting sections",a),ce([...a]),console.log("ITEMS",i),x(l=>[...l.filter(u=>!i.some(h=>h.id===u.id)),...i.map(u=>new I({...u,starterItem:!0}))]),r.push(...o.booths.map(l=>new je({...l,initialElement:document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`)})));for(const l of r){for(let g=0;g<l.cellsTall;g++)for(let u=0;u<l.cellsLong;u++){const h=e.find(b=>b.sectionName===o.name);h.cells[l.cell.y+g][l.cell.x+u].hasItem=!0,h.cells[l.cell.y+g][l.cell.x+u].itemId=l.id}Ye(g=>[...g,l])}}function Bt(n){let e=[];return n.map(s=>e=[...e,...s]),e}function bn(n,e){let s=!1;return e.sections.forEach(a=>{a.booths.forEach(i=>{i.user?.id===n.id&&(s=!0)})}),s}function vt(n,e){console.log(n);const s=c?J.find(o=>o.sectionName===w).cells:E,a=s[n.y].length,i=s.length;if(console.log(a,i),n.x+e.cellsLong>a||n.y+e.cellsTall>i)return!1;const r=ye(n,S);if(!r&&!c&&(K!=="placing-sections"||!ne))return console.log("Item is out of bounds of any section"),!1;for(let o=0;o<e.cellsTall;o++)for(let l=0;l<e.cellsLong;l++){if(!c){const g=ye(new f({x:n.x+l,y:n.y+o}),S);if(!g&&(K!=="placing-sections"||!ne))return console.log("Item is out of bounds of any section"),!1;if(g?.name!=r?.name&&(K!=="placing-sections"||!ne))return console.log("Item is crossing section boundaries"),!1}if(s[n.y+o][n.x+l].hasItem&&s[n.y+o][n.x+l].itemId!=e.id){console.log("Something is already here");const g=O.find(u=>u.id==s[n.y+o][n.x+l].itemId);if(g&&g.isSectionModifier){if(g.sectionModifierType==="LeftDoor"||g.sectionModifierType==="RightDoor")return console.log("Item is on door of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),!1;if(g.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),l==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==e.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==0&&l==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==0&&l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==e.cellsTall-1&&l==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==e.cellsTall-1&&l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function Wt(n,e,s){console.log(e),console.log("CELLS",n);const a=n[e.y].length,i=n.length;if(console.log(a,i),e.x+s.cellsLong>a||e.y+s.cellsTall>i)return!1;const r=ye(e,S);if(!r&&!c&&(K!=="placing-sections"||!ne))return console.log("Item is out of bounds of any section"),!1;for(let o=0;o<s.cellsTall;o++)for(let l=0;l<s.cellsLong;l++){if(!c){const g=ye(new f({x:e.x+l,y:e.y+o}),S);if(!g&&(K!=="placing-sections"||!ne))return console.log("Item is out of bounds of any section"),!1;if(g?.name!=r?.name&&(K!=="placing-sections"||!ne))return console.log("Item is crossing section boundaries"),!1}if(n[e.y+o][e.x+l].hasItem&&n[e.y+o][e.x+l].itemId!=s.id){console.log("Something is already here");const g=O.find(u=>u.id==n[e.y+o][e.x+l].itemId);if(g&&g.isSectionModifier){if(g.sectionModifierType==="LeftDoor"||g.sectionModifierType==="RightDoor")return console.log("Item is on door of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),!1;if(g.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),l==s.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==s.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==0&&l==s.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==0&&l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==s.cellsTall-1&&l==s.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==s.cellsTall-1&&l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function Ot(n,e,s){const a=Array.from(c?J.find(o=>o.sectionName===w).cells:E);if(Ee(!0),s!=null){console.log("Removing item",e.id,"from cell",s.toId());const o=c?S.find(l=>l.name===w):ye(s,S);o.items=o.items.filter(l=>l.id!=e.id);for(let l=0;l<e.cellsTall;l++)for(let g=0;g<e.cellsLong;g++)a[s.y+l][s.x+g].hasItem=!1,a[s.y+l][s.x+g].itemId=""}const i=e.name+Math.floor(Math.random()*1e5).toString();if(K!=="placing-sections"||!ne){const o=c?S.find(g=>g.name===w):ye(n,S),l=new f({x:n.x-o.cellId.x,y:n.y-o.cellId.y});e.sectionCell=l,console.log("Adding item to section",o.name,"at",l,e),o.items.push(Ae?new I({...e,id:i}):e)}else e.sectionCell=new f({x:n.x,y:n.y});for(let o=0;o<e.cellsTall;o++)for(let l=0;l<e.cellsLong;l++)a[n.y+o][n.x+l].hasItem=!0,a[n.y+o][n.x+l].itemId=e.id;if(console.log(a),c){const o=J.find(l=>l.sectionName===w);o&&(o.cells=a.map(l=>l.map(g=>({...g}))),M([...J]))}else N(a);console.log("Removing item from inventory",e.name,e.hasMoved,e.starterItem);let r=!1;if(!e.hasMoved){console.log("INVENTORY ITEMs",oe);const o=oe.findIndex(l=>l.item.name==e.name&&!l.item.hasMoved);if(o!==-1){const l=[...oe];console.log("Found item in inventory",l[o]),l[o].quantity>0&&(l[o].quantity-=1,l[o].quantity<=0&&(r=!0,l.splice(o,1)),se(l))}else se(oe)}if(x(o=>(console.log("Placing item",e),console.log("Updating item",e.id),Ae&&he&&e.id==he.id?(console.log("Updating placing item",e.id),e.hasMoved=!0,e.starterItem=!0,e.isDisplayItem=!1,e.initialElement=document.querySelector(`.App #${n.toId()}.cell:not(.cell-border)`),console.log("New item id",i),[...o,new I({...e,hasMoved:!0,id:i})]):(o.find(l=>l.id==e.id).hasMoved||(o.find(l=>l.id==e.id).hasMoved=!0,o.find(l=>l.id==e.id).sectionCell=e.sectionCell),o))),Ae&&he&&r){Ne(null);return}}function jn(n){O.find(e=>e.name==n.name&&!e.hasMoved&&!e.starterItem)||x(e=>[...e,n])}d.useEffect(()=>{he?(console.log("Adding placing item",he.id),Me(he.id)):(console.log("Removing placing item",$e),Me(""))},[he]);function Gt(n){console.log("Removing item",n.id),x(e=>e.filter(s=>s.id!=n.id))}function Tn(n,e){const s=Array.from(c?J.find(o=>o.sectionName===w).cells:E);Ee(!0);const a=o=>{const l=o%2===1;return{cellsWide:l?n.cellsTall:n.cellsLong,cellsTall:l?n.cellsLong:n.cellsTall}},i=n.rotation||0,r=a(i);for(let o=0;o<r.cellsTall;o++)for(let l=0;l<r.cellsWide;l++)s[e.y+o][e.x+l].hasItem=!1,s[e.y+o][e.x+l].itemId="";if(c){const o=J.find(l=>l.sectionName===w);o&&(o.cells=s.map(l=>l.map(g=>({...g}))),M([...J])),M(l=>l.map(g=>g.sectionName===w?{...g,cells:s}:g))}else N(s);if(K!=="placing-sections"||!ne){const o=c?S.find(l=>l.name===w):ye(e,S);o.items=o.items.filter(l=>l.id!=n.id),console.log("DELETING ITEM section",n.id),console.log("SECTION ITEMS AFTER DELETE",o.items)}x(o=>(console.log("Removing item new",n.id),console.log("ITEMS AFTER REMOVE",o.filter(l=>l.id!=n.id)),o.filter(l=>l.id!=n.id))),se(o=>{const l=o.findIndex(g=>g.item.name==n.name&&!g.item.hasMoved);if(l!==-1){const g=[...o];return g[l].quantity>0&&(g[l].quantity+=1),g}else return[...o,new ue({item:new I({...n,hasMoved:!1}),quantity:1})]})}function Ln(n,e){const s=Array.from(c?J.find(g=>g.sectionName===w).cells:E);console.log("DELETING ITEM ROTATE",n.id,n.rotation),Ee(!0);const a=g=>{const u=g%2===1;return{cellsWide:u?n.cellsTall:n.cellsLong,cellsTall:u?n.cellsLong:n.cellsTall}},i=n.rotation||0,r=a(i);for(let g=0;g<r.cellsTall;g++)for(let u=0;u<r.cellsWide;u++)console.log("Deleting cell",e.y+g,e.x+u),s[e.y+g][e.x+u].hasItem=!1,s[e.y+g][e.x+u].itemId="";if(c){const g=J.find(u=>u.sectionName===w);g&&(g.cells=s.map(u=>u.map(h=>({...h}))),M([...J])),M(u=>u.map(h=>h.sectionName===w?{...h,cells:s}:h))}else N(s);console.log("DELETING ITEM",n.id);const o=c?S.find(g=>g.name===w):ye(e,S);o.items=o.items.filter(g=>g.id!=n.id);const l=new f({x:e.x-o.cellId.x,y:e.y-o.cellId.y});n.sectionCell=l,o.items.push(n)}function Ft(n,e){const s=c?J.find(r=>r.sectionName===w).cells:E,a=Array.from(s);if(s[n.y]==null){console.log("Start cell is out of bounds",n),St();return}const i=vt(n,e);a.forEach(r=>r.forEach(o=>{o.mouseOver=!1,o.canPlaceItem=!1,o.mouseOverLocation=""}));for(let r=0;r<e.cellsTall;r++)for(let o=0;o<e.cellsLong;o++)n.y+r<a.length&&n.x+o<a[n.y+r].length&&(e.cellsLong===1&&e.cellsTall===1?a[n.y+r][n.x+o].mouseOverLocation="single":e.cellsTall===1?o===0?a[n.y+r][n.x+o].mouseOverLocation="leftFull":o===e.cellsLong-1?a[n.y+r][n.x+o].mouseOverLocation="rightFull":a[n.y+r][n.x+o].mouseOverLocation="middleFull":e.cellsLong===1?r===0?a[n.y+r][n.x+o].mouseOverLocation="topFull":r===e.cellsTall-1?a[n.y+r][n.x+o].mouseOverLocation="bottomFull":a[n.y+r][n.x+o].mouseOverLocation="middleVFull":r===0&&o===0?a[n.y+r][n.x+o].mouseOverLocation="topLeftCorner":r===0&&o===e.cellsLong-1?a[n.y+r][n.x+o].mouseOverLocation="topRightCorner":r===e.cellsTall-1&&o===0?a[n.y+r][n.x+o].mouseOverLocation="bottomLeftCorner":r===e.cellsTall-1&&o===e.cellsLong-1?a[n.y+r][n.x+o].mouseOverLocation="bottomRightCorner":r===0?a[n.y+r][n.x+o].mouseOverLocation="top":r===e.cellsTall-1?a[n.y+r][n.x+o].mouseOverLocation="bottom":o===0?a[n.y+r][n.x+o].mouseOverLocation="left":o===e.cellsLong-1?a[n.y+r][n.x+o].mouseOverLocation="right":a[n.y+r][n.x+o].mouseOverLocation="middle",a[n.y+r][n.x+o].mouseOver=!0,a[n.y+r][n.x+o].canPlaceItem=i);if(c){const r=J.find(o=>o.sectionName===w);r&&(r.cells=a.map(o=>o.map(l=>({...l}))),M([...J])),M(o=>o.map(l=>l.sectionName===w?{...l,cells:a}:l))}else N(a)}function St(){console.log("Unhighlighting cells");const n=Array.from(c?J.find(e=>e.sectionName===w).cells:E);if(n.forEach(e=>e.forEach(s=>{s.mouseOver=!1,s.canPlaceItem=!1,s.mouseOverLocation=""})),c){const e=J.find(s=>s.sectionName===w);e&&(e.cells=n.map(s=>s.map(a=>({...a}))),M([...J])),M(s=>s.map(a=>a.sectionName===w?{...a,cells:n}:a))}else N(n)}d.useEffect(()=>{Sn(w,J,S)},[w]),d.useEffect(()=>{const n=()=>{const e=O.find(s=>s.id===y);console.log("Unselecting item",y),v(null),e&&(q(s=>[...s,e.id]),console.log("Unselecting item",e.id),setTimeout(()=>{q(s=>s.filter(a=>a!==e.id))},300))};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[y,O]);function Vt(n){v(null),q(e=>[...e,n]),console.log("Unselecting item",n),setTimeout(()=>{q(e=>e.filter(s=>s!==n))},300)}function Zt(n){const e=O.find(s=>s.id===y);console.log("Unselecting item",y),v(n),e&&(q(s=>[...s,e.id]),console.log("Unselecting item",e.id),setTimeout(()=>{q(s=>s.filter(a=>a!==e.id))},300))}function bt(n){se(e=>[...e,n])}const Fe=n=>{console.log("Preventing scroll"),n.preventDefault(),n.stopPropagation(),window.scrollTo(0,0)};d.useEffect(()=>(gt?(window.addEventListener("scroll",Fe),window.addEventListener("touchmove",Fe,{passive:!1})):(window.removeEventListener("scroll",Fe),window.removeEventListener("touchmove",Fe)),()=>{window.removeEventListener("scroll",Fe),window.removeEventListener("touchmove",Fe)}),[gt]);async function An(n){const e=[];Y(!0);for(const i of n){const r=i.name,o=new f({x:i.sectionCell.x,y:i.sectionCell.y}),l=new B({name:r,cellId:o,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:[],startingItems:[],items:[]});e.push(l)}let s=0,a=0;for(const i of e)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",i.cellsLong+i.cellId.x,"Current width:",s),i.cellsLong+i.cellId.x>s&&(console.log("Added section Width:",i.cellsLong+i.cellId.x),s+=i.cellsLong+i.cellId.x-s),console.log("Needed section Height:",i.cellsTall+i.cellId.y,"Current height:",a),i.cellsTall+i.cellId.y>a&&(console.log("Added section Height:",i.cellsTall+i.cellId.y),a+=i.cellsTall+i.cellId.y-a);await Yn(Z,Q,e,s,a),window.location.href=`/Layout/?companyId=${Z}&areaId=${Q}&type=create-area&stage=modify-sections`}async function Nn(n,e){const s=[];Y(!0);for(const a of e){const i=a.name,r=new f({x:a.cellId.x,y:a.cellId.y});console.log("Saving section modifier items for section",i,a.items.map(l=>l.name),"at cell",r);const o=new B({name:i,cellId:r,cellsLong:a.cellsLong,cellsTall:a.cellsTall,startingItems:[],items:[],modifierItems:a.items.map(l=>new z({cell:new f({x:l.sectionCell.x,y:l.sectionCell.y}),item:new I({...l,isSectionModifier:!0})}))});s.push(o)}console.log("Saving section modifier items",s),await Un(Z,Q,s),console.log("Section modifier items saved successfully"),window.location.href=`/Layout/?companyId=${Z}&areaId=${Q}&type=create-area&stage=placing-items`}async function Jt(n,e){Y(!0);const s=[];for(const a of n){const i=a.name,r=new f({x:a.cellId.x,y:a.cellId.y}),o=new B({name:i,cellId:r,cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(l=>new z({cell:new f({x:l.sectionCell.x,y:l.sectionCell.y}),item:new I({...l,starterItem:!0})})),items:[]});s.push(o)}console.log("Saving area sections",s),localStorage.setItem("screenshotSections",s.map(a=>JSON.stringify(a.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",s.map(a=>JSON.stringify(a.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),fe(!0),window.addEventListener("storage",async a=>{if(console.log("Storage event",a),a.key==="screenshot"){const i=new Hn({id:Q,name:nt.name,sections:s,templates:nt?.templates||[],previewImage:a.newValue,width:nt.width,height:nt.height,inventoryItems:e.map(r=>new ue({item:new I({...r.item,starterItem:!0}),quantity:r.quantity}))});await Xn(Z,i),console.log("Area saved successfully"),Y(!1),window.location.href=`/Layout/?companyId=${Z}&areaId=${Q}&type=view-area`}})}function Mn(n){const e=Array.from(c?J.find(s=>s.sectionName===w).cells:E);if(e[n.y]!=null)if(e[n.y][n.x].mouseOver=!0,e[n.y][n.x].canPlaceItem=!0,e[n.y][n.x].mouseOverLocation="single",Rt(s=>[...s,n]),c){const s=J.find(a=>a.sectionName===w);s&&(s.cells=e.map(a=>a.map(i=>({...i}))),M([...J])),M(a=>a.map(i=>i.sectionName===w?{...i,cells:e}:i))}else console.log("Adding highlighted cell",n.toId()),N(e)}function Cn(n){const e=Array.from(c?J.find(o=>o.sectionName===w).cells:E);Ee(!0);const s=[];un.forEach(o=>{s.some(l=>l.toId()===o.toId())||s.push(o)}),Rt([]);const a=[],i=oe.findIndex(o=>o.item.name==n.name&&!o.item.hasMoved);let r=i!==-1?oe[i].quantity:0;s.forEach(o=>{const l=new I({...n});if(l.id=l.name+Math.floor(Math.random()*1e5).toString(),console.log("Placing item",l.name,"at",o.toId(),"CAN PLACE?",Wt(e,o,l)),Wt(e,o,l)&&r!=0){if(i!==-1&&(r-=1),K!=="placing-sections"||!ne){const u=c?S.find(b=>b.name===w):ye(o,S);console.log("Adding item to section",u.name,"at",u.cellId,"with cell",o.toId(),o.x-u.cellId.x,o.y-u.cellId.y);const h=new f({x:o.x-u.cellId.x,y:o.y-u.cellId.y});l.sectionCell=h,console.log("Adding item to section",u.name,"at",h,l),u.items.push(l),console.log("SECTION ITEMS",u.items.map(b=>b.name))}else l.sectionCell=new f({x:o.x,y:o.y});for(let u=0;u<n.cellsTall;u++)for(let h=0;h<n.cellsLong;h++)e[o.y+u][o.x+h].hasItem=!0,e[o.y+u][o.x+h].itemId=l.id;l.hasMoved=!0,l.starterItem=!0,l.isDisplayItem=!1,l.initialElement=document.querySelector(`.App #${o.toId()}.cell:not(.cell-border)`);const g=new I({...l});a.push(g)}});for(const o of a)console.log("Adding item to items",o.id),x(l=>[...l,o]);if(i!==-1&&se(o=>{const l=[...o];return l[i].quantity>0&&(l[i].quantity=r,l[i].quantity==0&&l.splice(i,1)),l}),r==0&&Ne(null),c){const o=J.find(l=>l.sectionName===w);o&&(o.cells=e.map(l=>l.map(g=>({...g}))),M([...J])),M(l=>l.map(g=>g.sectionName===w?{...g,cells:e}:g))}else N(e);ce(S)}function En(n,e,s){Y(!0);const a=[];for(const i of n){const r=i.name,o=new f({x:i.cellId.x,y:i.cellId.y}),l=i.items.filter(h=>h.isBooth),g=i.items.filter(h=>!h.isBooth),u=new B({name:r,cellId:o,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:g.map(h=>new z({cell:new f({x:h.sectionCell.x,y:h.sectionCell.y}),item:new I({...h,displayItem:!0})})),booths:l.map(h=>new je({id:h.name+Math.floor(Math.random()*1e5).toString(),name:h.name,cell:new f({x:h.sectionCell.x,y:h.sectionCell.y}),cellsLong:h.cellsLong,cellsTall:h.cellsTall,user:h.boothUser})),items:[]});a.push(u)}console.log("Saving area sections",a),localStorage.setItem("screenshotSections",a.map(i=>JSON.stringify(i.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",a.map(i=>JSON.stringify(i.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),fe(!0),window.addEventListener("storage",async i=>{if(console.log("Storage event",i),i.key==="screenshot"){const r=new ke({id:s.id,name:s.name,sections:a,areaId:Q,previewImage:i.newValue,inventoryItems:e.map(o=>new ue({item:new I({...o.item,starterItem:!0}),quantity:o.quantity}))});await De(Z,r),console.log("Booth Map saved successfully"),Y(!1),window.location.href=`/Layout/?companyId=${Z}&areaId=${Q}&type=view-boothMap&boothMapId=${Ct}`}})}return console.log("RENDERING APP",!(ne&&K!="placing-items")),t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"App",children:[t.jsx("h1",{className:"title",children:"LayItOut"}),t.jsx("br",{}),Qe&&t.jsxs("div",{className:"area-creation",children:[ut?t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"area-creation-title",children:"You have already picked a booth"}),t.jsxs("label",{htmlFor:"",children:["Contact ",sn?.supportEmail," to change booths"]})]}):t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"area-creation-title",children:"Picking Booth"}),t.jsx("label",{htmlFor:"",children:"Tap on an open booth then click on the checkmark to pick a booth"})," "]}),t.jsxs("label",{htmlFor:"",children:["Booth Size: ",be?.plotWidth,"ft x ",be?.plotHeight,"ft"]}),t.jsx("br",{})]}),et&&t.jsxs("div",{className:"area-creation",children:[t.jsx("h2",{className:"area-creation-title",children:"Create Booth Map"}),t.jsx("label",{htmlFor:"",children:"Create a booth map by placing items and then creating and placing booths, same way you create and place items"})]}),ne&&t.jsxs("div",{className:"area-creation",children:[t.jsx("h2",{className:"area-creation-title",children:"Create Area"}),t.jsx("label",{htmlFor:"",children:K=="placing-sections"?"Create new sections and place them":K=="modify-sections"?"Add walls and doors to sections":"Add items to the inventory and place items"})]}),(W||X)&&t.jsxs("div",{className:"template-name-row",children:[t.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),t.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:n=>Mt(n.target.value),value:Ge})]}),(pe||We)&&t.jsxs("div",{className:"design-name-row",children:[t.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",Oe]}),pe&&Re&&t.jsxs("p",{children:["Design was submitted on ",kt?.toLocaleDateString()]})]}),(W||X)&&t.jsxs("div",{className:"template-creation",children:[t.jsxs("button",{className:"action-btn",onClick:()=>{if(Ge.trim()==""){alert("Please enter a template name");return}if(ve.some(n=>n.name===Ge&&(X?n.id!==Et.id:!0))){alert("Template with this name already exists");return}X?(Y(!0),setTimeout(async()=>{const n=S.map(e=>new B({name:e.name,cellId:new f({x:$.find(s=>s.name==e.name).cellId.x,y:$.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new z({cell:new f({x:s.sectionCell.x,y:s.sectionCell.y}),item:new I({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),fe(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){fe(!1);const s=ve.map(a=>a.id===Et.id?(console.log("SECTION",S),new xe({name:Ge,inventoryItems:oe,previewImage:e.newValue,sections:S.map(i=>new B({name:i.name,cellId:new f({x:a.sections.find(r=>r.name==i.name).cellId.x,y:a.sections.find(r=>r.name==i.name).cellId.y}),cellsLong:i.cellsLong,modifierItems:i.modifierItems,cellsTall:i.cellsTall,startingItems:i.items.map(r=>new z({cell:new f({x:r.sectionCell.x,y:r.sectionCell.y}),item:new I({...r,starterItem:!0})}))})),id:a.id})):new xe({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(i=>new B({name:i.name,cellId:new f({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(r=>new z({cell:new f({x:r.cell.x,y:r.cell.y}),item:new I({...r.item})}))})),id:a.id}));qe(Z,Q,s).then(()=>{console.log("Template updated successfully"),Y(!1);const a=new URLSearchParams(window.location.search),i=a.get("companyId"),r=a.get("areaId");window.location.href=`/Layout/?companyId=${i}&areaId=${r}&type=view-area`})}})},500)):(Y(!0),setTimeout(async()=>{const n=S.map(e=>new B({name:e.name,cellId:new f({x:$.find(s=>s.name==e.name).cellId.x,y:$.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new z({cell:new f({x:s.sectionCell.x,y:s.sectionCell.y}),item:new I({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),fe(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){fe(!1);const s=new xe({name:Ge,previewImage:e.newValue,inventoryItems:oe,sections:S.map(i=>new B({name:i.name,cellId:new f({x:$.find(r=>r.name==i.name).cellId.x,y:$.find(r=>r.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.items.map(r=>new z({cell:new f({x:r.sectionCell.x,y:r.sectionCell.y}),item:new I({...r,starterItem:!0})}))})),id:Ge+(Math.random()*1e4).toString()}),a=[...ve.map(i=>new xe({name:i.name,previewImage:i.previewImage,inventoryItems:i.inventoryItems,sections:i.sections.map(r=>new B({name:r.name,cellId:new f({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,modifierItems:r.modifierItems,startingItems:r.startingItems.map(o=>new z({cell:new f({x:o.cell.x,y:o.cell.y}),item:new I({...o.item})}))})),id:i.id})),s];qe(Z,Q,a).then(()=>{console.log("Template updated successfully"),Y(!1);const i=new URLSearchParams(window.location.search),r=i.get("companyId"),o=i.get("areaId");window.location.href=`/Layout/?companyId=${r}&areaId=${o}&type=view-area`})}})},500))},children:[W?"Create":"Save"," Template"]}),t.jsx("button",{className:"action-btn",onClick:()=>{const n=new URLSearchParams(window.location.search),e=n.get("companyId"),s=n.get("areaId");window.location.href=`/Layout/?companyId=${e}&areaId=${s}&type=view-area`},children:"Cancel"})]}),Be&&!Re&&t.jsxs("div",{className:"template-creation",children:[fn&&t.jsx("button",{className:"action-btn",onClick:()=>{Y(!0),setTimeout(async()=>{const n=S.map(e=>new B({name:e.name,cellId:new f({x:$.find(s=>s.name==e.name).cellId.x,y:$.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new z({cell:new f({x:s.sectionCell.x,y:s.sectionCell.y}),item:new I({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),fe(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){fe(!1);const s=new jt({name:Oe,previewImage:e.newValue,submitted:!1,dateSubmitted:null,areaId:Q,inventoryItems:oe,sections:S.map(a=>new B({name:a.name,cellId:new f({x:$.find(i=>i.name==a.name).cellId.x,y:$.find(i=>i.name==a.name).cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(i=>new z({cell:new f({x:i.sectionCell.x,y:i.sectionCell.y}),item:new I({...i,starterItem:!0})}))})),id:lt});Tt(Z,Q,s).then(()=>{console.log("Design updated successfully"),Ee(!1),Y(!1)})}})},500)},children:"Save"}),t.jsx("button",{className:"action-btn",onClick:()=>{Y(!0),setTimeout(async()=>{const n=S.map(e=>new B({name:e.name,cellId:new f({x:$.find(s=>s.name==e.name).cellId.x,y:$.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new z({cell:new f({x:s.sectionCell.x,y:s.sectionCell.y}),item:new I({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),fe(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){fe(!1);const s=new jt({name:Oe,previewImage:e.newValue,submitted:!0,dateSubmitted:new Date,areaId:Q,inventoryItems:oe,sections:S.map(a=>new B({name:a.name,cellId:new f({x:$.find(i=>i.name==a.name).cellId.x,y:$.find(i=>i.name==a.name).cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(i=>new z({cell:new f({x:i.sectionCell.x,y:i.sectionCell.y}),item:new I({...i,starterItem:!0})}))})),id:lt});Tt(Z,Q,s).then(()=>{console.log("Design updated successfully"),Ee(!1),Y(!1),Pt(!0),Dt(new Date)})}})},500)},children:"Submit"})]}),Be&&Re&&t.jsxs("div",{className:"area-creation",children:[t.jsxs("label",{htmlFor:"",children:["Design was submitted on ",kt?.toLocaleDateString()]}),t.jsx("br",{})]}),!pe&&!Xe&&!Se&&!Qe&&!We&&!(Re&&Be)&&t.jsxs("div",{className:"place-mode-row",children:[t.jsx("label",{htmlFor:"tap-and-place-mode",children:"Place Mode: "}),t.jsxs("select",{id:"tap-and-place-mode",name:"tap-and-place-mode",value:Ae?"tap":"drag",onChange:n=>Lt(n.target.value==="tap"),className:"place-mode-select",children:[t.jsx("option",{value:"drag",children:"Drag and Drop"}),t.jsx("option",{value:"tap",children:"Tap and Place"})]})]}),mt&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader-backdrop",children:t.jsx("div",{className:"loader"})})})," ",t.jsxs("div",{className:"layout",children:[!pe&&!Xe&&!Se&&!Qe&&!We&&!(Re&&Be)&&t.jsx(Kn,{setSelectedItem:Ne,tapAndPlaceMode:Ae,isModifyingSections:ne&&K=="modify-sections",isViewingDesign:pe,isEditingTemplate:X,isCreatingTemplate:W,maxHeight:c?200:j*D,showAddCustomItem:()=>{K=="placing-sections"&&ne?pt.current?.showModal():K=="placing-items"&&ne||dt?It.current?.showModal():ht.current?.showModal()},addDraggingItem:jn,removeItem:Gt,inventoryItems:oe.map(n=>new ue({item:new I({...n.item,displayItem:!0}),quantity:n.quantity}))}),Se&&le?t.jsx(rl,{onDeleteVendor:async n=>{Y(!0);const e=new ke({...le,vendors:le.vendors.filter(s=>s.id!==n),sections:le.sections.map(s=>new B({...s,booths:s.booths.map(a=>a.user?.id===n?new je({...a,user:null,initialElement:a.initialElement??void 0}):a)}))});await De(Z,e),Ce(e),window.location.reload()},onEditVendor:n=>{wn(n),yt.current?.showModal()},boothMap:le,vendors:le?.vendors??[],maxHeight:c?void 0:j*D,onAddVendor:()=>{wt.current?.showModal()}}):null,c?t.jsxs("div",{className:"mobile-areas",style:{height:U+"px"},children:[S.length>1&&t.jsx("img",{src:at,onClick:()=>{const n=S.findIndex(s=>s.name==w);if(n===-1)return;const e=(n-1+S.length)%S.length;te(S[e].name),console.log("Changing viewing section to",S[e].name)},className:"back-mobile-areas"}),Ue.map((n,e)=>t.jsx(Ut,{width:n.width,height:n.height,cells:Bt(J.find(s=>s.sectionName==n.sectionName).cells),id:n.sectionName,visibile:w==null?!0:n.sectionName==w,section:n.sectionName},e)),S.length>1&&t.jsx("img",{src:at,onClick:()=>{const n=S.findIndex(s=>s.name==w);if(n===-1)return;const e=(n+1)%S.length;te(S[e].name),console.log("Changing viewing section to",S[e].name)},className:"forward-mobile-areas"})]}):t.jsx(Ut,{width:V*D,height:j*D,cells:Bt(E)}),(K=="placing-items"||!ne)&&t.jsx(gl,{maxHeight:c?void 0:j*D})]}),Se&&t.jsx("div",{className:"design-view",children:t.jsx("button",{className:"action-btn",onClick:()=>{const n=S.map(e=>new B({name:e.name,cellId:new f({x:$.find(s=>s.name==e.name).cellId.x,y:$.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,booths:e.booths,startingItems:e.items.map(s=>new z({cell:new f({x:s.sectionCell.x,y:s.sectionCell.y}),item:new I({...s,starterItem:!0})}))}));localStorage.setItem("printSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/Print/?companyId=${Z}&areaId=${Q}&designName=${le?.name}`,"_blank")},children:"Print"})}),pe&&t.jsxs("div",{className:"design-view",children:[t.jsx("button",{className:"action-btn",onClick:()=>{const n=S.map(e=>new B({name:e.name,cellId:new f({x:$.find(s=>s.name==e.name).cellId.x,y:$.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,booths:e.booths,startingItems:e.items.map(s=>new z({cell:new f({x:s.sectionCell.x,y:s.sectionCell.y}),item:new I({...s,starterItem:!0})}))}));localStorage.setItem("printSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/Print/?companyId=${Z}&areaId=${Q}&designName=${Oe}&designId=${lt}`,"_blank")},children:"Print"}),t.jsx("button",{className:"action-btn",onClick:()=>{const n=new xe({name:Oe,previewImage:tt.previewImage,inventoryItems:tt.inventoryItems,sections:tt.sections,id:tt.name+(Math.random()*1e4).toString()}),e=[...ve.map(s=>new xe({name:s.name,previewImage:s.previewImage,inventoryItems:s.inventoryItems,sections:s.sections.map(a=>new B({name:a.name,cellId:new f({x:a.cellId.x,y:a.cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.startingItems.map(i=>new z({cell:new f({x:i.cell.x,y:i.cell.y}),item:new I({...i.item})}))})),id:s.id})),n];qe(Z,Q,e).then(()=>{console.log("Template updated successfully"),Pe(e),window.location.href=`/Layout/?companyId=${Z}&areaId=${Q}&type=edit-template&templateId=${n.id}`})},children:"Turn into a Template"}),t.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/?view=desings"},children:"Back"})]}),Se&&t.jsx("div",{className:"design-view",children:t.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/?view=boothmaps"},children:"Back"})}),Xe&&t.jsxs("div",{className:"design-view",children:[t.jsx("button",{className:"action-btn",onClick:()=>{window.location.href=`/Layout/?companyId=${Z}&areaId=${Q}&type=edit-area`},children:"Edit Area"}),t.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/?view=areas"},children:"Back"})]}),dt&&t.jsxs("div",{className:"design-view",children:[t.jsx("button",{className:"action-btn",onClick:async()=>{await Jt(S,oe)},children:"Save Area"}),t.jsx("button",{className:"action-btn",onClick:async()=>{Y(!0),window.location.href=`/Layout/?companyId=${Z}&areaId=${Q}&type=view-area`},children:"Back"})]}),ne&&t.jsxs("div",{className:"design-view",children:[t.jsx("button",{className:"action-btn",onClick:()=>{K=="placing-sections"?An(O.filter(n=>n.isSectionItem)):K=="modify-sections"?Nn(O.filter(n=>n.isSectionModifier),S):K=="placing-items"&&Jt(S,oe)},children:K=="placing-items"?"Create Area":"Next"}),t.jsx("button",{className:"action-btn",onClick:async()=>{Y(!0),await Gn(Z,Q),window.location.href="/"},children:"Cancel"})]}),et&&t.jsxs("div",{className:"design-view",children:[t.jsx("button",{className:"action-btn",onClick:()=>{console.log("Creating booth map with sections",S,"and inventory items",oe,"and boothMap",le),En(S,oe,le)},children:"Create Booth Map"}),t.jsx("button",{className:"action-btn",onClick:async()=>{Y(!0),await Fn(Z,Q,Ct),window.location.href="/?view=boothmaps"},children:"Cancel"})]})]}),t.jsxs("div",{children:[S.map(n=>t.jsx(Pn,{takingPhoto:!1,section:n,visible:w==null?!0:n.name==w,cellSize:D},n.cellId.toId())),O.map(n=>t.jsx(Bn,{isPlacingItem:he!=null,isCreatingArea:ne,isCreatingTemplate:W||X,cellSize:D,isViewingDesign:pe||Xe||Se||Qe||We||Re&&Be,removeItem:Gt,visible:c?!n.hasMoved&&!n.starterItem?!0:w==null?!1:n.isSectionModifier?S.find(e=>e.name==w)?.modifierItems.some(e=>e.item.id===n.id):n.starterItem?S.find(e=>e.name==w)?.startingItems.some(e=>e.item.id===n.id):S.find(e=>e.name==w)?.items.some(e=>e.id===n.id):!0,item:n,canPlaceItem:vt,placeItem:Ot,deleteItemRotate:Ln,highlightCells:Ft,unHighlightCells:St,deleteItem:Tn,isSelected:y===n.id,onSelect:Zt,isUnselecting:H.includes(n.id),onDeselect:()=>Vt(n.id)},n.id)),ct.map(n=>(console.log("CAN PICK BOOTH",n.cellsLong==be?.plotWidth&&n.cellsTall==be.plotHeight,"BOOTH",n,"VENDOR",be),t.jsx(Wn,{canPick:Se||ut||n.cellsLong==be?.plotWidth&&n.cellsTall==be.plotHeight,visible:c?w==null?!1:S.find(e=>e.name==w)?.booths.some(e=>e.id===n.id)??!1:!0,booth:n,isViewingBooth:Se,isPublicViewingBooth:We,hasPickedBooth:ut,isSelected:y==n.id,cellSize:D,onSelect:Zt,isUnselecting:H.includes(n.id),onDeselect:()=>Vt(n.id),onPickBooth:async e=>{Y(!0);const s=S.map(i=>i.name===w?new B({...i,booths:i.booths.map(r=>r.id===e?new je({...r,user:be,initialElement:r.initialElement??void 0}):r)}):i.booths.some(r=>r.id===e)?new B({...i,booths:i.booths.map(r=>r.id===e?new je({...r,user:be,initialElement:r.initialElement??void 0}):r)}):i);console.log("Updated sections",s),ce(s);const a=new ke({...le,sections:s});await De(Z,a),window.location.reload(),Y(!1)},onRemoveVendorFromBooth:()=>{Y(!0);const e=S.map(a=>new B({...a,booths:a.booths.map(i=>i.user?.id===n.user?.id?new je({...i,user:null,initialElement:i.initialElement??void 0}):i)})),s=new ke({...le,sections:e});De(Z,s).then(()=>{window.location.reload()})},onAddVendorToBooth:()=>{yn(n),xt.current?.showModal()}},n.id)))]}),c&&!mt&&t.jsx("div",{className:"layout-icon",onClick:()=>{Ze.current?.showModal(),Je(!0),console.log("Showing layout dialog")},children:t.jsx("img",{src:el,alt:""})}),!mt&&!(W||dt||X||pe||et||ne||Se||Qe||We||Re&&Be)&&t.jsx("div",{className:"template-icon",onClick:()=>{Ie.current?.showModal(),Le(!0),console.log("Showing template dialog")},children:t.jsx("img",{src:tl,alt:""})}),t.jsx(nl,{isViewingArea:Xe,dialogRef:Ie,isOpen:Te,closeDialog:()=>{Ie.current?.close(),Le(!1)},duplicateTemplate:n=>{const e=new xe({name:n.name+" Copy",previewImage:n.previewImage,inventoryItems:n.inventoryItems,sections:n.sections,id:n.name+"Copy"+(Math.random()*1e4).toString()}),s=[...ve.map(a=>new xe({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(i=>new B({name:i.name,cellId:new f({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(r=>new z({cell:new f({x:r.cell.x,y:r.cell.y}),item:new I({...r.item})}))})),id:a.id})),e];qe(Z,Q,s).then(()=>{Ie.current?.close(),console.log("Template updated successfully"),Pe(s),Le(!1),window.location.href=`/Layout/?companyId=${Z}&areaId=${Q}&type=edit-template&templateId=${e.id}`})},templates:ve,selectTemplate:n=>{Y(!0),setTimeout(async()=>{const e=n.sections.map(s=>new B({name:s.name,cellId:new f({x:n.sections.find(a=>a.name==s.name).cellId.x,y:n.sections.find(a=>a.name==s.name).cellId.y}),cellsLong:s.cellsLong,cellsTall:s.cellsTall,modifierItems:s.modifierItems,startingItems:s.startingItems.map(a=>new z({cell:new f({x:a.cell.x,y:a.cell.y}),item:new I({...a.item,starterItem:!0})}))}));localStorage.setItem("screenshotSections",e.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),fe(!0),window.addEventListener("storage",async s=>{if(console.log("Storage event",s),s.key==="screenshot"){fe(!1);const a=new jt({name:Oe,previewImage:s.newValue,areaId:Q,submitted:!1,dateSubmitted:null,inventoryItems:n.inventoryItems,sections:n.sections.map(i=>new B({name:i.name,cellId:new f({x:n.sections.find(r=>r.name==i.name).cellId.x,y:n.sections.find(r=>r.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(r=>new z({cell:new f({x:r.cell.x,y:r.cell.y}),item:new I({...r.item,starterItem:!0})}))})),id:lt});console.log("UPDATED DESIGN",a),Tt(Z,Q,a).then(()=>{console.log("Design updated successfully"),Ee(!1),Y(!1),window.location.reload()})}})},500)}}),t.jsx(_n,{dialogRef:Ze,closeDialog:()=>{Ze.current?.close(),Je(!1)},areaPreview:mn||""}),t.jsx(ll,{canBeBooth:et,dialogRef:ht,addInventoryItem:bt,closeDialog:()=>{ht.current?.close()}}),t.jsx(ol,{dialogRef:pt,closeDialog:()=>{pt.current?.close()},addSection:bt}),t.jsx(sl,{dialogRef:It,closeDialog:()=>{It.current?.close()},addInventoryItem:bt}),t.jsx(il,{placeMultiItem:Cn,addHighlightedCell:Mn,item:he,setSelectingItem:()=>{Ne(null)},canPlaceItem:vt,placeItem:Ot,highlightCells:Ft,unHighlightCells:St,cellSize:D}),t.jsx(dl,{dialogRef:wt,closeDialog:()=>{wt.current?.close()},addVendor:async n=>{const e=new ke({...le,vendors:[...le.vendors,n]});Ce(e),await De(Z,e)}}),t.jsx(ml,{oldVendor:In,dialogRef:yt,closeDialog:()=>{yt.current?.close()},editVendor:async n=>{const e=new ke({...le,vendors:le.vendors.map(s=>s.id===n.id?n:s)});Ce(e),await De(Z,e)}}),t.jsx(ul,{dialogRef:xt,vendors:le?.vendors.filter(n=>!bn(n,le))??[],closeDialog:()=>{xt.current?.close()},addVendorToBooth:async n=>{Y(!0);const e=S.map(a=>a.name===w?new B({...a,booths:a.booths.map(i=>i.id===ft.id?new je({...i,user:n,initialElement:i.initialElement??void 0}):i)}):a.booths.some(i=>i.id===ft.id)?new B({...a,booths:a.booths.map(i=>i.id===ft.id?new je({...i,user:n,initialElement:i.initialElement??void 0}):i)}):a);console.log("Updated sections",e),ce(e);const s=new ke({...le,sections:e});await De(Z,s),window.location.reload(),Y(!1)}}),gt&&t.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:window.location.origin+"/Preview/",width:C*D+20,height:F*D+20})]})}
