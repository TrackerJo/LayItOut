import{c as tl,j as r,r as g}from"./index-QIV6qY6h.js";import{A as Se,S as ol,D as sl}from"./section-Bs7d8TSU.js";import{T as F,S as b,C as f,b as j,I as T,s as be,D as al,u as cl,e as ie,f as il}from"./firestore-FyM7zbDZ.js";import{T as ml,F as Ee,L as rl,a as dl,b as gl,c as ul,A as Il}from"./add_custom_item_dialog-DU3zotvu.js";tl.createRoot(document.getElementById("root")).render(r.jsx(fl,{}));function fl(){const[i,yl]=g.useState(!1),[me,Ne]=g.useState(0),[Z,je]=g.useState(0),[D,O]=g.useState([]),[W,R]=g.useState([]),[De,Oe]=g.useState(0),[P,_]=g.useState(null),[Ae,M]=g.useState([]),x=10,[G,H]=g.useState([]),ee=g.useRef(null),[Re,re]=g.useState(!1),[B,le]=g.useState([]),[I,V]=g.useState([]),[K,de]=g.useState([]),[Pe,ge]=g.useState(!1),ne=g.useRef(null),[Me,ue]=g.useState([]),[S,C]=g.useState([]),[p,Q]=g.useState(null),[z,Ie]=g.useState(!1),[k,ke]=g.useState(!1),[U,Ue]=g.useState(!1),[$e,qe]=g.useState(!1),[pl,Fe]=g.useState(!1),[We,He]=g.useState(!1),[te,oe]=g.useState(""),[$,fe]=g.useState(""),[X,Be]=g.useState(""),[J,Ve]=g.useState(""),[ye,se]=g.useState(""),[ae,E]=g.useState(!0),[pe,Ce]=g.useState(null),[we,N]=g.useState(!1),ce=g.useRef(null);function Y(e,t){for(const c of t)if(e.x>=c.cellId.x&&e.x<c.cellId.x+c.cellsLong&&e.y>=c.cellId.y&&e.y<c.cellId.y+c.cellsTall)return c;return null}function ze(e){le([...e.map(a=>new b({name:a.name,cellId:new f({x:a.cellId.x/2,y:a.cellId.y/2}),cellsLong:a.cellsLong/2,cellsTall:a.cellsTall/2,startingItems:[]}))]);let t=me,c=Z;if(i){let a=0;const o=[],n=[];for(const l of e){const s=[],d={width:l.cellsLong*x,height:l.cellsTall*x,sectionName:l.name};d.height>a&&(a=d.height),ue(L=>[...L,d]),l.cellId.x=0,l.cellId.y=0,[...Array(d.height/x).keys()].map(L=>{const y=[];[...Array(d.width/x).keys()].map(w=>{y.push({id:new f({x:w,y:L}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:x})}),s.push(y)}),o.push({sectionName:l.name,cells:[...s]}),n.push(l)}C(o),V(n),Oe(a),Q(e[0]?e[0].name:null),setTimeout(()=>{E(!1)},500)}else{const a=[];for(const o of e)console.log("Generating cells for section",o.name,"at",o.cellId,"with size",o.cellsLong,"x",o.cellsTall),console.log("Needed section Width:",(o.cellsLong+o.cellId.x)*x,"Current width:",t),(o.cellsLong+o.cellId.x)*x>t&&(console.log("Added section Width:",o.cellsLong*x+o.cellId.x),t+=(o.cellsLong+o.cellId.x)*x-t),console.log("Needed section Height:",(o.cellsTall+o.cellId.y)*x,"Current height:",c),(o.cellsTall+o.cellId.y)*x>c&&(console.log("Added section Height:",o.cellsTall*x+o.cellId.y),c+=(o.cellsTall+o.cellId.y)*x-c);Ne(t),je(c),[...Array(c/x).keys()].map(o=>{const n=[];[...Array(t/x).keys()].map(l=>{n.push({id:new f({x:l,y:o}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:Y(new f({x:l,y:o}),e)!=null,size:x})}),a.push(n)}),O([...a]),setTimeout(()=>{const o=[],n=[...e];for(const l of n)l.cellElement=document.querySelector(`.App #${l.cellId.toId()}.cell:not(.cell-border)`),o.push(...l.startingItems.map(s=>new j({cell:new f({x:l.cellId.x+s.cell.x,y:l.cellId.y+s.cell.y}),item:new T({id:s.item.id,name:s.item.name,cellsLong:s.item.cellsLong,cellsTall:s.item.cellsTall,icon:s.item.icon,initialElement:document.querySelector(`.App #${s.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:s.item.moveable,rotation:s.item.rotation||0})})));V([...n]);for(const l of o){const s=y=>{const w=y%2===1;return{cellsLong:w?l.item.cellsTall:l.item.cellsLong,cellsTall:w?l.item.cellsLong:l.item.cellsTall}},d=l.item.rotation||0,L=s(d);for(let y=0;y<L.cellsTall;y++)for(let w=0;w<L.cellsLong;w++)a[l.cell.y+y][l.cell.x+w].hasItem=!0,a[l.cell.y+y][l.cell.x+w].itemId=l.item.id;l.item.initialElement=document.querySelector(`.App #${l.cell.toId()}.cell:not(.cell-border)`),R(y=>[...y,l.item])}O([...a]),setTimeout(()=>{E(!1),Je()},500)},100)}}async function Je(e,t){E(!0),N(!0),setTimeout(async()=>{const c=document.getElementById("capture"),a=await domtoimage.toPng(c);N(!1),localStorage.setItem("screenshot",a),window.close()},500)}async function Ye(){const e=new URLSearchParams(window.location.search),t=e.get("companyId"),c=e.get("areaId"),a=e.get("areaId")||"",o=e.get("companyId")||"",n=e.get("templateId")||"",l=await il(o,a),s=e.get("type")||"";if(s==="create-template")Ie(!0);else if(s==="edit-template"){ke(!0);const m=l.templates.find(u=>u.id===n);m&&(Ce(m),fe(m.name))}else if(s==="view-design"){Ue(!0);const m=e.get("designName")||"";oe(m);const u=e.get("designId")||"";se(u)}else if(s==="view-area")qe(!0);else if(s==="edit-design"){Fe(!0);const m=e.get("designName")||"";oe(m);const u=e.get("designId")||"";se(u)}else if(s==="client-edit-design"){He(!0);const m=e.get("designName")||"";oe(m);const u=e.get("designId")||"";se(u)}t&&Be(t),c&&Ve(c),H(l.inventoryItems.map(m=>new ie({item:new T({id:m.item.id,name:m.item.name,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,initialElement:m.item.initialElement,moveable:m.item.moveable,starterItem:m.item.starterItem,displayItem:!0}),quantity:m.quantity})));const d=[],L=[];for(const m of l.templates){const u=[],ve=[];for(const v of m.sections)u.push(new b({name:v.name,cellId:new f({x:v.cellId.x/(i?20:10),y:v.cellId.y/(i?20:10)}),cellsLong:v.cellsLong/(i?20:10),cellsTall:v.cellsTall/(i?20:10),startingItems:v.startingItems.map(h=>new j({cell:new f({x:h.cell.x/(i?2:1),y:h.cell.y/(i?2:1)}),item:new T({id:h.item.id,name:h.item.name,cellsLong:h.item.cellsLong/2,cellsTall:h.item.cellsTall/2,icon:h.item.icon,starterItem:!0,moveable:h.item.moveable,rotation:h.item.rotation||0})}))})),ve.push(new b({name:v.name,cellId:new f({x:v.cellId.x,y:v.cellId.y}),cellsLong:v.cellsLong,cellsTall:v.cellsTall,startingItems:v.startingItems.map(h=>new j({cell:new f({x:h.cell.x,y:h.cell.y}),item:new T({id:h.item.id,name:h.item.name,cellsLong:h.item.cellsLong,cellsTall:h.item.cellsTall,icon:h.item.icon,starterItem:!0,moveable:h.item.moveable,rotation:h.item.rotation||0})}))}));d.push(new F({name:m.name,sections:u,id:m.id,previewImage:m.previewImage})),L.push(new F({name:m.name,sections:ve,id:m.id,previewImage:m.previewImage}))}de([...d]);const y=[],w=n===""?void 0:L.find(m=>m.id===n);console.log("TEMPLATE",w,"AREA",l);let A=localStorage.getItem("screenshotSections");console.log("Screenshot sections from localStorage",A),A=A?.split("LAYOUTSEPARATOR")||"";const q=[];for(const m of A)q.push(b.fromJSON(m));le([...q]),V([...q.map(m=>new b({name:m.name,cellId:new f({x:m.cellId.x/10,y:m.cellId.y/10}),cellsLong:m.cellsLong/10,cellsTall:m.cellsTall/10,startingItems:m.startingItems,items:m.startingItems.map(u=>new T({id:u.item.id,name:u.item.name,sectionCell:u.cell,cellsLong:u.item.cellsLong,cellsTall:u.item.cellsTall,icon:u.item.icon,moveable:u.item.moveable,starterItem:u.item.starterItem,rotation:u.item.rotation}))}))]),y.push(...q.map(m=>new b({name:m.name,cellId:new f({x:m.cellId.x/10,y:m.cellId.y/10}),cellsLong:m.cellsLong/10,cellsTall:m.cellsTall/10,startingItems:m.startingItems,items:m.startingItems.map(u=>new T({id:u.item.id,name:u.item.name,sectionCell:u.cell,cellsLong:u.item.cellsLong,cellsTall:u.item.cellsTall,icon:u.item.icon,moveable:u.item.moveable,starterItem:u.item.starterItem,rotation:u.item.rotation}))}))),console.log("SECTIONS TO GENERATE",y),ze(y)}g.useEffect(()=>{Ye()},[]);function Ge(e,t,c){if(!i||e==null)return;const a=[...c],o=[],n=c.find(l=>l.name==e);console.log("NEW SECTION",n),console.log("Adding section",n.name,n.cellId),console.log("MOBILE CELLS",t),n.cellElement=document.querySelector(`.App #${n.name.split(" ").join("-")} #${n.name.split(" ").join("")}${n.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",n.cellElement);for(const l of n.startingItems){console.log("Placing starting item",l.item.name,l.cell);const s=y=>{const w=y%2===1;return{cellsLong:w?l.item.cellsTall:l.item.cellsLong,cellsTall:w?l.item.cellsLong:l.item.cellsTall}},d=l.item.rotation||0,L=s(d);for(let y=0;y<L.cellsTall;y++)for(let w=0;w<L.cellsLong;w++){const A=t.find(q=>q.sectionName===n.name);A.cells[l.cell.y+y][l.cell.x+w].hasItem=!0,A.cells[l.cell.y+y][l.cell.x+w].itemId=l.item.id}l.item.initialElement=document.querySelector(`.App #${n.name.split(" ").join("-")} #${n.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",l.item.initialElement),o.push(new T({id:l.item.id,name:l.item.name,cellsLong:l.item.cellsLong,cellsTall:l.item.cellsTall,icon:l.item.icon,initialElement:l.item.initialElement,starterItem:!0,moveable:l.item.moveable,rotation:l.item.rotation}))}console.log("Setting sections",a),V([...a]),console.log("ITEMS",o),R(l=>[...l.filter(d=>!o.some(L=>L.id===d.id)),...o.map(d=>new T({id:d.id,name:d.name,cellsLong:d.cellsLong,cellsTall:d.cellsTall,icon:d.icon,initialElement:d.initialElement,starterItem:!0,moveable:d.moveable,rotation:d.rotation}))])}function he(e){let t=[];return e.map(c=>t=[...t,...c]),t}function xe(e,t){console.log(e);const c=i?S.find(l=>l.sectionName===p).cells:D,a=c[e.y].length,o=c.length;if(console.log(a,o),e.x+t.cellsLong>a||e.y+t.cellsTall>o)return!1;const n=Y(e,I);if(!n&&!i)return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<t.cellsTall;l++)for(let s=0;s<t.cellsLong;s++){if(!i){const d=Y(new f({x:e.x+s,y:e.y+l}),I);if(!d)return console.log("Item is out of bounds of any section"),!1;if(d.name!=n.name)return console.log("Item is crossing section boundaries"),!1}if(c[e.y+l][e.x+s].hasItem&&c[e.y+l][e.x+s].itemId!=t.id)return console.log("Something is already here"),!1}return!0}function Ke(e,t,c){const a=Array.from(i?S.find(l=>l.sectionName===p).cells:D);if(c!=null){console.log("Removing item");const l=i?I.find(s=>s.name===p):Y(c,I);l.items=l.items.filter(s=>s.id!=t.id);for(let s=0;s<t.cellsTall;s++)for(let d=0;d<t.cellsLong;d++)a[c.y+s][c.x+d].hasItem=!1,a[c.y+s][c.x+d].itemId=""}const o=i?I.find(l=>l.name===p):Y(e,I),n=new f({x:e.x-o.cellId.x,y:e.y-o.cellId.y});t.sectionCell=n,o.items.push(t);for(let l=0;l<t.cellsTall;l++)for(let s=0;s<t.cellsLong;s++)a[e.y+l][e.x+s].hasItem=!0,a[e.y+l][e.x+s].itemId=t.id;if(console.log(a),i){const l=S.find(s=>s.sectionName===p);l&&(l.cells=a.map(s=>s.map(d=>({...d}))),C([...S]))}else O(a);if(console.log("Removing item from inventory",t.name),!t.hasMoved){const l=G.findIndex(s=>s.item.name==t.name&&!s.item.hasMoved);if(l!==-1){const s=[...G];s[l].quantity-=1,s[l].quantity<=0&&s.splice(l,1),H(s)}else H(G)}R(l=>(console.log("Placing item",t.id),console.log("Updating item",t.id),l.find(s=>s.id==t.id).hasMoved||(l.find(s=>s.id==t.id).hasMoved=!0),l))}function Qe(e){W.find(t=>t.name==e.name&&!t.hasMoved&&!t.starterItem)||R(t=>[...t,e])}function Te(e){console.log("Removing item",e.id),R(t=>t.filter(c=>c.id!=e.id))}function Xe(e,t){const c=Array.from(D),a=l=>{const s=l%2===1;return{cellsWide:s?e.cellsTall:e.cellsLong,cellsTall:s?e.cellsLong:e.cellsTall}},o=e.rotation||0,n=a(o);for(let l=0;l<n.cellsTall;l++)for(let s=0;s<n.cellsWide;s++)c[t.y+l][t.x+s].hasItem=!1,c[t.y+l][t.x+s].itemId="";O(c),console.log("DELETING ITEM",e.id),R(l=>(console.log(),l.filter(s=>s.id!=e.id))),H(l=>{const s=l.findIndex(d=>d.item.name==e.name&&!d.item.hasMoved);if(s!==-1){const d=[...l];return d[s].quantity+=1,d}else return[...l,new ie({item:new T({id:e.id,name:e.name,cellsLong:n.cellsWide,cellsTall:n.cellsTall,icon:e.icon}),quantity:1})]})}function Ze(e,t){const c=Array.from(i?S.find(l=>l.sectionName===p).cells:D);console.log("DELETING ITEM ROTATE",e.id,e.rotation);const a=l=>{const s=l%2===1;return{cellsWide:s?e.cellsTall:e.cellsLong,cellsTall:s?e.cellsLong:e.cellsTall}},o=e.rotation||0,n=a(o);for(let l=0;l<n.cellsTall;l++)for(let s=0;s<n.cellsWide;s++)console.log("Deleting cell",t.y+l,t.x+s),c[t.y+l][t.x+s].hasItem=!1,c[t.y+l][t.x+s].itemId="";O([...c]),console.log("DELETING ITEM",e.id)}function _e(e,t){const c=i?S.find(n=>n.sectionName===p).cells:D,a=Array.from(c);if(c[e.y]==null){Le();return}const o=xe(e,t);a.forEach(n=>n.forEach(l=>{l.mouseOver=!1,l.canPlaceItem=!1,l.mouseOverLocation=""}));for(let n=0;n<t.cellsTall;n++)for(let l=0;l<t.cellsLong;l++)e.y+n<a.length&&e.x+l<a[e.y+n].length&&(t.cellsLong===1&&t.cellsTall===1?a[e.y+n][e.x+l].mouseOverLocation="single":t.cellsTall===1?l===0?a[e.y+n][e.x+l].mouseOverLocation="leftFull":l===t.cellsLong-1?a[e.y+n][e.x+l].mouseOverLocation="rightFull":a[e.y+n][e.x+l].mouseOverLocation="middleFull":t.cellsLong===1?n===0?a[e.y+n][e.x+l].mouseOverLocation="topFull":n===t.cellsTall-1?a[e.y+n][e.x+l].mouseOverLocation="bottomFull":a[e.y+n][e.x+l].mouseOverLocation="middleVFull":n===0&&l===0?a[e.y+n][e.x+l].mouseOverLocation="topLeftCorner":n===0&&l===t.cellsLong-1?a[e.y+n][e.x+l].mouseOverLocation="topRightCorner":n===t.cellsTall-1&&l===0?a[e.y+n][e.x+l].mouseOverLocation="bottomLeftCorner":n===t.cellsTall-1&&l===t.cellsLong-1?a[e.y+n][e.x+l].mouseOverLocation="bottomRightCorner":n===0?a[e.y+n][e.x+l].mouseOverLocation="top":n===t.cellsTall-1?a[e.y+n][e.x+l].mouseOverLocation="bottom":l===0?a[e.y+n][e.x+l].mouseOverLocation="left":l===t.cellsLong-1?a[e.y+n][e.x+l].mouseOverLocation="right":a[e.y+n][e.x+l].mouseOverLocation="middle",a[e.y+n][e.x+l].mouseOver=!0,a[e.y+n][e.x+l].canPlaceItem=o);if(i){const n=S.find(l=>l.sectionName===p);n&&(n.cells=a.map(l=>l.map(s=>({...s}))),C([...S])),C(l=>l.map(s=>s.sectionName===p?{...s,cells:a}:s))}else O(a)}function Le(){const e=Array.from(i?S.find(t=>t.sectionName===p).cells:D);e.forEach(t=>t.forEach(c=>{c.mouseOver=!1,c.canPlaceItem=!1,c.mouseOverLocation=""})),O(e)}g.useEffect(()=>{Ge(p,S,I)},[p]),g.useEffect(()=>{const e=()=>{const t=W.find(c=>c.id===P);console.log("Unselecting item",P),_(null),t&&(M(c=>[...c,t.id]),console.log("Unselecting item",t.id),setTimeout(()=>{M(c=>c.filter(a=>a!==t.id))},300))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[P,W]);function el(e){_(null),M(t=>[...t,e]),console.log("Unselecting item",e),setTimeout(()=>{M(t=>t.filter(c=>c!==e))},300)}function ll(e){const t=W.find(c=>c.id===P);console.log("Unselecting item",P),_(e),t&&(M(c=>[...c,t.id]),console.log("Unselecting item",t.id),setTimeout(()=>{M(c=>c.filter(a=>a!==t.id))},300))}function nl(e){H(t=>[...t,e])}return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"App",children:[r.jsx("h1",{className:"title",children:"LayItOut"}),r.jsx("br",{}),(z||k)&&r.jsxs("div",{className:"template-name-row",children:[r.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),r.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:e=>fe(e.target.value),value:$})]}),U&&r.jsx("div",{className:"design-name-row",children:r.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",te]})}),(z||k)&&r.jsxs("div",{className:"template-creation",children:[r.jsxs("button",{className:"action-btn",onClick:()=>{if($.trim()==""){alert("Please enter a template name");return}if(K.some(e=>e.name===$&&(k?e.id!==pe.id:!0))){alert("Template with this name already exists");return}k?(E(!0),N(!0),setTimeout(async()=>{const e=document.getElementById("capture"),t=await domtoimage.toPng(e);N(!1);const c=K.map(a=>a.id===pe.id?(console.log("SECTION",I),new F({name:$,previewImage:t,sections:I.map(o=>new b({name:o.name,cellId:new f({x:a.sections.find(n=>n.name==o.name).cellId.x*(i?20:10),y:a.sections.find(n=>n.name==o.name).cellId.y*(i?20:10)}),cellsLong:o.cellsLong*10,cellsTall:o.cellsTall*10,startingItems:o.items.map(n=>new j({cell:new f({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))})),id:a.id})):new F({name:a.name,previewImage:a.previewImage,sections:a.sections.map(o=>new b({name:o.name,cellId:new f({x:o.cellId.x*(i?20:10),y:o.cellId.y*(i?20:10)}),cellsLong:o.cellsLong*(i?20:10),cellsTall:o.cellsTall*(i?20:10),startingItems:o.startingItems.map(n=>new j({cell:new f({x:n.cell.x*(i?2:1),y:n.cell.y*(i?2:1)}),item:new T({id:n.item.id,name:n.item.name,cellsLong:n.item.cellsLong*2,cellsTall:n.item.cellsTall*2,icon:n.item.icon,starterItem:n.item.starterItem,moveable:n.item.moveable,rotation:n.item.rotation})}))})),id:a.id}));be(X,J,c).then(()=>{console.log("Template updated successfully"),E(!1);const a=new URLSearchParams(window.location.search),o=a.get("companyId"),n=a.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${o}&areaId=${n}&type=view-area`})})):(E(!0),N(!0),setTimeout(async()=>{const e=document.getElementById("capture"),t=await domtoimage.toPng(e);N(!1);const c=new F({name:$,previewImage:t,sections:I.map(o=>new b({name:o.name,cellId:new f({x:B.find(n=>n.name==o.name).cellId.x*20,y:B.find(n=>n.name==o.name).cellId.y*20}),cellsLong:o.cellsLong*10,cellsTall:o.cellsTall*10,startingItems:o.items.map(n=>new j({cell:new f({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))})),id:$+(Math.random()*1e4).toString()}),a=[...K.map(o=>new F({name:o.name,previewImage:o.previewImage,sections:o.sections.map(n=>new b({name:n.name,cellId:new f({x:n.cellId.x*(i?20:10),y:n.cellId.y*(i?20:10)}),cellsLong:n.cellsLong*(i?20:10),cellsTall:n.cellsTall*(i?20:10),startingItems:n.startingItems.map(l=>new j({cell:new f({x:l.cell.x*(i?2:1),y:l.cell.y*(i?2:1)}),item:new T({id:l.item.id,name:l.item.name,cellsLong:l.item.cellsLong*2,cellsTall:l.item.cellsTall*2,icon:l.item.icon,starterItem:l.item.starterItem,moveable:l.item.moveable,rotation:l.item.rotation})}))})),id:o.id})),c];be(X,J,a).then(()=>{console.log("Template updated successfully"),E(!1);const o=new URLSearchParams(window.location.search),n=o.get("companyId"),l=o.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${n}&areaId=${l}&type=view-area`})},500))},children:[z?"Create":"Save"," Template"]}),r.jsx("button",{className:"action-btn",onClick:()=>{Ie(!1),de([]),le([]),V([]),C([]),ue([]),Q(null)},children:"Cancel"})]}),We&&r.jsxs("div",{className:"template-creation",children:[r.jsx("button",{className:"action-btn",onClick:()=>{E(!0),N(!0),setTimeout(async()=>{const e=document.getElementById("capture"),t=await domtoimage.toPng(e);N(!1);const c=new al({name:te,previewImage:t,areaId:J,sections:I.map(a=>new b({name:a.name,cellId:new f({x:B.find(o=>o.name==a.name).cellId.x*20,y:B.find(o=>o.name==a.name).cellId.y*20}),cellsLong:a.cellsLong*10,cellsTall:a.cellsTall*10,startingItems:a.items.map(o=>new j({cell:new f({x:o.sectionCell.x,y:o.sectionCell.y}),item:new T({id:o.id,name:o.name,cellsLong:o.cellsLong,cellsTall:o.cellsTall,icon:o.icon,starterItem:!0,moveable:o.moveable,rotation:o.rotation})}))})),id:ye});cl(X,J,c).then(()=>{console.log("Design updated successfully"),E(!1)})},500)},children:"Save"}),r.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),ae&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"loader-backdrop"}),r.jsx("div",{className:"loader"})]})," ",r.jsxs("div",{className:"layout",children:[!U&&r.jsx(ml,{isViewingDesign:U,isEditingTemplate:k,isCreatingTemplate:z,maxHeight:i?200:Z,showAddCustomItem:()=>{ce.current?.showModal()},addDraggingItem:Qe,removeItem:Te,inventoryItems:G.map(e=>new ie({item:new T({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,displayItem:!0}),quantity:e.quantity}))}),i?r.jsxs("div",{className:"mobile-areas",style:{height:De+"px"},children:[r.jsx("img",{src:Ee,onClick:()=>{const e=I.findIndex(c=>c.name==p);if(e===-1)return;const t=(e-1+I.length)%I.length;Q(I[t].name),console.log("Changing viewing section to",I[t].name)},className:"back-mobile-areas"}),Me.map((e,t)=>r.jsx(Se,{width:e.width,height:e.height,cells:he(S.find(c=>c.sectionName==e.sectionName).cells),id:e.sectionName,visibile:p==null?!0:e.sectionName==p,section:e.sectionName},t)),r.jsx("img",{src:Ee,onClick:()=>{const e=I.findIndex(c=>c.name==p);if(e===-1)return;const t=(e+1)%I.length;Q(I[t].name),console.log("Changing viewing section to",I[t].name)},className:"forward-mobile-areas"})]}):r.jsx(Se,{width:me,height:Z,cells:he(D)})]}),U&&r.jsx("div",{className:"design-view",children:r.jsx("button",{className:"action-btn",onClick:()=>{window.location.href=`/LayItOut/Print/?companyId=${X}&areaId=${J}&designName=${te}&designId=${ye}`},children:"Print"})})]}),r.jsxs("div",{id:we?"capture":"",children:[I.map(e=>r.jsx(ol,{takingPhoto:we,section:e,visible:p==null?!0:e.name==p,cellSize:x},e.cellId.toId())),W.map(e=>r.jsx(sl,{cellSize:x,isViewingDesign:U,removeItem:Te,visible:i?!e.hasMoved&&!e.starterItem?!0:p==null?!1:e.starterItem?I.find(t=>t.name==p)?.startingItems.some(t=>t.item.id===e.id):I.find(t=>t.name==p)?.items.some(t=>t.id===e.id):!0,item:e,canPlaceItem:xe,placeItem:Ke,deleteItemRotate:Ze,highlightCells:_e,unHighlightCells:Le,deleteItem:Xe,isSelected:P===e.id,onSelect:ll,isUnselecting:Ae.includes(e.id),onDeselect:()=>el(e.id)},e.id))]}),i&&!ae&&r.jsx("div",{className:"layout-icon",onClick:()=>{ee.current?.showModal(),re(!0),console.log("Showing layout dialog")},children:r.jsx("img",{src:rl,alt:""})}),!ae&&!(z||k||U)&&r.jsx("div",{className:"template-icon",onClick:()=>{ne.current?.showModal(),ge(!0),console.log("Showing template dialog")},children:r.jsx("img",{src:dl,alt:""})}),r.jsx(gl,{isViewingArea:$e,dialogRef:ne,isOpen:Pe,closeDialog:()=>{ne.current?.close(),ge(!1)},templates:K}),r.jsx(ul,{dialogRef:ee,isOpen:Re,closeDialog:()=>{ee.current?.close(),re(!1)},layoutSections:B}),r.jsx(Il,{dialogRef:ce,addInventoryItem:nl,closeDialog:()=>{ce.current?.close()}})]})}
