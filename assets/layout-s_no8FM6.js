import{r as u,j as o,c as gl}from"./index-QIV6qY6h.js";import{A as Pe,S as ul,D as Il}from"./section-T5K6jlVY.js";import{I as T,s as be,b as ie,S as E,C as h,e as M,T as oe,D as Ge,u as Me,f as fl,h as hl}from"./firestore-Cstgsan0.js";import{F as fe}from"./add_custom_item_dialog-CkfgPpdu.js";function yl({inventoryItem:g,addDraggingItem:W,removeItem:F}){const D=u.useRef(null),R=u.useRef(null),[J,U]=u.useState(12),[V,A]=u.useState(g.item);function O(p){const I=R.current,G=window.getComputedStyle(I),y=document.createElement("span");y.style.font=G.font,y.style.fontSize=p+"px",y.style.fontFamily=G.fontFamily,y.style.fontWeight=G.fontWeight,y.style.position="absolute",y.style.visibility="hidden",y.style.whiteSpace="nowrap",y.textContent=I.textContent,document.body.appendChild(y);const x=y.offsetWidth;return document.body.removeChild(y),x}function P(p){if(R.current){const I=R.current;return O(p-1)>I.offsetWidth&&p-1>8?P(p-1):p-1}return p}return u.useEffect(()=>{setTimeout(()=>{R.current&&U(P(J))},100)},[]),o.jsxs("div",{className:"display",children:[o.jsx("div",{ref:D,id:g.item.id,className:"display-item",style:{width:`${g.item.cellsLong*10}px`,height:`${g.item.cellsTall*10}px`},onMouseDown:p=>{p.preventDefault(),p.stopPropagation(),g.item.initialElement=D.current,g.item.id=g.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",g.item.id,"to initialElement",g.item.initialElement),A(new T({id:g.item.id,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,name:g.item.name,icon:g.item.icon,moveable:g.item.moveable,starterItem:g.item.starterItem,displayItem:g.item.isDisplayItem})),W(g.item)},onTouchStart:p=>{p.preventDefault(),p.stopPropagation(),g.item.initialElement=D.current,g.item.id=g.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",g.item.id,"to initialElement",g.item.initialElement),A(new T({id:g.item.id,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,name:g.item.name,icon:g.item.icon,moveable:g.item.moveable,starterItem:g.item.starterItem,displayItem:g.item.isDisplayItem})),W(g.item)},children:g.item.icon.includes("custom-")?o.jsx("div",{className:"custom-icon",children:o.jsx("div",{children:o.jsx("p",{ref:R,style:{fontSize:`${J}px`},children:g.item.icon.split("custom-")[1]})})}):o.jsx("img",{src:g.item.icon,alt:"icon"})}),o.jsx("p",{children:g.item.name}),o.jsxs("p",{className:"quantity",children:["x",g.quantity]})]})}const pl="/LayItOut/assets/plus.circle-Ce3xm00a.png";function xl({inventoryItems:g,addDraggingItem:W,maxHeight:F,removeItem:D,showAddCustomItem:R,isCreatingTemplate:J,isEditingTemplate:U,isViewingDesign:V}){return o.jsxs("div",{className:"toolbox",style:{maxHeight:F?`${F}px`:"200px"},children:[g.map(A=>o.jsx(yl,{inventoryItem:A,addDraggingItem:W,removeItem:D})),!(J||U||V)&&o.jsx("div",{className:"add-item",onClick:()=>{R()},children:o.jsx("img",{src:pl,alt:"Add Item"})})]})}function wl({dialogRef:g,closeDialog:W,areaPreview:F}){return o.jsx("dialog",{ref:g,className:"layout-dialog",children:o.jsxs("div",{className:"layout-dialog-div",children:[o.jsx("h2",{children:"Layout"}),o.jsx("img",{src:F,alt:"Layout preview",className:"layout-dialog-preview"}),o.jsx("br",{}),o.jsx("button",{className:"layout-dialog-close",onClick:W,children:"Close"})]})})}const Ll="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",Tl="/LayItOut/assets/template-Cjj8EPhc.png";function vl({dialogRef:g,closeDialog:W,templates:F,isOpen:D,isViewingArea:R,selectTemplate:J}){const[U,V]=u.useState(/Mobi|Android/i.test(navigator.userAgent)),[A,O]=u.useState([]),[P,p]=u.useState(!1),[I,G]=u.useState([]);return u.useEffect(()=>{G(F)},[F]),u.useEffect(()=>{if(D&&(console.log("Layout dialog opened, generating cells and sections",I),I.length!==0)){if(I.length==1){O([I[0].name]);return}O(U?[I[0].name]:[I[0].name,I[1].name])}},[D,I]),u.useEffect(()=>{const y=I.filter(x=>A.includes(x.name));console.log("Viewing templates:",A),y.sort((x,S)=>A.indexOf(x.name)-A.indexOf(S.name)),console.log("Generating templates for",y.map(x=>x.name))},[A,I]),o.jsx(o.Fragment,{children:o.jsx("dialog",{ref:g,className:"template-dialog",children:o.jsxs("div",{className:"template-dialog-div",children:[o.jsx("h2",{children:"Templates"}),o.jsxs("div",{className:"templates",children:[I.length>1&&I.filter(y=>!A.includes(y.name)).length>0&&o.jsx("img",{src:fe,onClick:()=>{if(U){const x=(I.findIndex(S=>S.name===A[0])-1+I.length)%I.length;O([I[x].name])}else O(y=>{const S=(I.findIndex(H=>H.name===y[0])-1+I.length)%I.length;return[I[S].name,y[0]]})},className:"back-mobile-areas"}),A.length===0&&o.jsx("div",{className:"no-templates",children:"No templates available"}),A.map(y=>o.jsxs("div",{className:"template",children:[o.jsx("img",{src:I.find(x=>x.name===y).previewImage,alt:y,className:"template-preview"}),o.jsx("h3",{children:y}),o.jsxs("div",{className:"template-actions",children:[o.jsx("button",{className:"template-select-btn",onClick:()=>{if(R){const x=new URLSearchParams(window.location.search),S=x.get("companyId"),H=x.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${S}&areaId=${H}&type=edit-template&templateId=${I.find(ce=>ce.name==y).id}`}else W(),J&&J(I.find(x=>x.name===y))},children:R?"Edit":"Select"}),R&&o.jsx("button",{className:"action-btn",onClick:()=>{if(P)return;p(!0);const x=I.filter(Q=>Q.name!==y);G(x),x.length==1?O([x[0].name]):x.length==0?O([]):O(U?[x[0].name]:[x[0].name,x[1].name]);const S=new URLSearchParams(window.location.search),H=S.get("companyId"),ce=S.get("areaId");be(H,ce,x).then(()=>{p(!1)})},children:"Delete"})]})]})),I.length>1&&I.filter(y=>!A.includes(y.name)).length>0&&o.jsx("img",{src:fe,onClick:()=>{if(U){const x=(I.findIndex(S=>S.name===A[0])+1)%I.length;O([I[x].name])}else O(y=>{const S=(I.findIndex(H=>H.name===y[y.length-1])+1)%I.length;return[y[1],I[S].name]})},className:"forward-mobile-areas"})]}),R&&o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"action-btn",onClick:()=>{const y=new URLSearchParams(window.location.search),x=y.get("companyId"),S=y.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${x}&areaId=${S}&type=create-template`},children:"Create new Template"})," ",o.jsx("br",{})]}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:W,children:"Close"}),P&&D&&o.jsx(o.Fragment,{children:o.jsx("div",{className:"loader"})})]})})})}function Sl({dialogRef:g,closeDialog:W,addInventoryItem:F}){const[D,R]=u.useState(""),[J,U]=u.useState(1),[V,A]=u.useState(1),[O,P]=u.useState(1);return o.jsx("dialog",{ref:g,className:"custom-item-dialog",children:o.jsxs("div",{className:"custom-item-dialog-div",children:[o.jsx("h2",{children:"Add Custom Item"}),o.jsxs("div",{className:"custom-item-row",children:[o.jsx("label",{htmlFor:"item-name",children:"Name:"}),o.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:p=>R(p.target.value??""),value:D})]}),o.jsxs("div",{className:"custom-item-row",children:[o.jsx("label",{htmlFor:"item-icon",children:"Count:"}),o.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:J,onChange:p=>U(parseInt(p.target.value)??1)})]}),o.jsxs("div",{className:"custom-item-row custom-item-size",children:[o.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),o.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:V,onChange:p=>A(parseFloat(p.target.value)??1)}),o.jsx("span",{children:" x "}),o.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:O,onChange:p=>P(parseFloat(p.target.value)??1)})]}),o.jsx("br",{}),o.jsx("button",{className:"custom-item-dialog-add",onClick:()=>{if(D.trim()===""){alert("Item name cannot be empty");return}const p=new ie({quantity:J,item:new T({id:D+(Math.random()*1e4).toString(),name:D,icon:`custom-${D}`,cellsLong:Math.ceil(V),cellsTall:Math.ceil(O),moveable:!0,starterItem:!1,displayItem:!0})});F(p),R(""),U(1),A(1),P(1),W()},children:"Add Item"}),o.jsx("br",{}),o.jsx("br",{}),o.jsx("button",{className:"custom-item-dialog-close",onClick:W,children:"Close"})]})})}gl.createRoot(document.getElementById("root")).render(o.jsx(bl,{}));function bl(){const[g,W]=u.useState(/Mobi|Android/i.test(navigator.userAgent)),[F,D]=u.useState(0),[R,J]=u.useState(0),[U,V]=u.useState(0),[A,O]=u.useState(0),[P,p]=u.useState([]),[I,G]=u.useState([]),[y,x]=u.useState(0),[S,H]=u.useState(null),[ce,Q]=u.useState([]),b=/Mobi|Android/i.test(navigator.userAgent)?5:10,[q,$]=u.useState([]),he=u.useRef(null),[jl,je]=u.useState(!1),[Y,ge]=u.useState([]),[w,le]=u.useState([]),[ue,We]=u.useState([]),[Fe,Ne]=u.useState(!1),ye=u.useRef(null),[Ue,Je]=u.useState([]),[k,B]=u.useState([]),[L,pe]=u.useState(null),[me,Ye]=u.useState(!1),[te,Ze]=u.useState(!1),[ne,He]=u.useState(!1),[Ae,Be]=u.useState(!1),[Nl,ze]=u.useState(!1),[Ve,Xe]=u.useState(!1),[Ie,xe]=u.useState(""),[se,Ee]=u.useState(""),[re,Qe]=u.useState(""),[_,Ke]=u.useState(""),[we,Le]=u.useState(""),[Te,z]=u.useState(!0),[Re,qe]=u.useState(null),[ve,K]=u.useState(!1),[$e,_e]=u.useState(null),[el,de]=u.useState(!1),Se=u.useRef(null);function ee(e,l){for(const n of l)if(e.x>=n.cellId.x&&e.x<n.cellId.x+n.cellsLong&&e.y>=n.cellId.y&&e.y<n.cellId.y+n.cellsTall)return n;return null}function ll(e){ge([...e.map(a=>new E({name:a.name,cellId:new h({x:a.cellId.x,y:a.cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,startingItems:[]}))]);let l=F,n=R;if(g){for(const t of e)console.log("Generating cells for section",t.name,"at",t.cellId,"with size",t.cellsLong,"x",t.cellsTall),console.log("Needed section Width:",(t.cellsLong+t.cellId.x)*b,"Current width:",l),(t.cellsLong+t.cellId.x)*b>l&&(console.log("Added section Width:",t.cellsLong*b+t.cellId.x),l+=(t.cellsLong+t.cellId.x)*b-l),console.log("Needed section Height:",(t.cellsTall+t.cellId.y)*b,"Current height:",n),(t.cellsTall+t.cellId.y)*b>n&&(console.log("Added section Height:",t.cellsTall*b+t.cellId.y),n+=(t.cellsTall+t.cellId.y)*b-n);O(n/b*2),V(l/b*2);let a=0;const i=[],s=[];for(const t of e){const c=[],d={width:t.cellsLong*b,height:t.cellsTall*b,sectionName:t.name};d.height>a&&(a=d.height),Je(f=>[...f,d]),t.cellId.x=0,t.cellId.y=0,[...Array(d.height/b).keys()].map(f=>{const v=[];[...Array(d.width/b).keys()].map(j=>{v.push({id:new h({x:j,y:f}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:b})}),c.push(v)}),i.push({sectionName:t.name,cells:[...c]}),s.push(t)}B(i),le(s),x(a),pe(e[0]?e[0].name:null),setTimeout(()=>{z(!1)},500)}else{const a=[];for(const i of e)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",i.cellsLong+i.cellId.x,"Current width:",l),i.cellsLong+i.cellId.x>l&&(console.log("Added section Width:",i.cellsLong+i.cellId.x),l+=i.cellsLong+i.cellId.x-l),console.log("Needed section Height:",i.cellsTall+i.cellId.y,"Current height:",n),i.cellsTall+i.cellId.y>n&&(console.log("Added section Height:",i.cellsTall+i.cellId.y),n+=i.cellsTall+i.cellId.y-n);D(l),J(n),V(l),O(n),console.log("Final width:",l,"Final height:",n),[...Array(n).keys()].map(i=>{const s=[];[...Array(l).keys()].map(t=>{s.push({id:new h({x:t,y:i}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:ee(new h({x:t,y:i}),e)!=null,size:b})}),a.push(s)}),p([...a]),setTimeout(()=>{const i=[],s=[...e];for(const t of s)t.cellElement=document.querySelector(`.App #${t.cellId.toId()}.cell:not(.cell-border)`),i.push(...t.startingItems.map(c=>new M({cell:new h({x:t.cellId.x+c.cell.x,y:t.cellId.y+c.cell.y}),item:new T({id:c.item.id,name:c.item.name,cellsLong:c.item.cellsLong,cellsTall:c.item.cellsTall,icon:c.item.icon,initialElement:document.querySelector(`.App #${c.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:c.item.moveable,rotation:c.item.rotation||0})})));le([...s]);for(const t of i){const c=v=>{const j=v%2===1;return{cellsLong:j?t.item.cellsTall:t.item.cellsLong,cellsTall:j?t.item.cellsLong:t.item.cellsTall}},d=t.item.rotation||0,f=c(d);for(let v=0;v<f.cellsTall;v++)for(let j=0;j<f.cellsLong;j++)a[t.cell.y+v][t.cell.x+j].hasItem=!0,a[t.cell.y+v][t.cell.x+j].itemId=t.item.id;t.item.initialElement=document.querySelector(`.App #${t.cell.toId()}.cell:not(.cell-border)`),G(v=>[...v,t.item])}p([...a]),setTimeout(()=>{z(!1)},500)},100)}}async function tl(){const e=new URLSearchParams(window.location.search),l=e.get("companyId"),n=e.get("areaId"),a=e.get("areaId")||"",i=e.get("companyId")||"",s=e.get("templateId")||"",t=await fl(i,a);_e(t.previewImage||null);const c=e.get("type")||"";let d=!1;if(c==="create-template")Ye(!0);else if(c==="edit-template"){Ze(!0);const m=t.templates.find(r=>r.id===s);m&&(qe(m),Ee(m.name))}else if(c==="view-design"){d=!0,He(!0);const m=e.get("designName")||"";xe(m);const r=e.get("designId")||"";Le(r)}else if(c==="view-area")Be(!0);else if(c==="edit-design"){d=!0,ze(!0);const m=e.get("designName")||"";xe(m);const r=e.get("designId")||"";Le(r)}else if(c==="client-edit-design"){d=!0,Xe(!0);const m=e.get("designName")||"";xe(m);const r=e.get("designId")||"";Le(r)}l&&Qe(l),n&&Ke(n),$(t.inventoryItems.map(m=>new ie({item:new T({id:m.item.id,name:m.item.name,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,initialElement:m.item.initialElement,moveable:m.item.moveable,starterItem:m.item.starterItem,displayItem:!0}),quantity:m.quantity})));const f=[],v=[];for(const m of t.templates){const r=[],N=[];for(const Z of m.sections)r.push(new E({name:Z.name,cellId:new h({x:Z.cellId.x,y:Z.cellId.y}),cellsLong:Z.cellsLong,cellsTall:Z.cellsTall,startingItems:Z.startingItems.map(C=>new M({cell:new h({x:C.cell.x,y:C.cell.y}),item:new T({id:C.item.id,name:C.item.name,cellsLong:C.item.cellsLong,cellsTall:C.item.cellsTall,icon:C.item.icon,starterItem:!0,moveable:C.item.moveable,rotation:C.item.rotation||0})}))})),N.push(new E({name:Z.name,cellId:new h({x:Z.cellId.x,y:Z.cellId.y}),cellsLong:Z.cellsLong,cellsTall:Z.cellsTall,startingItems:Z.startingItems.map(C=>new M({cell:new h({x:C.cell.x,y:C.cell.y}),item:new T({id:C.item.id,name:C.item.name,cellsLong:C.item.cellsLong,cellsTall:C.item.cellsTall,icon:C.item.icon,starterItem:!0,moveable:C.item.moveable,rotation:C.item.rotation||0})}))}));f.push(new oe({name:m.name,sections:r,inventoryItems:m.inventoryItems,id:m.id,previewImage:m.previewImage})),v.push(new oe({name:m.name,sections:N,id:m.id,previewImage:m.previewImage,inventoryItems:m.inventoryItems}))}We([...f]);const j=[],X=s===""?void 0:v.find(m=>m.id===s);if(console.log("TEMPLATE",X,"AREA",t),d){const m=await hl(i,a,e.get("designId")||"");if(m===null){window.location.href="/LayItOut/DNF/";return}$(m.inventoryItems.map(r=>new ie({item:new T({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,initialElement:r.item.initialElement,moveable:r.item.moveable,starterItem:r.item.starterItem,displayItem:!0}),quantity:r.quantity}))),ge([...m.sections]),le([...m.sections.map(r=>new E({name:r.name,cellId:new h({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,startingItems:r.startingItems,items:r.startingItems.map(N=>new T({id:N.item.id,name:N.item.name,sectionCell:N.cell,cellsLong:N.item.cellsLong,cellsTall:N.item.cellsTall,icon:N.item.icon,moveable:N.item.moveable,starterItem:N.item.starterItem,rotation:N.item.rotation}))}))]),j.push(...m.sections.map(r=>new E({name:r.name,cellId:new h({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,startingItems:r.startingItems,items:r.startingItems.map(N=>new T({id:N.item.id,name:N.item.name,sectionCell:N.cell,cellsLong:N.item.cellsLong,cellsTall:N.item.cellsTall,icon:N.item.icon,moveable:N.item.moveable,starterItem:N.item.starterItem,rotation:N.item.rotation}))})))}else X!==void 0?($(X.inventoryItems.map(m=>new ie({item:new T({id:m.item.id,name:m.item.name,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,initialElement:m.item.initialElement,moveable:m.item.moveable,starterItem:m.item.starterItem,displayItem:!0}),quantity:m.quantity}))),ge([...X.sections]),le([...X.sections.map(m=>new E({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,items:m.startingItems.map(r=>new T({id:r.item.id,name:r.item.name,sectionCell:r.cell,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,rotation:r.item.rotation}))}))]),j.push(...X.sections.map(m=>new E({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,items:m.startingItems.map(r=>new T({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,rotation:r.item.rotation,sectionCell:r.cell}))})))):(ge([...t.sections]),le([...t.sections.map(m=>new E({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,items:m.startingItems.map(r=>new T({id:r.item.id,name:r.item.name,sectionCell:r.cell,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,rotation:r.item.rotation}))}))]),j.push(...t.sections.map(m=>new E({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,items:m.startingItems.map(r=>new T({id:r.item.id,name:r.item.name,sectionCell:r.cell,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,rotation:r.item.rotation}))}))));console.log("SECTIONS TO GENERATE",j),ll(j)}u.useEffect(()=>{tl()},[]);function nl(e,l,n){if(!g||e==null)return;const a=[...n],i=[],s=n.find(t=>t.name==e);console.log("NEW SECTION",s),console.log("Adding section",s.name,s.cellId),console.log("MOBILE CELLS",l),s.cellElement=document.querySelector(`.App #${s.name.split(" ").join("-")} #${s.name.split(" ").join("")}${s.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",s.cellElement);for(const t of s.startingItems){console.log("Placing starting item",t.item.name,t.cell);const c=v=>{const j=v%2===1;return{cellsLong:j?t.item.cellsTall:t.item.cellsLong,cellsTall:j?t.item.cellsLong:t.item.cellsTall}},d=t.item.rotation||0,f=c(d);for(let v=0;v<f.cellsTall;v++)for(let j=0;j<f.cellsLong;j++){const X=l.find(m=>m.sectionName===s.name);X.cells[t.cell.y+v][t.cell.x+j].hasItem=!0,X.cells[t.cell.y+v][t.cell.x+j].itemId=t.item.id}t.item.initialElement=document.querySelector(`.App #${s.name.split(" ").join("-")} #${s.name.split(" ").join("")}${t.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",t.item.initialElement),i.push(new T({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,initialElement:t.item.initialElement,starterItem:!0,moveable:t.item.moveable,rotation:t.item.rotation}))}console.log("Setting sections",a),le([...a]),console.log("ITEMS",i),G(t=>[...t.filter(d=>!i.some(f=>f.id===d.id)),...i.map(d=>new T({id:d.id,name:d.name,cellsLong:d.cellsLong,cellsTall:d.cellsTall,icon:d.icon,initialElement:d.initialElement,starterItem:!0,moveable:d.moveable,rotation:d.rotation}))])}function Oe(e){let l=[];return e.map(n=>l=[...l,...n]),l}function Ce(e,l){console.log(e);const n=g?k.find(t=>t.sectionName===L).cells:P,a=n[e.y].length,i=n.length;if(console.log(a,i),e.x+l.cellsLong>a||e.y+l.cellsTall>i)return!1;const s=ee(e,w);if(!s&&!g)return console.log("Item is out of bounds of any section"),!1;for(let t=0;t<l.cellsTall;t++)for(let c=0;c<l.cellsLong;c++){if(!g){const d=ee(new h({x:e.x+c,y:e.y+t}),w);if(!d)return console.log("Item is out of bounds of any section"),!1;if(d.name!=s.name)return console.log("Item is crossing section boundaries"),!1}if(n[e.y+t][e.x+c].hasItem&&n[e.y+t][e.x+c].itemId!=l.id)return console.log("Something is already here"),!1}return!0}function sl(e,l,n){const a=Array.from(g?k.find(t=>t.sectionName===L).cells:P);if(de(!0),n!=null){console.log("Removing item");const t=g?w.find(c=>c.name===L):ee(n,w);t.items=t.items.filter(c=>c.id!=l.id);for(let c=0;c<l.cellsTall;c++)for(let d=0;d<l.cellsLong;d++)a[n.y+c][n.x+d].hasItem=!1,a[n.y+c][n.x+d].itemId=""}const i=g?w.find(t=>t.name===L):ee(e,w),s=new h({x:e.x-i.cellId.x,y:e.y-i.cellId.y});l.sectionCell=s,console.log("Adding item to section",i.name,"at",s,l),i.items.push(l);for(let t=0;t<l.cellsTall;t++)for(let c=0;c<l.cellsLong;c++)a[e.y+t][e.x+c].hasItem=!0,a[e.y+t][e.x+c].itemId=l.id;if(console.log(a),g){const t=k.find(c=>c.sectionName===L);t&&(t.cells=a.map(c=>c.map(d=>({...d}))),B([...k]))}else p(a);if(console.log("Removing item from inventory",l.name),!l.hasMoved){const t=q.findIndex(c=>c.item.name==l.name&&!c.item.hasMoved);if(t!==-1){const c=[...q];c[t].quantity-=1,c[t].quantity<=0&&c.splice(t,1),$(c)}else $(q)}G(t=>(console.log("Placing item",l.id),console.log("Updating item",l.id),t.find(c=>c.id==l.id).hasMoved||(t.find(c=>c.id==l.id).hasMoved=!0),t))}function al(e){I.find(l=>l.name==e.name&&!l.hasMoved&&!l.starterItem)||G(l=>[...l,e])}function ke(e){console.log("Removing item",e.id),G(l=>l.filter(n=>n.id!=e.id))}function ol(e,l){const n=Array.from(g?k.find(c=>c.sectionName===L).cells:P);de(!0);const a=c=>{const d=c%2===1;return{cellsWide:d?e.cellsTall:e.cellsLong,cellsTall:d?e.cellsLong:e.cellsTall}},i=e.rotation||0,s=a(i);for(let c=0;c<s.cellsTall;c++)for(let d=0;d<s.cellsWide;d++)n[l.y+c][l.x+d].hasItem=!1,n[l.y+c][l.x+d].itemId="";if(g){const c=k.find(d=>d.sectionName===L);c&&(c.cells=n.map(d=>d.map(f=>({...f}))),B([...k])),B(d=>d.map(f=>f.sectionName===L?{...f,cells:n}:f))}else p(n);const t=g?w.find(c=>c.name===L):ee(l,w);t.items=t.items.filter(c=>c.id!=e.id),console.log("DELETING ITEM",e.id),G(c=>(console.log(),c.filter(d=>d.id!=e.id))),$(c=>{const d=c.findIndex(f=>f.item.name==e.name&&!f.item.hasMoved);if(d!==-1){const f=[...c];return f[d].quantity+=1,f}else return[...c,new ie({item:new T({id:e.id,name:e.name,cellsLong:s.cellsWide,cellsTall:s.cellsTall,icon:e.icon}),quantity:1})]})}function il(e,l){const n=Array.from(g?k.find(d=>d.sectionName===L).cells:P);console.log("DELETING ITEM ROTATE",e.id,e.rotation),de(!0);const a=d=>{const f=d%2===1;return{cellsWide:f?e.cellsTall:e.cellsLong,cellsTall:f?e.cellsLong:e.cellsTall}},i=e.rotation||0,s=a(i);for(let d=0;d<s.cellsTall;d++)for(let f=0;f<s.cellsWide;f++)console.log("Deleting cell",l.y+d,l.x+f),n[l.y+d][l.x+f].hasItem=!1,n[l.y+d][l.x+f].itemId="";if(g){const d=k.find(f=>f.sectionName===L);d&&(d.cells=n.map(f=>f.map(v=>({...v}))),B([...k])),B(f=>f.map(v=>v.sectionName===L?{...v,cells:n}:v))}else p(n);console.log("DELETING ITEM",e.id);const t=g?w.find(d=>d.name===L):ee(l,w);t.items=t.items.filter(d=>d.id!=e.id);const c=new h({x:l.x-t.cellId.x,y:l.y-t.cellId.y});e.sectionCell=c,t.items.push(e)}function cl(e,l){const n=g?k.find(s=>s.sectionName===L).cells:P,a=Array.from(n);if(n[e.y]==null){De();return}const i=Ce(e,l);a.forEach(s=>s.forEach(t=>{t.mouseOver=!1,t.canPlaceItem=!1,t.mouseOverLocation=""}));for(let s=0;s<l.cellsTall;s++)for(let t=0;t<l.cellsLong;t++)e.y+s<a.length&&e.x+t<a[e.y+s].length&&(l.cellsLong===1&&l.cellsTall===1?a[e.y+s][e.x+t].mouseOverLocation="single":l.cellsTall===1?t===0?a[e.y+s][e.x+t].mouseOverLocation="leftFull":t===l.cellsLong-1?a[e.y+s][e.x+t].mouseOverLocation="rightFull":a[e.y+s][e.x+t].mouseOverLocation="middleFull":l.cellsLong===1?s===0?a[e.y+s][e.x+t].mouseOverLocation="topFull":s===l.cellsTall-1?a[e.y+s][e.x+t].mouseOverLocation="bottomFull":a[e.y+s][e.x+t].mouseOverLocation="middleVFull":s===0&&t===0?a[e.y+s][e.x+t].mouseOverLocation="topLeftCorner":s===0&&t===l.cellsLong-1?a[e.y+s][e.x+t].mouseOverLocation="topRightCorner":s===l.cellsTall-1&&t===0?a[e.y+s][e.x+t].mouseOverLocation="bottomLeftCorner":s===l.cellsTall-1&&t===l.cellsLong-1?a[e.y+s][e.x+t].mouseOverLocation="bottomRightCorner":s===0?a[e.y+s][e.x+t].mouseOverLocation="top":s===l.cellsTall-1?a[e.y+s][e.x+t].mouseOverLocation="bottom":t===0?a[e.y+s][e.x+t].mouseOverLocation="left":t===l.cellsLong-1?a[e.y+s][e.x+t].mouseOverLocation="right":a[e.y+s][e.x+t].mouseOverLocation="middle",a[e.y+s][e.x+t].mouseOver=!0,a[e.y+s][e.x+t].canPlaceItem=i);if(g){const s=k.find(t=>t.sectionName===L);s&&(s.cells=a.map(t=>t.map(c=>({...c}))),B([...k])),B(t=>t.map(c=>c.sectionName===L?{...c,cells:a}:c))}else p(a)}function De(){console.log("Unhighlighting cells");const e=Array.from(g?k.find(l=>l.sectionName===L).cells:P);if(e.forEach(l=>l.forEach(n=>{n.mouseOver=!1,n.canPlaceItem=!1,n.mouseOverLocation=""})),g){const l=k.find(n=>n.sectionName===L);l&&(l.cells=e.map(n=>n.map(a=>({...a}))),B([...k])),B(n=>n.map(a=>a.sectionName===L?{...a,cells:e}:a))}else p(e)}u.useEffect(()=>{nl(L,k,w)},[L]),u.useEffect(()=>{const e=()=>{const l=I.find(n=>n.id===S);console.log("Unselecting item",S),H(null),l&&(Q(n=>[...n,l.id]),console.log("Unselecting item",l.id),setTimeout(()=>{Q(n=>n.filter(a=>a!==l.id))},300))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[S,I]);function ml(e){H(null),Q(l=>[...l,e]),console.log("Unselecting item",e),setTimeout(()=>{Q(l=>l.filter(n=>n!==e))},300)}function rl(e){const l=I.find(n=>n.id===S);console.log("Unselecting item",S),H(e),l&&(Q(n=>[...n,l.id]),console.log("Unselecting item",l.id),setTimeout(()=>{Q(n=>n.filter(a=>a!==l.id))},300))}function dl(e){$(l=>[...l,e])}const ae=e=>{console.log("Preventing scroll"),e.preventDefault(),e.stopPropagation(),window.scrollTo(0,0)};return u.useEffect(()=>(ve?(window.addEventListener("scroll",ae),window.addEventListener("touchmove",ae,{passive:!1})):(window.removeEventListener("scroll",ae),window.removeEventListener("touchmove",ae)),()=>{window.removeEventListener("scroll",ae),window.removeEventListener("touchmove",ae)}),[ve]),o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"App",children:[o.jsx("h1",{className:"title",children:"LayItOut"}),o.jsx("br",{}),(me||te)&&o.jsxs("div",{className:"template-name-row",children:[o.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),o.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:e=>Ee(e.target.value),value:se})]}),ne&&o.jsx("div",{className:"design-name-row",children:o.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",Ie]})}),(me||te)&&o.jsxs("div",{className:"template-creation",children:[o.jsxs("button",{className:"action-btn",onClick:()=>{if(se.trim()==""){alert("Please enter a template name");return}if(ue.some(e=>e.name===se&&(te?e.id!==Re.id:!0))){alert("Template with this name already exists");return}te?(z(!0),setTimeout(async()=>{const e=w.map(l=>new E({name:l.name,cellId:new h({x:Y.find(n=>n.name==l.name).cellId.x,y:Y.find(n=>n.name==l.name).cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,startingItems:l.items.map(n=>new M({cell:new h({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),K(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){K(!1);const n=ue.map(a=>a.id===Re.id?(console.log("SECTION",w),new oe({name:se,inventoryItems:q,previewImage:l.newValue,sections:w.map(i=>new E({name:i.name,cellId:new h({x:a.sections.find(s=>s.name==i.name).cellId.x,y:a.sections.find(s=>s.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,startingItems:i.items.map(s=>new M({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new T({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:a.id})):new oe({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(i=>new E({name:i.name,cellId:new h({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,startingItems:i.startingItems.map(s=>new M({cell:new h({x:s.cell.x,y:s.cell.y}),item:new T({id:s.item.id,name:s.item.name,cellsLong:s.item.cellsLong,cellsTall:s.item.cellsTall,icon:s.item.icon,starterItem:s.item.starterItem,moveable:s.item.moveable,rotation:s.item.rotation})}))})),id:a.id}));be(re,_,n).then(()=>{console.log("Template updated successfully"),z(!1);const a=new URLSearchParams(window.location.search),i=a.get("companyId"),s=a.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${i}&areaId=${s}&type=view-area`})}})},500)):(z(!0),setTimeout(async()=>{const e=w.map(l=>new E({name:l.name,cellId:new h({x:Y.find(n=>n.name==l.name).cellId.x,y:Y.find(n=>n.name==l.name).cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,startingItems:l.items.map(n=>new M({cell:new h({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),K(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){K(!1);const n=new oe({name:se,previewImage:l.newValue,inventoryItems:q,sections:w.map(i=>new E({name:i.name,cellId:new h({x:Y.find(s=>s.name==i.name).cellId.x,y:Y.find(s=>s.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,startingItems:i.items.map(s=>new M({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new T({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:se+(Math.random()*1e4).toString()}),a=[...ue.map(i=>new oe({name:i.name,previewImage:i.previewImage,inventoryItems:i.inventoryItems,sections:i.sections.map(s=>new E({name:s.name,cellId:new h({x:s.cellId.x,y:s.cellId.y}),cellsLong:s.cellsLong,cellsTall:s.cellsTall,startingItems:s.startingItems.map(t=>new M({cell:new h({x:t.cell.x,y:t.cell.y}),item:new T({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,starterItem:t.item.starterItem,moveable:t.item.moveable,rotation:t.item.rotation})}))})),id:i.id})),n];be(re,_,a).then(()=>{console.log("Template updated successfully"),z(!1);const i=new URLSearchParams(window.location.search),s=i.get("companyId"),t=i.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${s}&areaId=${t}&type=view-area`})}})},500))},children:[me?"Create":"Save"," Template"]}),o.jsx("button",{className:"action-btn",onClick:()=>{const e=new URLSearchParams(window.location.search),l=e.get("companyId"),n=e.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${l}&areaId=${n}&type=view-area`},children:"Cancel"})]}),Ve&&o.jsxs("div",{className:"template-creation",children:[el&&o.jsx("button",{className:"action-btn",onClick:()=>{z(!0),setTimeout(async()=>{const e=w.map(l=>new E({name:l.name,cellId:new h({x:Y.find(n=>n.name==l.name).cellId.x,y:Y.find(n=>n.name==l.name).cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,startingItems:l.items.map(n=>new M({cell:new h({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),K(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){K(!1);const n=new Ge({name:Ie,previewImage:l.newValue,areaId:_,inventoryItems:q,sections:w.map(a=>new E({name:a.name,cellId:new h({x:Y.find(i=>i.name==a.name).cellId.x,y:Y.find(i=>i.name==a.name).cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,startingItems:a.items.map(i=>new M({cell:new h({x:i.sectionCell.x,y:i.sectionCell.y}),item:new T({id:i.id,name:i.name,cellsLong:i.cellsLong,cellsTall:i.cellsTall,icon:i.icon,starterItem:!0,moveable:i.moveable,rotation:i.rotation})}))})),id:we});Me(re,_,n).then(()=>{console.log("Design updated successfully"),de(!1),z(!1)})}})},500)},children:"Save"}),o.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),Te&&o.jsx(o.Fragment,{children:o.jsx("div",{className:"loader-backdrop",children:o.jsx("div",{className:"loader"})})})," ",o.jsxs("div",{className:"layout",children:[!ne&&o.jsx(xl,{isViewingDesign:ne,isEditingTemplate:te,isCreatingTemplate:me,maxHeight:g?200:R*b,showAddCustomItem:()=>{Se.current?.showModal()},addDraggingItem:al,removeItem:ke,inventoryItems:q.map(e=>new ie({item:new T({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,displayItem:!0}),quantity:e.quantity}))}),g?o.jsxs("div",{className:"mobile-areas",style:{height:y+"px"},children:[o.jsx("img",{src:fe,onClick:()=>{const e=w.findIndex(n=>n.name==L);if(e===-1)return;const l=(e-1+w.length)%w.length;pe(w[l].name),console.log("Changing viewing section to",w[l].name)},className:"back-mobile-areas"}),Ue.map((e,l)=>o.jsx(Pe,{width:e.width,height:e.height,cells:Oe(k.find(n=>n.sectionName==e.sectionName).cells),id:e.sectionName,visibile:L==null?!0:e.sectionName==L,section:e.sectionName},l)),o.jsx("img",{src:fe,onClick:()=>{const e=w.findIndex(n=>n.name==L);if(e===-1)return;const l=(e+1)%w.length;pe(w[l].name),console.log("Changing viewing section to",w[l].name)},className:"forward-mobile-areas"})]}):o.jsx(Pe,{width:F*b,height:R*b,cells:Oe(P)})]}),ne&&o.jsxs("div",{className:"design-view",children:[o.jsx("button",{className:"action-btn",onClick:()=>{const e=w.map(l=>new E({name:l.name,cellId:new h({x:Y.find(n=>n.name==l.name).cellId.x,y:Y.find(n=>n.name==l.name).cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,startingItems:l.items.map(n=>new M({cell:new h({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("printSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),window.location.href=`/LayItOut/Print/?companyId=${re}&areaId=${_}&designName=${Ie}&designId=${we}`},children:"Print"}),o.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/"},children:"Back"})]}),Ae&&o.jsx("div",{className:"design-view",children:o.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/"},children:"Back"})})]}),o.jsxs("div",{children:[w.map(e=>o.jsx(ul,{takingPhoto:!1,section:e,visible:L==null?!0:e.name==L,cellSize:b},e.cellId.toId())),I.map(e=>o.jsx(Il,{cellSize:b,isViewingDesign:ne,removeItem:ke,visible:g?!e.hasMoved&&!e.starterItem?!0:L==null?!1:e.starterItem?w.find(l=>l.name==L)?.startingItems.some(l=>l.item.id===e.id):w.find(l=>l.name==L)?.items.some(l=>l.id===e.id):!0,item:e,canPlaceItem:Ce,placeItem:sl,deleteItemRotate:il,highlightCells:cl,unHighlightCells:De,deleteItem:ol,isSelected:S===e.id,onSelect:rl,isUnselecting:ce.includes(e.id),onDeselect:()=>ml(e.id)},e.id))]}),g&&!Te&&o.jsx("div",{className:"layout-icon",onClick:()=>{he.current?.showModal(),je(!0),console.log("Showing layout dialog")},children:o.jsx("img",{src:Ll,alt:""})}),!Te&&!(me||te||ne)&&o.jsx("div",{className:"template-icon",onClick:()=>{ye.current?.showModal(),Ne(!0),console.log("Showing template dialog")},children:o.jsx("img",{src:Tl,alt:""})}),o.jsx(vl,{isViewingArea:Ae,dialogRef:ye,isOpen:Fe,closeDialog:()=>{ye.current?.close(),Ne(!1)},templates:ue,selectTemplate:e=>{z(!0),setTimeout(async()=>{const l=e.sections.map(n=>new E({name:n.name,cellId:new h({x:e.sections.find(a=>a.name==n.name).cellId.x,y:e.sections.find(a=>a.name==n.name).cellId.y}),cellsLong:n.cellsLong,cellsTall:n.cellsTall,startingItems:n.startingItems.map(a=>new M({cell:new h({x:a.cell.x,y:a.cell.y}),item:new T({id:a.item.id,name:a.item.name,cellsLong:a.item.cellsLong,cellsTall:a.item.cellsTall,icon:a.item.icon,starterItem:!0,moveable:a.item.moveable,rotation:a.item.rotation})}))}));localStorage.setItem("screenshotSections",l.map(n=>JSON.stringify(n.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",l.map(n=>JSON.stringify(n.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),K(!0),window.addEventListener("storage",async n=>{if(console.log("Storage event",n),n.key==="screenshot"){K(!1);const a=new Ge({name:Ie,previewImage:n.newValue,areaId:_,inventoryItems:e.inventoryItems,sections:e.sections.map(i=>new E({name:i.name,cellId:new h({x:e.sections.find(s=>s.name==i.name).cellId.x,y:e.sections.find(s=>s.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,startingItems:i.startingItems.map(s=>new M({cell:new h({x:s.cell.x,y:s.cell.y}),item:new T({id:s.item.id,name:s.item.name,cellsLong:s.item.cellsLong,cellsTall:s.item.cellsTall,icon:s.item.icon,starterItem:!0,moveable:s.item.moveable,rotation:s.item.rotation})}))})),id:we});console.log("UPDATED DESIGN",a),Me(re,_,a).then(()=>{console.log("Design updated successfully"),de(!1),z(!1),window.location.reload()})}})},500)}}),o.jsx(wl,{dialogRef:he,closeDialog:()=>{he.current?.close(),je(!1)},areaPreview:$e||""}),o.jsx(Sl,{dialogRef:Se,addInventoryItem:dl,closeDialog:()=>{Se.current?.close()}}),ve&&o.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:"https://trackerjo.github.io/LayItOut/Preview/",width:U*b+20,height:A*b+20})]})}
