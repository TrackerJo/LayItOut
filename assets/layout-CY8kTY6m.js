import{r as d,j as e,c as Tn}from"./index-CIvrVTT1.js";import{A as Dt,S as An,D as Nn,B as Mn}from"./booth_item-B1shCAhw.js";import{I as w,s as He,j as ge,p as Cn,C as h,V as Bt,S as W,k as z,T as xe,D as Ot,u as Wt,B as Me,l as je,m as Ce,d as En,b as Rn,n as kn,o as wt,q as Dn,r as On,t as Wn,v as Bn,A as Pn,w as Gn}from"./firestore-BIrJGVi9.js";import{F as Ke}from"./add_custom_item_dialog-ExnVy99Z.js";import"./auth-iroOyPOj.js";import{L as Fn,T as Zn}from"./link-DQZq8SUn.js";function Vn({inventoryItem:r,addDraggingItem:B,removeItem:F,setSelectedItem:L,tapAndPlaceMode:b}){const E=d.useRef(null),C=d.useRef(null),[T,G]=d.useState(12),[A,R]=d.useState(r.item),[N,P]=d.useState(!1);function v(x){const V=C.current,X=window.getComputedStyle(V),H=document.createElement("span");H.style.font=X.font,H.style.fontSize=x+"px",H.style.fontFamily=X.fontFamily,H.style.fontWeight=X.fontWeight,H.style.position="absolute",H.style.visibility="hidden",H.style.whiteSpace="nowrap",H.textContent=V.textContent,document.body.appendChild(H);const k=H.offsetWidth;return document.body.removeChild(H),k}function U(x){if(C.current){const V=C.current;return v(x-1)>V.offsetWidth&&x-1>8?U(x-1):x-1}return x}d.useEffect(()=>{setTimeout(()=>{C.current&&G(U(T))},100)},[]);const I=d.useCallback(()=>{if(console.log("MOUSE MOVE",N),N){if(P(!1),b)return;r.item.initialElement=E.current,r.item.id=r.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",r.item.id,"to initialElement",r.item.initialElement),R(new w({...r.item})),B(r.item),window.removeEventListener("mousemove",I),window.removeEventListener("touchmove",I)}},[N,b]);return d.useEffect(()=>(N?(window.addEventListener("touchmove",I),window.addEventListener("mousemove",I)):(window.removeEventListener("touchmove",I),window.removeEventListener("mousemove",I)),()=>{window.removeEventListener("touchmove",I),window.removeEventListener("mousemove",I)}),[N,I]),e.jsxs("div",{className:"display",children:[e.jsx("div",{ref:E,id:r.item.id,className:r.item.isSectionItem?"display-section":`display-item ${r.item.isSectionModifier?r.item.sectionModifierType.toString():""}`,style:{width:`${r.item.cellsLong*10}px`,height:`${r.item.cellsTall*10}px`},onMouseDown:x=>{P(!0)},onMouseUp:()=>{console.log("MOUSE UP"),P(!1)},onClick:x=>{if(!b){x.preventDefault(),x.stopPropagation();return}console.log("CLICKED ON ITEM",r.item.id,"with tap and place mode"),x.preventDefault(),x.stopPropagation(),r.item.initialElement=E.current,r.item.id=r.item.name+(Math.random()*1e4).toString(),L(r.item)},onTouchStart:x=>{b||(x.preventDefault(),x.stopPropagation(),r.item.initialElement=E.current,r.item.id=r.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",r.item.id,"to initialElement",r.item.initialElement),R(new w({...r.item})),B(r.item))},children:r.item.isSectionModifier?r.item.sectionModifierType==="LeftDoor"||r.item.sectionModifierType==="RightDoor"?e.jsx("img",{src:r.item.icon,alt:"icon"}):null:r.item.icon.includes("custom-")?e.jsx("div",{className:r.item.isSectionItem?"custom-section":"custom-icon",children:e.jsx("div",{children:e.jsx("p",{ref:C,style:{fontSize:`${T}px`},children:r.item.icon.split("custom-")[1]})})}):e.jsx("img",{src:r.item.icon,alt:"icon"})}),e.jsx("p",{children:r.item.name}),r.quantity>0&&e.jsxs("p",{className:"quantity",children:["x",r.quantity]})]})}const Pt="/LayItOut/assets/plus.circle-Ce3xm00a.png";function Yn({inventoryItems:r,addDraggingItem:B,maxHeight:F,removeItem:L,showAddCustomItem:b,isCreatingTemplate:E,isEditingTemplate:C,isViewingDesign:T,tapAndPlaceMode:G,setSelectedItem:A,isModifyingSections:R}){return e.jsxs("div",{className:"toolbox",style:{maxHeight:F?`${F}px`:"200px"},children:[r.map(N=>e.jsx(Vn,{setSelectedItem:A,tapAndPlaceMode:G,inventoryItem:N,addDraggingItem:B,removeItem:L})),!(E||C||T||R)&&e.jsx("div",{className:"add-item",onClick:()=>{b()},children:e.jsx("img",{src:Pt,alt:"Add Item"})})]})}function Jn({dialogRef:r,closeDialog:B,areaPreview:F}){return e.jsx("dialog",{ref:r,className:"layout-dialog",children:e.jsxs("div",{className:"layout-dialog-div",children:[e.jsx("h2",{children:"Layout"}),e.jsx("img",{src:F,alt:"Layout preview",className:"layout-dialog-preview"}),e.jsx("br",{}),e.jsx("button",{className:"layout-dialog-close",onClick:B,children:"Close"})]})})}const Un="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",Hn="/LayItOut/assets/template-Cjj8EPhc.png";function Xn({dialogRef:r,closeDialog:B,templates:F,isOpen:L,isViewingArea:b,selectTemplate:E,duplicateTemplate:C}){const[T,G]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[A,R]=d.useState([]),[N,P]=d.useState(!1),[v,U]=d.useState([]);return d.useEffect(()=>{U(F)},[F]),d.useEffect(()=>{if(L&&(console.log("Layout dialog opened, generating cells and sections",v),v.length!==0)){if(v.length==1){R([v[0].name]);return}R(T?[v[0].name]:[v[0].name,v[1].name])}},[L,v]),d.useEffect(()=>{const I=v.filter(x=>A.includes(x.name));console.log("Viewing templates:",A),I.sort((x,V)=>A.indexOf(x.name)-A.indexOf(V.name)),console.log("Generating templates for",I.map(x=>x.name))},[A,v]),e.jsx(e.Fragment,{children:e.jsx("dialog",{ref:r,className:"template-dialog",children:e.jsxs("div",{className:"template-dialog-div",children:[e.jsx("h2",{children:"Templates"}),e.jsxs("div",{className:"templates",children:[v.length>1&&v.filter(I=>!A.includes(I.name)).length>0&&e.jsx("img",{src:Ke,onClick:()=>{if(T){const x=(v.findIndex(V=>V.name===A[0])-1+v.length)%v.length;R([v[x].name])}else R(I=>{const V=(v.findIndex(X=>X.name===I[0])-1+v.length)%v.length;return[v[V].name,I[0]]})},className:"back-mobile-areas"}),A.length===0&&e.jsx("div",{className:"no-templates",children:"No templates available"}),A.map(I=>e.jsxs("div",{className:"template",children:[e.jsx("img",{src:v.find(x=>x.name===I).previewImage,alt:I,className:"template-preview"}),e.jsx("h3",{children:I}),e.jsxs("div",{className:"template-actions",children:[e.jsx("button",{className:"template-select-btn",onClick:()=>{if(b){const x=new URLSearchParams(window.location.search),V=x.get("companyId"),X=x.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${V}&areaId=${X}&type=edit-template&templateId=${v.find(H=>H.name==I).id}`}else B(),E&&E(v.find(x=>x.name===I))},children:b?"Edit":"Select"}),b&&e.jsx("button",{className:"action-btn",onClick:()=>{N||(P(!0),C&&C(v.find(x=>x.name===I)))},children:"Duplicate"}),b&&e.jsx("button",{className:"action-btn",onClick:()=>{if(N)return;P(!0);const x=v.filter(k=>k.name!==I);U(x),x.length==1?R([x[0].name]):x.length==0?R([]):R(T?[x[0].name]:[x[0].name,x[1].name]);const V=new URLSearchParams(window.location.search),X=V.get("companyId"),H=V.get("areaId");He(X,H,x).then(()=>{P(!1)})},children:"Delete"})]})]})),v.length>1&&v.filter(I=>!A.includes(I.name)).length>0&&e.jsx("img",{src:Ke,onClick:()=>{if(T){const x=(v.findIndex(V=>V.name===A[0])+1)%v.length;R([v[x].name])}else R(I=>{const V=(v.findIndex(X=>X.name===I[I.length-1])+1)%v.length;return[I[1],v[V].name]})},className:"forward-mobile-areas"})]}),b&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"action-btn",onClick:()=>{const I=new URLSearchParams(window.location.search),x=I.get("companyId"),V=I.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${x}&areaId=${V}&type=create-template`},children:"Create new Template"})," ",e.jsx("br",{})]}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:B,children:"Close"}),N&&L&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"loader"})})]})})})}function Qn({dialogRef:r,closeDialog:B,addInventoryItem:F,canBeBooth:L}){const[b,E]=d.useState(""),[C,T]=d.useState(1),[G,A]=d.useState(1),[R,N]=d.useState(1),[P,v]=d.useState(!1);return e.jsx("dialog",{ref:r,className:"custom-item-dialog",children:e.jsxs("div",{className:"custom-item-dialog-div",children:[e.jsx("h2",{children:"Add Custom Item"}),e.jsxs("div",{className:"custom-item-row",children:[e.jsx("label",{htmlFor:"item-name",children:"Name:"}),e.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:U=>E(U.target.value??""),value:b})]}),e.jsxs("div",{className:"custom-item-row",children:[e.jsx("label",{htmlFor:"item-icon",children:"Count:"}),e.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:C,onChange:U=>T(parseInt(U.target.value)??1)})]}),e.jsxs("div",{className:"custom-item-row custom-item-size",children:[e.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),e.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:G,onChange:U=>A(parseFloat(U.target.value)??1)}),e.jsx("span",{children:" x "}),e.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:R,onChange:U=>N(parseFloat(U.target.value)??1)})]}),L?e.jsxs("div",{className:"custom-item-row",children:[e.jsx("label",{htmlFor:"is-booth",children:"Is Booth:"}),e.jsx("input",{type:"checkbox",id:"is-booth",name:"is-booth",checked:P,onChange:U=>v(U.target.checked)})]}):null,e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{if(b.trim()===""){alert("Item name cannot be empty");return}const U=new ge({quantity:C,item:new w({id:b+(Math.random()*1e4).toString(),name:b,icon:`custom-${b}`,cellsLong:Math.ceil(G),cellsTall:Math.ceil(R),moveable:!0,starterItem:!1,displayItem:!0,isBooth:P})});F(U),E(""),T(1),A(1),N(1),v(!1),B()},children:"Add Item"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{B(),E(""),T(1),A(1),N(1),v(!1)},children:"Close"})]})})}function zn({dialogRef:r,closeDialog:B,addSection:F}){const[L,b]=d.useState(""),[E,C]=d.useState(1),[T,G]=d.useState(1);return e.jsx("dialog",{ref:r,className:"section-dialog",children:e.jsxs("div",{className:"section-dialog-div",children:[e.jsx("h2",{children:"Add Section"}),e.jsxs("div",{className:"section-row",children:[e.jsx("label",{htmlFor:"section-name",children:"Name:"}),e.jsx("input",{type:"text",id:"section-name",name:"section-name",onChange:A=>b(A.target.value??""),value:L})]}),e.jsxs("div",{className:"section-row section-size",children:[e.jsx("label",{htmlFor:"section-width",children:"Size (in feet):"}),e.jsx("input",{type:"number",id:"section-width",name:"section-width",min:"1",value:E,onChange:A=>C(parseFloat(A.target.value)??1)}),e.jsx("span",{children:" x "}),e.jsx("input",{type:"number",id:"section-height",name:"section-height",min:"1",value:T,onChange:A=>G(parseFloat(A.target.value)??1)})]}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{if(L.trim()===""){alert("Section name cannot be empty");return}const A=new ge({quantity:1,item:new w({id:L+(Math.random()*1e4).toString(),name:L,icon:`custom-${L}`,cellsLong:Math.ceil(E),cellsTall:Math.ceil(T),moveable:!0,starterItem:!1,displayItem:!0,isSectionItem:!0})});F(A),b(""),C(1),G(1),B()},children:"Add Section"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:B,children:"Close"})]})})}function qn({dialogRef:r,closeDialog:B,addInventoryItem:F}){const[L,b]=d.useState(null),[E,C]=d.useState(""),[T,G]=d.useState(1),[A,R]=d.useState(1),[N,P]=d.useState(1),[v,U]=d.useState(!0);return e.jsx("dialog",{ref:r,className:"inventory-item-dialog",children:e.jsxs("div",{className:"inventory-item-dialog-div",children:[e.jsx("h2",{children:"Add Inventory Item"}),L==null?e.jsxs(e.Fragment,{children:["  ",e.jsx("label",{htmlFor:"",children:"Premade Items:"}),e.jsx("div",{className:"inventory-item-list",children:Cn.map(I=>e.jsx("div",{className:"inventory-item",onClick:()=>{const x=new ge({quantity:1,item:new w({id:I.name+(Math.random()*1e4).toString(),name:I.name,icon:I.icon,cellsLong:I.cellsLong,cellsTall:I.cellsTall,moveable:!0,starterItem:!1,displayItem:!0})});b(x)},children:e.jsxs("div",{className:"inventory-item-display",children:[e.jsx("img",{src:I.icon,alt:"icon"}),e.jsx("p",{children:I.name}),e.jsxs("p",{className:"quantity",children:[I.cellsLong,"ft x ",I.cellsTall,"ft"]})]})},I.name))}),e.jsx("label",{htmlFor:"",children:"Or:"}),e.jsx("label",{htmlFor:"",children:"Custom Item:"}),e.jsxs("div",{className:"inventory-item-row",children:[e.jsx("label",{htmlFor:"item-name",children:"Name:"}),e.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:I=>C(I.target.value??""),value:E})]}),e.jsxs("div",{className:"inventory-item-row",children:[e.jsx("label",{htmlFor:"item-icon",children:"Count:"}),e.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:T,onChange:I=>G(parseInt(I.target.value)??1)})]}),e.jsxs("div",{className:"inventory-item-row inventory-item-size",children:[e.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),e.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:A,onChange:I=>R(parseFloat(I.target.value)??1)}),e.jsx("span",{children:" x "}),e.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:N,onChange:I=>P(parseFloat(I.target.value)??1)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),e.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:v,onChange:I=>U(I.target.checked)})]}),e.jsx("br",{})]}):e.jsxs(e.Fragment,{children:[e.jsxs("label",{htmlFor:"",children:["Item: ",L.item.name]}),e.jsxs("div",{className:"inventory-item-row",children:[e.jsx("label",{htmlFor:"item-icon",children:"Count:"}),e.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:T,onChange:I=>G(parseInt(I.target.value)??1)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),e.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:v,onChange:I=>U(I.target.checked)})]})]}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{if(E.trim()===""&&L==null){alert("Item name cannot be empty");return}if(T<=0){alert("Item count must be greater than zero");return}let I=L;I==null?I=new ge({quantity:T,item:new w({id:E+(Math.random()*1e4).toString(),name:E,icon:`inventory-${E}`,cellsLong:Math.ceil(A),cellsTall:Math.ceil(N),moveable:v,starterItem:!1,displayItem:!0})}):(I.quantity=T,I.item.moveable=v),F(I),U(!0),b(null),C(""),G(1),R(1),P(1),B()},children:"Add Item"}),e.jsx("button",{className:"action-btn",onClick:B,children:"Close"})]})})}function $n({item:r,setSelectingItem:B,addHighlightedCell:F,canPlaceItem:L,placeItem:b,highlightCells:E,unHighlightCells:C,cellSize:T,placeMultiItem:G}){const[A,R]=d.useState(0),[N,P]=d.useState(0),v=d.useRef(null),[U,I]=d.useState(0),[x,V]=d.useState(0),[X,H]=d.useState(!1),[k,re]=d.useState(0),[le,Ee]=d.useState(null),[xt,fe]=d.useState(!0),[Ae,Xe]=d.useState(12),[Ne,Qe]=d.useState(null),ze=d.useRef(null),[Pe,vt]=d.useState(!0),[Ge,oe]=d.useState(!1),[ae,j]=d.useState(!1),ie=d.useCallback(M=>{const y=M%2===1;return{width:y?r.cellsTall*T:r.cellsLong*T,height:y?r.cellsLong*T:r.cellsTall*T,cellsWide:y?r.cellsTall:r.cellsLong,cellsTall:y?r.cellsLong:r.cellsTall}},[r,T]);function _e(M){const y=v.current,ee=window.getComputedStyle(y),D=document.createElement("span");D.style.font=ee.font,D.style.fontSize=M+"px",D.style.fontFamily=ee.fontFamily,D.style.fontWeight=ee.fontWeight,D.style.position="absolute",D.style.visibility="hidden",D.style.whiteSpace="nowrap",D.textContent=y.textContent,document.body.appendChild(D);const ce=D.offsetWidth;return document.body.removeChild(D),ce}function Fe(M){if(v.current){const y=v.current;return _e(M-1)>y.offsetWidth&&M-1>8?Fe(M-1):M-1}return M}const ve=()=>{oe(!0)},Re=()=>{oe(!1)};d.useEffect(()=>(setTimeout(()=>{v.current&&Xe(Fe(Ae))},100),window.addEventListener("mousedown",ve),window.addEventListener("mouseup",Re),()=>{window.removeEventListener("mousedown",ve),window.removeEventListener("mouseup",Re)}),[]),d.useEffect(()=>{if(r){H(!0);const M=ze.current?.getBoundingClientRect();Qe({x:M?M.left-A:0,y:M?M.top-N:0})}else console.log("No item to place, stopping dragging"),H(!1),Qe(null),R(0),P(0),I(0),V(0),re(0),Ee(null),fe(!0),Xe(12),vt(!0)},[r]);const Le=M=>{M.preventDefault()},Te=d.useCallback((M,y,ee)=>{if(r==null||!X||!Ne)return;console.log("PLACING MOVE",r);const D=ee.target,ce=ie(k),Y=w.fromDoc(r.toDoc());Y.cellsLong=ce.cellsWide,Y.cellsTall=ce.cellsTall,Y.initialElement=r.initialElement,Y.rotation=k,Y.hasMoved=r.hasMoved,Y.id=r.id;let pe=D;if(!pe||!pe.classList?.contains("cell")){const Ie=document.elementFromPoint(M,y);Ie?.classList?.contains("cell")&&(pe=Ie)}pe?.classList?.contains("cell")&&!ae?E(h.fromString(pe.id),Y):pe?.classList?.contains("section-modifier")&&!ae?E(h.fromString(pe.dataset.cell),Y):ae||C(),R(M-Ne.x),P(y-Ne.y+(r.sectionModifierType?.includes("Door")?10:5)),Ge&&(ae||C(),j(!0),F(h.fromString(pe.id)))},[r,X,A,N,ae,Ge,Ne,L,b,ie,k,E,C,ze]),he=d.useCallback(M=>{if(r==null)return;const y=M.clientX,ee=M.clientY;console.log("Drag ended"),C(),document.body.removeEventListener("touchmove",Le);const D=document.elementFromPoint(y,ee);if(!D?.classList?.contains("cell")&&!D?.classList?.contains("section-modifier")){const ce=ie(k),Y={...r,cellsLong:ce.cellsWide,cellsTall:ce.cellsTall};ae?(j(!1),G(Y)):B()}else if(D?.classList?.contains("section-modifier")){if(console.log("Placing item on section modifier cell"),console.log("Target element:",D.dataset.cell),D.dataset.cell=="")return;const ce=ie(k),Y={...r,cellsLong:ce.cellsWide,cellsTall:ce.cellsTall};if(ae)j(!1),G(Y);else{if(!L(h.fromString(D.dataset.cell),Y))return;b(h.fromString(D.dataset.cell),Y,le!=null?h.fromString(le.id):null)}console.log("Placed item at cell:",D)}else{const ce=ie(k),Y={...r,cellsLong:ce.cellsWide,cellsTall:ce.cellsTall};if(ae)j(!1),G(Y);else{if(!L(h.fromString(D.id),Y))return;b(h.fromString(D.id),Y,le!=null?h.fromString(le.id):null)}console.log("Placed item at cell:",D)}},[r,k,B,ae,L,b,le,C,U,x]),Ze=d.useCallback(M=>{const y=M.clientX,ee=M.clientY;Te(y,ee,M)},[Te]),Ve=d.useCallback(M=>{const y=M.touches[0],ee=y.clientX,D=y.clientY;Te(ee,D,M)},[Te]),Z=d.useCallback(M=>{const y=M.changedTouches[0],ee=y.clientX,D=y.clientY;he({clientX:ee,clientY:D}),document.body.removeEventListener("touchmove",Le)},[he,Le]);return d.useEffect(()=>{if(X)return document.body.addEventListener("touchmove",Le,{passive:!1}),document.addEventListener("mousemove",Ze),document.addEventListener("mouseup",he),document.addEventListener("touchmove",Ve),document.addEventListener("touchend",Z),()=>{document.body.removeEventListener("touchmove",Le),document.removeEventListener("mousemove",Ze),document.removeEventListener("mouseup",he),document.removeEventListener("touchmove",Ve),document.removeEventListener("touchend",Z)}},[X,Ze,he,Ve,Z,Le]),A==0||N==0||!Pe||r==null?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsx("div",{id:r.id,ref:ze,className:`draggable-item ${r.isSectionModifier&&!r.moveable?"placed-modifier":""} ${r.isSectionModifier?r.sectionModifierType?.toString():""} ${X?"dragging":""} ${r.moveable?"":"not-moveable"}`,style:{top:`${N}px`,left:`${A}px`,width:`${r.cellsLong*(r.isDisplayItem&&!X&&!r.hasMoved?10:T)-(r.sectionModifierType=="LeftWall"||r.sectionModifierType=="RightWall"||r.sectionModifierType?.includes("Corner")?1:0)}px`,height:`${r.cellsTall*(r.isDisplayItem&&!X&&!r.hasMoved?10:T)-(r.sectionModifierType=="TopWall"||r.sectionModifierType=="BottomWall"||r.sectionModifierType?.includes("Corner")?1:0)}px`,rotate:`${k*90}deg`,transformOrigin:"center center",fontSize:`${Ae}px`,zIndex:X?1e3:1},children:r.isSectionModifier?null:r.icon.includes("custom-")?e.jsx("div",{className:r.isSectionItem?"custom-section":"custom-icon",children:e.jsx("div",{children:e.jsx("p",{ref:v,children:r.icon.split("custom-")[1]})})}):e.jsx("img",{src:r.icon,alt:"icon"})})})}const Kn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE02lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTE2PC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmRiZTM1YTM5LWE0MDUtNDM2MC04YzRjLWI3NmJmMTY3Mjc1YjwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5hZGQtaXRlbSAtIDc8L3JkZjpsaT4KICAgPC9yZGY6QWx0PgogIDwvZGM6dGl0bGU+CiA8L3JkZjpEZXNjcmlwdGlvbj4KCiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogIHhtbG5zOnBkZj0naHR0cDovL25zLmFkb2JlLmNvbS9wZGYvMS4zLyc+CiAgPHBkZjpBdXRob3I+U2FyYWggS2VtbWVOYXNoPC9wZGY6QXV0aG9yPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp4bXA9J2h0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8nPgogIDx4bXA6Q3JlYXRvclRvb2w+Q2FudmEgKFJlbmRlcmVyKSBkb2M9REFHdTJ5dUVOWkEgdXNlcj1VQUZqR1c2eHRDUSBicmFuZD1bQVJDSElWRURdIEZvcnQgV2F5bmUgQ29tbXVuaXR5IFNjaG9vbHMgdGVtcGxhdGU9PC94bXA6Q3JlYXRvclRvb2w+CiA8L3JkZjpEZXNjcmlwdGlvbj4KPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0ncic/PupmVZwAAAT8SURBVHic7d1PaBxVHMDxX41Wh6DsE1FcweGltiAUpE7Vanm9BGzGqvGgJ9e/bRSliHrwkIueiif/gShkVFRGLCbR4p8ulSBMEEul7+rJF6jgXqQTFSEiK15m4yTZze7MvJn3m5nf95p9+xv4MLOZycxmB1Co2mF6A6iNEQiyCARZBIIsAkEWgSCLQJBFIMgiEGQRCLIIBFkEgiwCGVCDi7GJydnjbOLQEQC4AQBUqAJfeu6nec4lkD41uLjcmWl/AQBTm38WquAd6bnP5jV7LK83LmsRxucA4Pb7ucXs2xgX13ek/1Ue8wkk1jCMXhaz9zMurutI/2vd20AgUQ0udkaHqW0xekV7yrUd6X+jczsIBNYxFgDgSJJ1Eco1Hemf1rUttQeJYdybZr3F7NsZF1d3pN/WsT21BmlwcZkz016ElBi9LGbfwbhgOlBqDXLwpZ8WAeB+He9lMfsA4+KqjvTPZHmfWoMwLpoWsw/rej+L2XcyLq7MglJrkI70f2Bc/KkZ5S7GxXhH+t+mWV9rEIB1lD80oxxkXFzsSP9c0rW1BwEA6Ej/LOPid4vZWy6VpM1i9oFQLb+2tnrh3yTrLtG1AZhrcLFz8sRfLze4sAa9RnruG6EKXtQ4lrEJsTfposqDROcZ8wDwijPT/rLBxRWDXis99/VQBc9rHP930gWVvto74KTvzPm5qenVleW1QetuPXb6OTZx6M2M439Zmh2/Memiyu4hsT1j80nf3c5M+9SQPeWtUAUvZJmf9vBXyQ/12J5x34CX7Go6rf2hWp5fW73Q7feC6IP+osXskS42xgtV8LT03I+TrgOoIEiCa1M3NZ2WMwTlHOPiN4vZ94w6P1TBU9Jz55Jsc7xKgaS4ULh7BJQfR0UJVXBUeu57SbZ5c5UByXDVdnfTae3LihKq4EnpuR8knL2lSoBkvYQOAHsilIUUKN1QBY9Jz/0o5ewNlR5EA0avNCjdUAWPSs/1M85er9QgGjF67Wk6rVsilL6XPGIoh0MVPKz7tqDSnhjGzjMG/WqbpVPn56YeWl1Z/mfQC/jk7K6VpRM/6x5cSpAc9ox+DUXJo9KdqReEAQAw7cy0Tza4uDTnORsq1WdIgRi9bm46rb2hWl5Mehk9baU5ZEU3JMyDpr+BJ2xhaXb8wSIGleKQFWF8BmYwIFTBd0XNQr+HxDCmTcwPVXBceu7bRc1DDVI3DADEIHXEAEAKUlcMAIQgdcYAQAZSdwwARCAIMJ6RnvuuidnxUIAQxv8ZByGMjRkFIYytGQMhjP4ZASGMwRUOQhjbVygIAoxMN7EVUWEghDFahYAQxujlDkIYycoVhDCSlxsIYaQrFxDCSJ92EAQYx7I+EmAyrSAIMI5Kz33fxGxdaQMhDD1pASEMfWUGIQy9ZQIhDP2lBiGMfEoFggBDywOWGEsM0uBiLLoL/YEctmdooQoel577oYnZRZT47nc2IfaBOYwnqowBAJDm6SAjjzBUfc/oVYrnQ+qCAVACkDphACAHqRsGAF6QbqiCR+qGAZDuQz3vel9X8YnpDTERtj2k1hgAuEBqjwGAB4QwojCAEEYs0yCEsSmTv2V1QxW08v43dGXLFEg3+vKvk4bmo83EIYswtinNHvIrALyadmCogu+l5+byPwCrkPGHPqmNEQiyCARZBIIsAkEWgSCLQJBFIMgiEGQRCLIIBFkEgqz/ADvdpRk/dmKqAAAAAElFTkSuQmCC";function _n({vendor:r,onDelete:B,onEdit:F,boothMap:L}){return e.jsxs("div",{className:"vendor-display-tile",children:[e.jsxs("div",{className:"vendor-info",children:[e.jsx("h3",{className:"vendor-business-name",children:r.businessName}),e.jsxs("p",{className:"vendor-plot-size",children:[r.plotWidth,"ft x ",r.plotHeight,"ft"]})]}),e.jsxs("div",{className:"vendor-actions",children:[e.jsx("img",{src:Fn,alt:"Share",className:"vendor-link",onClick:async b=>{b.stopPropagation();const E=localStorage.getItem("companyId"),C=window.location.origin+`/LayItOut/Layout/?companyId=${E}&areaId=${L.areaId}&type=pick-booth&boothMapId=${L.id}&boothMapName=${L.name}&vendorId=${r.id}`;await navigator.clipboard.writeText(C),alert("BoothMap link copied to clipboard!")}}),e.jsx("img",{src:Kn,alt:"Edit",className:"vendor-edit",onClick:b=>{b.stopPropagation(),F(r.id)}}),e.jsx("img",{src:Zn,alt:"Delete",className:"vendor-delete",onClick:b=>{b.stopPropagation(),window.confirm("Are you sure you want to delete this vendor?")&&B(r.id)}})]})]})}function el({maxHeight:r,vendors:B,onAddVendor:F,boothMap:L,onDeleteVendor:b,onEditVendor:E}){return e.jsxs("div",{className:"vendors-tile",style:{maxHeight:r?`${r}px`:"200px"},children:[e.jsx("h2",{children:"Vendors"}),e.jsx("div",{className:"vendors-divider"}),e.jsxs("div",{className:"vendors-tile-content",children:[B.map(C=>e.jsx(_n,{vendor:C,boothMap:L,onDelete:T=>{b(T)},onEdit:T=>{E(C)}},C.id)),e.jsx("div",{className:"add-vendor",onClick:F,children:e.jsx("img",{src:Pt,alt:"Add vendor"})})]})]})}function tl({dialogRef:r,closeDialog:B,addVendor:F}){const[L,b]=d.useState(""),[E,C]=d.useState(1),[T,G]=d.useState(1),[A,R]=d.useState(!1);return e.jsxs("dialog",{ref:r,className:"add-vendor-dialog",children:[e.jsxs("div",{className:"add-vendor-dialog-div",children:[e.jsx("h2",{children:"Add Vendor"}),e.jsxs("div",{className:"add-vendor-row",children:[e.jsx("label",{htmlFor:"business-name",children:"Business Name:"}),e.jsx("input",{type:"text",id:"business-name",name:"business-name",onChange:N=>b(N.target.value??""),value:L})]}),e.jsxs("div",{className:"add-vendor-row add-vendor-size",children:[e.jsx("label",{htmlFor:"item-width",children:"Booth Size (in feet):"}),e.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:E,onChange:N=>C(parseFloat(N.target.value)??1)}),e.jsx("span",{children:" x "}),e.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:T,onChange:N=>G(parseFloat(N.target.value)??1)})]}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:async()=>{if(L.trim()===""){alert("Business name cannot be empty");return}const N=new Bt({id:L+(Math.random()*1e4).toString(),businessName:L,plotWidth:Math.ceil(E),plotHeight:Math.ceil(T)});R(!0),await F(N),b(""),C(1),G(1),R(!1),B()},children:"Add Vendor"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{B(),b(""),C(1),G(1)},children:"Close"})]}),A&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"loader"})})]})}function nl({dialogRef:r,closeDialog:B,editVendor:F,oldVendor:L}){const[b,E]=d.useState(""),[C,T]=d.useState(1),[G,A]=d.useState(1),[R,N]=d.useState(!1);return d.useEffect(()=>{L&&(E(L.businessName),T(L.plotWidth),A(L.plotHeight))},[L]),e.jsxs("dialog",{ref:r,className:"edit-vendor-dialog",children:[e.jsxs("div",{className:"edit-vendor-dialog-div",children:[e.jsx("h2",{children:"Edit Vendor"}),e.jsxs("div",{className:"edit-vendor-row",children:[e.jsx("label",{htmlFor:"business-name",children:"Business Name:"}),e.jsx("input",{type:"text",id:"business-name",name:"business-name",onChange:P=>E(P.target.value??""),value:b})]}),e.jsxs("div",{className:"edit-vendor-row edit-vendor-size",children:[e.jsx("label",{htmlFor:"item-width",children:"Booth Size (in feet):"}),e.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:C,onChange:P=>T(parseFloat(P.target.value)??1)}),e.jsx("span",{children:" x "}),e.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:G,onChange:P=>A(parseFloat(P.target.value)??1)})]}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:async()=>{if(b.trim()===""){alert("Business name cannot be empty");return}const P=new Bt({id:L.id,businessName:b,plotWidth:Math.ceil(C),plotHeight:Math.ceil(G)});N(!0),await F(P),E(""),T(1),A(1),N(!1),B()},children:"Save Vendor"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{B(),E(L.businessName),T(L.plotWidth),A(L.plotHeight)},children:"Close"})]}),R&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"loader"})})]})}function ll({maxHeight:r}){return e.jsxs("div",{className:"key-tile",children:[e.jsx("h2",{children:"Key"}),e.jsx("div",{className:"key-divider"}),e.jsxs("div",{className:"key-tile-content",children:[e.jsxs("div",{className:"key-item",children:[e.jsx("div",{className:"cell cell-border"}),e.jsx("p",{children:"1ft x 1ft"})]}),e.jsxs("div",{className:"key-item",children:[e.jsx("div",{className:"container",children:e.jsx("div",{className:"wall"})}),e.jsx("p",{children:"Wall"})]}),e.jsxs("div",{className:"key-item",children:[e.jsx("div",{className:"window-container",children:e.jsx("div",{className:"window"})}),e.jsx("p",{children:"Window"})]}),e.jsxs("div",{className:"key-item",children:[e.jsx("div",{className:"container",children:e.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fright_door.png?alt=media&token=8c6f3b4d-5e7a-4b9c-8d2f-0a3b5e6f7c8d",alt:"",className:"door"})}),e.jsx("p",{children:"Door"})]}),e.jsxs("div",{className:"key-item",children:[e.jsx("div",{className:"window-container",children:e.jsx("div",{className:"section-divider"})}),e.jsx("p",{children:"Section Divider"})]})]})]})}function ol({dialogRef:r,closeDialog:B,vendors:F,addVendorToBooth:L}){const[b,E]=d.useState(!1),[C,T]=d.useState(null);return e.jsxs("dialog",{ref:r,className:"add-vendor-dialog",children:[e.jsxs("div",{className:"add-vendor-dialog-div",children:[e.jsx("h2",{children:"Select Vendor"}),e.jsxs("div",{className:"add-vendor-row",children:[e.jsx("label",{htmlFor:"boothMap-area",children:"Vendor:"}),e.jsxs("select",{id:"boothMap-area",name:"boothMap-area",onChange:G=>{const A=G.target.value,R=F.find(N=>N.id===A)||null;T(R)},value:C?.id||"",children:[e.jsx("option",{value:"",children:"Select a Vendor"}),F.map(G=>e.jsx("option",{value:G.id,children:G.businessName},G.id))]})]}),e.jsx("button",{className:"action-btn",onClick:()=>{if(!C){alert("Please select a vendor");return}E(!0),L(C)},children:"Select"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{B(),T(null)},children:"Close"})]}),b&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"loader"})})]})}Tn.createRoot(document.getElementById("root")).render(e.jsx(sl,{}));function sl(){const[r,B]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[F,L]=d.useState(0),[b,E]=d.useState(0),[C,T]=d.useState(0),[G,A]=d.useState(0),[R,N]=d.useState([]),[P,v]=d.useState([]),[U,I]=d.useState(0),[x,V]=d.useState(null),[X,H]=d.useState([]),k=/Mobi|Android/i.test(navigator.userAgent)?5:10,[re,le]=d.useState([]),[Ee,xt]=d.useState(!1),[fe,Ae]=d.useState(null),[Xe,Ne]=d.useState(null),[Qe,ze]=d.useState([new w({id:"left-wall",name:"Left Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWall"}),new w({id:"right-wall",name:"Right Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWall"}),new w({id:"top-wall",name:"Top Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWall"}),new w({id:"bottom-wall",name:"Bottom Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWall"}),new w({id:"left-door",name:"Left Door",cellsLong:1,cellsTall:1,icon:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fleft_door.png?alt=media&token=91fde31c-ebc6-4807-9670-f846c8d75cb6",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftDoor"}),new w({id:"right-door",name:"Right Door",cellsLong:1,cellsTall:1,icon:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fright_door.png?alt=media&token=8c6f3b4d-5e7a-4b9c-8d2f-0a3b5e6f7c8d",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightDoor"}),new w({id:"left-window",name:"Left Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWindow"}),new w({id:"right-window",name:"Right Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWindow"}),new w({id:"top-window",name:"Top Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWindow"}),new w({id:"bottom-window",name:"Bottom Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWindow"})]),Pe=d.useRef(null),[vt,Ge]=d.useState(!1),[oe,ae]=d.useState([]),[j,ie]=d.useState([]),[_e,Fe]=d.useState([]),[ve,Re]=d.useState([]),[Le,Te]=d.useState(!1),he=d.useRef(null),[Ze,Ve]=d.useState([]),[Z,M]=d.useState([]),[y,ee]=d.useState(null),[D,ce]=d.useState(!1),[Y,pe]=d.useState(!1),[Ie,Gt]=d.useState(!1),[Ye,Ft]=d.useState(!1),[te,Zt]=d.useState(!1),[$,et]=d.useState("placing-sections"),[il,Vt]=d.useState(!1),[Se,Yt]=d.useState(!1),[qe,Jt]=d.useState(!1),[Je,Ut]=d.useState(!1),[Ht,Xt]=d.useState(!1),[Ue,tt]=d.useState(""),[$e,Qt]=d.useState(null),[ke,St]=d.useState(""),[J,zt]=d.useState(""),[qt,$t]=d.useState(null),[q,Kt]=d.useState(""),[nt,_t]=d.useState(null),[lt,ot]=d.useState(""),[bt,st]=d.useState(""),[ne,De]=d.useState(null),[it,Q]=d.useState(!0),[jt,en]=d.useState(null),[at,ye]=d.useState(!1),[tn,nn]=d.useState(null),[ln,Lt]=d.useState([]),[on,Oe]=d.useState(!1),[be,sn]=d.useState(null),[ct,an]=d.useState(!1),[cn,rn]=d.useState(null),[rt,dn]=d.useState(null),dt=d.useRef(null),mt=d.useRef(null),gt=d.useRef(null),ut=d.useRef(null),ft=d.useRef(null),ht=d.useRef(null);function we(n,t){for(const o of t)if(n.x>=o.cellId.x&&n.x<o.cellId.x+o.cellsLong&&n.y>=o.cellId.y&&n.y<o.cellId.y+o.cellsTall)return o;return null}function mn(n,t,o,a){ae([...n.map(l=>new W({name:l.name,cellId:new h({x:l.cellId.x,y:l.cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,modifierItems:l.modifierItems.map(s=>new z({cell:new h({x:s.cell.x,y:s.cell.y}),item:new w({...s.item,starterItem:!0})})),startingItems:[]}))]);let i=F,c=b;if(r){for(const u of n)console.log("Generating cells for section",u.name,"at",u.cellId,"with size",u.cellsLong,"x",u.cellsTall),console.log("Needed section Width:",(u.cellsLong+u.cellId.x)*k,"Current width:",i),(u.cellsLong+u.cellId.x)*k>i&&(console.log("Added section Width:",u.cellsLong*k+u.cellId.x),i+=(u.cellsLong+u.cellId.x)*k-i),console.log("Needed section Height:",(u.cellsTall+u.cellId.y)*k,"Current height:",c),(u.cellsTall+u.cellId.y)*k>c&&(console.log("Added section Height:",u.cellsTall*k+u.cellId.y),c+=(u.cellsTall+u.cellId.y)*k-c);A(c/k*2),T(i/k*2);let l=0;const s=[],g=[];for(const u of n){const f=[],S={width:u.cellsLong*k,height:u.cellsTall*k,sectionName:u.name};S.height>l&&(l=S.height),Ve(O=>[...O,S]),u.cellId.x=0,u.cellId.y=0,[...Array(S.height/k).keys()].map(O=>{const de=[];[...Array(S.width/k).keys()].map(se=>{de.push({id:new h({x:se,y:O}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:k})}),f.push(de)}),s.push({sectionName:u.name,cells:[...f]}),g.push(u)}M(s),ie(g),I(l),ee(n[0]?n[0].name:null),setTimeout(()=>{Q(!1)},500)}else{const l=[];for(const s of n)console.log("Generating cells for section",s.name,"at",s.cellId,"with size",s.cellsLong,"x",s.cellsTall),console.log("Needed section Width:",s.cellsLong+s.cellId.x,"Current width:",i),s.cellsLong+s.cellId.x>i&&(console.log("Added section Width:",s.cellsLong+s.cellId.x),i+=s.cellsLong+s.cellId.x-i),console.log("Needed section Height:",s.cellsTall+s.cellId.y,"Current height:",c),s.cellsTall+s.cellId.y>c&&(console.log("Added section Height:",s.cellsTall+s.cellId.y),c+=s.cellsTall+s.cellId.y-c);L(t.width),E(t.height),T(t.width),A(t.height),console.log("Final width:",i,"Final height:",c),[...Array(t.height).keys()].map(s=>{const g=[];[...Array(t.width).keys()].map(u=>{console.log("Creating cell at",u,s,"with size",k,o),g.push({id:new h({x:u,y:s}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:o&&a=="placing-sections"?!0:we(new h({x:u,y:s}),n)!=null,size:k})}),l.push(g)}),N([...l]),setTimeout(()=>{const s=[],g=[...n],u=[];for(const f of g)f.cellElement=document.querySelector(`.App #${f.cellId.toId()}.cell:not(.cell-border)`),s.push(...f.startingItems.map(S=>new z({cell:new h({x:f.cellId.x+S.cell.x,y:f.cellId.y+S.cell.y}),item:new w({...S.item,initialElement:document.querySelector(`.App #${S.cell.toId()}.cell:not(.cell-border)`),starterItem:!0})}))),s.push(...f.modifierItems.map(S=>new z({cell:new h({x:f.cellId.x+S.cell.x,y:f.cellId.y+S.cell.y}),item:new w({...S.item,initialElement:document.querySelector(`.App #${S.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1})}))),u.push(...f.booths.map(S=>new je({...S,cell:new h({x:f.cellId.x+S.cell.x,y:f.cellId.y+S.cell.y}),initialElement:document.querySelector(`.App #${S.cell.toId()}.cell:not(.cell-border)`)})));ie([...g]);for(const f of s){const S=se=>{const me=se%2===1;return{cellsLong:me?f.item.cellsTall:f.item.cellsLong,cellsTall:me?f.item.cellsLong:f.item.cellsTall}},O=f.item.rotation||0,de=S(O);for(let se=0;se<de.cellsTall;se++)for(let me=0;me<de.cellsLong;me++)l[f.cell.y+se][f.cell.x+me].hasItem=!0,l[f.cell.y+se][f.cell.x+me].itemId=f.item.id;f.item.initialElement=document.querySelector(`.App #${f.cell.toId()}.cell:not(.cell-border)`),v(se=>[...se,f.item])}for(const f of u){for(let S=0;S<f.cellsTall;S++)for(let O=0;O<f.cellsLong;O++)l[f.cell.y+S][f.cell.x+O].hasItem=!0,l[f.cell.y+S][f.cell.x+O].itemId=f.id;f.initialElement=document.querySelector(`.App #${f.cell.toId()}.cell:not(.cell-border)`),Fe(S=>[...S,f])}N([...l]),setTimeout(()=>{Q(!1)},500)},100)}}async function gn(){const n=new URLSearchParams(window.location.search),t=n.get("companyId"),o=n.get("areaId"),a=n.get("areaId")||"",i=n.get("companyId")||"",c=n.get("templateId")||"",l=await kn(i,a);if(l===null){window.location.href="/LayItOut/DNF/";return}_t(l),nn(l.previewImage||null);const s=n.get("type")||"";let g=!1,u=!1,f="modify-sections",S=!1,O=null;if(s==="create-template")ce(!0);else if(s==="edit-template"){pe(!0);const m=l.templates.find(p=>p.id===c);m&&(en(m),St(m.name))}else if(s==="view-design"){g=!0,Gt(!0);const m=n.get("designName")||"";tt(m);const p=n.get("designId")||"";ot(p)}else if(s==="view-area")Ft(!0);else if(s==="edit-design"){g=!0,Vt(!0);const m=n.get("designName")||"";tt(m);const p=n.get("designId")||"";ot(p)}else if(s==="client-edit-design"){g=!0,Xt(!0);const m=n.get("designName")||"";tt(m);const p=n.get("designId")||"";ot(p)}else if(s==="create-area"){u=!0,Zt(!0);const m=n.get("stage");m==="placing-sections"?(f="placing-sections",et("placing-sections")):m==="modify-sections"?(et("modify-sections"),f="modify-sections",le(Qe.map(p=>new ge({item:new w({...p,displayItem:!0}),quantity:-1})))):m==="placing-items"&&(et("placing-items"),f="placing-items",le(l.inventoryItems.map(p=>new ge({item:new w({...p.item,displayItem:!0}),quantity:p.quantity}))))}else if(s==="view-boothMap"){S=!0,Yt(!0);const m=n.get("boothMapId")||"";st(m);const p=await wt(i,a,m);if(p===null){window.location.href="/LayItOut/DNF/";return}De(p),O=p}else if(s==="pick-booth"){S=!0,Ut(!0);const m=n.get("boothMapId")||"";st(m);const p=await wt(i,a,m);if(p===null){window.location.href="/LayItOut/DNF/";return}De(p),O=p;const ue=n.get("vendorId")||"";if(ue!==""){const _=p.vendors.find(K=>K.id===ue);if(_){sn(_),console.log("Vendor found",_);let K=!1;O.sections.forEach(jn=>{jn.booths.forEach(Ln=>{Ln.user?.id===_.id&&(K=!0)})}),an(K);const kt=await Dn(i);if(kt===null){window.location.href="/LayItOut/DNF/";return}$t(kt)}else{window.location.href="/LayItOut/DNF/";return}}}else if(s==="create-boothMap"){S=!0,Jt(!0);const m=n.get("boothMapId")||"";st(m);const p=await wt(i,a,m);if(p===null){window.location.href="/LayItOut/DNF/";return}De(p),O=p}t&&zt(t),o&&Kt(o),u||le(l.inventoryItems.map(m=>new ge({item:new w({...m.item,displayItem:!0}),quantity:m.quantity})));const de=[],se=[];for(const m of l.templates){const p=[],ue=[];for(const _ of m.sections)p.push(new W({name:_.name,cellId:new h({x:_.cellId.x,y:_.cellId.y}),cellsLong:_.cellsLong,cellsTall:_.cellsTall,modifierItems:_.modifierItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new w({...K.item,starterItem:!0})})),startingItems:_.startingItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new w({...K.item,starterItem:!0})}))})),ue.push(new W({name:_.name,cellId:new h({x:_.cellId.x,y:_.cellId.y}),cellsLong:_.cellsLong,cellsTall:_.cellsTall,modifierItems:_.modifierItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new w({...K.item,starterItem:!0})})),startingItems:_.startingItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new w({...K.item,starterItem:!0})}))}));de.push(new xe({name:m.name,sections:p,inventoryItems:m.inventoryItems,id:m.id,previewImage:m.previewImage})),se.push(new xe({name:m.name,sections:ue,id:m.id,previewImage:m.previewImage,inventoryItems:m.inventoryItems}))}Re([...de]);const me=[],Be=c===""?void 0:se.find(m=>m.id===c);if(console.log("TEMPLATE",Be,"AREA",l),S&&O)le(O.inventoryItems.map(m=>new ge({item:new w({...m.item,displayItem:!0}),quantity:m.quantity}))),ae([...O.sections]),ie([...O.sections.map(m=>new W({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,booths:m.booths,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new w({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))]),me.push(...O.sections.map(m=>new W({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,booths:m.booths,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new w({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))})));else if(g){const m=await On(i,a,n.get("designId")||"");if(m===null){window.location.href="/LayItOut/DNF/";return}Qt(m),le(m.inventoryItems.map(p=>new ge({item:new w({...p.item,displayItem:!0}),quantity:p.quantity}))),ae([...m.sections]),ie([...m.sections.map(p=>new W({name:p.name,cellId:new h({x:p.cellId.x,y:p.cellId.y}),cellsLong:p.cellsLong,cellsTall:p.cellsTall,startingItems:p.startingItems,modifierItems:p.modifierItems,items:p.startingItems.map(ue=>new w({...ue.item,sectionCell:new h({x:ue.cell.x,y:ue.cell.y})}))}))]),me.push(...m.sections.map(p=>new W({name:p.name,cellId:new h({x:p.cellId.x,y:p.cellId.y}),cellsLong:p.cellsLong,cellsTall:p.cellsTall,startingItems:p.startingItems,modifierItems:p.modifierItems,items:p.startingItems.map(ue=>new w({...ue.item,sectionCell:new h({x:ue.cell.x,y:ue.cell.y})}))})))}else Be!==void 0?(le(Be.inventoryItems.map(m=>new ge({item:new w({...m.item,displayItem:!0}),quantity:m.quantity}))),ae([...Be.sections]),ie([...Be.sections.map(m=>new W({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new w({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))]),me.push(...Be.sections.map(m=>new W({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,modifierItems:m.modifierItems,startingItems:m.startingItems,items:m.startingItems.map(p=>new w({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))})))):(ae([...l.sections]),ie([...l.sections.map(m=>new W({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,modifierItems:m.modifierItems,startingItems:m.startingItems,items:m.startingItems.map(p=>new w({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))]),me.push(...l.sections.map(m=>new W({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new w({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))));console.log("SECTIONS TO GENERATE",me),mn(me,l,s==="create-area",f)}d.useEffect(()=>{gn()},[]);function un(n,t,o){if(!r||n==null)return;const a=[...o],i=[],c=[],l=o.find(s=>s.name==n);console.log("NEW SECTION",l),console.log("Adding section",l.name,l.cellId),console.log("MOBILE CELLS",t),l.cellElement=document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${l.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",l.cellElement);for(const s of l.startingItems){console.log("Placing starting item",s.item.name,s.cell);const g=S=>{const O=S%2===1;return{cellsLong:O?s.item.cellsTall:s.item.cellsLong,cellsTall:O?s.item.cellsLong:s.item.cellsTall}},u=s.item.rotation||0,f=g(u);for(let S=0;S<f.cellsTall;S++)for(let O=0;O<f.cellsLong;O++){const de=t.find(se=>se.sectionName===l.name);de.cells[s.cell.y+S][s.cell.x+O].hasItem=!0,de.cells[s.cell.y+S][s.cell.x+O].itemId=s.item.id}s.item.initialElement=document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${s.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",s.item.initialElement),i.push(new w({...s.item}))}for(const s of l.modifierItems){console.log("Placing starting item",s.item.name,s.cell);const g=S=>{const O=S%2===1;return{cellsLong:O?s.item.cellsTall:s.item.cellsLong,cellsTall:O?s.item.cellsLong:s.item.cellsTall}},u=s.item.rotation||0,f=g(u);for(let S=0;S<f.cellsTall;S++)for(let O=0;O<f.cellsLong;O++){const de=t.find(se=>se.sectionName===l.name);de.cells[s.cell.y+S][s.cell.x+O].hasItem=!0,de.cells[s.cell.y+S][s.cell.x+O].itemId=s.item.id}console.log("Adding item to items",document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${s.cell.toId()}.cell:not(.cell-border)`)),i.push(new w({...s.item,initialElement:document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${s.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1}))}console.log("Setting sections",a),ie([...a]),console.log("ITEMS",i),v(s=>[...s.filter(u=>!i.some(f=>f.id===u.id)),...i.map(u=>new w({...u,starterItem:!0}))]),c.push(...l.booths.map(s=>new je({...s,initialElement:document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${s.cell.toId()}.cell:not(.cell-border)`)})));for(const s of c){for(let g=0;g<s.cellsTall;g++)for(let u=0;u<s.cellsLong;u++){const f=t.find(S=>S.sectionName===l.name);f.cells[s.cell.y+g][s.cell.x+u].hasItem=!0,f.cells[s.cell.y+g][s.cell.x+u].itemId=s.id}Fe(g=>[...g,s])}}function Tt(n){let t=[];return n.map(o=>t=[...t,...o]),t}function fn(n,t){let o=!1;return t.sections.forEach(a=>{a.booths.forEach(i=>{i.user?.id===n.id&&(o=!0)})}),o}function pt(n,t){console.log(n);const o=r?Z.find(l=>l.sectionName===y).cells:R,a=o[n.y].length,i=o.length;if(console.log(a,i),n.x+t.cellsLong>a||n.y+t.cellsTall>i)return!1;const c=we(n,j);if(!c&&!r&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<t.cellsTall;l++)for(let s=0;s<t.cellsLong;s++){if(!r){const g=we(new h({x:n.x+s,y:n.y+l}),j);if(!g&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;if(g?.name!=c?.name&&($!=="placing-sections"||!te))return console.log("Item is crossing section boundaries"),!1}if(o[n.y+l][n.x+s].hasItem&&o[n.y+l][n.x+s].itemId!=t.id){console.log("Something is already here");const g=P.find(u=>u.id==o[n.y+l][n.x+s].itemId);if(g&&g.isSectionModifier){if(g.sectionModifierType==="LeftDoor"||g.sectionModifierType==="RightDoor")return console.log("Item is on door of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),!1;if(g.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),s==t.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),s==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),l==t.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),l==0&&s==t.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),l==0&&s==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),l==t.cellsTall-1&&s==t.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),l==t.cellsTall-1&&s==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function At(n,t,o){console.log(t),console.log("CELLS",n);const a=n[t.y].length,i=n.length;if(console.log(a,i),t.x+o.cellsLong>a||t.y+o.cellsTall>i)return!1;const c=we(t,j);if(!c&&!r&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<o.cellsTall;l++)for(let s=0;s<o.cellsLong;s++){if(!r){const g=we(new h({x:t.x+s,y:t.y+l}),j);if(!g&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;if(g?.name!=c?.name&&($!=="placing-sections"||!te))return console.log("Item is crossing section boundaries"),!1}if(n[t.y+l][t.x+s].hasItem&&n[t.y+l][t.x+s].itemId!=o.id){console.log("Something is already here");const g=P.find(u=>u.id==n[t.y+l][t.x+s].itemId);if(g&&g.isSectionModifier){if(g.sectionModifierType==="LeftDoor"||g.sectionModifierType==="RightDoor")return console.log("Item is on door of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),!1;if(g.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),s==o.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),s==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),l==o.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),l==0&&s==o.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),l==0&&s==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),l==o.cellsTall-1&&s==o.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),l==o.cellsTall-1&&s==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function Nt(n,t,o){const a=Array.from(r?Z.find(c=>c.sectionName===y).cells:R);if(Oe(!0),o!=null){console.log("Removing item",t.id,"from cell",o.toId());const c=r?j.find(l=>l.name===y):we(o,j);c.items=c.items.filter(l=>l.id!=t.id);for(let l=0;l<t.cellsTall;l++)for(let s=0;s<t.cellsLong;s++)a[o.y+l][o.x+s].hasItem=!1,a[o.y+l][o.x+s].itemId=""}if($!=="placing-sections"||!te){const c=r?j.find(s=>s.name===y):we(n,j),l=new h({x:n.x-c.cellId.x,y:n.y-c.cellId.y});t.sectionCell=l,console.log("Adding item to section",c.name,"at",l,t),c.items.push(t)}else t.sectionCell=new h({x:n.x,y:n.y});for(let c=0;c<t.cellsTall;c++)for(let l=0;l<t.cellsLong;l++)a[n.y+c][n.x+l].hasItem=!0,a[n.y+c][n.x+l].itemId=t.id;if(console.log(a),r){const c=Z.find(l=>l.sectionName===y);c&&(c.cells=a.map(l=>l.map(s=>({...s}))),M([...Z]))}else N(a);console.log("Removing item from inventory",t.name);let i=!1;if(!t.hasMoved){const c=re.findIndex(l=>l.item.name==t.name&&!l.item.hasMoved);if(c!==-1){const l=[...re];l[c].quantity>0&&(l[c].quantity-=1,l[c].quantity<=0&&(i=!0,l.splice(c,1)),le(l))}else le(re)}if(v(c=>(console.log("Placing item",t),console.log("Updating item",t.id),Ee&&fe&&t.id==fe.id?(console.log("Updating placing item",t.id),t.hasMoved=!0,t.starterItem=!0,t.isDisplayItem=!1,t.initialElement=document.querySelector(`.App #${n.toId()}.cell:not(.cell-border)`),[...c,new w({...t,hasMoved:!0,id:t.name+Math.floor(Math.random()*1e5).toString()})]):(c.find(l=>l.id==t.id).hasMoved||(c.find(l=>l.id==t.id).hasMoved=!0,c.find(l=>l.id==t.id).sectionCell=t.sectionCell),c))),Ee&&fe&&i){Ae(null);return}}function hn(n){P.find(t=>t.name==n.name&&!t.hasMoved&&!t.starterItem)||v(t=>[...t,n])}d.useEffect(()=>{fe?(console.log("Adding placing item",fe.id),Ne(fe.id)):(console.log("Removing placing item",Xe),Ne(""))},[fe]);function Mt(n){console.log("Removing item",n.id),v(t=>t.filter(o=>o.id!=n.id))}function pn(n,t){const o=Array.from(r?Z.find(l=>l.sectionName===y).cells:R);Oe(!0);const a=l=>{const s=l%2===1;return{cellsWide:s?n.cellsTall:n.cellsLong,cellsTall:s?n.cellsLong:n.cellsTall}},i=n.rotation||0,c=a(i);for(let l=0;l<c.cellsTall;l++)for(let s=0;s<c.cellsWide;s++)o[t.y+l][t.x+s].hasItem=!1,o[t.y+l][t.x+s].itemId="";if(r){const l=Z.find(s=>s.sectionName===y);l&&(l.cells=o.map(s=>s.map(g=>({...g}))),M([...Z])),M(s=>s.map(g=>g.sectionName===y?{...g,cells:o}:g))}else N(o);if($!=="placing-sections"||!te){const l=r?j.find(s=>s.name===y):we(t,j);l.items=l.items.filter(s=>s.id!=n.id),console.log("DELETING ITEM",n.id)}v(l=>(console.log(),l.filter(s=>s.id!=n.id))),le(l=>{const s=l.findIndex(g=>g.item.name==n.name&&!g.item.hasMoved);if(s!==-1){const g=[...l];return g[s].quantity>0&&(g[s].quantity+=1),g}else return[...l,new ge({item:new w({...n}),quantity:1})]})}function In(n,t){const o=Array.from(r?Z.find(g=>g.sectionName===y).cells:R);console.log("DELETING ITEM ROTATE",n.id,n.rotation),Oe(!0);const a=g=>{const u=g%2===1;return{cellsWide:u?n.cellsTall:n.cellsLong,cellsTall:u?n.cellsLong:n.cellsTall}},i=n.rotation||0,c=a(i);for(let g=0;g<c.cellsTall;g++)for(let u=0;u<c.cellsWide;u++)console.log("Deleting cell",t.y+g,t.x+u),o[t.y+g][t.x+u].hasItem=!1,o[t.y+g][t.x+u].itemId="";if(r){const g=Z.find(u=>u.sectionName===y);g&&(g.cells=o.map(u=>u.map(f=>({...f}))),M([...Z])),M(u=>u.map(f=>f.sectionName===y?{...f,cells:o}:f))}else N(o);console.log("DELETING ITEM",n.id);const l=r?j.find(g=>g.name===y):we(t,j);l.items=l.items.filter(g=>g.id!=n.id);const s=new h({x:t.x-l.cellId.x,y:t.y-l.cellId.y});n.sectionCell=s,l.items.push(n)}function Ct(n,t){const o=r?Z.find(c=>c.sectionName===y).cells:R,a=Array.from(o);if(o[n.y]==null){console.log("Start cell is out of bounds",n),It();return}const i=pt(n,t);a.forEach(c=>c.forEach(l=>{l.mouseOver=!1,l.canPlaceItem=!1,l.mouseOverLocation=""}));for(let c=0;c<t.cellsTall;c++)for(let l=0;l<t.cellsLong;l++)n.y+c<a.length&&n.x+l<a[n.y+c].length&&(t.cellsLong===1&&t.cellsTall===1?a[n.y+c][n.x+l].mouseOverLocation="single":t.cellsTall===1?l===0?a[n.y+c][n.x+l].mouseOverLocation="leftFull":l===t.cellsLong-1?a[n.y+c][n.x+l].mouseOverLocation="rightFull":a[n.y+c][n.x+l].mouseOverLocation="middleFull":t.cellsLong===1?c===0?a[n.y+c][n.x+l].mouseOverLocation="topFull":c===t.cellsTall-1?a[n.y+c][n.x+l].mouseOverLocation="bottomFull":a[n.y+c][n.x+l].mouseOverLocation="middleVFull":c===0&&l===0?a[n.y+c][n.x+l].mouseOverLocation="topLeftCorner":c===0&&l===t.cellsLong-1?a[n.y+c][n.x+l].mouseOverLocation="topRightCorner":c===t.cellsTall-1&&l===0?a[n.y+c][n.x+l].mouseOverLocation="bottomLeftCorner":c===t.cellsTall-1&&l===t.cellsLong-1?a[n.y+c][n.x+l].mouseOverLocation="bottomRightCorner":c===0?a[n.y+c][n.x+l].mouseOverLocation="top":c===t.cellsTall-1?a[n.y+c][n.x+l].mouseOverLocation="bottom":l===0?a[n.y+c][n.x+l].mouseOverLocation="left":l===t.cellsLong-1?a[n.y+c][n.x+l].mouseOverLocation="right":a[n.y+c][n.x+l].mouseOverLocation="middle",a[n.y+c][n.x+l].mouseOver=!0,a[n.y+c][n.x+l].canPlaceItem=i);if(r){const c=Z.find(l=>l.sectionName===y);c&&(c.cells=a.map(l=>l.map(s=>({...s}))),M([...Z])),M(l=>l.map(s=>s.sectionName===y?{...s,cells:a}:s))}else N(a)}function It(){console.log("Unhighlighting cells");const n=Array.from(r?Z.find(t=>t.sectionName===y).cells:R);if(n.forEach(t=>t.forEach(o=>{o.mouseOver=!1,o.canPlaceItem=!1,o.mouseOverLocation=""})),r){const t=Z.find(o=>o.sectionName===y);t&&(t.cells=n.map(o=>o.map(a=>({...a}))),M([...Z])),M(o=>o.map(a=>a.sectionName===y?{...a,cells:n}:a))}else N(n)}d.useEffect(()=>{un(y,Z,j)},[y]),d.useEffect(()=>{const n=()=>{const t=P.find(o=>o.id===x);console.log("Unselecting item",x),V(null),t&&(H(o=>[...o,t.id]),console.log("Unselecting item",t.id),setTimeout(()=>{H(o=>o.filter(a=>a!==t.id))},300))};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[x,P]);function Et(n){V(null),H(t=>[...t,n]),console.log("Unselecting item",n),setTimeout(()=>{H(t=>t.filter(o=>o!==n))},300)}function Rt(n){const t=P.find(o=>o.id===x);console.log("Unselecting item",x),V(n),t&&(H(o=>[...o,t.id]),console.log("Unselecting item",t.id),setTimeout(()=>{H(o=>o.filter(a=>a!==t.id))},300))}function yt(n){le(t=>[...t,n])}const We=n=>{console.log("Preventing scroll"),n.preventDefault(),n.stopPropagation(),window.scrollTo(0,0)};d.useEffect(()=>(at?(window.addEventListener("scroll",We),window.addEventListener("touchmove",We,{passive:!1})):(window.removeEventListener("scroll",We),window.removeEventListener("touchmove",We)),()=>{window.removeEventListener("scroll",We),window.removeEventListener("touchmove",We)}),[at]);async function yn(n){const t=[];Q(!0);for(const i of n){const c=i.name,l=new h({x:i.sectionCell.x,y:i.sectionCell.y}),s=new W({name:c,cellId:l,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:[],startingItems:[],items:[]});t.push(s)}let o=0,a=0;for(const i of t)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",i.cellsLong+i.cellId.x,"Current width:",o),i.cellsLong+i.cellId.x>o&&(console.log("Added section Width:",i.cellsLong+i.cellId.x),o+=i.cellsLong+i.cellId.x-o),console.log("Needed section Height:",i.cellsTall+i.cellId.y,"Current height:",a),i.cellsTall+i.cellId.y>a&&(console.log("Added section Height:",i.cellsTall+i.cellId.y),a+=i.cellsTall+i.cellId.y-a);await Wn(J,q,t,o,a),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=create-area&stage=modify-sections`}async function wn(n,t){const o=[];Q(!0);for(const a of t){const i=a.name,c=new h({x:a.cellId.x,y:a.cellId.y});console.log("Saving section modifier items for section",i,a.items.map(s=>s.name),"at cell",c);const l=new W({name:i,cellId:c,cellsLong:a.cellsLong,cellsTall:a.cellsTall,startingItems:[],items:[],modifierItems:a.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new w({...s,isSectionModifier:!0})}))});o.push(l)}console.log("Saving section modifier items",o),await Bn(J,q,o),console.log("Section modifier items saved successfully"),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=create-area&stage=placing-items`}async function xn(n,t){Q(!0);const o=[];for(const a of n){const i=a.name,c=new h({x:a.cellId.x,y:a.cellId.y}),l=new W({name:i,cellId:c,cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new w({...s,starterItem:!0})})),items:[]});o.push(l)}console.log("Saving area sections",o),localStorage.setItem("screenshotSections",o.map(a=>JSON.stringify(a.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",o.map(a=>JSON.stringify(a.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async a=>{if(console.log("Storage event",a),a.key==="screenshot"){const i=new Pn({id:q,name:nt.name,sections:o,templates:[],previewImage:a.newValue,width:nt.width,height:nt.height,inventoryItems:t.map(c=>new ge({item:new w({...c.item,starterItem:!0}),quantity:c.quantity}))});await Gn(J,i),console.log("Area saved successfully"),Q(!1),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=view-area`}})}function vn(n){const t=Array.from(r?Z.find(o=>o.sectionName===y).cells:R);if(t[n.y]!=null)if(t[n.y][n.x].mouseOver=!0,t[n.y][n.x].canPlaceItem=!0,t[n.y][n.x].mouseOverLocation="single",Lt(o=>[...o,n]),r){const o=Z.find(a=>a.sectionName===y);o&&(o.cells=t.map(a=>a.map(i=>({...i}))),M([...Z])),M(a=>a.map(i=>i.sectionName===y?{...i,cells:t}:i))}else console.log("Adding highlighted cell",n.toId()),N(t)}function Sn(n){const t=Array.from(r?Z.find(l=>l.sectionName===y).cells:R);Oe(!0);const o=[];ln.forEach(l=>{o.some(s=>s.toId()===l.toId())||o.push(l)}),Lt([]);const a=[],i=re.findIndex(l=>l.item.name==n.name&&!l.item.hasMoved);let c=i!==-1?re[i].quantity:0;o.forEach(l=>{const s=new w({...n});if(s.id=s.name+Math.floor(Math.random()*1e5).toString(),console.log("Placing item",s.name,"at",l.toId(),"CAN PLACE?",At(t,l,s)),At(t,l,s)&&c!=0){if(i!==-1&&(c-=1),$!=="placing-sections"||!te){const u=r?j.find(S=>S.name===y):we(l,j);console.log("Adding item to section",u.name,"at",u.cellId,"with cell",l.toId(),l.x-u.cellId.x,l.y-u.cellId.y);const f=new h({x:l.x-u.cellId.x,y:l.y-u.cellId.y});s.sectionCell=f,console.log("Adding item to section",u.name,"at",f,s),u.items.push(s),console.log("SECTION ITEMS",u.items.map(S=>S.name))}else s.sectionCell=new h({x:l.x,y:l.y});for(let u=0;u<n.cellsTall;u++)for(let f=0;f<n.cellsLong;f++)t[l.y+u][l.x+f].hasItem=!0,t[l.y+u][l.x+f].itemId=s.id;s.hasMoved=!0,s.starterItem=!0,s.isDisplayItem=!1,s.initialElement=document.querySelector(`.App #${l.toId()}.cell:not(.cell-border)`);const g=new w({...s});a.push(g)}});for(const l of a)console.log("Adding item to items",l.id),v(s=>[...s,l]);if(i!==-1&&le(l=>{const s=[...l];return s[i].quantity>0&&(s[i].quantity=c,s[i].quantity==0&&s.splice(i,1)),s}),c==0&&Ae(null),r){const l=Z.find(s=>s.sectionName===y);l&&(l.cells=t.map(s=>s.map(g=>({...g}))),M([...Z])),M(s=>s.map(g=>g.sectionName===y?{...g,cells:t}:g))}else N(t);ie(j)}function bn(n,t,o){Q(!0);const a=[];for(const i of n){const c=i.name,l=new h({x:i.cellId.x,y:i.cellId.y}),s=i.items.filter(f=>f.isBooth),g=i.items.filter(f=>!f.isBooth),u=new W({name:c,cellId:l,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:g.map(f=>new z({cell:new h({x:f.sectionCell.x,y:f.sectionCell.y}),item:new w({...f,displayItem:!0})})),booths:s.map(f=>new je({id:f.name+Math.floor(Math.random()*1e5).toString(),name:f.name,cell:new h({x:f.sectionCell.x,y:f.sectionCell.y}),cellsLong:f.cellsLong,cellsTall:f.cellsTall,user:f.boothUser})),items:[]});a.push(u)}console.log("Saving area sections",a),localStorage.setItem("screenshotSections",a.map(i=>JSON.stringify(i.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",a.map(i=>JSON.stringify(i.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async i=>{if(console.log("Storage event",i),i.key==="screenshot"){const c=new Me({id:o.id,name:o.name,sections:a,areaId:q,previewImage:i.newValue,inventoryItems:t.map(l=>new ge({item:new w({...l.item,starterItem:!0}),quantity:l.quantity}))});await Ce(J,c),console.log("Booth Map saved successfully"),Q(!1),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=view-boothMap&boothMapId=${bt}`}})}return console.log("RENDERING APP",!(te&&$!="placing-items")),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"App",children:[e.jsx("h1",{className:"title",children:"LayItOut"}),e.jsx("br",{}),Je&&e.jsxs("div",{className:"area-creation",children:[ct?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"area-creation-title",children:"You have already picked a booth"}),e.jsxs("label",{htmlFor:"",children:["Contact ",qt?.supportEmail," to change booths"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"area-creation-title",children:"Picking Booth"}),e.jsx("label",{htmlFor:"",children:"Tap on an open booth then click on the checkmark to pick a booth"})," "]}),e.jsxs("label",{htmlFor:"",children:["Booth Size: ",be?.plotWidth,"ft x ",be?.plotHeight,"ft"]}),e.jsx("br",{})]}),qe&&e.jsxs("div",{className:"area-creation",children:[e.jsx("h2",{className:"area-creation-title",children:"Create Booth Map"}),e.jsx("label",{htmlFor:"",children:"Create a booth map by placing items and then creating and placing booths, same way you create and place items"})]}),te&&e.jsxs("div",{className:"area-creation",children:[e.jsx("h2",{className:"area-creation-title",children:"Create Area"}),e.jsx("label",{htmlFor:"",children:$=="placing-sections"?"Create new sections and place them":$=="modify-sections"?"Add walls and doors to sections":"Add items to the inventory and place items"})]}),(D||Y)&&e.jsxs("div",{className:"template-name-row",children:[e.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),e.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:n=>St(n.target.value),value:ke})]}),Ie&&e.jsx("div",{className:"design-name-row",children:e.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",Ue]})}),(D||Y)&&e.jsxs("div",{className:"template-creation",children:[e.jsxs("button",{className:"action-btn",onClick:()=>{if(ke.trim()==""){alert("Please enter a template name");return}if(ve.some(n=>n.name===ke&&(Y?n.id!==jt.id:!0))){alert("Template with this name already exists");return}Y?(Q(!0),setTimeout(async()=>{const n=j.map(t=>new W({name:t.name,cellId:new h({x:oe.find(o=>o.name==t.name).cellId.x,y:oe.find(o=>o.name==t.name).cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,modifierItems:t.modifierItems,startingItems:t.items.map(o=>new z({cell:new h({x:o.sectionCell.x,y:o.sectionCell.y}),item:new w({...o,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async t=>{if(console.log("Storage event",t),t.key==="screenshot"){ye(!1);const o=ve.map(a=>a.id===jt.id?(console.log("SECTION",j),new xe({name:ke,inventoryItems:re,previewImage:t.newValue,sections:j.map(i=>new W({name:i.name,cellId:new h({x:a.sections.find(c=>c.name==i.name).cellId.x,y:a.sections.find(c=>c.name==i.name).cellId.y}),cellsLong:i.cellsLong,modifierItems:i.modifierItems,cellsTall:i.cellsTall,startingItems:i.items.map(c=>new z({cell:new h({x:c.sectionCell.x,y:c.sectionCell.y}),item:new w({...c,starterItem:!0})}))})),id:a.id})):new xe({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(i=>new W({name:i.name,cellId:new h({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(c=>new z({cell:new h({x:c.cell.x,y:c.cell.y}),item:new w({...c.item})}))})),id:a.id}));He(J,q,o).then(()=>{console.log("Template updated successfully"),Q(!1);const a=new URLSearchParams(window.location.search),i=a.get("companyId"),c=a.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${i}&areaId=${c}&type=view-area`})}})},500)):(Q(!0),setTimeout(async()=>{const n=j.map(t=>new W({name:t.name,cellId:new h({x:oe.find(o=>o.name==t.name).cellId.x,y:oe.find(o=>o.name==t.name).cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,modifierItems:t.modifierItems,startingItems:t.items.map(o=>new z({cell:new h({x:o.sectionCell.x,y:o.sectionCell.y}),item:new w({...o,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async t=>{if(console.log("Storage event",t),t.key==="screenshot"){ye(!1);const o=new xe({name:ke,previewImage:t.newValue,inventoryItems:re,sections:j.map(i=>new W({name:i.name,cellId:new h({x:oe.find(c=>c.name==i.name).cellId.x,y:oe.find(c=>c.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.items.map(c=>new z({cell:new h({x:c.sectionCell.x,y:c.sectionCell.y}),item:new w({...c,starterItem:!0})}))})),id:ke+(Math.random()*1e4).toString()}),a=[...ve.map(i=>new xe({name:i.name,previewImage:i.previewImage,inventoryItems:i.inventoryItems,sections:i.sections.map(c=>new W({name:c.name,cellId:new h({x:c.cellId.x,y:c.cellId.y}),cellsLong:c.cellsLong,cellsTall:c.cellsTall,modifierItems:c.modifierItems,startingItems:c.startingItems.map(l=>new z({cell:new h({x:l.cell.x,y:l.cell.y}),item:new w({...l.item})}))})),id:i.id})),o];He(J,q,a).then(()=>{console.log("Template updated successfully"),Q(!1);const i=new URLSearchParams(window.location.search),c=i.get("companyId"),l=i.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${c}&areaId=${l}&type=view-area`})}})},500))},children:[D?"Create":"Save"," Template"]}),e.jsx("button",{className:"action-btn",onClick:()=>{const n=new URLSearchParams(window.location.search),t=n.get("companyId"),o=n.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${t}&areaId=${o}&type=view-area`},children:"Cancel"})]}),Ht&&e.jsxs("div",{className:"template-creation",children:[on&&e.jsx("button",{className:"action-btn",onClick:()=>{Q(!0),setTimeout(async()=>{const n=j.map(t=>new W({name:t.name,cellId:new h({x:oe.find(o=>o.name==t.name).cellId.x,y:oe.find(o=>o.name==t.name).cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,modifierItems:t.modifierItems,startingItems:t.items.map(o=>new z({cell:new h({x:o.sectionCell.x,y:o.sectionCell.y}),item:new w({...o,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async t=>{if(console.log("Storage event",t),t.key==="screenshot"){ye(!1);const o=new Ot({name:Ue,previewImage:t.newValue,areaId:q,inventoryItems:re,sections:j.map(a=>new W({name:a.name,cellId:new h({x:oe.find(i=>i.name==a.name).cellId.x,y:oe.find(i=>i.name==a.name).cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(i=>new z({cell:new h({x:i.sectionCell.x,y:i.sectionCell.y}),item:new w({...i,starterItem:!0})}))})),id:lt});Wt(J,q,o).then(()=>{console.log("Design updated successfully"),Oe(!1),Q(!1)})}})},500)},children:"Save"}),e.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),!Ie&&!Ye&&!Se&&!Je&&e.jsxs("div",{className:"place-mode-row",children:[e.jsx("label",{htmlFor:"tap-and-place-mode",children:"Place Mode: "}),e.jsxs("select",{id:"tap-and-place-mode",name:"tap-and-place-mode",value:Ee?"tap":"drag",onChange:n=>xt(n.target.value==="tap"),className:"place-mode-select",children:[e.jsx("option",{value:"drag",children:"Drag and Drop"}),e.jsx("option",{value:"tap",children:"Tap and Place"})]})]}),it&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"loader-backdrop",children:e.jsx("div",{className:"loader"})})})," ",e.jsxs("div",{className:"layout",children:[!Ie&&!Ye&&!Se&&!Je&&e.jsx(Yn,{setSelectedItem:Ae,tapAndPlaceMode:Ee,isModifyingSections:te&&$=="modify-sections",isViewingDesign:Ie,isEditingTemplate:Y,isCreatingTemplate:D,maxHeight:r?200:b*k,showAddCustomItem:()=>{$=="placing-sections"&&te?mt.current?.showModal():$=="placing-items"&&te?gt.current?.showModal():dt.current?.showModal()},addDraggingItem:hn,removeItem:Mt,inventoryItems:re.map(n=>new ge({item:new w({...n.item,displayItem:!0}),quantity:n.quantity}))}),Se&&ne?e.jsx(el,{onDeleteVendor:async n=>{Q(!0);const t=new Me({...ne,vendors:ne.vendors.filter(o=>o.id!==n),sections:ne.sections.map(o=>new W({...o,booths:o.booths.map(a=>a.user?.id===n?new je({...a,user:null,initialElement:a.initialElement??void 0}):a)}))});await Ce(J,t),De(t),window.location.reload()},onEditVendor:n=>{rn(n),ft.current?.showModal()},boothMap:ne,vendors:ne?.vendors??[],maxHeight:r?void 0:b*k,onAddVendor:()=>{ut.current?.showModal()}}):null,r?e.jsxs("div",{className:"mobile-areas",style:{height:U+"px"},children:[j.length>1&&e.jsx("img",{src:Ke,onClick:()=>{const n=j.findIndex(o=>o.name==y);if(n===-1)return;const t=(n-1+j.length)%j.length;ee(j[t].name),console.log("Changing viewing section to",j[t].name)},className:"back-mobile-areas"}),Ze.map((n,t)=>e.jsx(Dt,{width:n.width,height:n.height,cells:Tt(Z.find(o=>o.sectionName==n.sectionName).cells),id:n.sectionName,visibile:y==null?!0:n.sectionName==y,section:n.sectionName},t)),j.length>1&&e.jsx("img",{src:Ke,onClick:()=>{const n=j.findIndex(o=>o.name==y);if(n===-1)return;const t=(n+1)%j.length;ee(j[t].name),console.log("Changing viewing section to",j[t].name)},className:"forward-mobile-areas"})]}):e.jsx(Dt,{width:F*k,height:b*k,cells:Tt(R)}),($=="placing-items"||!te)&&e.jsx(ll,{maxHeight:r?void 0:b*k})]}),Se&&e.jsx("div",{className:"design-view",children:e.jsx("button",{className:"action-btn",onClick:()=>{const n=j.map(t=>new W({name:t.name,cellId:new h({x:oe.find(o=>o.name==t.name).cellId.x,y:oe.find(o=>o.name==t.name).cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,modifierItems:t.modifierItems,booths:t.booths,startingItems:t.items.map(o=>new z({cell:new h({x:o.sectionCell.x,y:o.sectionCell.y}),item:new w({...o,starterItem:!0})}))}));localStorage.setItem("printSections",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/LayItOut/Print/?companyId=${J}&areaId=${q}&designName=${ne?.name}`,"_blank")},children:"Print"})}),Ie&&e.jsxs("div",{className:"design-view",children:[e.jsx("button",{className:"action-btn",onClick:()=>{const n=j.map(t=>new W({name:t.name,cellId:new h({x:oe.find(o=>o.name==t.name).cellId.x,y:oe.find(o=>o.name==t.name).cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,modifierItems:t.modifierItems,booths:t.booths,startingItems:t.items.map(o=>new z({cell:new h({x:o.sectionCell.x,y:o.sectionCell.y}),item:new w({...o,starterItem:!0})}))}));localStorage.setItem("printSections",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/LayItOut/Print/?companyId=${J}&areaId=${q}&designName=${Ue}&designId=${lt}`,"_blank")},children:"Print"}),e.jsx("button",{className:"action-btn",onClick:()=>{const n=new xe({name:Ue,previewImage:$e.previewImage,inventoryItems:$e.inventoryItems,sections:$e.sections,id:$e.name+(Math.random()*1e4).toString()}),t=[...ve.map(o=>new xe({name:o.name,previewImage:o.previewImage,inventoryItems:o.inventoryItems,sections:o.sections.map(a=>new W({name:a.name,cellId:new h({x:a.cellId.x,y:a.cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.startingItems.map(i=>new z({cell:new h({x:i.cell.x,y:i.cell.y}),item:new w({...i.item})}))})),id:o.id})),n];He(J,q,t).then(()=>{console.log("Template updated successfully"),Re(t),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=edit-template&templateId=${n.id}`})},children:"Turn into a Template"}),e.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=desings"},children:"Back"})]}),Se&&e.jsx("div",{className:"design-view",children:e.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=boothmaps"},children:"Back"})}),Ye&&e.jsx("div",{className:"design-view",children:e.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=areas"},children:"Back"})}),te&&e.jsxs("div",{className:"design-view",children:[e.jsx("button",{className:"action-btn",onClick:()=>{$=="placing-sections"?yn(P.filter(n=>n.isSectionItem)):$=="modify-sections"?wn(P.filter(n=>n.isSectionModifier),j):$=="placing-items"&&xn(j,re)},children:$=="placing-items"?"Create Area":"Next"}),e.jsx("button",{className:"action-btn",onClick:async()=>{Q(!0),await En(J,q),window.location.href="/LayItOut/"},children:"Cancel"})]}),qe&&e.jsxs("div",{className:"design-view",children:[e.jsx("button",{className:"action-btn",onClick:()=>{console.log("Creating booth map with sections",j,"and inventory items",re,"and boothMap",ne),bn(j,re,ne)},children:"Create Booth Map"}),e.jsx("button",{className:"action-btn",onClick:async()=>{Q(!0),await Rn(J,q,bt),window.location.href="/LayItOut/?view=boothmaps"},children:"Cancel"})]})]}),e.jsxs("div",{children:[j.map(n=>e.jsx(An,{takingPhoto:!1,section:n,visible:y==null?!0:n.name==y,cellSize:k},n.cellId.toId())),P.map(n=>e.jsx(Nn,{isPlacingItem:fe!=null,isCreatingArea:te,isCreatingTemplate:D||Y,cellSize:k,isViewingDesign:Ie||Ye||Se||Je,removeItem:Mt,visible:r?!n.hasMoved&&!n.starterItem?!0:y==null?!1:n.isSectionModifier?j.find(t=>t.name==y)?.modifierItems.some(t=>t.item.id===n.id):n.starterItem?j.find(t=>t.name==y)?.startingItems.some(t=>t.item.id===n.id):j.find(t=>t.name==y)?.items.some(t=>t.id===n.id):!0,item:n,canPlaceItem:pt,placeItem:Nt,deleteItemRotate:In,highlightCells:Ct,unHighlightCells:It,deleteItem:pn,isSelected:x===n.id,onSelect:Rt,isUnselecting:X.includes(n.id),onDeselect:()=>Et(n.id)},n.id)),_e.map(n=>(console.log("CAN PICK BOOTH",n.cellsLong==be?.plotWidth&&n.cellsTall==be.plotHeight,"BOOTH",n,"VENDOR",be),e.jsx(Mn,{canPick:Se||ct||n.cellsLong==be?.plotWidth&&n.cellsTall==be.plotHeight,visible:r?y==null?!1:j.find(t=>t.name==y)?.booths.some(t=>t.id===n.id)??!1:!0,booth:n,isViewingBooth:Se,hasPickedBooth:ct,isSelected:x==n.id,cellSize:k,onSelect:Rt,isUnselecting:X.includes(n.id),onDeselect:()=>Et(n.id),onPickBooth:async t=>{Q(!0);const o=j.map(i=>i.name===y?new W({...i,booths:i.booths.map(c=>c.id===t?new je({...c,user:be,initialElement:c.initialElement??void 0}):c)}):i.booths.some(c=>c.id===t)?new W({...i,booths:i.booths.map(c=>c.id===t?new je({...c,user:be,initialElement:c.initialElement??void 0}):c)}):i);console.log("Updated sections",o),ie(o);const a=new Me({...ne,sections:o});await Ce(J,a),window.location.reload(),Q(!1)},onRemoveVendorFromBooth:()=>{Q(!0);const t=j.map(a=>new W({...a,booths:a.booths.map(i=>i.user?.id===n.user?.id?new je({...i,user:null,initialElement:i.initialElement??void 0}):i)})),o=new Me({...ne,sections:t});Ce(J,o).then(()=>{window.location.reload()})},onAddVendorToBooth:()=>{dn(n),ht.current?.showModal()}},n.id)))]}),r&&!it&&e.jsx("div",{className:"layout-icon",onClick:()=>{Pe.current?.showModal(),Ge(!0),console.log("Showing layout dialog")},children:e.jsx("img",{src:Un,alt:""})}),!it&&!(D||Y||Ie||qe||te||Se||Je)&&e.jsx("div",{className:"template-icon",onClick:()=>{he.current?.showModal(),Te(!0),console.log("Showing template dialog")},children:e.jsx("img",{src:Hn,alt:""})}),e.jsx(Xn,{isViewingArea:Ye,dialogRef:he,isOpen:Le,closeDialog:()=>{he.current?.close(),Te(!1)},duplicateTemplate:n=>{const t=new xe({name:n.name+" Copy",previewImage:n.previewImage,inventoryItems:n.inventoryItems,sections:n.sections,id:n.name+"Copy"+(Math.random()*1e4).toString()}),o=[...ve.map(a=>new xe({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(i=>new W({name:i.name,cellId:new h({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(c=>new z({cell:new h({x:c.cell.x,y:c.cell.y}),item:new w({...c.item})}))})),id:a.id})),t];He(J,q,o).then(()=>{he.current?.close(),console.log("Template updated successfully"),Re(o),Te(!1),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=edit-template&templateId=${t.id}`})},templates:ve,selectTemplate:n=>{Q(!0),setTimeout(async()=>{const t=n.sections.map(o=>new W({name:o.name,cellId:new h({x:n.sections.find(a=>a.name==o.name).cellId.x,y:n.sections.find(a=>a.name==o.name).cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,modifierItems:o.modifierItems,startingItems:o.startingItems.map(a=>new z({cell:new h({x:a.cell.x,y:a.cell.y}),item:new w({...a.item,starterItem:!0})}))}));localStorage.setItem("screenshotSections",t.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async o=>{if(console.log("Storage event",o),o.key==="screenshot"){ye(!1);const a=new Ot({name:Ue,previewImage:o.newValue,areaId:q,inventoryItems:n.inventoryItems,sections:n.sections.map(i=>new W({name:i.name,cellId:new h({x:n.sections.find(c=>c.name==i.name).cellId.x,y:n.sections.find(c=>c.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(c=>new z({cell:new h({x:c.cell.x,y:c.cell.y}),item:new w({...c.item,starterItem:!0})}))})),id:lt});console.log("UPDATED DESIGN",a),Wt(J,q,a).then(()=>{console.log("Design updated successfully"),Oe(!1),Q(!1),window.location.reload()})}})},500)}}),e.jsx(Jn,{dialogRef:Pe,closeDialog:()=>{Pe.current?.close(),Ge(!1)},areaPreview:tn||""}),e.jsx(Qn,{canBeBooth:qe,dialogRef:dt,addInventoryItem:yt,closeDialog:()=>{dt.current?.close()}}),e.jsx(zn,{dialogRef:mt,closeDialog:()=>{mt.current?.close()},addSection:yt}),e.jsx(qn,{dialogRef:gt,closeDialog:()=>{gt.current?.close()},addInventoryItem:yt}),e.jsx($n,{placeMultiItem:Sn,addHighlightedCell:vn,item:fe,setSelectingItem:()=>{Ae(null)},canPlaceItem:pt,placeItem:Nt,highlightCells:Ct,unHighlightCells:It,cellSize:k}),e.jsx(tl,{dialogRef:ut,closeDialog:()=>{ut.current?.close()},addVendor:async n=>{const t=new Me({...ne,vendors:[...ne.vendors,n]});De(t),await Ce(J,t)}}),e.jsx(nl,{oldVendor:cn,dialogRef:ft,closeDialog:()=>{ft.current?.close()},editVendor:async n=>{const t=new Me({...ne,vendors:ne.vendors.map(o=>o.id===n.id?n:o)});De(t),await Ce(J,t)}}),e.jsx(ol,{dialogRef:ht,vendors:ne?.vendors.filter(n=>!fn(n,ne))??[],closeDialog:()=>{ht.current?.close()},addVendorToBooth:async n=>{Q(!0);const t=j.map(a=>a.name===y?new W({...a,booths:a.booths.map(i=>i.id===rt.id?new je({...i,user:n,initialElement:i.initialElement??void 0}):i)}):a.booths.some(i=>i.id===rt.id)?new W({...a,booths:a.booths.map(i=>i.id===rt.id?new je({...i,user:n,initialElement:i.initialElement??void 0}):i)}):a);console.log("Updated sections",t),ie(t);const o=new Me({...ne,sections:t});await Ce(J,o),window.location.reload(),Q(!1)}}),at&&e.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:window.location.origin+"/LayItOut/Preview/",width:C*k+20,height:G*k+20})]})}
