import{c as U,j as o,r}from"./index-QIV6qY6h.js";import{A as W,S as $,D as z}from"./section-ADRdvFWR.js";import{S as h,C as I,I as p,k as L}from"./firestore-BzzbFXtm.js";U.createRoot(document.getElementById("root")).render(o.jsx(M,{}));function M(){const[B,F]=r.useState(/Mobi|Android/i.test(navigator.userAgent)),[x,A]=r.useState(0),[y,T]=r.useState(0),[C,S]=r.useState([]),[j,N]=r.useState([]),f=10,[E,w]=r.useState([]),[G,b]=r.useState(""),[J,v]=r.useState(""),[R,D]=r.useState(""),[O,V]=r.useState(!0);function P(s,c){for(const n of c)if(s.x>=n.cellId.x&&s.x<n.cellId.x+n.cellsLong&&s.y>=n.cellId.y&&s.y<n.cellId.y+n.cellsTall)return n;return null}function k(s){let c=x,n=y;const m=[];for(const l of s)console.log("Generating cells for section",l.name,"at",l.cellId,"with size",l.cellsLong,"x",l.cellsTall),console.log("Needed section Width:",l.cellsLong+l.cellId.x,"Current width:",c),l.cellsLong+l.cellId.x>c&&(console.log("Added section Width:",l.cellsLong+l.cellId.x),c+=l.cellsLong+l.cellId.x-c),console.log("Needed section Height:",l.cellsTall+l.cellId.y,"Current height:",n),l.cellsTall+l.cellId.y>n&&(console.log("Added section Height:",l.cellsTall+l.cellId.y),n+=l.cellsTall+l.cellId.y-n);A(c),T(n),[...Array(n).keys()].map(l=>{const d=[];[...Array(c).keys()].map(e=>{d.push({id:new I({x:e,y:l}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:P(new I({x:e,y:l}),s)!=null,size:f})}),m.push(d)}),S([...m]),setTimeout(()=>{const l=[],d=[...s];for(const e of d)e.cellElement=document.querySelector(`.App #${e.cellId.toId()}.cell:not(.cell-border)`),l.push(...e.startingItems.map(a=>new L({cell:new I({x:e.cellId.x+a.cell.x,y:e.cellId.y+a.cell.y}),item:new p({...a.item,initialElement:document.querySelector(`.App #${a.cell.toId()}.cell:not(.cell-border)`),starterItem:!0})}))),l.push(...e.modifierItems.map(a=>new L({cell:new I({x:e.cellId.x+a.cell.x,y:e.cellId.y+a.cell.y}),item:new p({...a.item,initialElement:document.querySelector(`.App #${a.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1})})));w([...d]);for(const e of l){const a=g=>{const u=g%2===1;return{cellsLong:u?e.item.cellsTall:e.item.cellsLong,cellsTall:u?e.item.cellsLong:e.item.cellsTall}},t=e.item.rotation||0,i=a(t);for(let g=0;g<i.cellsTall;g++)for(let u=0;u<i.cellsLong;u++)m[e.cell.y+g][e.cell.x+u].hasItem=!0,m[e.cell.y+g][e.cell.x+u].itemId=e.item.id;e.item.initialElement=document.querySelector(`.App #${e.cell.toId()}.cell:not(.cell-border)`),N(g=>[...g,e.item])}S([...m]),setTimeout(()=>{window.print(),window.close()},500)},100)}async function H(){const s=new URLSearchParams(window.location.search),c=s.get("companyId"),n=s.get("areaId"),m=s.get("designName"),l=s.get("designId");if(!c||!n||!m||!l){alert("Invalid URL parameters");return}b(c),v(n),D(m);const d=[];let e=localStorage.getItem("printSections");console.log("Screenshot sections from localStorage",e),e=e?.split("LAYOUTSEPARATOR")||"";const a=[];for(const t of e)console.log("Section string",t),a.push(h.fromJSON(t));w([...a.map(t=>new h({name:t.name,cellId:new I({x:t.cellId.x,y:t.cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,startingItems:t.startingItems,modifierItems:t.modifierItems,items:t.startingItems.map(i=>new p({...i.item,sectionCell:new I({x:i.cell.x,y:i.cell.y})}))}))]),d.push(...a.map(t=>new h({name:t.name,cellId:new I({x:t.cellId.x,y:t.cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,startingItems:t.startingItems,modifierItems:t.modifierItems,items:t.startingItems.map(i=>new p({...i.item,sectionCell:new I({x:i.cell.x,y:i.cell.y})}))}))),console.log("SECTIONS TO GENERATE",d),k(d)}r.useEffect(()=>{H()},[]);function q(s){let c=[];return s.map(n=>c=[...c,...n]),c}return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"App",children:[O&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"loader-backdrop"}),o.jsx("div",{className:"loader"})]}),o.jsx("div",{className:"layout",children:o.jsx(W,{width:x*f,height:y*f,cells:q(C)})})]}),E.map(s=>o.jsx($,{takingPhoto:!1,section:s,visible:!0,cellSize:f},s.cellId.toId())),j.map(s=>o.jsx(z,{isCreatingArea:!1,isCreatingTemplate:!1,cellSize:f,isViewingDesign:!0,removeItem:()=>{},visible:!0,item:s,canPlaceItem:()=>!1,placeItem:()=>{},deleteItemRotate:()=>{},highlightCells:()=>{},unHighlightCells:()=>{},deleteItem:()=>{},isSelected:!1,onSelect:()=>{},isUnselecting:!1,onDeselect:()=>{}},s.id)),o.jsxs("div",{className:"print-footer",children:[o.jsx("p",{children:"Printed Layout from LayItOut.com"}),o.jsxs("p",{children:["Design Name: ",R]}),o.jsxs("p",{children:["Generated on: ",new Date().toLocaleString()]})]})]})}
