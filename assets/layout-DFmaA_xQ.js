import{r as h,j as c,c as It}from"./index-QIV6qY6h.js";import{A as Le,S as Ye,D as ht}from"./section-Cmi4yfhz.js";import{I as P,C as b,T as _,S as W,b as z,s as ve,e as ue,_ as pt,f as yt,r as Ue,h as wt,i as xt,j as Tt,k as Se,l as Lt,m as vt,p as bt,u as St,F as At,n as Nt,D as jt,o as Et,q as kt,t as Ct}from"./firestore-DmwLrE3V.js";import{F as ge}from"./add_custom_item_dialog-DgwAOwWV.js";function Ot({inventoryItem:t,addDraggingItem:m,removeItem:i}){const d=h.useRef(null),I=h.useRef(null),[x,T]=h.useState(12),[w,j]=h.useState(t.item);function C(y){const S=I.current,O=window.getComputedStyle(S),E=document.createElement("span");E.style.font=O.font,E.style.fontSize=y+"px",E.style.fontFamily=O.fontFamily,E.style.fontWeight=O.fontWeight,E.style.position="absolute",E.style.visibility="hidden",E.style.whiteSpace="nowrap",E.textContent=S.textContent,document.body.appendChild(E);const D=E.offsetWidth;return document.body.removeChild(E),D}function N(y){if(I.current){const S=I.current;return C(y-1)>S.offsetWidth&&y-1>8?N(y-1):y-1}return y}return h.useEffect(()=>{setTimeout(()=>{I.current&&T(N(x))},100)},[]),c.jsxs("div",{className:"display",children:[c.jsx("div",{ref:d,id:t.item.id,className:"display-item",style:{width:`${t.item.cellsLong*10}px`,height:`${t.item.cellsTall*10}px`},onMouseDown:y=>{y.preventDefault(),y.stopPropagation(),t.item.initialElement=d.current,t.item.id=t.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",t.item.id,"to initialElement",t.item.initialElement),j(new P({id:t.item.id,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,name:t.item.name,icon:t.item.icon,moveable:t.item.moveable,starterItem:t.item.starterItem,displayItem:t.item.isDisplayItem})),m(t.item)},onTouchStart:y=>{y.preventDefault(),y.stopPropagation(),t.item.initialElement=d.current,t.item.id=t.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",t.item.id,"to initialElement",t.item.initialElement),j(new P({id:t.item.id,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,name:t.item.name,icon:t.item.icon,moveable:t.item.moveable,starterItem:t.item.starterItem,displayItem:t.item.isDisplayItem})),m(t.item)},children:t.item.icon.includes("custom-")?c.jsx("div",{className:"custom-icon",children:c.jsx("div",{children:c.jsx("p",{ref:I,style:{fontSize:`${x}px`},children:t.item.icon.split("custom-")[1]})})}):c.jsx("img",{src:t.item.icon,alt:"icon"})}),c.jsx("p",{children:t.item.name}),c.jsxs("p",{className:"quantity",children:["x",t.quantity]})]})}const Rt="/LayItOut/assets/plus.circle-Ce3xm00a.png";function Pt({inventoryItems:t,addDraggingItem:m,maxHeight:i,removeItem:d,showAddCustomItem:I,isCreatingTemplate:x,isEditingTemplate:T,isViewingDesign:w}){return c.jsxs("div",{className:"toolbox",style:{maxHeight:i?`${i}px`:"200px"},children:[t.map(j=>c.jsx(Ot,{inventoryItem:j,addDraggingItem:m,removeItem:d})),!(x||T||w)&&c.jsx("div",{className:"add-item",onClick:()=>{I()},children:c.jsx("img",{src:Rt,alt:"Add Item"})})]})}function Dt({dialogRef:t,closeDialog:m,layoutSections:i,isOpen:d}){const[I,x]=h.useState(0),[T,w]=h.useState(0),[j,C]=h.useState([]),[N,y]=h.useState([...i]),S=/Mobi|Android/i.test(navigator.userAgent)?5:10;function O(D){for(const v of N)if(D.x>=v.cellId.x&&D.x<v.cellId.x+v.cellsLong&&D.y>=v.cellId.y&&D.y<v.cellId.y+v.cellsTall)return v;return null}h.useEffect(()=>{if(!d)return;console.log("Layout dialog opened, generating cells and sections",i);const D=[];let v=0,A=0;for(const p of i)console.log("Generating cells for section",p.name,"at",p.cellId,"with size",p.cellsLong,"x",p.cellsTall),console.log("Added section Length:",p.cellsLong*S+p.cellId.x),(p.cellsLong+p.cellId.x)*S>v&&(v+=p.cellsLong*S),(p.cellsTall+p.cellId.y)*S>A&&(A+=p.cellsTall*S);console.log("Current width:",v,"Current height:",A),x(v),w(A),[...Array(A/S).keys()].map(p=>{const k=[];[...Array(v/S).keys()].map(Y=>{console.log(O(new b({x:Y,y:p}))!=null?"In section":"Outside section"),k.push({id:new b({x:Y,y:p}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!1,size:S})}),D.push(k)}),C([...D]),setTimeout(()=>{const p=[...i];for(const k of p)console.log("Adding section",k.name,k.cellId),k.cellElement=document.querySelector(`.layout-dialog #${k.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",k.cellElement);console.log("Setting sections",p),y([...p]),C([...D])},100)},[d,i]);function E(D){let v=[];return D.map(A=>v=[...v,...A]),v}return c.jsxs("dialog",{ref:t,className:"layout-dialog",children:[c.jsxs("div",{className:"layout-dialog-div",children:[c.jsx("h2",{children:"Layout"}),c.jsx(Le,{width:I,height:T,cells:E(j)}),c.jsx("br",{}),c.jsx("button",{className:"layout-dialog-close",onClick:m,children:"Close"})]}),N.map(D=>c.jsx(Ye,{takingPhoto:!1,section:D,visible:!0,cellSize:S},D.cellId.toId()))]})}const Gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",Ft="/LayItOut/assets/template-Cjj8EPhc.png";function Mt({dialogRef:t,closeDialog:m,templates:i,isOpen:d,isViewingArea:I}){const[x,T]=h.useState([]),[w,j]=h.useState([]),[C,N]=h.useState([]),[y,S]=h.useState(/Mobi|Android/i.test(navigator.userAgent)),[O,E]=h.useState([]),[D,v]=h.useState(!1);return h.useEffect(()=>{if(d&&(console.log("Layout dialog opened, generating cells and sections",i),i.length!==0)){if(i.length==1){E([i[0].name]);return}E(y?[i[0].name]:[i[0].name,i[1].name])}},[d,i]),h.useEffect(()=>{const A=i.filter(p=>O.includes(p.name));console.log("Viewing templates:",O),A.sort((p,k)=>O.indexOf(p.name)-O.indexOf(k.name)),console.log("Generating templates for",A.map(p=>p.name))},[O]),c.jsx(c.Fragment,{children:c.jsx("dialog",{ref:t,className:"template-dialog",children:c.jsxs("div",{className:"template-dialog-div",children:[c.jsx("h2",{children:"Templates"}),c.jsxs("div",{className:"templates",children:[i.length>1&&i.filter(A=>!O.includes(A.name)).length>0&&c.jsx("img",{src:ge,onClick:()=>{if(y){const p=(i.findIndex(k=>k.name===O[0])-1+i.length)%i.length;E([i[p].name])}else E(A=>{const k=(i.findIndex(Y=>Y.name===A[0])-1+i.length)%i.length;return[i[k].name,A[0]]})},className:"back-mobile-areas"}),O.length===0&&c.jsx("div",{className:"no-templates",children:"No templates available"}),O.map(A=>c.jsxs("div",{className:"template",children:[c.jsx("img",{src:i.find(p=>p.name===A).previewImage,alt:A,className:"template-preview"}),c.jsx("h3",{children:A}),c.jsxs("div",{className:"template-actions",children:[c.jsx("button",{className:"template-select-btn",onClick:()=>{if(I){const p=new URLSearchParams(window.location.search),k=p.get("companyId"),Y=p.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${k}&areaId=${Y}&type=edit-template&templateId=${i.find(Z=>Z.name==A).id}`}else{const p=i.find(Z=>Z.name===A),k=new _({name:p.name,id:p.id,previewImage:p.previewImage,sections:p.sections.map(Z=>new W({name:Z.name,cellId:new b({x:Z.cellId.x*(y?20:10),y:Z.cellId.y*(y?20:10)}),cellsLong:Z.cellsLong*(y?20:10),cellsTall:Z.cellsTall*(y?20:10),startingItems:Z.startingItems.map(G=>new z({cell:new b({x:G.cell.x*(y?2:1),y:G.cell.y*(y?2:1)}),item:new P({id:G.item.id,name:G.item.name,icon:G.item.icon,cellsLong:G.item.cellsLong*2,cellsTall:G.item.cellsTall*2,starterItem:G.item.starterItem,moveable:G.item.moveable})}))}))}),Y=new URLSearchParams(window.location.search);Y.set("templateName",k.name),window.location.search=Y.toString()}},children:I?"Edit":"Select"}),I&&c.jsx("button",{className:"action-btn",onClick:()=>{if(D)return;v(!0);const p=i.filter(G=>G.name!==A);p.length==1?E([p[0].name]):p.length==0?E([]):p.length==2&&E(y?[p[0].name]:[p[0].name,p[1].name]);const k=new URLSearchParams(window.location.search),Y=k.get("companyId"),Z=k.get("areaId");ve(Y,Z,p).then(()=>{v(!1)})},children:"Delete"})]})]})),i.length>1&&i.filter(A=>!O.includes(A.name)).length>0&&c.jsx("img",{src:ge,onClick:()=>{if(y){const p=(i.findIndex(k=>k.name===O[0])+1)%i.length;E([i[p].name])}else E(A=>{const k=(i.findIndex(Y=>Y.name===A[A.length-1])+1)%i.length;return[A[1],i[k].name]})},className:"forward-mobile-areas"})]}),I&&c.jsxs(c.Fragment,{children:[c.jsx("button",{className:"action-btn",onClick:()=>{const A=new URLSearchParams(window.location.search),p=A.get("companyId"),k=A.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${p}&areaId=${k}&type=create-template`},children:"Create new Template"})," ",c.jsx("br",{})]}),c.jsx("br",{}),c.jsx("button",{className:"action-btn",onClick:m,children:"Close"}),D&&d&&c.jsx(c.Fragment,{children:c.jsx("div",{className:"loader"})})]})})})}function Ut({dialogRef:t,closeDialog:m,addInventoryItem:i}){const[d,I]=h.useState(""),[x,T]=h.useState(1),[w,j]=h.useState(1),[C,N]=h.useState(1);return c.jsx("dialog",{ref:t,className:"custom-item-dialog",children:c.jsxs("div",{className:"custom-item-dialog-div",children:[c.jsx("h2",{children:"Add Custom Item"}),c.jsxs("div",{className:"custom-item-row",children:[c.jsx("label",{htmlFor:"item-name",children:"Name:"}),c.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:y=>I(y.target.value??""),value:d})]}),c.jsxs("div",{className:"custom-item-row",children:[c.jsx("label",{htmlFor:"item-icon",children:"Count:"}),c.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:x,onChange:y=>T(parseInt(y.target.value)??1)})]}),c.jsxs("div",{className:"custom-item-row custom-item-size",children:[c.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),c.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:w,onChange:y=>j(parseFloat(y.target.value)??1)}),c.jsx("span",{children:" x "}),c.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:C,onChange:y=>N(parseFloat(y.target.value)??1)})]}),c.jsx("br",{}),c.jsx("button",{className:"custom-item-dialog-add",onClick:()=>{if(d.trim()===""){alert("Item name cannot be empty");return}const y=new ue({quantity:x,item:new P({id:d+(Math.random()*1e4).toString(),name:d,icon:`custom-${d}`,cellsLong:Math.ceil(w),cellsTall:Math.ceil(C),moveable:!0,starterItem:!1,displayItem:!0})});i(y),I(""),T(1),j(1),N(1),m()},children:"Add Item"}),c.jsx("br",{}),c.jsx("br",{}),c.jsx("button",{className:"custom-item-dialog-close",onClick:m,children:"Close"})]})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jt="type.googleapis.com/google.protobuf.Int64Value",Ht="type.googleapis.com/google.protobuf.UInt64Value";function Ze(t,m){const i={};for(const d in t)t.hasOwnProperty(d)&&(i[d]=m(t[d]));return i}function fe(t){if(t==null)return null;if(t instanceof Number&&(t=t.valueOf()),typeof t=="number"&&isFinite(t)||t===!0||t===!1||Object.prototype.toString.call(t)==="[object String]")return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map(m=>fe(m));if(typeof t=="function"||typeof t=="object")return Ze(t,m=>fe(m));throw new Error("Data cannot be encoded in JSON: "+t)}function se(t){if(t==null)return t;if(t["@type"])switch(t["@type"]){case Jt:case Ht:{const m=Number(t.value);if(isNaN(m))throw new Error("Data cannot be decoded from JSON: "+t);return m}default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(m=>se(m)):typeof t=="function"||typeof t=="object"?Ze(t,m=>se(m)):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ae="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Je={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class V extends At{constructor(m,i,d){super(`${Ae}/${m}`,i||""),this.details=d,Object.setPrototypeOf(this,V.prototype)}}function Wt(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Ie(t,m){let i=Wt(t),d=i,I;try{const x=m&&m.error;if(x){const T=x.status;if(typeof T=="string"){if(!Je[T])return new V("internal","internal");i=Je[T],d=T}const w=x.message;typeof w=="string"&&(d=w),I=x.details,I!==void 0&&(I=se(I))}}catch{}return i==="ok"?null:new V(i,d,I)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(m,i,d,I){this.app=m,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,wt(m)&&m.settings.appCheckToken&&(this.serverAppAppCheckToken=m.settings.appCheckToken),this.auth=i.getImmediate({optional:!0}),this.messaging=d.getImmediate({optional:!0}),this.auth||i.get().then(x=>this.auth=x,()=>{}),this.messaging||d.get().then(x=>this.messaging=x,()=>{}),this.appCheck||I?.get().then(x=>this.appCheck=x,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(m){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const i=m?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return i.error?null:i.token}return null}async getContext(m){const i=await this.getAuthToken(),d=await this.getMessagingToken(),I=await this.getAppCheckToken(m);return{authToken:i,messagingToken:d,appCheckToken:I}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const be="us-central1",Zt=/^data: (.*?)(?:\n|$)/;function Bt(t){let m=null;return{promise:new Promise((i,d)=>{m=setTimeout(()=>{d(new V("deadline-exceeded","deadline-exceeded"))},t)}),cancel:()=>{m&&clearTimeout(m)}}}class Vt{constructor(m,i,d,I,x=be,T=(...w)=>fetch(...w)){this.app=m,this.fetchImpl=T,this.emulatorOrigin=null,this.contextProvider=new Yt(m,i,d,I),this.cancelAllRequests=new Promise(w=>{this.deleteService=()=>Promise.resolve(w())});try{const w=new URL(x);this.customDomain=w.origin+(w.pathname==="/"?"":w.pathname),this.region=be}catch{this.customDomain=null,this.region=x}}_delete(){return this.deleteService()}_url(m){const i=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${i}/${this.region}/${m}`:this.customDomain!==null?`${this.customDomain}/${m}`:`https://${this.region}-${i}.cloudfunctions.net/${m}`}}function zt(t,m,i){const d=vt(m);t.emulatorOrigin=`http${d?"s":""}://${m}:${i}`,d&&(bt(t.emulatorOrigin),St("Functions",!0))}function Xt(t,m,i){const d=I=>$t(t,m,I,{});return d.stream=(I,x)=>Qt(t,m,I,x),d}async function qt(t,m,i,d){i["Content-Type"]="application/json";let I;try{I=await d(t,{method:"POST",body:JSON.stringify(m),headers:i})}catch{return{status:0,json:null}}let x=null;try{x=await I.json()}catch{}return{status:I.status,json:x}}async function Be(t,m){const i={},d=await t.contextProvider.getContext(m.limitedUseAppCheckTokens);return d.authToken&&(i.Authorization="Bearer "+d.authToken),d.messagingToken&&(i["Firebase-Instance-ID-Token"]=d.messagingToken),d.appCheckToken!==null&&(i["X-Firebase-AppCheck"]=d.appCheckToken),i}function $t(t,m,i,d){const I=t._url(m);return Kt(t,I,i,d)}async function Kt(t,m,i,d){i=fe(i);const I={data:i},x=await Be(t,d),T=d.timeout||7e4,w=Bt(T),j=await Promise.race([qt(m,I,x,t.fetchImpl),w.promise,t.cancelAllRequests]);if(w.cancel(),!j)throw new V("cancelled","Firebase Functions instance was deleted.");const C=Ie(j.status,j.json);if(C)throw C;if(!j.json)throw new V("internal","Response is not valid JSON object.");let N=j.json.data;if(typeof N>"u"&&(N=j.json.result),typeof N>"u")throw new V("internal","Response is missing data field.");return{data:se(N)}}function Qt(t,m,i,d){const I=t._url(m);return _t(t,I,i,d||{})}async function _t(t,m,i,d){i=fe(i);const I={data:i},x=await Be(t,d);x["Content-Type"]="application/json",x.Accept="text/event-stream";let T;try{T=await t.fetchImpl(m,{method:"POST",body:JSON.stringify(I),headers:x,signal:d?.signal})}catch(S){if(S instanceof Error&&S.name==="AbortError"){const E=new V("cancelled","Request was cancelled.");return{data:Promise.reject(E),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(E)}}}}}}const O=Ie(0,null);return{data:Promise.reject(O),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(O)}}}}}}let w,j;const C=new Promise((S,O)=>{w=S,j=O});d?.signal?.addEventListener("abort",()=>{const S=new V("cancelled","Request was cancelled.");j(S)});const N=T.body.getReader(),y=en(N,w,j,d?.signal);return{stream:{[Symbol.asyncIterator](){const S=y.getReader();return{async next(){const{value:O,done:E}=await S.read();return{value:O,done:E}},async return(){return await S.cancel(),{done:!0,value:void 0}}}}},data:C}}function en(t,m,i,d){const I=(T,w)=>{const j=T.match(Zt);if(!j)return;const C=j[1];try{const N=JSON.parse(C);if("result"in N){m(se(N.result));return}if("message"in N){w.enqueue(se(N.message));return}if("error"in N){const y=Ie(0,N);w.error(y),i(y);return}}catch(N){if(N instanceof V){w.error(N),i(N);return}}},x=new TextDecoder;return new ReadableStream({start(T){let w="";return j();async function j(){if(d?.aborted){const C=new V("cancelled","Request was cancelled");return T.error(C),i(C),Promise.resolve()}try{const{value:C,done:N}=await t.read();if(N){w.trim()&&I(w.trim(),T),T.close();return}if(d?.aborted){const S=new V("cancelled","Request was cancelled");T.error(S),i(S),await t.cancel();return}w+=x.decode(C,{stream:!0});const y=w.split(`
`);w=y.pop()||"";for(const S of y)S.trim()&&I(S.trim(),T);return j()}catch(C){const N=C instanceof V?C:Ie(0,null);T.error(N),i(N)}}},cancel(){return t.cancel()}})}const He="@firebase/functions",We="0.13.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tn="auth-internal",nn="app-check-internal",ln="messaging-internal";function sn(t){const m=(i,{instanceIdentifier:d})=>{const I=i.getProvider("app").getImmediate(),x=i.getProvider(tn),T=i.getProvider(ln),w=i.getProvider(nn);return new Vt(I,x,T,w,d)};pt(new yt(Ae,m,"PUBLIC").setMultipleInstances(!0)),Ue(He,We,t),Ue(He,We,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function on(t=xt(),m=be){const d=Tt(Se(t),Ae).getImmediate({identifier:m}),I=Lt("functions");return I&&an(d,...I),d}function an(t,m,i){zt(Se(t),m,i)}function cn(t,m,i){return Xt(Se(t),m)}sn();const rn=on(Nt);async function mn(t,m,i){const d=cn(rn,"generatePreviewImage");console.log("Generating preview image for companyId:",i.map(I=>JSON.stringify(I.toJSON())).join("LAYOUTSEPARATOR"));try{return(await d({companyId:t,areaId:m,templateName:"Preview",sections:i.map(x=>JSON.stringify(x.toJSON())).join("LAYOUTSEPARATOR")})).data}catch(I){throw console.error("Error generating preview image:",I.message),I}}It.createRoot(document.getElementById("root")).render(c.jsx(dn,{}));function dn(){const[t,m]=h.useState(/Mobi|Android/i.test(navigator.userAgent)),[i,d]=h.useState(0),[I,x]=h.useState(0),[T,w]=h.useState([]),[j,C]=h.useState([]),[N,y]=h.useState(0),[S,O]=h.useState(null),[E,D]=h.useState([]),v=/Mobi|Android/i.test(navigator.userAgent)?5:10,[A,p]=h.useState([]),k=h.useRef(null),[Y,Z]=h.useState(!1),[G,oe]=h.useState([]),[R,Q]=h.useState([]),[me,Ne]=h.useState([]),[Ve,je]=h.useState(!1),he=h.useRef(null),[ze,Ee]=h.useState([]),[q,ae]=h.useState([]),[U,de]=h.useState(null),[ie,ke]=h.useState(!1),[ee,Xe]=h.useState(!1),[te,qe]=h.useState(!1),[$e,Ke]=h.useState(!1),[un,Qe]=h.useState(!1),[_e,et]=h.useState(!1),[pe,ye]=h.useState(""),[ne,Ce]=h.useState(""),[ce,tt]=h.useState(""),[le,nt]=h.useState(""),[Oe,we]=h.useState(""),[xe,$]=h.useState(!0),[Re,lt]=h.useState(null),[Pe,gn]=h.useState(!1),Te=h.useRef(null);function re(n,s){for(const o of s)if(n.x>=o.cellId.x&&n.x<o.cellId.x+o.cellsLong&&n.y>=o.cellId.y&&n.y<o.cellId.y+o.cellsTall)return o;return null}function st(n){oe([...n.map(l=>new W({name:l.name,cellId:new b({x:l.cellId.x/2,y:l.cellId.y/2}),cellsLong:l.cellsLong/2,cellsTall:l.cellsTall/2,startingItems:[]}))]);let s=i,o=I;if(t){let l=0;const u=[],a=[];for(const e of n){const r=[],L={width:e.cellsLong*v,height:e.cellsTall*v,sectionName:e.name};L.height>l&&(l=L.height),Ee(B=>[...B,L]),e.cellId.x=0,e.cellId.y=0,[...Array(L.height/v).keys()].map(B=>{const J=[];[...Array(L.width/v).keys()].map(F=>{J.push({id:new b({x:F,y:B}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:v})}),r.push(J)}),u.push({sectionName:e.name,cells:[...r]}),a.push(e)}ae(u),Q(a),y(l),de(n[0]?n[0].name:null),setTimeout(()=>{$(!1)},500)}else{const l=[];for(const u of n)console.log("Generating cells for section",u.name,"at",u.cellId,"with size",u.cellsLong,"x",u.cellsTall),console.log("Needed section Width:",(u.cellsLong+u.cellId.x)*v,"Current width:",s),(u.cellsLong+u.cellId.x)*v>s&&(console.log("Added section Width:",u.cellsLong*v+u.cellId.x),s+=(u.cellsLong+u.cellId.x)*v-s),console.log("Needed section Height:",(u.cellsTall+u.cellId.y)*v,"Current height:",o),(u.cellsTall+u.cellId.y)*v>o&&(console.log("Added section Height:",u.cellsTall*v+u.cellId.y),o+=(u.cellsTall+u.cellId.y)*v-o);d(s),x(o),[...Array(o/v).keys()].map(u=>{const a=[];[...Array(s/v).keys()].map(e=>{a.push({id:new b({x:e,y:u}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:re(new b({x:e,y:u}),n)!=null,size:v})}),l.push(a)}),w([...l]),setTimeout(()=>{const u=[],a=[...n];for(const e of a)e.cellElement=document.querySelector(`.App #${e.cellId.toId()}.cell:not(.cell-border)`),u.push(...e.startingItems.map(r=>new z({cell:new b({x:e.cellId.x+r.cell.x,y:e.cellId.y+r.cell.y}),item:new P({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,initialElement:document.querySelector(`.App #${r.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:r.item.moveable,rotation:r.item.rotation||0})})));Q([...a]);for(const e of u){const r=J=>{const F=J%2===1;return{cellsLong:F?e.item.cellsTall:e.item.cellsLong,cellsTall:F?e.item.cellsLong:e.item.cellsTall}},L=e.item.rotation||0,B=r(L);for(let J=0;J<B.cellsTall;J++)for(let F=0;F<B.cellsLong;F++)l[e.cell.y+J][e.cell.x+F].hasItem=!0,l[e.cell.y+J][e.cell.x+F].itemId=e.item.id;e.item.initialElement=document.querySelector(`.App #${e.cell.toId()}.cell:not(.cell-border)`),C(J=>[...J,e.item])}w([...l]),setTimeout(()=>{$(!1)},500)},100)}}async function ot(){const n=new URLSearchParams(window.location.search),s=n.get("companyId"),o=n.get("areaId"),l=n.get("areaId")||"",u=n.get("companyId")||"",a=n.get("templateId")||"",e=await kt(u,l),r=n.get("type")||"";let L=!1;if(r==="create-template")ke(!0);else if(r==="edit-template"){Xe(!0);const g=e.templates.find(f=>f.id===a);g&&(lt(g),Ce(g.name))}else if(r==="view-design"){L=!0,qe(!0);const g=n.get("designName")||"";ye(g);const f=n.get("designId")||"";we(f)}else if(r==="view-area")Ke(!0);else if(r==="edit-design"){L=!0,Qe(!0);const g=n.get("designName")||"";ye(g);const f=n.get("designId")||"";we(f)}else if(r==="client-edit-design"){L=!0,et(!0);const g=n.get("designName")||"";ye(g);const f=n.get("designId")||"";we(f)}s&&tt(s),o&&nt(o),p(e.inventoryItems.map(g=>new ue({item:new P({id:g.item.id,name:g.item.name,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,initialElement:g.item.initialElement,moveable:g.item.moveable,starterItem:g.item.starterItem,displayItem:!0}),quantity:g.quantity})));const B=[],J=[];for(const g of e.templates){const f=[],M=[];for(const X of g.sections)f.push(new W({name:X.name,cellId:new b({x:X.cellId.x/(t?20:10),y:X.cellId.y/(t?20:10)}),cellsLong:X.cellsLong/(t?20:10),cellsTall:X.cellsTall/(t?20:10),startingItems:X.startingItems.map(H=>new z({cell:new b({x:H.cell.x/(t?2:1),y:H.cell.y/(t?2:1)}),item:new P({id:H.item.id,name:H.item.name,cellsLong:H.item.cellsLong/2,cellsTall:H.item.cellsTall/2,icon:H.item.icon,starterItem:!0,moveable:H.item.moveable,rotation:H.item.rotation||0})}))})),M.push(new W({name:X.name,cellId:new b({x:X.cellId.x,y:X.cellId.y}),cellsLong:X.cellsLong,cellsTall:X.cellsTall,startingItems:X.startingItems.map(H=>new z({cell:new b({x:H.cell.x,y:H.cell.y}),item:new P({id:H.item.id,name:H.item.name,cellsLong:H.item.cellsLong,cellsTall:H.item.cellsTall,icon:H.item.icon,starterItem:!0,moveable:H.item.moveable,rotation:H.item.rotation||0})}))}));B.push(new _({name:g.name,sections:f,id:g.id,previewImage:g.previewImage})),J.push(new _({name:g.name,sections:M,id:g.id,previewImage:g.previewImage}))}Ne([...B]);const F=[],K=a===""?void 0:J.find(g=>g.id===a);if(console.log("TEMPLATE",K,"AREA",e),L){const g=await Ct(u,l,n.get("designId")||"");if(g===null){window.location.href="/LayItOut/DNF/";return}oe([...g.sections]),Q([...g.sections.map(f=>new W({name:f.name,cellId:new b({x:f.cellId.x/10,y:f.cellId.y/10}),cellsLong:f.cellsLong/10,cellsTall:f.cellsTall/10,startingItems:f.startingItems,items:f.startingItems.map(M=>new P({id:M.item.id,name:M.item.name,sectionCell:M.cell,cellsLong:M.item.cellsLong,cellsTall:M.item.cellsTall,icon:M.item.icon,moveable:M.item.moveable,starterItem:M.item.starterItem,rotation:M.item.rotation}))}))]),F.push(...g.sections.map(f=>new W({name:f.name,cellId:new b({x:f.cellId.x/10,y:f.cellId.y/10}),cellsLong:f.cellsLong/10,cellsTall:f.cellsTall/10,startingItems:f.startingItems,items:f.startingItems.map(M=>new P({id:M.item.id,name:M.item.name,sectionCell:M.cell,cellsLong:M.item.cellsLong,cellsTall:M.item.cellsTall,icon:M.item.icon,moveable:M.item.moveable,starterItem:M.item.starterItem,rotation:M.item.rotation}))})))}else K!==void 0?(oe([...K.sections]),Q([...K.sections.map(g=>new W({name:g.name,cellId:new b({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(f=>new P({id:f.item.id,name:f.item.name,sectionCell:f.cell,cellsLong:f.item.cellsLong,cellsTall:f.item.cellsTall,icon:f.item.icon,moveable:f.item.moveable,starterItem:f.item.starterItem,rotation:f.item.rotation}))}))]),F.push(...K.sections.map(g=>new W({name:g.name,cellId:new b({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(f=>new P({id:f.item.id,name:f.item.name,cellsLong:f.item.cellsLong,cellsTall:f.item.cellsTall,icon:f.item.icon,moveable:f.item.moveable,starterItem:f.item.starterItem,rotation:f.item.rotation,sectionCell:f.cell}))})))):(oe([...e.sections]),Q([...e.sections.map(g=>new W({name:g.name,cellId:new b({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(f=>new P({id:f.item.id,name:f.item.name,sectionCell:f.cell,cellsLong:f.item.cellsLong,cellsTall:f.item.cellsTall,icon:f.item.icon,moveable:f.item.moveable,starterItem:f.item.starterItem,rotation:f.item.rotation}))}))]),F.push(...e.sections.map(g=>new W({name:g.name,cellId:new b({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(f=>new P({id:f.item.id,name:f.item.name,sectionCell:f.cell,cellsLong:f.item.cellsLong,cellsTall:f.item.cellsTall,icon:f.item.icon,moveable:f.item.moveable,starterItem:f.item.starterItem,rotation:f.item.rotation}))}))));console.log("SECTIONS TO GENERATE",F),st(F)}h.useEffect(()=>{ot()},[]);function at(n,s,o){if(!t||n==null)return;const l=[...o],u=[],a=o.find(e=>e.name==n);console.log("NEW SECTION",a),console.log("Adding section",a.name,a.cellId),console.log("MOBILE CELLS",s),a.cellElement=document.querySelector(`.App #${a.name.split(" ").join("-")} #${a.name.split(" ").join("")}${a.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",a.cellElement);for(const e of a.startingItems){console.log("Placing starting item",e.item.name,e.cell);const r=J=>{const F=J%2===1;return{cellsLong:F?e.item.cellsTall:e.item.cellsLong,cellsTall:F?e.item.cellsLong:e.item.cellsTall}},L=e.item.rotation||0,B=r(L);for(let J=0;J<B.cellsTall;J++)for(let F=0;F<B.cellsLong;F++){const K=s.find(g=>g.sectionName===a.name);K.cells[e.cell.y+J][e.cell.x+F].hasItem=!0,K.cells[e.cell.y+J][e.cell.x+F].itemId=e.item.id}e.item.initialElement=document.querySelector(`.App #${a.name.split(" ").join("-")} #${a.name.split(" ").join("")}${e.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",e.item.initialElement),u.push(new P({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,initialElement:e.item.initialElement,starterItem:!0,moveable:e.item.moveable,rotation:e.item.rotation}))}console.log("Setting sections",l),Q([...l]),console.log("ITEMS",u),C(e=>[...e.filter(L=>!u.some(B=>B.id===L.id)),...u.map(L=>new P({id:L.id,name:L.name,cellsLong:L.cellsLong,cellsTall:L.cellsTall,icon:L.icon,initialElement:L.initialElement,starterItem:!0,moveable:L.moveable,rotation:L.rotation}))])}function De(n){let s=[];return n.map(o=>s=[...s,...o]),s}function Ge(n,s){console.log(n);const o=t?q.find(e=>e.sectionName===U).cells:T,l=o[n.y].length,u=o.length;if(console.log(l,u),n.x+s.cellsLong>l||n.y+s.cellsTall>u)return!1;const a=re(n,R);if(!a&&!t)return console.log("Item is out of bounds of any section"),!1;for(let e=0;e<s.cellsTall;e++)for(let r=0;r<s.cellsLong;r++){if(!t){const L=re(new b({x:n.x+r,y:n.y+e}),R);if(!L)return console.log("Item is out of bounds of any section"),!1;if(L.name!=a.name)return console.log("Item is crossing section boundaries"),!1}if(o[n.y+e][n.x+r].hasItem&&o[n.y+e][n.x+r].itemId!=s.id)return console.log("Something is already here"),!1}return!0}function it(n,s,o){const l=Array.from(t?q.find(e=>e.sectionName===U).cells:T);if(o!=null){console.log("Removing item");const e=t?R.find(r=>r.name===U):re(o,R);e.items=e.items.filter(r=>r.id!=s.id);for(let r=0;r<s.cellsTall;r++)for(let L=0;L<s.cellsLong;L++)l[o.y+r][o.x+L].hasItem=!1,l[o.y+r][o.x+L].itemId=""}const u=t?R.find(e=>e.name===U):re(n,R),a=new b({x:n.x-u.cellId.x,y:n.y-u.cellId.y});s.sectionCell=a,u.items.push(s);for(let e=0;e<s.cellsTall;e++)for(let r=0;r<s.cellsLong;r++)l[n.y+e][n.x+r].hasItem=!0,l[n.y+e][n.x+r].itemId=s.id;if(console.log(l),t){const e=q.find(r=>r.sectionName===U);e&&(e.cells=l.map(r=>r.map(L=>({...L}))),ae([...q]))}else w(l);if(console.log("Removing item from inventory",s.name),!s.hasMoved){const e=A.findIndex(r=>r.item.name==s.name&&!r.item.hasMoved);if(e!==-1){const r=[...A];r[e].quantity-=1,r[e].quantity<=0&&r.splice(e,1),p(r)}else p(A)}C(e=>(console.log("Placing item",s.id),console.log("Updating item",s.id),e.find(r=>r.id==s.id).hasMoved||(e.find(r=>r.id==s.id).hasMoved=!0),e))}function ct(n){j.find(s=>s.name==n.name&&!s.hasMoved&&!s.starterItem)||C(s=>[...s,n])}function Fe(n){console.log("Removing item",n.id),C(s=>s.filter(o=>o.id!=n.id))}function rt(n,s){const o=Array.from(T),l=e=>{const r=e%2===1;return{cellsWide:r?n.cellsTall:n.cellsLong,cellsTall:r?n.cellsLong:n.cellsTall}},u=n.rotation||0,a=l(u);for(let e=0;e<a.cellsTall;e++)for(let r=0;r<a.cellsWide;r++)o[s.y+e][s.x+r].hasItem=!1,o[s.y+e][s.x+r].itemId="";w(o),console.log("DELETING ITEM",n.id),C(e=>(console.log(),e.filter(r=>r.id!=n.id))),p(e=>{const r=e.findIndex(L=>L.item.name==n.name&&!L.item.hasMoved);if(r!==-1){const L=[...e];return L[r].quantity+=1,L}else return[...e,new ue({item:new P({id:n.id,name:n.name,cellsLong:a.cellsWide,cellsTall:a.cellsTall,icon:n.icon}),quantity:1})]})}function mt(n,s){const o=Array.from(t?q.find(e=>e.sectionName===U).cells:T);console.log("DELETING ITEM ROTATE",n.id,n.rotation);const l=e=>{const r=e%2===1;return{cellsWide:r?n.cellsTall:n.cellsLong,cellsTall:r?n.cellsLong:n.cellsTall}},u=n.rotation||0,a=l(u);for(let e=0;e<a.cellsTall;e++)for(let r=0;r<a.cellsWide;r++)console.log("Deleting cell",s.y+e,s.x+r),o[s.y+e][s.x+r].hasItem=!1,o[s.y+e][s.x+r].itemId="";w([...o]),console.log("DELETING ITEM",n.id)}function dt(n,s){const o=t?q.find(a=>a.sectionName===U).cells:T,l=Array.from(o);if(o[n.y]==null){Me();return}const u=Ge(n,s);l.forEach(a=>a.forEach(e=>{e.mouseOver=!1,e.canPlaceItem=!1,e.mouseOverLocation=""}));for(let a=0;a<s.cellsTall;a++)for(let e=0;e<s.cellsLong;e++)n.y+a<l.length&&n.x+e<l[n.y+a].length&&(s.cellsLong===1&&s.cellsTall===1?l[n.y+a][n.x+e].mouseOverLocation="single":s.cellsTall===1?e===0?l[n.y+a][n.x+e].mouseOverLocation="leftFull":e===s.cellsLong-1?l[n.y+a][n.x+e].mouseOverLocation="rightFull":l[n.y+a][n.x+e].mouseOverLocation="middleFull":s.cellsLong===1?a===0?l[n.y+a][n.x+e].mouseOverLocation="topFull":a===s.cellsTall-1?l[n.y+a][n.x+e].mouseOverLocation="bottomFull":l[n.y+a][n.x+e].mouseOverLocation="middleVFull":a===0&&e===0?l[n.y+a][n.x+e].mouseOverLocation="topLeftCorner":a===0&&e===s.cellsLong-1?l[n.y+a][n.x+e].mouseOverLocation="topRightCorner":a===s.cellsTall-1&&e===0?l[n.y+a][n.x+e].mouseOverLocation="bottomLeftCorner":a===s.cellsTall-1&&e===s.cellsLong-1?l[n.y+a][n.x+e].mouseOverLocation="bottomRightCorner":a===0?l[n.y+a][n.x+e].mouseOverLocation="top":a===s.cellsTall-1?l[n.y+a][n.x+e].mouseOverLocation="bottom":e===0?l[n.y+a][n.x+e].mouseOverLocation="left":e===s.cellsLong-1?l[n.y+a][n.x+e].mouseOverLocation="right":l[n.y+a][n.x+e].mouseOverLocation="middle",l[n.y+a][n.x+e].mouseOver=!0,l[n.y+a][n.x+e].canPlaceItem=u);if(t){const a=q.find(e=>e.sectionName===U);a&&(a.cells=l.map(e=>e.map(r=>({...r}))),ae([...q])),ae(e=>e.map(r=>r.sectionName===U?{...r,cells:l}:r))}else w(l)}function Me(){const n=Array.from(t?q.find(s=>s.sectionName===U).cells:T);n.forEach(s=>s.forEach(o=>{o.mouseOver=!1,o.canPlaceItem=!1,o.mouseOverLocation=""})),w(n)}h.useEffect(()=>{at(U,q,R)},[U]),h.useEffect(()=>{const n=()=>{const s=j.find(o=>o.id===S);console.log("Unselecting item",S),O(null),s&&(D(o=>[...o,s.id]),console.log("Unselecting item",s.id),setTimeout(()=>{D(o=>o.filter(l=>l!==s.id))},300))};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[S,j]);function ut(n){O(null),D(s=>[...s,n]),console.log("Unselecting item",n),setTimeout(()=>{D(s=>s.filter(o=>o!==n))},300)}function gt(n){const s=j.find(o=>o.id===S);console.log("Unselecting item",S),O(n),s&&(D(o=>[...o,s.id]),console.log("Unselecting item",s.id),setTimeout(()=>{D(o=>o.filter(l=>l!==s.id))},300))}function ft(n){p(s=>[...s,n])}return c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"App",children:[c.jsx("h1",{className:"title",children:"LayItOut"}),c.jsx("br",{}),(ie||ee)&&c.jsxs("div",{className:"template-name-row",children:[c.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),c.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:n=>Ce(n.target.value),value:ne})]}),te&&c.jsx("div",{className:"design-name-row",children:c.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",pe]})}),c.jsx("button",{onClick:async()=>{const n=R.map(o=>new W({name:o.name,cellId:new b({x:G.find(l=>l.name==o.name).cellId.x*20,y:G.find(l=>l.name==o.name).cellId.y*20}),cellsLong:o.cellsLong*10,cellsTall:o.cellsTall*10,startingItems:o.items.map(l=>new z({cell:new b({x:l.sectionCell.x,y:l.sectionCell.y}),item:new P({id:l.id,name:l.name,cellsLong:l.cellsLong,cellsTall:l.cellsTall,icon:l.icon,starterItem:!0,moveable:l.moveable,rotation:l.rotation})}))})),s=await mn(ce,le,n);console.log("Preview image generated",s)},children:"Test"}),(ie||ee)&&c.jsxs("div",{className:"template-creation",children:[c.jsxs("button",{className:"action-btn",onClick:()=>{if(ne.trim()==""){alert("Please enter a template name");return}if(me.some(n=>n.name===ne&&(ee?n.id!==Re.id:!0))){alert("Template with this name already exists");return}ee?($(!0),setTimeout(async()=>{const n=window.location.origin+"/LayItOut/Preview/"+window.location.search,s=R.map(o=>new W({name:o.name,cellId:new b({x:G.find(l=>l.name==o.name).cellId.x*20,y:G.find(l=>l.name==o.name).cellId.y*20}),cellsLong:o.cellsLong*10,cellsTall:o.cellsTall*10,startingItems:o.items.map(l=>new z({cell:new b({x:l.sectionCell.x,y:l.sectionCell.y}),item:new P({id:l.id,name:l.name,cellsLong:l.cellsLong,cellsTall:l.cellsTall,icon:l.icon,starterItem:!0,moveable:l.moveable,rotation:l.rotation})}))}));localStorage.setItem("screenshotSections",s.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",s.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),window.addEventListener("storage",async o=>{if(console.log("Storage event",o),o.key==="screenshot"){const l=me.map(u=>u.id===Re.id?(console.log("SECTION",R),new _({name:ne,previewImage:o.newValue,sections:R.map(a=>new W({name:a.name,cellId:new b({x:u.sections.find(e=>e.name==a.name).cellId.x*(t?20:10),y:u.sections.find(e=>e.name==a.name).cellId.y*(t?20:10)}),cellsLong:a.cellsLong*10,cellsTall:a.cellsTall*10,startingItems:a.items.map(e=>new z({cell:new b({x:e.sectionCell.x,y:e.sectionCell.y}),item:new P({id:e.id,name:e.name,cellsLong:e.cellsLong,cellsTall:e.cellsTall,icon:e.icon,starterItem:!0,moveable:e.moveable,rotation:e.rotation})}))})),id:u.id})):new _({name:u.name,previewImage:u.previewImage,sections:u.sections.map(a=>new W({name:a.name,cellId:new b({x:a.cellId.x*(t?20:10),y:a.cellId.y*(t?20:10)}),cellsLong:a.cellsLong*(t?20:10),cellsTall:a.cellsTall*(t?20:10),startingItems:a.startingItems.map(e=>new z({cell:new b({x:e.cell.x*(t?2:1),y:e.cell.y*(t?2:1)}),item:new P({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong*2,cellsTall:e.item.cellsTall*2,icon:e.item.icon,starterItem:e.item.starterItem,moveable:e.item.moveable,rotation:e.item.rotation})}))})),id:u.id}));ve(ce,le,l).then(()=>{console.log("Template updated successfully"),$(!1);const u=new URLSearchParams(window.location.search),a=u.get("companyId"),e=u.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${a}&areaId=${e}&type=view-area`})}}),window.open(n,"_blank")},500)):($(!0),setTimeout(async()=>{const n=window.location.origin+"/LayItOut/Preview/"+window.location.search,s=R.map(o=>new W({name:o.name,cellId:new b({x:G.find(l=>l.name==o.name).cellId.x*20,y:G.find(l=>l.name==o.name).cellId.y*20}),cellsLong:o.cellsLong*10,cellsTall:o.cellsTall*10,startingItems:o.items.map(l=>new z({cell:new b({x:l.sectionCell.x,y:l.sectionCell.y}),item:new P({id:l.id,name:l.name,cellsLong:l.cellsLong,cellsTall:l.cellsTall,icon:l.icon,starterItem:!0,moveable:l.moveable,rotation:l.rotation})}))}));localStorage.setItem("screenshotSections",s.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",s.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),window.addEventListener("storage",async o=>{if(console.log("Storage event",o),o.key==="screenshot"){const l=new _({name:ne,previewImage:o.newValue,sections:R.map(a=>new W({name:a.name,cellId:new b({x:G.find(e=>e.name==a.name).cellId.x*20,y:G.find(e=>e.name==a.name).cellId.y*20}),cellsLong:a.cellsLong*10,cellsTall:a.cellsTall*10,startingItems:a.items.map(e=>new z({cell:new b({x:e.sectionCell.x,y:e.sectionCell.y}),item:new P({id:e.id,name:e.name,cellsLong:e.cellsLong,cellsTall:e.cellsTall,icon:e.icon,starterItem:!0,moveable:e.moveable,rotation:e.rotation})}))})),id:ne+(Math.random()*1e4).toString()}),u=[...me.map(a=>new _({name:a.name,previewImage:a.previewImage,sections:a.sections.map(e=>new W({name:e.name,cellId:new b({x:e.cellId.x*(t?20:10),y:e.cellId.y*(t?20:10)}),cellsLong:e.cellsLong*(t?20:10),cellsTall:e.cellsTall*(t?20:10),startingItems:e.startingItems.map(r=>new z({cell:new b({x:r.cell.x*(t?2:1),y:r.cell.y*(t?2:1)}),item:new P({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong*2,cellsTall:r.item.cellsTall*2,icon:r.item.icon,starterItem:r.item.starterItem,moveable:r.item.moveable,rotation:r.item.rotation})}))})),id:a.id})),l];ve(ce,le,u).then(()=>{console.log("Template updated successfully"),$(!1);const a=new URLSearchParams(window.location.search),e=a.get("companyId"),r=a.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${e}&areaId=${r}&type=view-area`})}}),window.open(n,"_blank")},500))},children:[ie?"Create":"Save"," Template"]}),c.jsx("button",{className:"action-btn",onClick:()=>{ke(!1),Ne([]),oe([]),Q([]),ae([]),Ee([]),de(null)},children:"Cancel"})]}),_e&&c.jsxs("div",{className:"template-creation",children:[c.jsx("button",{className:"action-btn",onClick:()=>{$(!0),setTimeout(async()=>{const n=window.location.origin+"/LayItOut/Preview/"+window.location.search,s=R.map(o=>new W({name:o.name,cellId:new b({x:G.find(l=>l.name==o.name).cellId.x*20,y:G.find(l=>l.name==o.name).cellId.y*20}),cellsLong:o.cellsLong*10,cellsTall:o.cellsTall*10,startingItems:o.items.map(l=>new z({cell:new b({x:l.sectionCell.x,y:l.sectionCell.y}),item:new P({id:l.id,name:l.name,cellsLong:l.cellsLong,cellsTall:l.cellsTall,icon:l.icon,starterItem:!0,moveable:l.moveable,rotation:l.rotation})}))}));localStorage.setItem("screenshotSections",s.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",s.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),window.addEventListener("storage",async o=>{if(console.log("Storage event",o),o.key==="screenshot"){const l=new jt({name:pe,previewImage:o.newValue,areaId:le,sections:R.map(u=>new W({name:u.name,cellId:new b({x:G.find(a=>a.name==u.name).cellId.x*20,y:G.find(a=>a.name==u.name).cellId.y*20}),cellsLong:u.cellsLong*10,cellsTall:u.cellsTall*10,startingItems:u.items.map(a=>new z({cell:new b({x:a.sectionCell.x,y:a.sectionCell.y}),item:new P({id:a.id,name:a.name,cellsLong:a.cellsLong,cellsTall:a.cellsTall,icon:a.icon,starterItem:!0,moveable:a.moveable,rotation:a.rotation})}))})),id:Oe});Et(ce,le,l).then(()=>{console.log("Design updated successfully"),$(!1)})}}),window.open(n,"_blank")},500)},children:"Save"}),c.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),xe&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"loader-backdrop"}),c.jsx("div",{className:"loader"})]})," ",c.jsxs("div",{className:"layout",children:[!te&&c.jsx(Pt,{isViewingDesign:te,isEditingTemplate:ee,isCreatingTemplate:ie,maxHeight:t?200:I,showAddCustomItem:()=>{Te.current?.showModal()},addDraggingItem:ct,removeItem:Fe,inventoryItems:A.map(n=>new ue({item:new P({id:n.item.id,name:n.item.name,cellsLong:n.item.cellsLong,cellsTall:n.item.cellsTall,icon:n.item.icon,displayItem:!0}),quantity:n.quantity}))}),t?c.jsxs("div",{className:"mobile-areas",style:{height:N+"px"},children:[c.jsx("img",{src:ge,onClick:()=>{const n=R.findIndex(o=>o.name==U);if(n===-1)return;const s=(n-1+R.length)%R.length;de(R[s].name),console.log("Changing viewing section to",R[s].name)},className:"back-mobile-areas"}),ze.map((n,s)=>c.jsx(Le,{width:n.width,height:n.height,cells:De(q.find(o=>o.sectionName==n.sectionName).cells),id:n.sectionName,visibile:U==null?!0:n.sectionName==U,section:n.sectionName},s)),c.jsx("img",{src:ge,onClick:()=>{const n=R.findIndex(o=>o.name==U);if(n===-1)return;const s=(n+1)%R.length;de(R[s].name),console.log("Changing viewing section to",R[s].name)},className:"forward-mobile-areas"})]}):c.jsx(Le,{width:i,height:I,cells:De(T)})]}),te&&c.jsx("div",{className:"design-view",children:c.jsx("button",{className:"action-btn",onClick:()=>{window.location.href=`/LayItOut/Print/?companyId=${ce}&areaId=${le}&designName=${pe}&designId=${Oe}`},children:"Print"})})]}),c.jsxs("div",{id:Pe?"capture":"",children:[R.map(n=>c.jsx(Ye,{takingPhoto:Pe,section:n,visible:U==null?!0:n.name==U,cellSize:v},n.cellId.toId())),j.map(n=>c.jsx(ht,{cellSize:v,isViewingDesign:te,removeItem:Fe,visible:t?!n.hasMoved&&!n.starterItem?!0:U==null?!1:n.starterItem?R.find(s=>s.name==U)?.startingItems.some(s=>s.item.id===n.id):R.find(s=>s.name==U)?.items.some(s=>s.id===n.id):!0,item:n,canPlaceItem:Ge,placeItem:it,deleteItemRotate:mt,highlightCells:dt,unHighlightCells:Me,deleteItem:rt,isSelected:S===n.id,onSelect:gt,isUnselecting:E.includes(n.id),onDeselect:()=>ut(n.id)},n.id))]}),t&&!xe&&c.jsx("div",{className:"layout-icon",onClick:()=>{k.current?.showModal(),Z(!0),console.log("Showing layout dialog")},children:c.jsx("img",{src:Gt,alt:""})}),!xe&&!(ie||ee||te)&&c.jsx("div",{className:"template-icon",onClick:()=>{he.current?.showModal(),je(!0),console.log("Showing template dialog")},children:c.jsx("img",{src:Ft,alt:""})}),c.jsx(Mt,{isViewingArea:$e,dialogRef:he,isOpen:Ve,closeDialog:()=>{he.current?.close(),je(!1)},templates:me}),c.jsx(Dt,{dialogRef:k,isOpen:Y,closeDialog:()=>{k.current?.close(),Z(!1)},layoutSections:G}),c.jsx(Ut,{dialogRef:Te,addInventoryItem:ft,closeDialog:()=>{Te.current?.close()}})]})}
