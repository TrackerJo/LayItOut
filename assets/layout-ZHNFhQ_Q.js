import{r as d,j as e,c as Nn}from"./index-_mSZXrjJ.js";import{A as Pt,S as Mn,D as Cn,B as En}from"./booth_item-HD65K4xB.js";import{I as w,s as Qe,j as ue,p as Rn,C as h,V as Gt,S as P,k as z,T as xe,D as Bt,u as Wt,B as Ce,l as je,m as Ee,d as kn,b as Dn,n as On,o as nt,q as Pn,r as Bn,t as Wn,v as Gn,A as Fn,w as Zn}from"./firestore-BIrJGVi9.js";import{F as lt}from"./add_custom_item_dialog-B83re6ox.js";import"./auth-iroOyPOj.js";import{L as Vn,T as Yn}from"./link-DQZq8SUn.js";function Jn({inventoryItem:r,addDraggingItem:B,removeItem:F,setSelectedItem:L,tapAndPlaceMode:S}){const E=d.useRef(null),C=d.useRef(null),[T,G]=d.useState(12),[A,R]=d.useState(r.item),[N,W]=d.useState(!1);function v(x){const V=C.current,X=window.getComputedStyle(V),H=document.createElement("span");H.style.font=X.font,H.style.fontSize=x+"px",H.style.fontFamily=X.fontFamily,H.style.fontWeight=X.fontWeight,H.style.position="absolute",H.style.visibility="hidden",H.style.whiteSpace="nowrap",H.textContent=V.textContent,document.body.appendChild(H);const k=H.offsetWidth;return document.body.removeChild(H),k}function U(x){if(C.current){const V=C.current;return v(x-1)>V.offsetWidth&&x-1>8?U(x-1):x-1}return x}d.useEffect(()=>{setTimeout(()=>{C.current&&G(U(T))},100)},[]);const I=d.useCallback(()=>{if(console.log("MOUSE MOVE",N),N){if(W(!1),S)return;r.item.initialElement=E.current,r.item.id=r.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",r.item.id,"to initialElement",r.item.initialElement),R(new w({...r.item})),B(r.item),window.removeEventListener("mousemove",I),window.removeEventListener("touchmove",I)}},[N,S]);return d.useEffect(()=>(N?(window.addEventListener("touchmove",I),window.addEventListener("mousemove",I)):(window.removeEventListener("touchmove",I),window.removeEventListener("mousemove",I)),()=>{window.removeEventListener("touchmove",I),window.removeEventListener("mousemove",I)}),[N,I]),e.jsxs("div",{className:"display",children:[e.jsx("div",{ref:E,id:r.item.id,className:r.item.isSectionItem?"display-section":`display-item ${r.item.isSectionModifier?r.item.sectionModifierType.toString():""}`,style:{width:`${r.item.cellsLong*10}px`,height:`${r.item.cellsTall*10}px`},onMouseDown:x=>{W(!0)},onMouseUp:()=>{console.log("MOUSE UP"),W(!1)},onClick:x=>{if(!S){x.preventDefault(),x.stopPropagation();return}console.log("CLICKED ON ITEM",r.item.id,"with tap and place mode"),x.preventDefault(),x.stopPropagation(),r.item.initialElement=E.current,r.item.id=r.item.name+(Math.random()*1e4).toString(),L(r.item)},onTouchStart:x=>{S||(x.preventDefault(),x.stopPropagation(),r.item.initialElement=E.current,r.item.id=r.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",r.item.id,"to initialElement",r.item.initialElement),R(new w({...r.item})),B(r.item))},children:r.item.isSectionModifier?r.item.sectionModifierType==="LeftDoor"||r.item.sectionModifierType==="RightDoor"?e.jsx("img",{src:r.item.icon,alt:"icon"}):null:r.item.icon.includes("custom-")?e.jsx("div",{className:r.item.isSectionItem?"custom-section":"custom-icon",children:e.jsx("div",{children:e.jsx("p",{ref:C,style:{fontSize:`${T}px`},children:r.item.icon.split("custom-")[1]})})}):e.jsx("img",{src:r.item.icon,alt:"icon"})}),e.jsx("p",{children:r.item.name}),r.quantity>0&&e.jsxs("p",{className:"quantity",children:["x",r.quantity]})]})}const Ft="/LayItOut/assets/plus.circle-Ce3xm00a.png";function Un({inventoryItems:r,addDraggingItem:B,maxHeight:F,removeItem:L,showAddCustomItem:S,isCreatingTemplate:E,isEditingTemplate:C,isViewingDesign:T,tapAndPlaceMode:G,setSelectedItem:A,isModifyingSections:R}){return e.jsxs("div",{className:"toolbox",style:{maxHeight:F?`${F}px`:"200px"},children:[r.map(N=>e.jsx(Jn,{setSelectedItem:A,tapAndPlaceMode:G,inventoryItem:N,addDraggingItem:B,removeItem:L})),!(E||C||T||R)&&e.jsx("div",{className:"add-item",onClick:()=>{S()},children:e.jsx("img",{src:Ft,alt:"Add Item"})})]})}function Hn({dialogRef:r,closeDialog:B,areaPreview:F}){return e.jsx("dialog",{ref:r,className:"layout-dialog",children:e.jsxs("div",{className:"layout-dialog-div",children:[e.jsx("h2",{children:"Layout"}),e.jsx("img",{src:F,alt:"Layout preview",className:"layout-dialog-preview"}),e.jsx("br",{}),e.jsx("button",{className:"layout-dialog-close",onClick:B,children:"Close"})]})})}const Xn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",Qn="/LayItOut/assets/template-Cjj8EPhc.png";function zn({dialogRef:r,closeDialog:B,templates:F,isOpen:L,isViewingArea:S,selectTemplate:E,duplicateTemplate:C}){const[T,G]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[A,R]=d.useState([]),[N,W]=d.useState(!1),[v,U]=d.useState([]);return d.useEffect(()=>{U(F)},[F]),d.useEffect(()=>{if(L&&(console.log("Layout dialog opened, generating cells and sections",v),v.length!==0)){if(v.length==1){R([v[0].name]);return}R(T?[v[0].name]:[v[0].name,v[1].name])}},[L,v]),d.useEffect(()=>{const I=v.filter(x=>A.includes(x.name));console.log("Viewing templates:",A),I.sort((x,V)=>A.indexOf(x.name)-A.indexOf(V.name)),console.log("Generating templates for",I.map(x=>x.name))},[A,v]),e.jsx(e.Fragment,{children:e.jsx("dialog",{ref:r,className:"template-dialog",children:e.jsxs("div",{className:"template-dialog-div",children:[e.jsx("h2",{children:"Templates"}),e.jsxs("div",{className:"templates",children:[v.length>1&&v.filter(I=>!A.includes(I.name)).length>0&&e.jsx("img",{src:lt,onClick:()=>{if(T){const x=(v.findIndex(V=>V.name===A[0])-1+v.length)%v.length;R([v[x].name])}else R(I=>{const V=(v.findIndex(X=>X.name===I[0])-1+v.length)%v.length;return[v[V].name,I[0]]})},className:"back-mobile-areas"}),A.length===0&&e.jsx("div",{className:"no-templates",children:"No templates available"}),A.map(I=>e.jsxs("div",{className:"template",children:[e.jsx("img",{src:v.find(x=>x.name===I).previewImage,alt:I,className:"template-preview"}),e.jsx("h3",{children:I}),e.jsxs("div",{className:"template-actions",children:[e.jsx("button",{className:"template-select-btn",onClick:()=>{if(S){const x=new URLSearchParams(window.location.search),V=x.get("companyId"),X=x.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${V}&areaId=${X}&type=edit-template&templateId=${v.find(H=>H.name==I).id}`}else B(),E&&E(v.find(x=>x.name===I))},children:S?"Edit":"Select"}),S&&e.jsx("button",{className:"action-btn",onClick:()=>{N||(W(!0),C&&C(v.find(x=>x.name===I)))},children:"Duplicate"}),S&&e.jsx("button",{className:"action-btn",onClick:()=>{if(N)return;W(!0);const x=v.filter(k=>k.name!==I);U(x),x.length==1?R([x[0].name]):x.length==0?R([]):R(T?[x[0].name]:[x[0].name,x[1].name]);const V=new URLSearchParams(window.location.search),X=V.get("companyId"),H=V.get("areaId");Qe(X,H,x).then(()=>{W(!1)})},children:"Delete"})]})]})),v.length>1&&v.filter(I=>!A.includes(I.name)).length>0&&e.jsx("img",{src:lt,onClick:()=>{if(T){const x=(v.findIndex(V=>V.name===A[0])+1)%v.length;R([v[x].name])}else R(I=>{const V=(v.findIndex(X=>X.name===I[I.length-1])+1)%v.length;return[I[1],v[V].name]})},className:"forward-mobile-areas"})]}),S&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"action-btn",onClick:()=>{const I=new URLSearchParams(window.location.search),x=I.get("companyId"),V=I.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${x}&areaId=${V}&type=create-template`},children:"Create new Template"})," ",e.jsx("br",{})]}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:B,children:"Close"}),N&&L&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"loader"})})]})})})}function qn({dialogRef:r,closeDialog:B,addInventoryItem:F,canBeBooth:L}){const[S,E]=d.useState(""),[C,T]=d.useState(1),[G,A]=d.useState(1),[R,N]=d.useState(1),[W,v]=d.useState(!1);return e.jsx("dialog",{ref:r,className:"custom-item-dialog",children:e.jsxs("div",{className:"custom-item-dialog-div",children:[e.jsx("h2",{children:"Add Custom Item"}),e.jsxs("div",{className:"custom-item-row",children:[e.jsx("label",{htmlFor:"item-name",children:"Name:"}),e.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:U=>E(U.target.value??""),value:S})]}),e.jsxs("div",{className:"custom-item-row",children:[e.jsx("label",{htmlFor:"item-icon",children:"Count:"}),e.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:C,onChange:U=>T(parseInt(U.target.value)??1)})]}),e.jsxs("div",{className:"custom-item-row custom-item-size",children:[e.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),e.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:G,onChange:U=>A(parseFloat(U.target.value)??1)}),e.jsx("span",{children:" x "}),e.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:R,onChange:U=>N(parseFloat(U.target.value)??1)})]}),L?e.jsxs("div",{className:"custom-item-row",children:[e.jsx("label",{htmlFor:"is-booth",children:"Is Booth:"}),e.jsx("input",{type:"checkbox",id:"is-booth",name:"is-booth",checked:W,onChange:U=>v(U.target.checked)})]}):null,e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{if(S.trim()===""){alert("Item name cannot be empty");return}const U=new ue({quantity:C,item:new w({id:S+(Math.random()*1e4).toString(),name:S,icon:`custom-${S}`,cellsLong:Math.ceil(G),cellsTall:Math.ceil(R),moveable:!0,starterItem:!1,displayItem:!0,isBooth:W})});F(U),E(""),T(1),A(1),N(1),v(!1),B()},children:"Add Item"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{B(),E(""),T(1),A(1),N(1),v(!1)},children:"Close"})]})})}function $n({dialogRef:r,closeDialog:B,addSection:F}){const[L,S]=d.useState(""),[E,C]=d.useState(1),[T,G]=d.useState(1);return e.jsx("dialog",{ref:r,className:"section-dialog",children:e.jsxs("div",{className:"section-dialog-div",children:[e.jsx("h2",{children:"Add Section"}),e.jsxs("div",{className:"section-row",children:[e.jsx("label",{htmlFor:"section-name",children:"Name:"}),e.jsx("input",{type:"text",id:"section-name",name:"section-name",onChange:A=>S(A.target.value??""),value:L})]}),e.jsxs("div",{className:"section-row section-size",children:[e.jsx("label",{htmlFor:"section-width",children:"Size (in feet):"}),e.jsx("input",{type:"number",id:"section-width",name:"section-width",min:"1",value:E,onChange:A=>C(parseFloat(A.target.value)??1)}),e.jsx("span",{children:" x "}),e.jsx("input",{type:"number",id:"section-height",name:"section-height",min:"1",value:T,onChange:A=>G(parseFloat(A.target.value)??1)})]}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{if(L.trim()===""){alert("Section name cannot be empty");return}const A=new ue({quantity:1,item:new w({id:L+(Math.random()*1e4).toString(),name:L,icon:`custom-${L}`,cellsLong:Math.ceil(E),cellsTall:Math.ceil(T),moveable:!0,starterItem:!1,displayItem:!0,isSectionItem:!0})});F(A),S(""),C(1),G(1),B()},children:"Add Section"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:B,children:"Close"})]})})}function Kn({dialogRef:r,closeDialog:B,addInventoryItem:F}){const[L,S]=d.useState(null),[E,C]=d.useState(""),[T,G]=d.useState(1),[A,R]=d.useState(1),[N,W]=d.useState(1),[v,U]=d.useState(!0);return e.jsx("dialog",{ref:r,className:"inventory-item-dialog",children:e.jsxs("div",{className:"inventory-item-dialog-div",children:[e.jsx("h2",{children:"Add Inventory Item"}),L==null?e.jsxs(e.Fragment,{children:["  ",e.jsx("label",{htmlFor:"",children:"Premade Items:"}),e.jsx("div",{className:"inventory-item-list",children:Rn.map(I=>e.jsx("div",{className:"inventory-item",onClick:()=>{const x=new ue({quantity:1,item:new w({id:I.name+(Math.random()*1e4).toString(),name:I.name,icon:I.icon,cellsLong:I.cellsLong,cellsTall:I.cellsTall,moveable:!0,starterItem:!1,displayItem:!0})});S(x)},children:e.jsxs("div",{className:"inventory-item-display",children:[e.jsx("img",{src:I.icon,alt:"icon"}),e.jsx("p",{children:I.name}),e.jsxs("p",{className:"quantity",children:[I.cellsLong,"ft x ",I.cellsTall,"ft"]})]})},I.name))}),e.jsx("label",{htmlFor:"",children:"Or:"}),e.jsx("label",{htmlFor:"",children:"Custom Item:"}),e.jsxs("div",{className:"inventory-item-row",children:[e.jsx("label",{htmlFor:"item-name",children:"Name:"}),e.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:I=>C(I.target.value??""),value:E})]}),e.jsxs("div",{className:"inventory-item-row",children:[e.jsx("label",{htmlFor:"item-icon",children:"Count:"}),e.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:T,onChange:I=>G(parseInt(I.target.value)??1)})]}),e.jsxs("div",{className:"inventory-item-row inventory-item-size",children:[e.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),e.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:A,onChange:I=>R(parseFloat(I.target.value)??1)}),e.jsx("span",{children:" x "}),e.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:N,onChange:I=>W(parseFloat(I.target.value)??1)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),e.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:v,onChange:I=>U(I.target.checked)})]}),e.jsx("br",{})]}):e.jsxs(e.Fragment,{children:[e.jsxs("label",{htmlFor:"",children:["Item: ",L.item.name]}),e.jsxs("div",{className:"inventory-item-row",children:[e.jsx("label",{htmlFor:"item-icon",children:"Count:"}),e.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:T,onChange:I=>G(parseInt(I.target.value)??1)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),e.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:v,onChange:I=>U(I.target.checked)})]})]}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{if(E.trim()===""&&L==null){alert("Item name cannot be empty");return}if(T<=0){alert("Item count must be greater than zero");return}let I=L;I==null?I=new ue({quantity:T,item:new w({id:E+(Math.random()*1e4).toString(),name:E,icon:`inventory-${E}`,cellsLong:Math.ceil(A),cellsTall:Math.ceil(N),moveable:v,starterItem:!1,displayItem:!0})}):(I.quantity=T,I.item.moveable=v),F(I),U(!0),S(null),C(""),G(1),R(1),W(1),B()},children:"Add Item"}),e.jsx("button",{className:"action-btn",onClick:B,children:"Close"})]})})}function _n({item:r,setSelectingItem:B,addHighlightedCell:F,canPlaceItem:L,placeItem:S,highlightCells:E,unHighlightCells:C,cellSize:T,placeMultiItem:G}){const[A,R]=d.useState(0),[N,W]=d.useState(0),v=d.useRef(null),[U,I]=d.useState(0),[x,V]=d.useState(0),[X,H]=d.useState(!1),[k,ce]=d.useState(0),[le,Re]=d.useState(null),[vt,fe]=d.useState(!0),[Ae,ze]=d.useState(12),[Ne,qe]=d.useState(null),$e=d.useRef(null),[Ge,bt]=d.useState(!0),[Fe,oe]=d.useState(!1),[re,j]=d.useState(!1),ae=d.useCallback(M=>{const y=M%2===1;return{width:y?r.cellsTall*T:r.cellsLong*T,height:y?r.cellsLong*T:r.cellsTall*T,cellsWide:y?r.cellsTall:r.cellsLong,cellsTall:y?r.cellsLong:r.cellsTall}},[r,T]);function ot(M){const y=v.current,ee=window.getComputedStyle(y),O=document.createElement("span");O.style.font=ee.font,O.style.fontSize=M+"px",O.style.fontFamily=ee.fontFamily,O.style.fontWeight=ee.fontWeight,O.style.position="absolute",O.style.visibility="hidden",O.style.whiteSpace="nowrap",O.textContent=y.textContent,document.body.appendChild(O);const de=O.offsetWidth;return document.body.removeChild(O),de}function Ze(M){if(v.current){const y=v.current;return ot(M-1)>y.offsetWidth&&M-1>8?Ze(M-1):M-1}return M}const ve=()=>{oe(!0)},ke=()=>{oe(!1)};d.useEffect(()=>(setTimeout(()=>{v.current&&ze(Ze(Ae))},100),window.addEventListener("mousedown",ve),window.addEventListener("mouseup",ke),()=>{window.removeEventListener("mousedown",ve),window.removeEventListener("mouseup",ke)}),[]),d.useEffect(()=>{if(r){H(!0);const M=$e.current?.getBoundingClientRect();qe({x:M?M.left-A:0,y:M?M.top-N:0})}else console.log("No item to place, stopping dragging"),H(!1),qe(null),R(0),W(0),I(0),V(0),ce(0),Re(null),fe(!0),ze(12),bt(!0)},[r]);const Le=M=>{M.preventDefault()},Te=d.useCallback((M,y,ee)=>{if(r==null||!X||!Ne)return;console.log("PLACING MOVE",r);const O=ee.target,de=ae(k),Y=w.fromDoc(r.toDoc());Y.cellsLong=de.cellsWide,Y.cellsTall=de.cellsTall,Y.initialElement=r.initialElement,Y.rotation=k,Y.hasMoved=r.hasMoved,Y.id=r.id;let pe=O;if(!pe||!pe.classList?.contains("cell")){const Ie=document.elementFromPoint(M,y);Ie?.classList?.contains("cell")&&(pe=Ie)}pe?.classList?.contains("cell")&&!re?E(h.fromString(pe.id),Y):pe?.classList?.contains("section-modifier")&&!re?E(h.fromString(pe.dataset.cell),Y):re||C(),R(M-Ne.x),W(y-Ne.y+(r.sectionModifierType?.includes("Door")?10:5)),Fe&&(re||C(),j(!0),F(h.fromString(pe.id)))},[r,X,A,N,re,Fe,Ne,L,S,ae,k,E,C,$e]),he=d.useCallback(M=>{if(r==null)return;const y=M.clientX,ee=M.clientY;console.log("Drag ended"),C(),document.body.removeEventListener("touchmove",Le);const O=document.elementFromPoint(y,ee);if(!O?.classList?.contains("cell")&&!O?.classList?.contains("section-modifier")){const de=ae(k),Y={...r,cellsLong:de.cellsWide,cellsTall:de.cellsTall};re?(j(!1),G(Y)):B()}else if(O?.classList?.contains("section-modifier")){if(console.log("Placing item on section modifier cell"),console.log("Target element:",O.dataset.cell),O.dataset.cell=="")return;const de=ae(k),Y={...r,cellsLong:de.cellsWide,cellsTall:de.cellsTall};if(re)j(!1),G(Y);else{if(!L(h.fromString(O.dataset.cell),Y))return;S(h.fromString(O.dataset.cell),Y,le!=null?h.fromString(le.id):null)}console.log("Placed item at cell:",O)}else{const de=ae(k),Y={...r,cellsLong:de.cellsWide,cellsTall:de.cellsTall};if(re)j(!1),G(Y);else{if(!L(h.fromString(O.id),Y))return;S(h.fromString(O.id),Y,le!=null?h.fromString(le.id):null)}console.log("Placed item at cell:",O)}},[r,k,B,re,L,S,le,C,U,x]),Ve=d.useCallback(M=>{const y=M.clientX,ee=M.clientY;Te(y,ee,M)},[Te]),Ye=d.useCallback(M=>{const y=M.touches[0],ee=y.clientX,O=y.clientY;Te(ee,O,M)},[Te]),Z=d.useCallback(M=>{const y=M.changedTouches[0],ee=y.clientX,O=y.clientY;he({clientX:ee,clientY:O}),document.body.removeEventListener("touchmove",Le)},[he,Le]);return d.useEffect(()=>{if(X)return document.body.addEventListener("touchmove",Le,{passive:!1}),document.addEventListener("mousemove",Ve),document.addEventListener("mouseup",he),document.addEventListener("touchmove",Ye),document.addEventListener("touchend",Z),()=>{document.body.removeEventListener("touchmove",Le),document.removeEventListener("mousemove",Ve),document.removeEventListener("mouseup",he),document.removeEventListener("touchmove",Ye),document.removeEventListener("touchend",Z)}},[X,Ve,he,Ye,Z,Le]),A==0||N==0||!Ge||r==null?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsx("div",{id:r.id,ref:$e,className:`draggable-item ${r.isSectionModifier&&!r.moveable?"placed-modifier":""} ${r.isSectionModifier?r.sectionModifierType?.toString():""} ${X?"dragging":""} ${r.moveable?"":"not-moveable"}`,style:{top:`${N}px`,left:`${A}px`,width:`${r.cellsLong*(r.isDisplayItem&&!X&&!r.hasMoved?10:T)-(r.sectionModifierType=="LeftWall"||r.sectionModifierType=="RightWall"||r.sectionModifierType?.includes("Corner")?1:0)}px`,height:`${r.cellsTall*(r.isDisplayItem&&!X&&!r.hasMoved?10:T)-(r.sectionModifierType=="TopWall"||r.sectionModifierType=="BottomWall"||r.sectionModifierType?.includes("Corner")?1:0)}px`,rotate:`${k*90}deg`,transformOrigin:"center center",fontSize:`${Ae}px`,zIndex:X?1e3:1},children:r.isSectionModifier?null:r.icon.includes("custom-")?e.jsx("div",{className:r.isSectionItem?"custom-section":"custom-icon",children:e.jsx("div",{children:e.jsx("p",{ref:v,children:r.icon.split("custom-")[1]})})}):e.jsx("img",{src:r.icon,alt:"icon"})})})}const el="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE02lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTE2PC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmRiZTM1YTM5LWE0MDUtNDM2MC04YzRjLWI3NmJmMTY3Mjc1YjwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5hZGQtaXRlbSAtIDc8L3JkZjpsaT4KICAgPC9yZGY6QWx0PgogIDwvZGM6dGl0bGU+CiA8L3JkZjpEZXNjcmlwdGlvbj4KCiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogIHhtbG5zOnBkZj0naHR0cDovL25zLmFkb2JlLmNvbS9wZGYvMS4zLyc+CiAgPHBkZjpBdXRob3I+U2FyYWggS2VtbWVOYXNoPC9wZGY6QXV0aG9yPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp4bXA9J2h0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8nPgogIDx4bXA6Q3JlYXRvclRvb2w+Q2FudmEgKFJlbmRlcmVyKSBkb2M9REFHdTJ5dUVOWkEgdXNlcj1VQUZqR1c2eHRDUSBicmFuZD1bQVJDSElWRURdIEZvcnQgV2F5bmUgQ29tbXVuaXR5IFNjaG9vbHMgdGVtcGxhdGU9PC94bXA6Q3JlYXRvclRvb2w+CiA8L3JkZjpEZXNjcmlwdGlvbj4KPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0ncic/PupmVZwAAAT8SURBVHic7d1PaBxVHMDxX41Wh6DsE1FcweGltiAUpE7Vanm9BGzGqvGgJ9e/bRSliHrwkIueiif/gShkVFRGLCbR4p8ulSBMEEul7+rJF6jgXqQTFSEiK15m4yTZze7MvJn3m5nf95p9+xv4MLOZycxmB1Co2mF6A6iNEQiyCARZBIIsAkEWgSCLQJBFIMgiEGQRCLIIBFkEgiwCGVCDi7GJydnjbOLQEQC4AQBUqAJfeu6nec4lkD41uLjcmWl/AQBTm38WquAd6bnP5jV7LK83LmsRxucA4Pb7ucXs2xgX13ek/1Ue8wkk1jCMXhaz9zMurutI/2vd20AgUQ0udkaHqW0xekV7yrUd6X+jczsIBNYxFgDgSJJ1Eco1Hemf1rUttQeJYdybZr3F7NsZF1d3pN/WsT21BmlwcZkz016ElBi9LGbfwbhgOlBqDXLwpZ8WAeB+He9lMfsA4+KqjvTPZHmfWoMwLpoWsw/rej+L2XcyLq7MglJrkI70f2Bc/KkZ5S7GxXhH+t+mWV9rEIB1lD80oxxkXFzsSP9c0rW1BwEA6Ej/LOPid4vZWy6VpM1i9oFQLb+2tnrh3yTrLtG1AZhrcLFz8sRfLze4sAa9RnruG6EKXtQ4lrEJsTfposqDROcZ8wDwijPT/rLBxRWDXis99/VQBc9rHP930gWVvto74KTvzPm5qenVleW1QetuPXb6OTZx6M2M439Zmh2/Memiyu4hsT1j80nf3c5M+9SQPeWtUAUvZJmf9vBXyQ/12J5x34CX7Go6rf2hWp5fW73Q7feC6IP+osXskS42xgtV8LT03I+TrgOoIEiCa1M3NZ2WMwTlHOPiN4vZ94w6P1TBU9Jz55Jsc7xKgaS4ULh7BJQfR0UJVXBUeu57SbZ5c5UByXDVdnfTae3LihKq4EnpuR8knL2lSoBkvYQOAHsilIUUKN1QBY9Jz/0o5ewNlR5EA0avNCjdUAWPSs/1M85er9QgGjF67Wk6rVsilL6XPGIoh0MVPKz7tqDSnhjGzjMG/WqbpVPn56YeWl1Z/mfQC/jk7K6VpRM/6x5cSpAc9ox+DUXJo9KdqReEAQAw7cy0Tza4uDTnORsq1WdIgRi9bm46rb2hWl5Mehk9baU5ZEU3JMyDpr+BJ2xhaXb8wSIGleKQFWF8BmYwIFTBd0XNQr+HxDCmTcwPVXBceu7bRc1DDVI3DADEIHXEAEAKUlcMAIQgdcYAQAZSdwwARCAIMJ6RnvuuidnxUIAQxv8ZByGMjRkFIYytGQMhjP4ZASGMwRUOQhjbVygIAoxMN7EVUWEghDFahYAQxujlDkIYycoVhDCSlxsIYaQrFxDCSJ92EAQYx7I+EmAyrSAIMI5Kz33fxGxdaQMhDD1pASEMfWUGIQy9ZQIhDP2lBiGMfEoFggBDywOWGEsM0uBiLLoL/YEctmdooQoel577oYnZRZT47nc2IfaBOYwnqowBAJDm6SAjjzBUfc/oVYrnQ+qCAVACkDphACAHqRsGAF6QbqiCR+qGAZDuQz3vel9X8YnpDTERtj2k1hgAuEBqjwGAB4QwojCAEEYs0yCEsSmTv2V1QxW08v43dGXLFEg3+vKvk4bmo83EIYswtinNHvIrALyadmCogu+l5+byPwCrkPGHPqmNEQiyCARZBIIsAkEWgSCLQJBFIMgiEGQRCLIIBFkEgqz/ADvdpRk/dmKqAAAAAElFTkSuQmCC";function tl({vendor:r,onDelete:B,onEdit:F,boothMap:L}){return e.jsxs("div",{className:"vendor-display-tile",children:[e.jsxs("div",{className:"vendor-info",children:[e.jsx("h3",{className:"vendor-business-name",children:r.businessName}),e.jsxs("p",{className:"vendor-plot-size",children:[r.plotWidth,"ft x ",r.plotHeight,"ft"]})]}),e.jsxs("div",{className:"vendor-actions",children:[e.jsx("img",{src:Vn,alt:"Share",className:"vendor-link",onClick:async S=>{S.stopPropagation();const E=localStorage.getItem("companyId"),C=window.location.origin+`/LayItOut/Layout/?companyId=${E}&areaId=${L.areaId}&type=pick-booth&boothMapId=${L.id}&boothMapName=${L.name}&vendorId=${r.id}`;await navigator.clipboard.writeText(C),alert("BoothMap link copied to clipboard!")}}),e.jsx("img",{src:el,alt:"Edit",className:"vendor-edit",onClick:S=>{S.stopPropagation(),F(r.id)}}),e.jsx("img",{src:Yn,alt:"Delete",className:"vendor-delete",onClick:S=>{S.stopPropagation(),window.confirm("Are you sure you want to delete this vendor?")&&B(r.id)}})]})]})}function nl({maxHeight:r,vendors:B,onAddVendor:F,boothMap:L,onDeleteVendor:S,onEditVendor:E}){return e.jsxs("div",{className:"vendors-tile",style:{maxHeight:r?`${r}px`:"200px"},children:[e.jsx("h2",{children:"Vendors"}),e.jsx("div",{className:"vendors-divider"}),e.jsxs("div",{className:"vendors-tile-content",children:[B.map(C=>e.jsx(tl,{vendor:C,boothMap:L,onDelete:T=>{S(T)},onEdit:T=>{E(C)}},C.id)),e.jsx("div",{className:"add-vendor",onClick:F,children:e.jsx("img",{src:Ft,alt:"Add vendor"})})]})]})}function ll({dialogRef:r,closeDialog:B,addVendor:F}){const[L,S]=d.useState(""),[E,C]=d.useState(1),[T,G]=d.useState(1),[A,R]=d.useState(!1);return e.jsxs("dialog",{ref:r,className:"add-vendor-dialog",children:[e.jsxs("div",{className:"add-vendor-dialog-div",children:[e.jsx("h2",{children:"Add Vendor"}),e.jsxs("div",{className:"add-vendor-row",children:[e.jsx("label",{htmlFor:"business-name",children:"Business Name:"}),e.jsx("input",{type:"text",id:"business-name",name:"business-name",onChange:N=>S(N.target.value??""),value:L})]}),e.jsxs("div",{className:"add-vendor-row add-vendor-size",children:[e.jsx("label",{htmlFor:"item-width",children:"Booth Size (in feet):"}),e.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:E,onChange:N=>C(parseFloat(N.target.value)??1)}),e.jsx("span",{children:" x "}),e.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:T,onChange:N=>G(parseFloat(N.target.value)??1)})]}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:async()=>{if(L.trim()===""){alert("Business name cannot be empty");return}const N=new Gt({id:L+(Math.random()*1e4).toString(),businessName:L,plotWidth:Math.ceil(E),plotHeight:Math.ceil(T)});R(!0),await F(N),S(""),C(1),G(1),R(!1),B()},children:"Add Vendor"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{B(),S(""),C(1),G(1)},children:"Close"})]}),A&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"loader"})})]})}function ol({dialogRef:r,closeDialog:B,editVendor:F,oldVendor:L}){const[S,E]=d.useState(""),[C,T]=d.useState(1),[G,A]=d.useState(1),[R,N]=d.useState(!1);return d.useEffect(()=>{L&&(E(L.businessName),T(L.plotWidth),A(L.plotHeight))},[L]),e.jsxs("dialog",{ref:r,className:"edit-vendor-dialog",children:[e.jsxs("div",{className:"edit-vendor-dialog-div",children:[e.jsx("h2",{children:"Edit Vendor"}),e.jsxs("div",{className:"edit-vendor-row",children:[e.jsx("label",{htmlFor:"business-name",children:"Business Name:"}),e.jsx("input",{type:"text",id:"business-name",name:"business-name",onChange:W=>E(W.target.value??""),value:S})]}),e.jsxs("div",{className:"edit-vendor-row edit-vendor-size",children:[e.jsx("label",{htmlFor:"item-width",children:"Booth Size (in feet):"}),e.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:C,onChange:W=>T(parseFloat(W.target.value)??1)}),e.jsx("span",{children:" x "}),e.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:G,onChange:W=>A(parseFloat(W.target.value)??1)})]}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:async()=>{if(S.trim()===""){alert("Business name cannot be empty");return}const W=new Gt({id:L.id,businessName:S,plotWidth:Math.ceil(C),plotHeight:Math.ceil(G)});N(!0),await F(W),E(""),T(1),A(1),N(!1),B()},children:"Save Vendor"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{B(),E(L.businessName),T(L.plotWidth),A(L.plotHeight)},children:"Close"})]}),R&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"loader"})})]})}function sl({maxHeight:r}){return e.jsxs("div",{className:"key-tile",children:[e.jsx("h2",{children:"Key"}),e.jsx("div",{className:"key-divider"}),e.jsxs("div",{className:"key-tile-content",children:[e.jsxs("div",{className:"key-item",children:[e.jsx("div",{className:"cell cell-border"}),e.jsx("p",{children:"1ft x 1ft"})]}),e.jsxs("div",{className:"key-item",children:[e.jsx("div",{className:"container",children:e.jsx("div",{className:"wall"})}),e.jsx("p",{children:"Wall"})]}),e.jsxs("div",{className:"key-item",children:[e.jsx("div",{className:"window-container",children:e.jsx("div",{className:"window"})}),e.jsx("p",{children:"Window"})]}),e.jsxs("div",{className:"key-item",children:[e.jsx("div",{className:"container",children:e.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fright_door.png?alt=media&token=8c6f3b4d-5e7a-4b9c-8d2f-0a3b5e6f7c8d",alt:"",className:"door"})}),e.jsx("p",{children:"Door"})]}),e.jsxs("div",{className:"key-item",children:[e.jsx("div",{className:"window-container",children:e.jsx("div",{className:"section-divider"})}),e.jsx("p",{children:"Section Divider"})]})]})]})}function il({dialogRef:r,closeDialog:B,vendors:F,addVendorToBooth:L}){const[S,E]=d.useState(!1),[C,T]=d.useState(null);return e.jsxs("dialog",{ref:r,className:"add-vendor-dialog",children:[e.jsxs("div",{className:"add-vendor-dialog-div",children:[e.jsx("h2",{children:"Select Vendor"}),e.jsxs("div",{className:"add-vendor-row",children:[e.jsx("label",{htmlFor:"boothMap-area",children:"Vendor:"}),e.jsxs("select",{id:"boothMap-area",name:"boothMap-area",onChange:G=>{const A=G.target.value,R=F.find(N=>N.id===A)||null;T(R)},value:C?.id||"",children:[e.jsx("option",{value:"",children:"Select a Vendor"}),F.map(G=>e.jsx("option",{value:G.id,children:G.businessName},G.id))]})]}),e.jsx("button",{className:"action-btn",onClick:()=>{if(!C){alert("Please select a vendor");return}E(!0),L(C)},children:"Select"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("button",{className:"action-btn",onClick:()=>{B(),T(null)},children:"Close"})]}),S&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"loader"})})]})}Nn.createRoot(document.getElementById("root")).render(e.jsx(al,{}));function al(){const[r,B]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[F,L]=d.useState(0),[S,E]=d.useState(0),[C,T]=d.useState(0),[G,A]=d.useState(0),[R,N]=d.useState([]),[W,v]=d.useState([]),[U,I]=d.useState(0),[x,V]=d.useState(null),[X,H]=d.useState([]),k=/Mobi|Android/i.test(navigator.userAgent)?5:10,[ce,le]=d.useState([]),[Re,vt]=d.useState(!1),[fe,Ae]=d.useState(null),[ze,Ne]=d.useState(null),[qe,$e]=d.useState([new w({id:"left-wall",name:"Left Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWall"}),new w({id:"right-wall",name:"Right Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWall"}),new w({id:"top-wall",name:"Top Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWall"}),new w({id:"bottom-wall",name:"Bottom Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWall"}),new w({id:"left-door",name:"Left Door",cellsLong:1,cellsTall:1,icon:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fleft_door.png?alt=media&token=91fde31c-ebc6-4807-9670-f846c8d75cb6",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftDoor"}),new w({id:"right-door",name:"Right Door",cellsLong:1,cellsTall:1,icon:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fright_door.png?alt=media&token=8c6f3b4d-5e7a-4b9c-8d2f-0a3b5e6f7c8d",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightDoor"}),new w({id:"left-window",name:"Left Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWindow"}),new w({id:"right-window",name:"Right Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWindow"}),new w({id:"top-window",name:"Top Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWindow"}),new w({id:"bottom-window",name:"Bottom Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWindow"})]),Ge=d.useRef(null),[bt,Fe]=d.useState(!1),[oe,re]=d.useState([]),[j,ae]=d.useState([]),[ot,Ze]=d.useState([]),[ve,ke]=d.useState([]),[Le,Te]=d.useState(!1),he=d.useRef(null),[Ve,Ye]=d.useState([]),[Z,M]=d.useState([]),[y,ee]=d.useState(null),[O,de]=d.useState(!1),[Y,pe]=d.useState(!1),[Ie,Zt]=d.useState(!1),[Je,Vt]=d.useState(!1),[te,Yt]=d.useState(!1),[$,st]=d.useState("placing-sections"),[cl,Jt]=d.useState(!1),[be,Ut]=d.useState(!1),[Ke,Ht]=d.useState(!1),[Ue,Xt]=d.useState(!1),[Qt,zt]=d.useState(!1),[De,St]=d.useState(!1),[He,Xe]=d.useState(""),[_e,qt]=d.useState(null),[Oe,jt]=d.useState(""),[J,$t]=d.useState(""),[Kt,_t]=d.useState(null),[q,en]=d.useState(""),[it,tn]=d.useState(null),[at,et]=d.useState(""),[Lt,tt]=d.useState(""),[ne,Me]=d.useState(null),[ct,Q]=d.useState(!0),[Tt,nn]=d.useState(null),[rt,ye]=d.useState(!1),[ln,on]=d.useState(null),[sn,At]=d.useState([]),[an,Pe]=d.useState(!1),[Se,cn]=d.useState(null),[dt,rn]=d.useState(!1),[dn,mn]=d.useState(null),[mt,gn]=d.useState(null),gt=d.useRef(null),ut=d.useRef(null),ft=d.useRef(null),ht=d.useRef(null),pt=d.useRef(null),It=d.useRef(null);function we(n,t){for(const o of t)if(n.x>=o.cellId.x&&n.x<o.cellId.x+o.cellsLong&&n.y>=o.cellId.y&&n.y<o.cellId.y+o.cellsTall)return o;return null}function un(n,t,o,a){re([...n.map(l=>new P({name:l.name,cellId:new h({x:l.cellId.x,y:l.cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,modifierItems:l.modifierItems.map(s=>new z({cell:new h({x:s.cell.x,y:s.cell.y}),item:new w({...s.item,starterItem:!0})})),startingItems:[]}))]);let i=F,c=S;if(r){for(const u of n)console.log("Generating cells for section",u.name,"at",u.cellId,"with size",u.cellsLong,"x",u.cellsTall),console.log("Needed section Width:",(u.cellsLong+u.cellId.x)*k,"Current width:",i),(u.cellsLong+u.cellId.x)*k>i&&(console.log("Added section Width:",u.cellsLong*k+u.cellId.x),i+=(u.cellsLong+u.cellId.x)*k-i),console.log("Needed section Height:",(u.cellsTall+u.cellId.y)*k,"Current height:",c),(u.cellsTall+u.cellId.y)*k>c&&(console.log("Added section Height:",u.cellsTall*k+u.cellId.y),c+=(u.cellsTall+u.cellId.y)*k-c);A(c/k*2),T(i/k*2);let l=0;const s=[],g=[];for(const u of n){const f=[],b={width:u.cellsLong*k,height:u.cellsTall*k,sectionName:u.name};b.height>l&&(l=b.height),Ye(D=>[...D,b]),u.cellId.x=0,u.cellId.y=0,[...Array(b.height/k).keys()].map(D=>{const me=[];[...Array(b.width/k).keys()].map(se=>{me.push({id:new h({x:se,y:D}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:k})}),f.push(me)}),s.push({sectionName:u.name,cells:[...f]}),g.push(u)}M(s),ae(g),I(l),ee(n[0]?n[0].name:null),setTimeout(()=>{Q(!1)},500)}else{const l=[];for(const s of n)console.log("Generating cells for section",s.name,"at",s.cellId,"with size",s.cellsLong,"x",s.cellsTall),console.log("Needed section Width:",s.cellsLong+s.cellId.x,"Current width:",i),s.cellsLong+s.cellId.x>i&&(console.log("Added section Width:",s.cellsLong+s.cellId.x),i+=s.cellsLong+s.cellId.x-i),console.log("Needed section Height:",s.cellsTall+s.cellId.y,"Current height:",c),s.cellsTall+s.cellId.y>c&&(console.log("Added section Height:",s.cellsTall+s.cellId.y),c+=s.cellsTall+s.cellId.y-c);L(t.width),E(t.height),T(t.width),A(t.height),console.log("Final width:",i,"Final height:",c),[...Array(t.height).keys()].map(s=>{const g=[];[...Array(t.width).keys()].map(u=>{console.log("Creating cell at",u,s,"with size",k,o),g.push({id:new h({x:u,y:s}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:o&&a=="placing-sections"?!0:we(new h({x:u,y:s}),n)!=null,size:k})}),l.push(g)}),N([...l]),setTimeout(()=>{const s=[],g=[...n],u=[];for(const f of g)f.cellElement=document.querySelector(`.App #${f.cellId.toId()}.cell:not(.cell-border)`),s.push(...f.startingItems.map(b=>new z({cell:new h({x:f.cellId.x+b.cell.x,y:f.cellId.y+b.cell.y}),item:new w({...b.item,initialElement:document.querySelector(`.App #${b.cell.toId()}.cell:not(.cell-border)`),starterItem:!0})}))),s.push(...f.modifierItems.map(b=>new z({cell:new h({x:f.cellId.x+b.cell.x,y:f.cellId.y+b.cell.y}),item:new w({...b.item,initialElement:document.querySelector(`.App #${b.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1})}))),u.push(...f.booths.map(b=>new je({...b,cell:new h({x:f.cellId.x+b.cell.x,y:f.cellId.y+b.cell.y}),initialElement:document.querySelector(`.App #${b.cell.toId()}.cell:not(.cell-border)`)})));ae([...g]);for(const f of s){const b=se=>{const ge=se%2===1;return{cellsLong:ge?f.item.cellsTall:f.item.cellsLong,cellsTall:ge?f.item.cellsLong:f.item.cellsTall}},D=f.item.rotation||0,me=b(D);for(let se=0;se<me.cellsTall;se++)for(let ge=0;ge<me.cellsLong;ge++)l[f.cell.y+se][f.cell.x+ge].hasItem=!0,l[f.cell.y+se][f.cell.x+ge].itemId=f.item.id;f.item.initialElement=document.querySelector(`.App #${f.cell.toId()}.cell:not(.cell-border)`),v(se=>[...se,f.item])}for(const f of u){for(let b=0;b<f.cellsTall;b++)for(let D=0;D<f.cellsLong;D++)l[f.cell.y+b][f.cell.x+D].hasItem=!0,l[f.cell.y+b][f.cell.x+D].itemId=f.id;f.initialElement=document.querySelector(`.App #${f.cell.toId()}.cell:not(.cell-border)`),Ze(b=>[...b,f])}N([...l]),setTimeout(()=>{Q(!1)},500)},100)}}async function fn(){const n=new URLSearchParams(window.location.search),t=n.get("companyId"),o=n.get("areaId"),a=n.get("areaId")||"",i=n.get("companyId")||"",c=n.get("templateId")||"",l=await On(i,a);if(l===null){window.location.href="/LayItOut/DNF/";return}tn(l),on(l.previewImage||null);const s=n.get("type")||"";let g=!1,u=!1,f="modify-sections",b=!1,D=null;if(s==="public-preview"){St(!0);const m=n.get("designName")||"";Xe(m);const p=n.get("designId")||"";et(p)}else if(s==="create-template")de(!0);else if(s==="edit-template"){pe(!0);const m=l.templates.find(p=>p.id===c);m&&(nn(m),jt(m.name))}else if(s==="view-design"){g=!0,Zt(!0);const m=n.get("designName")||"";Xe(m);const p=n.get("designId")||"";et(p)}else if(s==="view-area")Vt(!0);else if(s==="edit-design"){g=!0,Jt(!0);const m=n.get("designName")||"";Xe(m);const p=n.get("designId")||"";et(p)}else if(s==="client-edit-design"){g=!0,zt(!0);const m=n.get("designName")||"";Xe(m);const p=n.get("designId")||"";et(p)}else if(s==="create-area"){u=!0,Yt(!0);const m=n.get("stage");m==="placing-sections"?(f="placing-sections",st("placing-sections")):m==="modify-sections"?(st("modify-sections"),f="modify-sections",le(qe.map(p=>new ue({item:new w({...p,displayItem:!0}),quantity:-1})))):m==="placing-items"&&(st("placing-items"),f="placing-items",le(l.inventoryItems.map(p=>new ue({item:new w({...p.item,displayItem:!0}),quantity:p.quantity}))))}else if(s==="view-boothMap"){b=!0,Ut(!0);const m=n.get("boothMapId")||"";tt(m);const p=await nt(i,a,m);if(p===null){window.location.href="/LayItOut/DNF/";return}Me(p),D=p}else if(s==="pick-booth"){b=!0,Xt(!0);const m=n.get("boothMapId")||"";tt(m);const p=await nt(i,a,m);if(p===null){window.location.href="/LayItOut/DNF/";return}Me(p),D=p;const ie=n.get("vendorId")||"";if(ie!==""){const _=p.vendors.find(K=>K.id===ie);if(_){cn(_),console.log("Vendor found",_);let K=!1;D.sections.forEach(Tn=>{Tn.booths.forEach(An=>{An.user?.id===_.id&&(K=!0)})}),rn(K);const Ot=await Pn(i);if(Ot===null){window.location.href="/LayItOut/DNF/";return}_t(Ot)}else{window.location.href="/LayItOut/DNF/";return}}}else if(s==="create-boothMap"){b=!0,Ht(!0);const m=n.get("boothMapId")||"";tt(m);const p=await nt(i,a,m);if(p===null){window.location.href="/LayItOut/DNF/";return}Me(p),D=p}else if(s==="public-preview-boothMap"){b=!0,St(!0);const m=n.get("boothMapId")||"";tt(m);const p=n.get("designName")||"";Xe(p);const ie=await nt(i,a,m);if(ie===null){window.location.href="/LayItOut/DNF/";return}Me(ie),D=ie}t&&$t(t),o&&en(o),u||le(l.inventoryItems.map(m=>new ue({item:new w({...m.item,displayItem:!0}),quantity:m.quantity})));const me=[],se=[];for(const m of l.templates){const p=[],ie=[];for(const _ of m.sections)p.push(new P({name:_.name,cellId:new h({x:_.cellId.x,y:_.cellId.y}),cellsLong:_.cellsLong,cellsTall:_.cellsTall,modifierItems:_.modifierItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new w({...K.item,starterItem:!0})})),startingItems:_.startingItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new w({...K.item,starterItem:!0})}))})),ie.push(new P({name:_.name,cellId:new h({x:_.cellId.x,y:_.cellId.y}),cellsLong:_.cellsLong,cellsTall:_.cellsTall,modifierItems:_.modifierItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new w({...K.item,starterItem:!0})})),startingItems:_.startingItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new w({...K.item,starterItem:!0})}))}));me.push(new xe({name:m.name,sections:p,inventoryItems:m.inventoryItems,id:m.id,previewImage:m.previewImage})),se.push(new xe({name:m.name,sections:ie,id:m.id,previewImage:m.previewImage,inventoryItems:m.inventoryItems}))}ke([...me]);const ge=[],We=c===""?void 0:se.find(m=>m.id===c);if(console.log("TEMPLATE",We,"AREA",l),b&&D)le(D.inventoryItems.map(m=>new ue({item:new w({...m.item,displayItem:!0}),quantity:m.quantity}))),re([...D.sections]),ae([...D.sections.map(m=>new P({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,booths:m.booths,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new w({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))]),ge.push(...D.sections.map(m=>new P({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,booths:m.booths,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new w({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))})));else if(g){const m=await Bn(i,a,n.get("designId")||"");if(m===null){window.location.href="/LayItOut/DNF/";return}qt(m),le(m.inventoryItems.map(p=>new ue({item:new w({...p.item,displayItem:!0}),quantity:p.quantity}))),re([...m.sections]),ae([...m.sections.map(p=>new P({name:p.name,cellId:new h({x:p.cellId.x,y:p.cellId.y}),cellsLong:p.cellsLong,cellsTall:p.cellsTall,startingItems:p.startingItems,modifierItems:p.modifierItems,items:p.startingItems.map(ie=>new w({...ie.item,sectionCell:new h({x:ie.cell.x,y:ie.cell.y})}))}))]),ge.push(...m.sections.map(p=>new P({name:p.name,cellId:new h({x:p.cellId.x,y:p.cellId.y}),cellsLong:p.cellsLong,cellsTall:p.cellsTall,startingItems:p.startingItems,modifierItems:p.modifierItems,items:p.startingItems.map(ie=>new w({...ie.item,sectionCell:new h({x:ie.cell.x,y:ie.cell.y})}))})))}else We!==void 0?(le(We.inventoryItems.map(m=>new ue({item:new w({...m.item,displayItem:!0}),quantity:m.quantity}))),re([...We.sections]),ae([...We.sections.map(m=>new P({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new w({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))]),ge.push(...We.sections.map(m=>new P({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,modifierItems:m.modifierItems,startingItems:m.startingItems,items:m.startingItems.map(p=>new w({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))})))):(re([...l.sections]),ae([...l.sections.map(m=>new P({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,modifierItems:m.modifierItems,startingItems:m.startingItems,items:m.startingItems.map(p=>new w({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))]),ge.push(...l.sections.map(m=>new P({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new w({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))));console.log("SECTIONS TO GENERATE",ge),un(ge,l,s==="create-area",f)}d.useEffect(()=>{fn()},[]);function hn(n,t,o){if(!r||n==null)return;const a=[...o],i=[],c=[],l=o.find(s=>s.name==n);console.log("NEW SECTION",l),console.log("Adding section",l.name,l.cellId),console.log("MOBILE CELLS",t),l.cellElement=document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${l.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",l.cellElement);for(const s of l.startingItems){console.log("Placing starting item",s.item.name,s.cell);const g=b=>{const D=b%2===1;return{cellsLong:D?s.item.cellsTall:s.item.cellsLong,cellsTall:D?s.item.cellsLong:s.item.cellsTall}},u=s.item.rotation||0,f=g(u);for(let b=0;b<f.cellsTall;b++)for(let D=0;D<f.cellsLong;D++){const me=t.find(se=>se.sectionName===l.name);me.cells[s.cell.y+b][s.cell.x+D].hasItem=!0,me.cells[s.cell.y+b][s.cell.x+D].itemId=s.item.id}s.item.initialElement=document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${s.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",s.item.initialElement),i.push(new w({...s.item}))}for(const s of l.modifierItems){console.log("Placing starting item",s.item.name,s.cell);const g=b=>{const D=b%2===1;return{cellsLong:D?s.item.cellsTall:s.item.cellsLong,cellsTall:D?s.item.cellsLong:s.item.cellsTall}},u=s.item.rotation||0,f=g(u);for(let b=0;b<f.cellsTall;b++)for(let D=0;D<f.cellsLong;D++){const me=t.find(se=>se.sectionName===l.name);me.cells[s.cell.y+b][s.cell.x+D].hasItem=!0,me.cells[s.cell.y+b][s.cell.x+D].itemId=s.item.id}console.log("Adding item to items",document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${s.cell.toId()}.cell:not(.cell-border)`)),i.push(new w({...s.item,initialElement:document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${s.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1}))}console.log("Setting sections",a),ae([...a]),console.log("ITEMS",i),v(s=>[...s.filter(u=>!i.some(f=>f.id===u.id)),...i.map(u=>new w({...u,starterItem:!0}))]),c.push(...l.booths.map(s=>new je({...s,initialElement:document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${s.cell.toId()}.cell:not(.cell-border)`)})));for(const s of c){for(let g=0;g<s.cellsTall;g++)for(let u=0;u<s.cellsLong;u++){const f=t.find(b=>b.sectionName===l.name);f.cells[s.cell.y+g][s.cell.x+u].hasItem=!0,f.cells[s.cell.y+g][s.cell.x+u].itemId=s.id}Ze(g=>[...g,s])}}function Nt(n){let t=[];return n.map(o=>t=[...t,...o]),t}function pn(n,t){let o=!1;return t.sections.forEach(a=>{a.booths.forEach(i=>{i.user?.id===n.id&&(o=!0)})}),o}function yt(n,t){console.log(n);const o=r?Z.find(l=>l.sectionName===y).cells:R,a=o[n.y].length,i=o.length;if(console.log(a,i),n.x+t.cellsLong>a||n.y+t.cellsTall>i)return!1;const c=we(n,j);if(!c&&!r&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<t.cellsTall;l++)for(let s=0;s<t.cellsLong;s++){if(!r){const g=we(new h({x:n.x+s,y:n.y+l}),j);if(!g&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;if(g?.name!=c?.name&&($!=="placing-sections"||!te))return console.log("Item is crossing section boundaries"),!1}if(o[n.y+l][n.x+s].hasItem&&o[n.y+l][n.x+s].itemId!=t.id){console.log("Something is already here");const g=W.find(u=>u.id==o[n.y+l][n.x+s].itemId);if(g&&g.isSectionModifier){if(g.sectionModifierType==="LeftDoor"||g.sectionModifierType==="RightDoor")return console.log("Item is on door of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),!1;if(g.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),s==t.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),s==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),l==t.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),l==0&&s==t.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),l==0&&s==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),l==t.cellsTall-1&&s==t.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",l,s,t.cellsTall,t.cellsLong),l==t.cellsTall-1&&s==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function Mt(n,t,o){console.log(t),console.log("CELLS",n);const a=n[t.y].length,i=n.length;if(console.log(a,i),t.x+o.cellsLong>a||t.y+o.cellsTall>i)return!1;const c=we(t,j);if(!c&&!r&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<o.cellsTall;l++)for(let s=0;s<o.cellsLong;s++){if(!r){const g=we(new h({x:t.x+s,y:t.y+l}),j);if(!g&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;if(g?.name!=c?.name&&($!=="placing-sections"||!te))return console.log("Item is crossing section boundaries"),!1}if(n[t.y+l][t.x+s].hasItem&&n[t.y+l][t.x+s].itemId!=o.id){console.log("Something is already here");const g=W.find(u=>u.id==n[t.y+l][t.x+s].itemId);if(g&&g.isSectionModifier){if(g.sectionModifierType==="LeftDoor"||g.sectionModifierType==="RightDoor")return console.log("Item is on door of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),!1;if(g.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),s==o.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),s==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),l==o.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),l==0&&s==o.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),l==0&&s==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),l==o.cellsTall-1&&s==o.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",l,s,o.cellsTall,o.cellsLong),l==o.cellsTall-1&&s==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function Ct(n,t,o){const a=Array.from(r?Z.find(c=>c.sectionName===y).cells:R);if(Pe(!0),o!=null){console.log("Removing item",t.id,"from cell",o.toId());const c=r?j.find(l=>l.name===y):we(o,j);c.items=c.items.filter(l=>l.id!=t.id);for(let l=0;l<t.cellsTall;l++)for(let s=0;s<t.cellsLong;s++)a[o.y+l][o.x+s].hasItem=!1,a[o.y+l][o.x+s].itemId=""}if($!=="placing-sections"||!te){const c=r?j.find(s=>s.name===y):we(n,j),l=new h({x:n.x-c.cellId.x,y:n.y-c.cellId.y});t.sectionCell=l,console.log("Adding item to section",c.name,"at",l,t),c.items.push(t)}else t.sectionCell=new h({x:n.x,y:n.y});for(let c=0;c<t.cellsTall;c++)for(let l=0;l<t.cellsLong;l++)a[n.y+c][n.x+l].hasItem=!0,a[n.y+c][n.x+l].itemId=t.id;if(console.log(a),r){const c=Z.find(l=>l.sectionName===y);c&&(c.cells=a.map(l=>l.map(s=>({...s}))),M([...Z]))}else N(a);console.log("Removing item from inventory",t.name,t.hasMoved);let i=!1;if(!t.hasMoved){console.log("INVENTORY ITEMs",ce);const c=ce.findIndex(l=>l.item.name==t.name&&!l.item.hasMoved);if(c!==-1){const l=[...ce];console.log("Found item in inventory",l[c]),l[c].quantity>0&&(l[c].quantity-=1,l[c].quantity<=0&&(i=!0,l.splice(c,1)),le(l))}else le(ce)}if(v(c=>(console.log("Placing item",t),console.log("Updating item",t.id),Re&&fe&&t.id==fe.id?(console.log("Updating placing item",t.id),t.hasMoved=!0,t.starterItem=!0,t.isDisplayItem=!1,t.initialElement=document.querySelector(`.App #${n.toId()}.cell:not(.cell-border)`),[...c,new w({...t,hasMoved:!0,id:t.name+Math.floor(Math.random()*1e5).toString()})]):(c.find(l=>l.id==t.id).hasMoved||(c.find(l=>l.id==t.id).hasMoved=!0,c.find(l=>l.id==t.id).sectionCell=t.sectionCell),c))),Re&&fe&&i){Ae(null);return}}function In(n){W.find(t=>t.name==n.name&&!t.hasMoved&&!t.starterItem)||v(t=>[...t,n])}d.useEffect(()=>{fe?(console.log("Adding placing item",fe.id),Ne(fe.id)):(console.log("Removing placing item",ze),Ne(""))},[fe]);function Et(n){console.log("Removing item",n.id),v(t=>t.filter(o=>o.id!=n.id))}function yn(n,t){const o=Array.from(r?Z.find(l=>l.sectionName===y).cells:R);Pe(!0);const a=l=>{const s=l%2===1;return{cellsWide:s?n.cellsTall:n.cellsLong,cellsTall:s?n.cellsLong:n.cellsTall}},i=n.rotation||0,c=a(i);for(let l=0;l<c.cellsTall;l++)for(let s=0;s<c.cellsWide;s++)o[t.y+l][t.x+s].hasItem=!1,o[t.y+l][t.x+s].itemId="";if(r){const l=Z.find(s=>s.sectionName===y);l&&(l.cells=o.map(s=>s.map(g=>({...g}))),M([...Z])),M(s=>s.map(g=>g.sectionName===y?{...g,cells:o}:g))}else N(o);if($!=="placing-sections"||!te){const l=r?j.find(s=>s.name===y):we(t,j);l.items=l.items.filter(s=>s.id!=n.id),console.log("DELETING ITEM",n.id)}v(l=>(console.log(),l.filter(s=>s.id!=n.id))),le(l=>{const s=l.findIndex(g=>g.item.name==n.name&&!g.item.hasMoved);if(s!==-1){const g=[...l];return g[s].quantity>0&&(g[s].quantity+=1),g}else return[...l,new ue({item:new w({...n,hasMoved:!1}),quantity:1})]})}function wn(n,t){const o=Array.from(r?Z.find(g=>g.sectionName===y).cells:R);console.log("DELETING ITEM ROTATE",n.id,n.rotation),Pe(!0);const a=g=>{const u=g%2===1;return{cellsWide:u?n.cellsTall:n.cellsLong,cellsTall:u?n.cellsLong:n.cellsTall}},i=n.rotation||0,c=a(i);for(let g=0;g<c.cellsTall;g++)for(let u=0;u<c.cellsWide;u++)console.log("Deleting cell",t.y+g,t.x+u),o[t.y+g][t.x+u].hasItem=!1,o[t.y+g][t.x+u].itemId="";if(r){const g=Z.find(u=>u.sectionName===y);g&&(g.cells=o.map(u=>u.map(f=>({...f}))),M([...Z])),M(u=>u.map(f=>f.sectionName===y?{...f,cells:o}:f))}else N(o);console.log("DELETING ITEM",n.id);const l=r?j.find(g=>g.name===y):we(t,j);l.items=l.items.filter(g=>g.id!=n.id);const s=new h({x:t.x-l.cellId.x,y:t.y-l.cellId.y});n.sectionCell=s,l.items.push(n)}function Rt(n,t){const o=r?Z.find(c=>c.sectionName===y).cells:R,a=Array.from(o);if(o[n.y]==null){console.log("Start cell is out of bounds",n),wt();return}const i=yt(n,t);a.forEach(c=>c.forEach(l=>{l.mouseOver=!1,l.canPlaceItem=!1,l.mouseOverLocation=""}));for(let c=0;c<t.cellsTall;c++)for(let l=0;l<t.cellsLong;l++)n.y+c<a.length&&n.x+l<a[n.y+c].length&&(t.cellsLong===1&&t.cellsTall===1?a[n.y+c][n.x+l].mouseOverLocation="single":t.cellsTall===1?l===0?a[n.y+c][n.x+l].mouseOverLocation="leftFull":l===t.cellsLong-1?a[n.y+c][n.x+l].mouseOverLocation="rightFull":a[n.y+c][n.x+l].mouseOverLocation="middleFull":t.cellsLong===1?c===0?a[n.y+c][n.x+l].mouseOverLocation="topFull":c===t.cellsTall-1?a[n.y+c][n.x+l].mouseOverLocation="bottomFull":a[n.y+c][n.x+l].mouseOverLocation="middleVFull":c===0&&l===0?a[n.y+c][n.x+l].mouseOverLocation="topLeftCorner":c===0&&l===t.cellsLong-1?a[n.y+c][n.x+l].mouseOverLocation="topRightCorner":c===t.cellsTall-1&&l===0?a[n.y+c][n.x+l].mouseOverLocation="bottomLeftCorner":c===t.cellsTall-1&&l===t.cellsLong-1?a[n.y+c][n.x+l].mouseOverLocation="bottomRightCorner":c===0?a[n.y+c][n.x+l].mouseOverLocation="top":c===t.cellsTall-1?a[n.y+c][n.x+l].mouseOverLocation="bottom":l===0?a[n.y+c][n.x+l].mouseOverLocation="left":l===t.cellsLong-1?a[n.y+c][n.x+l].mouseOverLocation="right":a[n.y+c][n.x+l].mouseOverLocation="middle",a[n.y+c][n.x+l].mouseOver=!0,a[n.y+c][n.x+l].canPlaceItem=i);if(r){const c=Z.find(l=>l.sectionName===y);c&&(c.cells=a.map(l=>l.map(s=>({...s}))),M([...Z])),M(l=>l.map(s=>s.sectionName===y?{...s,cells:a}:s))}else N(a)}function wt(){console.log("Unhighlighting cells");const n=Array.from(r?Z.find(t=>t.sectionName===y).cells:R);if(n.forEach(t=>t.forEach(o=>{o.mouseOver=!1,o.canPlaceItem=!1,o.mouseOverLocation=""})),r){const t=Z.find(o=>o.sectionName===y);t&&(t.cells=n.map(o=>o.map(a=>({...a}))),M([...Z])),M(o=>o.map(a=>a.sectionName===y?{...a,cells:n}:a))}else N(n)}d.useEffect(()=>{hn(y,Z,j)},[y]),d.useEffect(()=>{const n=()=>{const t=W.find(o=>o.id===x);console.log("Unselecting item",x),V(null),t&&(H(o=>[...o,t.id]),console.log("Unselecting item",t.id),setTimeout(()=>{H(o=>o.filter(a=>a!==t.id))},300))};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[x,W]);function kt(n){V(null),H(t=>[...t,n]),console.log("Unselecting item",n),setTimeout(()=>{H(t=>t.filter(o=>o!==n))},300)}function Dt(n){const t=W.find(o=>o.id===x);console.log("Unselecting item",x),V(n),t&&(H(o=>[...o,t.id]),console.log("Unselecting item",t.id),setTimeout(()=>{H(o=>o.filter(a=>a!==t.id))},300))}function xt(n){le(t=>[...t,n])}const Be=n=>{console.log("Preventing scroll"),n.preventDefault(),n.stopPropagation(),window.scrollTo(0,0)};d.useEffect(()=>(rt?(window.addEventListener("scroll",Be),window.addEventListener("touchmove",Be,{passive:!1})):(window.removeEventListener("scroll",Be),window.removeEventListener("touchmove",Be)),()=>{window.removeEventListener("scroll",Be),window.removeEventListener("touchmove",Be)}),[rt]);async function xn(n){const t=[];Q(!0);for(const i of n){const c=i.name,l=new h({x:i.sectionCell.x,y:i.sectionCell.y}),s=new P({name:c,cellId:l,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:[],startingItems:[],items:[]});t.push(s)}let o=0,a=0;for(const i of t)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",i.cellsLong+i.cellId.x,"Current width:",o),i.cellsLong+i.cellId.x>o&&(console.log("Added section Width:",i.cellsLong+i.cellId.x),o+=i.cellsLong+i.cellId.x-o),console.log("Needed section Height:",i.cellsTall+i.cellId.y,"Current height:",a),i.cellsTall+i.cellId.y>a&&(console.log("Added section Height:",i.cellsTall+i.cellId.y),a+=i.cellsTall+i.cellId.y-a);await Wn(J,q,t,o,a),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=create-area&stage=modify-sections`}async function vn(n,t){const o=[];Q(!0);for(const a of t){const i=a.name,c=new h({x:a.cellId.x,y:a.cellId.y});console.log("Saving section modifier items for section",i,a.items.map(s=>s.name),"at cell",c);const l=new P({name:i,cellId:c,cellsLong:a.cellsLong,cellsTall:a.cellsTall,startingItems:[],items:[],modifierItems:a.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new w({...s,isSectionModifier:!0})}))});o.push(l)}console.log("Saving section modifier items",o),await Gn(J,q,o),console.log("Section modifier items saved successfully"),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=create-area&stage=placing-items`}async function bn(n,t){Q(!0);const o=[];for(const a of n){const i=a.name,c=new h({x:a.cellId.x,y:a.cellId.y}),l=new P({name:i,cellId:c,cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new w({...s,starterItem:!0})})),items:[]});o.push(l)}console.log("Saving area sections",o),localStorage.setItem("screenshotSections",o.map(a=>JSON.stringify(a.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",o.map(a=>JSON.stringify(a.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async a=>{if(console.log("Storage event",a),a.key==="screenshot"){const i=new Fn({id:q,name:it.name,sections:o,templates:[],previewImage:a.newValue,width:it.width,height:it.height,inventoryItems:t.map(c=>new ue({item:new w({...c.item,starterItem:!0}),quantity:c.quantity}))});await Zn(J,i),console.log("Area saved successfully"),Q(!1),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=view-area`}})}function Sn(n){const t=Array.from(r?Z.find(o=>o.sectionName===y).cells:R);if(t[n.y]!=null)if(t[n.y][n.x].mouseOver=!0,t[n.y][n.x].canPlaceItem=!0,t[n.y][n.x].mouseOverLocation="single",At(o=>[...o,n]),r){const o=Z.find(a=>a.sectionName===y);o&&(o.cells=t.map(a=>a.map(i=>({...i}))),M([...Z])),M(a=>a.map(i=>i.sectionName===y?{...i,cells:t}:i))}else console.log("Adding highlighted cell",n.toId()),N(t)}function jn(n){const t=Array.from(r?Z.find(l=>l.sectionName===y).cells:R);Pe(!0);const o=[];sn.forEach(l=>{o.some(s=>s.toId()===l.toId())||o.push(l)}),At([]);const a=[],i=ce.findIndex(l=>l.item.name==n.name&&!l.item.hasMoved);let c=i!==-1?ce[i].quantity:0;o.forEach(l=>{const s=new w({...n});if(s.id=s.name+Math.floor(Math.random()*1e5).toString(),console.log("Placing item",s.name,"at",l.toId(),"CAN PLACE?",Mt(t,l,s)),Mt(t,l,s)&&c!=0){if(i!==-1&&(c-=1),$!=="placing-sections"||!te){const u=r?j.find(b=>b.name===y):we(l,j);console.log("Adding item to section",u.name,"at",u.cellId,"with cell",l.toId(),l.x-u.cellId.x,l.y-u.cellId.y);const f=new h({x:l.x-u.cellId.x,y:l.y-u.cellId.y});s.sectionCell=f,console.log("Adding item to section",u.name,"at",f,s),u.items.push(s),console.log("SECTION ITEMS",u.items.map(b=>b.name))}else s.sectionCell=new h({x:l.x,y:l.y});for(let u=0;u<n.cellsTall;u++)for(let f=0;f<n.cellsLong;f++)t[l.y+u][l.x+f].hasItem=!0,t[l.y+u][l.x+f].itemId=s.id;s.hasMoved=!0,s.starterItem=!0,s.isDisplayItem=!1,s.initialElement=document.querySelector(`.App #${l.toId()}.cell:not(.cell-border)`);const g=new w({...s});a.push(g)}});for(const l of a)console.log("Adding item to items",l.id),v(s=>[...s,l]);if(i!==-1&&le(l=>{const s=[...l];return s[i].quantity>0&&(s[i].quantity=c,s[i].quantity==0&&s.splice(i,1)),s}),c==0&&Ae(null),r){const l=Z.find(s=>s.sectionName===y);l&&(l.cells=t.map(s=>s.map(g=>({...g}))),M([...Z])),M(s=>s.map(g=>g.sectionName===y?{...g,cells:t}:g))}else N(t);ae(j)}function Ln(n,t,o){Q(!0);const a=[];for(const i of n){const c=i.name,l=new h({x:i.cellId.x,y:i.cellId.y}),s=i.items.filter(f=>f.isBooth),g=i.items.filter(f=>!f.isBooth),u=new P({name:c,cellId:l,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:g.map(f=>new z({cell:new h({x:f.sectionCell.x,y:f.sectionCell.y}),item:new w({...f,displayItem:!0})})),booths:s.map(f=>new je({id:f.name+Math.floor(Math.random()*1e5).toString(),name:f.name,cell:new h({x:f.sectionCell.x,y:f.sectionCell.y}),cellsLong:f.cellsLong,cellsTall:f.cellsTall,user:f.boothUser})),items:[]});a.push(u)}console.log("Saving area sections",a),localStorage.setItem("screenshotSections",a.map(i=>JSON.stringify(i.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",a.map(i=>JSON.stringify(i.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async i=>{if(console.log("Storage event",i),i.key==="screenshot"){const c=new Ce({id:o.id,name:o.name,sections:a,areaId:q,previewImage:i.newValue,inventoryItems:t.map(l=>new ue({item:new w({...l.item,starterItem:!0}),quantity:l.quantity}))});await Ee(J,c),console.log("Booth Map saved successfully"),Q(!1),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=view-boothMap&boothMapId=${Lt}`}})}return console.log("RENDERING APP",!(te&&$!="placing-items")),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"App",children:[e.jsx("h1",{className:"title",children:"LayItOut"}),e.jsx("br",{}),Ue&&e.jsxs("div",{className:"area-creation",children:[dt?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"area-creation-title",children:"You have already picked a booth"}),e.jsxs("label",{htmlFor:"",children:["Contact ",Kt?.supportEmail," to change booths"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"area-creation-title",children:"Picking Booth"}),e.jsx("label",{htmlFor:"",children:"Tap on an open booth then click on the checkmark to pick a booth"})," "]}),e.jsxs("label",{htmlFor:"",children:["Booth Size: ",Se?.plotWidth,"ft x ",Se?.plotHeight,"ft"]}),e.jsx("br",{})]}),Ke&&e.jsxs("div",{className:"area-creation",children:[e.jsx("h2",{className:"area-creation-title",children:"Create Booth Map"}),e.jsx("label",{htmlFor:"",children:"Create a booth map by placing items and then creating and placing booths, same way you create and place items"})]}),te&&e.jsxs("div",{className:"area-creation",children:[e.jsx("h2",{className:"area-creation-title",children:"Create Area"}),e.jsx("label",{htmlFor:"",children:$=="placing-sections"?"Create new sections and place them":$=="modify-sections"?"Add walls and doors to sections":"Add items to the inventory and place items"})]}),(O||Y)&&e.jsxs("div",{className:"template-name-row",children:[e.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),e.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:n=>jt(n.target.value),value:Oe})]}),(Ie||De)&&e.jsx("div",{className:"design-name-row",children:e.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",He]})}),(O||Y)&&e.jsxs("div",{className:"template-creation",children:[e.jsxs("button",{className:"action-btn",onClick:()=>{if(Oe.trim()==""){alert("Please enter a template name");return}if(ve.some(n=>n.name===Oe&&(Y?n.id!==Tt.id:!0))){alert("Template with this name already exists");return}Y?(Q(!0),setTimeout(async()=>{const n=j.map(t=>new P({name:t.name,cellId:new h({x:oe.find(o=>o.name==t.name).cellId.x,y:oe.find(o=>o.name==t.name).cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,modifierItems:t.modifierItems,startingItems:t.items.map(o=>new z({cell:new h({x:o.sectionCell.x,y:o.sectionCell.y}),item:new w({...o,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async t=>{if(console.log("Storage event",t),t.key==="screenshot"){ye(!1);const o=ve.map(a=>a.id===Tt.id?(console.log("SECTION",j),new xe({name:Oe,inventoryItems:ce,previewImage:t.newValue,sections:j.map(i=>new P({name:i.name,cellId:new h({x:a.sections.find(c=>c.name==i.name).cellId.x,y:a.sections.find(c=>c.name==i.name).cellId.y}),cellsLong:i.cellsLong,modifierItems:i.modifierItems,cellsTall:i.cellsTall,startingItems:i.items.map(c=>new z({cell:new h({x:c.sectionCell.x,y:c.sectionCell.y}),item:new w({...c,starterItem:!0})}))})),id:a.id})):new xe({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(i=>new P({name:i.name,cellId:new h({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(c=>new z({cell:new h({x:c.cell.x,y:c.cell.y}),item:new w({...c.item})}))})),id:a.id}));Qe(J,q,o).then(()=>{console.log("Template updated successfully"),Q(!1);const a=new URLSearchParams(window.location.search),i=a.get("companyId"),c=a.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${i}&areaId=${c}&type=view-area`})}})},500)):(Q(!0),setTimeout(async()=>{const n=j.map(t=>new P({name:t.name,cellId:new h({x:oe.find(o=>o.name==t.name).cellId.x,y:oe.find(o=>o.name==t.name).cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,modifierItems:t.modifierItems,startingItems:t.items.map(o=>new z({cell:new h({x:o.sectionCell.x,y:o.sectionCell.y}),item:new w({...o,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async t=>{if(console.log("Storage event",t),t.key==="screenshot"){ye(!1);const o=new xe({name:Oe,previewImage:t.newValue,inventoryItems:ce,sections:j.map(i=>new P({name:i.name,cellId:new h({x:oe.find(c=>c.name==i.name).cellId.x,y:oe.find(c=>c.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.items.map(c=>new z({cell:new h({x:c.sectionCell.x,y:c.sectionCell.y}),item:new w({...c,starterItem:!0})}))})),id:Oe+(Math.random()*1e4).toString()}),a=[...ve.map(i=>new xe({name:i.name,previewImage:i.previewImage,inventoryItems:i.inventoryItems,sections:i.sections.map(c=>new P({name:c.name,cellId:new h({x:c.cellId.x,y:c.cellId.y}),cellsLong:c.cellsLong,cellsTall:c.cellsTall,modifierItems:c.modifierItems,startingItems:c.startingItems.map(l=>new z({cell:new h({x:l.cell.x,y:l.cell.y}),item:new w({...l.item})}))})),id:i.id})),o];Qe(J,q,a).then(()=>{console.log("Template updated successfully"),Q(!1);const i=new URLSearchParams(window.location.search),c=i.get("companyId"),l=i.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${c}&areaId=${l}&type=view-area`})}})},500))},children:[O?"Create":"Save"," Template"]}),e.jsx("button",{className:"action-btn",onClick:()=>{const n=new URLSearchParams(window.location.search),t=n.get("companyId"),o=n.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${t}&areaId=${o}&type=view-area`},children:"Cancel"})]}),Qt&&e.jsxs("div",{className:"template-creation",children:[an&&e.jsx("button",{className:"action-btn",onClick:()=>{Q(!0),setTimeout(async()=>{const n=j.map(t=>new P({name:t.name,cellId:new h({x:oe.find(o=>o.name==t.name).cellId.x,y:oe.find(o=>o.name==t.name).cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,modifierItems:t.modifierItems,startingItems:t.items.map(o=>new z({cell:new h({x:o.sectionCell.x,y:o.sectionCell.y}),item:new w({...o,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async t=>{if(console.log("Storage event",t),t.key==="screenshot"){ye(!1);const o=new Bt({name:He,previewImage:t.newValue,areaId:q,inventoryItems:ce,sections:j.map(a=>new P({name:a.name,cellId:new h({x:oe.find(i=>i.name==a.name).cellId.x,y:oe.find(i=>i.name==a.name).cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(i=>new z({cell:new h({x:i.sectionCell.x,y:i.sectionCell.y}),item:new w({...i,starterItem:!0})}))})),id:at});Wt(J,q,o).then(()=>{console.log("Design updated successfully"),Pe(!1),Q(!1)})}})},500)},children:"Save"}),e.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),!Ie&&!Je&&!be&&!Ue&&!De&&e.jsxs("div",{className:"place-mode-row",children:[e.jsx("label",{htmlFor:"tap-and-place-mode",children:"Place Mode: "}),e.jsxs("select",{id:"tap-and-place-mode",name:"tap-and-place-mode",value:Re?"tap":"drag",onChange:n=>vt(n.target.value==="tap"),className:"place-mode-select",children:[e.jsx("option",{value:"drag",children:"Drag and Drop"}),e.jsx("option",{value:"tap",children:"Tap and Place"})]})]}),ct&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"loader-backdrop",children:e.jsx("div",{className:"loader"})})})," ",e.jsxs("div",{className:"layout",children:[!Ie&&!Je&&!be&&!Ue&&!De&&e.jsx(Un,{setSelectedItem:Ae,tapAndPlaceMode:Re,isModifyingSections:te&&$=="modify-sections",isViewingDesign:Ie,isEditingTemplate:Y,isCreatingTemplate:O,maxHeight:r?200:S*k,showAddCustomItem:()=>{$=="placing-sections"&&te?ut.current?.showModal():$=="placing-items"&&te?ft.current?.showModal():gt.current?.showModal()},addDraggingItem:In,removeItem:Et,inventoryItems:ce.map(n=>new ue({item:new w({...n.item,displayItem:!0}),quantity:n.quantity}))}),be&&ne?e.jsx(nl,{onDeleteVendor:async n=>{Q(!0);const t=new Ce({...ne,vendors:ne.vendors.filter(o=>o.id!==n),sections:ne.sections.map(o=>new P({...o,booths:o.booths.map(a=>a.user?.id===n?new je({...a,user:null,initialElement:a.initialElement??void 0}):a)}))});await Ee(J,t),Me(t),window.location.reload()},onEditVendor:n=>{mn(n),pt.current?.showModal()},boothMap:ne,vendors:ne?.vendors??[],maxHeight:r?void 0:S*k,onAddVendor:()=>{ht.current?.showModal()}}):null,r?e.jsxs("div",{className:"mobile-areas",style:{height:U+"px"},children:[j.length>1&&e.jsx("img",{src:lt,onClick:()=>{const n=j.findIndex(o=>o.name==y);if(n===-1)return;const t=(n-1+j.length)%j.length;ee(j[t].name),console.log("Changing viewing section to",j[t].name)},className:"back-mobile-areas"}),Ve.map((n,t)=>e.jsx(Pt,{width:n.width,height:n.height,cells:Nt(Z.find(o=>o.sectionName==n.sectionName).cells),id:n.sectionName,visibile:y==null?!0:n.sectionName==y,section:n.sectionName},t)),j.length>1&&e.jsx("img",{src:lt,onClick:()=>{const n=j.findIndex(o=>o.name==y);if(n===-1)return;const t=(n+1)%j.length;ee(j[t].name),console.log("Changing viewing section to",j[t].name)},className:"forward-mobile-areas"})]}):e.jsx(Pt,{width:F*k,height:S*k,cells:Nt(R)}),($=="placing-items"||!te)&&e.jsx(sl,{maxHeight:r?void 0:S*k})]}),be&&e.jsx("div",{className:"design-view",children:e.jsx("button",{className:"action-btn",onClick:()=>{const n=j.map(t=>new P({name:t.name,cellId:new h({x:oe.find(o=>o.name==t.name).cellId.x,y:oe.find(o=>o.name==t.name).cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,modifierItems:t.modifierItems,booths:t.booths,startingItems:t.items.map(o=>new z({cell:new h({x:o.sectionCell.x,y:o.sectionCell.y}),item:new w({...o,starterItem:!0})}))}));localStorage.setItem("printSections",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/LayItOut/Print/?companyId=${J}&areaId=${q}&designName=${ne?.name}`,"_blank")},children:"Print"})}),Ie&&e.jsxs("div",{className:"design-view",children:[e.jsx("button",{className:"action-btn",onClick:()=>{const n=j.map(t=>new P({name:t.name,cellId:new h({x:oe.find(o=>o.name==t.name).cellId.x,y:oe.find(o=>o.name==t.name).cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,modifierItems:t.modifierItems,booths:t.booths,startingItems:t.items.map(o=>new z({cell:new h({x:o.sectionCell.x,y:o.sectionCell.y}),item:new w({...o,starterItem:!0})}))}));localStorage.setItem("printSections",n.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/LayItOut/Print/?companyId=${J}&areaId=${q}&designName=${He}&designId=${at}`,"_blank")},children:"Print"}),e.jsx("button",{className:"action-btn",onClick:()=>{const n=new xe({name:He,previewImage:_e.previewImage,inventoryItems:_e.inventoryItems,sections:_e.sections,id:_e.name+(Math.random()*1e4).toString()}),t=[...ve.map(o=>new xe({name:o.name,previewImage:o.previewImage,inventoryItems:o.inventoryItems,sections:o.sections.map(a=>new P({name:a.name,cellId:new h({x:a.cellId.x,y:a.cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.startingItems.map(i=>new z({cell:new h({x:i.cell.x,y:i.cell.y}),item:new w({...i.item})}))})),id:o.id})),n];Qe(J,q,t).then(()=>{console.log("Template updated successfully"),ke(t),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=edit-template&templateId=${n.id}`})},children:"Turn into a Template"}),e.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=desings"},children:"Back"})]}),be&&e.jsx("div",{className:"design-view",children:e.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=boothmaps"},children:"Back"})}),Je&&e.jsx("div",{className:"design-view",children:e.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=areas"},children:"Back"})}),te&&e.jsxs("div",{className:"design-view",children:[e.jsx("button",{className:"action-btn",onClick:()=>{$=="placing-sections"?xn(W.filter(n=>n.isSectionItem)):$=="modify-sections"?vn(W.filter(n=>n.isSectionModifier),j):$=="placing-items"&&bn(j,ce)},children:$=="placing-items"?"Create Area":"Next"}),e.jsx("button",{className:"action-btn",onClick:async()=>{Q(!0),await kn(J,q),window.location.href="/LayItOut/"},children:"Cancel"})]}),Ke&&e.jsxs("div",{className:"design-view",children:[e.jsx("button",{className:"action-btn",onClick:()=>{console.log("Creating booth map with sections",j,"and inventory items",ce,"and boothMap",ne),Ln(j,ce,ne)},children:"Create Booth Map"}),e.jsx("button",{className:"action-btn",onClick:async()=>{Q(!0),await Dn(J,q,Lt),window.location.href="/LayItOut/?view=boothmaps"},children:"Cancel"})]})]}),e.jsxs("div",{children:[j.map(n=>e.jsx(Mn,{takingPhoto:!1,section:n,visible:y==null?!0:n.name==y,cellSize:k},n.cellId.toId())),W.map(n=>e.jsx(Cn,{isPlacingItem:fe!=null,isCreatingArea:te,isCreatingTemplate:O||Y,cellSize:k,isViewingDesign:Ie||Je||be||Ue||De,removeItem:Et,visible:r?!n.hasMoved&&!n.starterItem?!0:y==null?!1:n.isSectionModifier?j.find(t=>t.name==y)?.modifierItems.some(t=>t.item.id===n.id):n.starterItem?j.find(t=>t.name==y)?.startingItems.some(t=>t.item.id===n.id):j.find(t=>t.name==y)?.items.some(t=>t.id===n.id):!0,item:n,canPlaceItem:yt,placeItem:Ct,deleteItemRotate:wn,highlightCells:Rt,unHighlightCells:wt,deleteItem:yn,isSelected:x===n.id,onSelect:Dt,isUnselecting:X.includes(n.id),onDeselect:()=>kt(n.id)},n.id)),ot.map(n=>(console.log("CAN PICK BOOTH",n.cellsLong==Se?.plotWidth&&n.cellsTall==Se.plotHeight,"BOOTH",n,"VENDOR",Se),e.jsx(En,{canPick:be||dt||n.cellsLong==Se?.plotWidth&&n.cellsTall==Se.plotHeight,visible:r?y==null?!1:j.find(t=>t.name==y)?.booths.some(t=>t.id===n.id)??!1:!0,booth:n,isViewingBooth:be,isPublicViewingBooth:De,hasPickedBooth:dt,isSelected:x==n.id,cellSize:k,onSelect:Dt,isUnselecting:X.includes(n.id),onDeselect:()=>kt(n.id),onPickBooth:async t=>{Q(!0);const o=j.map(i=>i.name===y?new P({...i,booths:i.booths.map(c=>c.id===t?new je({...c,user:Se,initialElement:c.initialElement??void 0}):c)}):i.booths.some(c=>c.id===t)?new P({...i,booths:i.booths.map(c=>c.id===t?new je({...c,user:Se,initialElement:c.initialElement??void 0}):c)}):i);console.log("Updated sections",o),ae(o);const a=new Ce({...ne,sections:o});await Ee(J,a),window.location.reload(),Q(!1)},onRemoveVendorFromBooth:()=>{Q(!0);const t=j.map(a=>new P({...a,booths:a.booths.map(i=>i.user?.id===n.user?.id?new je({...i,user:null,initialElement:i.initialElement??void 0}):i)})),o=new Ce({...ne,sections:t});Ee(J,o).then(()=>{window.location.reload()})},onAddVendorToBooth:()=>{gn(n),It.current?.showModal()}},n.id)))]}),r&&!ct&&e.jsx("div",{className:"layout-icon",onClick:()=>{Ge.current?.showModal(),Fe(!0),console.log("Showing layout dialog")},children:e.jsx("img",{src:Xn,alt:""})}),!ct&&!(O||Y||Ie||Ke||te||be||Ue||De)&&e.jsx("div",{className:"template-icon",onClick:()=>{he.current?.showModal(),Te(!0),console.log("Showing template dialog")},children:e.jsx("img",{src:Qn,alt:""})}),e.jsx(zn,{isViewingArea:Je,dialogRef:he,isOpen:Le,closeDialog:()=>{he.current?.close(),Te(!1)},duplicateTemplate:n=>{const t=new xe({name:n.name+" Copy",previewImage:n.previewImage,inventoryItems:n.inventoryItems,sections:n.sections,id:n.name+"Copy"+(Math.random()*1e4).toString()}),o=[...ve.map(a=>new xe({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(i=>new P({name:i.name,cellId:new h({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(c=>new z({cell:new h({x:c.cell.x,y:c.cell.y}),item:new w({...c.item})}))})),id:a.id})),t];Qe(J,q,o).then(()=>{he.current?.close(),console.log("Template updated successfully"),ke(o),Te(!1),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=edit-template&templateId=${t.id}`})},templates:ve,selectTemplate:n=>{Q(!0),setTimeout(async()=>{const t=n.sections.map(o=>new P({name:o.name,cellId:new h({x:n.sections.find(a=>a.name==o.name).cellId.x,y:n.sections.find(a=>a.name==o.name).cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,modifierItems:o.modifierItems,startingItems:o.startingItems.map(a=>new z({cell:new h({x:a.cell.x,y:a.cell.y}),item:new w({...a.item,starterItem:!0})}))}));localStorage.setItem("screenshotSections",t.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async o=>{if(console.log("Storage event",o),o.key==="screenshot"){ye(!1);const a=new Bt({name:He,previewImage:o.newValue,areaId:q,inventoryItems:n.inventoryItems,sections:n.sections.map(i=>new P({name:i.name,cellId:new h({x:n.sections.find(c=>c.name==i.name).cellId.x,y:n.sections.find(c=>c.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(c=>new z({cell:new h({x:c.cell.x,y:c.cell.y}),item:new w({...c.item,starterItem:!0})}))})),id:at});console.log("UPDATED DESIGN",a),Wt(J,q,a).then(()=>{console.log("Design updated successfully"),Pe(!1),Q(!1),window.location.reload()})}})},500)}}),e.jsx(Hn,{dialogRef:Ge,closeDialog:()=>{Ge.current?.close(),Fe(!1)},areaPreview:ln||""}),e.jsx(qn,{canBeBooth:Ke,dialogRef:gt,addInventoryItem:xt,closeDialog:()=>{gt.current?.close()}}),e.jsx($n,{dialogRef:ut,closeDialog:()=>{ut.current?.close()},addSection:xt}),e.jsx(Kn,{dialogRef:ft,closeDialog:()=>{ft.current?.close()},addInventoryItem:xt}),e.jsx(_n,{placeMultiItem:jn,addHighlightedCell:Sn,item:fe,setSelectingItem:()=>{Ae(null)},canPlaceItem:yt,placeItem:Ct,highlightCells:Rt,unHighlightCells:wt,cellSize:k}),e.jsx(ll,{dialogRef:ht,closeDialog:()=>{ht.current?.close()},addVendor:async n=>{const t=new Ce({...ne,vendors:[...ne.vendors,n]});Me(t),await Ee(J,t)}}),e.jsx(ol,{oldVendor:dn,dialogRef:pt,closeDialog:()=>{pt.current?.close()},editVendor:async n=>{const t=new Ce({...ne,vendors:ne.vendors.map(o=>o.id===n.id?n:o)});Me(t),await Ee(J,t)}}),e.jsx(il,{dialogRef:It,vendors:ne?.vendors.filter(n=>!pn(n,ne))??[],closeDialog:()=>{It.current?.close()},addVendorToBooth:async n=>{Q(!0);const t=j.map(a=>a.name===y?new P({...a,booths:a.booths.map(i=>i.id===mt.id?new je({...i,user:n,initialElement:i.initialElement??void 0}):i)}):a.booths.some(i=>i.id===mt.id)?new P({...a,booths:a.booths.map(i=>i.id===mt.id?new je({...i,user:n,initialElement:i.initialElement??void 0}):i)}):a);console.log("Updated sections",t),ae(t);const o=new Ce({...ne,sections:t});await Ee(J,o),window.location.reload(),Q(!1)}}),rt&&e.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:window.location.origin+"/LayItOut/Preview/",width:C*k+20,height:G*k+20})]})}
