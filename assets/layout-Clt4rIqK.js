import{r as d,j as t,c as Nn}from"./index-_mSZXrjJ.js";import{A as Pt,S as Mn,D as Cn,B as En}from"./booth_item-JaGj03SR.js";import{I as y,s as Qe,k as ue,p as Rn,C as h,V as Gt,S as P,m as z,T as xe,D as Bt,u as Wt,B as Ee,n as je,o as Re,d as kn,b as Dn,q as On,r as nt,t as Pn,v as Bn,w as Wn,x as Gn,A as Fn,y as Vn}from"./firestore-e7Y9lgJc.js";import{F as lt}from"./add_custom_item_dialog-B83re6ox.js";import{L as Zn,T as Yn}from"./link-DQZq8SUn.js";function Jn({inventoryItem:c,addDraggingItem:B,removeItem:F,setSelectedItem:L,tapAndPlaceMode:b}){const E=d.useRef(null),C=d.useRef(null),[T,G]=d.useState(12),[A,R]=d.useState(c.item),[N,W]=d.useState(!1);function v(x){const Z=C.current,X=window.getComputedStyle(Z),H=document.createElement("span");H.style.font=X.font,H.style.fontSize=x+"px",H.style.fontFamily=X.fontFamily,H.style.fontWeight=X.fontWeight,H.style.position="absolute",H.style.visibility="hidden",H.style.whiteSpace="nowrap",H.textContent=Z.textContent,document.body.appendChild(H);const k=H.offsetWidth;return document.body.removeChild(H),k}function U(x){if(C.current){const Z=C.current;return v(x-1)>Z.offsetWidth&&x-1>8?U(x-1):x-1}return x}d.useEffect(()=>{setTimeout(()=>{C.current&&G(U(T))},100)},[]);const I=d.useCallback(()=>{if(console.log("MOUSE MOVE",N),N){if(W(!1),b)return;c.item.initialElement=E.current,c.item.id=c.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",c.item.id,"to initialElement",c.item.initialElement),R(new y({...c.item})),B(c.item),window.removeEventListener("mousemove",I),window.removeEventListener("touchmove",I)}},[N,b]);return d.useEffect(()=>(N?(window.addEventListener("touchmove",I),window.addEventListener("mousemove",I)):(window.removeEventListener("touchmove",I),window.removeEventListener("mousemove",I)),()=>{window.removeEventListener("touchmove",I),window.removeEventListener("mousemove",I)}),[N,I]),t.jsxs("div",{className:"display",children:[t.jsx("div",{ref:E,id:c.item.id,className:c.item.isSectionItem?"display-section":`display-item ${c.item.isSectionModifier?c.item.sectionModifierType.toString():""}`,style:{width:`${c.item.cellsLong*10}px`,height:`${c.item.cellsTall*10}px`},onMouseDown:x=>{W(!0)},onMouseUp:()=>{console.log("MOUSE UP"),W(!1)},onClick:x=>{if(!b){x.preventDefault(),x.stopPropagation();return}console.log("CLICKED ON ITEM",c.item.id,"with tap and place mode"),x.preventDefault(),x.stopPropagation(),c.item.initialElement=E.current,c.item.id=c.item.name+(Math.random()*1e4).toString(),L(c.item)},onTouchStart:x=>{b||(x.preventDefault(),x.stopPropagation(),c.item.initialElement=E.current,c.item.id=c.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",c.item.id,"to initialElement",c.item.initialElement),R(new y({...c.item})),B(c.item))},children:c.item.isSectionModifier?c.item.sectionModifierType==="LeftDoor"||c.item.sectionModifierType==="RightDoor"?t.jsx("img",{src:c.item.icon,alt:"icon"}):null:c.item.icon.includes("custom-")?t.jsx("div",{className:c.item.isSectionItem?"custom-section":"custom-icon",children:t.jsx("div",{children:t.jsx("p",{ref:C,style:{fontSize:`${T}px`},children:c.item.icon.split("custom-")[1]})})}):t.jsx("img",{src:c.item.icon,alt:"icon"})}),t.jsx("p",{children:c.item.name}),c.quantity>0&&t.jsxs("p",{className:"quantity",children:["x",c.quantity]})]})}const Ft="/LayItOut/assets/plus.circle-Ce3xm00a.png";function Un({inventoryItems:c,addDraggingItem:B,maxHeight:F,removeItem:L,showAddCustomItem:b,isCreatingTemplate:E,isEditingTemplate:C,isViewingDesign:T,tapAndPlaceMode:G,setSelectedItem:A,isModifyingSections:R}){return t.jsxs("div",{className:"toolbox",style:{maxHeight:F?`${F}px`:"200px"},children:[c.map(N=>t.jsx(Jn,{setSelectedItem:A,tapAndPlaceMode:G,inventoryItem:N,addDraggingItem:B,removeItem:L})),!(E||C||T||R)&&t.jsx("div",{className:"add-item",onClick:()=>{b()},children:t.jsx("img",{src:Ft,alt:"Add Item"})})]})}function Hn({dialogRef:c,closeDialog:B,areaPreview:F}){return t.jsx("dialog",{ref:c,className:"layout-dialog",children:t.jsxs("div",{className:"layout-dialog-div",children:[t.jsx("h2",{children:"Layout"}),t.jsx("img",{src:F,alt:"Layout preview",className:"layout-dialog-preview"}),t.jsx("br",{}),t.jsx("button",{className:"layout-dialog-close",onClick:B,children:"Close"})]})})}const Xn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",Qn="/LayItOut/assets/template-Cjj8EPhc.png";function zn({dialogRef:c,closeDialog:B,templates:F,isOpen:L,isViewingArea:b,selectTemplate:E,duplicateTemplate:C}){const[T,G]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[A,R]=d.useState([]),[N,W]=d.useState(!1),[v,U]=d.useState([]);return d.useEffect(()=>{U(F)},[F]),d.useEffect(()=>{if(L&&(console.log("Layout dialog opened, generating cells and sections",v),v.length!==0)){if(v.length==1){R([v[0].name]);return}R(T?[v[0].name]:[v[0].name,v[1].name])}},[L,v]),d.useEffect(()=>{const I=v.filter(x=>A.includes(x.name));console.log("Viewing templates:",A),I.sort((x,Z)=>A.indexOf(x.name)-A.indexOf(Z.name)),console.log("Generating templates for",I.map(x=>x.name))},[A,v]),t.jsx(t.Fragment,{children:t.jsx("dialog",{ref:c,className:"template-dialog",children:t.jsxs("div",{className:"template-dialog-div",children:[t.jsx("h2",{children:"Templates"}),t.jsxs("div",{className:"templates",children:[v.length>1&&v.filter(I=>!A.includes(I.name)).length>0&&t.jsx("img",{src:lt,onClick:()=>{if(T){const x=(v.findIndex(Z=>Z.name===A[0])-1+v.length)%v.length;R([v[x].name])}else R(I=>{const Z=(v.findIndex(X=>X.name===I[0])-1+v.length)%v.length;return[v[Z].name,I[0]]})},className:"back-mobile-areas"}),A.length===0&&t.jsx("div",{className:"no-templates",children:"No templates available"}),A.map(I=>t.jsxs("div",{className:"template",children:[t.jsx("img",{src:v.find(x=>x.name===I).previewImage,alt:I,className:"template-preview"}),t.jsx("h3",{children:I}),t.jsxs("div",{className:"template-actions",children:[t.jsx("button",{className:"template-select-btn",onClick:()=>{if(b){const x=new URLSearchParams(window.location.search),Z=x.get("companyId"),X=x.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${Z}&areaId=${X}&type=edit-template&templateId=${v.find(H=>H.name==I).id}`}else B(),E&&E(v.find(x=>x.name===I))},children:b?"Edit":"Select"}),b&&t.jsx("button",{className:"action-btn",onClick:()=>{N||(W(!0),C&&C(v.find(x=>x.name===I)))},children:"Duplicate"}),b&&t.jsx("button",{className:"action-btn",onClick:()=>{if(N)return;W(!0);const x=v.filter(k=>k.name!==I);U(x),x.length==1?R([x[0].name]):x.length==0?R([]):R(T?[x[0].name]:[x[0].name,x[1].name]);const Z=new URLSearchParams(window.location.search),X=Z.get("companyId"),H=Z.get("areaId");Qe(X,H,x).then(()=>{W(!1)})},children:"Delete"})]})]})),v.length>1&&v.filter(I=>!A.includes(I.name)).length>0&&t.jsx("img",{src:lt,onClick:()=>{if(T){const x=(v.findIndex(Z=>Z.name===A[0])+1)%v.length;R([v[x].name])}else R(I=>{const Z=(v.findIndex(X=>X.name===I[I.length-1])+1)%v.length;return[I[1],v[Z].name]})},className:"forward-mobile-areas"})]}),b&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"action-btn",onClick:()=>{const I=new URLSearchParams(window.location.search),x=I.get("companyId"),Z=I.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${x}&areaId=${Z}&type=create-template`},children:"Create new Template"})," ",t.jsx("br",{})]}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:B,children:"Close"}),N&&L&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader"})})]})})})}function qn({dialogRef:c,closeDialog:B,addInventoryItem:F,canBeBooth:L}){const[b,E]=d.useState(""),[C,T]=d.useState(1),[G,A]=d.useState(1),[R,N]=d.useState(1),[W,v]=d.useState(!1);return t.jsx("dialog",{ref:c,className:"custom-item-dialog",children:t.jsxs("div",{className:"custom-item-dialog-div",children:[t.jsx("h2",{children:"Add Custom Item"}),t.jsxs("div",{className:"custom-item-row",children:[t.jsx("label",{htmlFor:"item-name",children:"Name:"}),t.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:U=>E(U.target.value??""),value:b})]}),t.jsxs("div",{className:"custom-item-row",children:[t.jsx("label",{htmlFor:"item-icon",children:"Count:"}),t.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:C,onChange:U=>T(parseInt(U.target.value)??1)})]}),t.jsxs("div",{className:"custom-item-row custom-item-size",children:[t.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),t.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:G,onChange:U=>A(parseFloat(U.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:R,onChange:U=>N(parseFloat(U.target.value)??1)})]}),L?t.jsxs("div",{className:"custom-item-row",children:[t.jsx("label",{htmlFor:"is-booth",children:"Is Booth:"}),t.jsx("input",{type:"checkbox",id:"is-booth",name:"is-booth",checked:W,onChange:U=>v(U.target.checked)})]}):null,t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{if(b.trim()===""){alert("Item name cannot be empty");return}const U=new ue({quantity:C,item:new y({id:b+(Math.random()*1e4).toString(),name:b,icon:`custom-${b}`,cellsLong:Math.ceil(G),cellsTall:Math.ceil(R),moveable:!0,starterItem:!1,displayItem:!0,isBooth:W})});F(U),E(""),T(1),A(1),N(1),v(!1),B()},children:"Add Item"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{B(),E(""),T(1),A(1),N(1),v(!1)},children:"Close"})]})})}function $n({dialogRef:c,closeDialog:B,addSection:F}){const[L,b]=d.useState(""),[E,C]=d.useState(1),[T,G]=d.useState(1);return t.jsx("dialog",{ref:c,className:"section-dialog",children:t.jsxs("div",{className:"section-dialog-div",children:[t.jsx("h2",{children:"Add Section"}),t.jsxs("div",{className:"section-row",children:[t.jsx("label",{htmlFor:"section-name",children:"Name:"}),t.jsx("input",{type:"text",id:"section-name",name:"section-name",onChange:A=>b(A.target.value??""),value:L})]}),t.jsxs("div",{className:"section-row section-size",children:[t.jsx("label",{htmlFor:"section-width",children:"Size (in feet):"}),t.jsx("input",{type:"number",id:"section-width",name:"section-width",min:"1",value:E,onChange:A=>C(parseFloat(A.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"section-height",name:"section-height",min:"1",value:T,onChange:A=>G(parseFloat(A.target.value)??1)})]}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{if(L.trim()===""){alert("Section name cannot be empty");return}const A=new ue({quantity:1,item:new y({id:L+(Math.random()*1e4).toString(),name:L,icon:`custom-${L}`,cellsLong:Math.ceil(E),cellsTall:Math.ceil(T),moveable:!0,starterItem:!1,displayItem:!0,isSectionItem:!0})});F(A),b(""),C(1),G(1),B()},children:"Add Section"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:B,children:"Close"})]})})}function Kn({dialogRef:c,closeDialog:B,addInventoryItem:F}){const[L,b]=d.useState(null),[E,C]=d.useState(""),[T,G]=d.useState(1),[A,R]=d.useState(1),[N,W]=d.useState(1),[v,U]=d.useState(!0);return t.jsx("dialog",{ref:c,className:"inventory-item-dialog",children:t.jsxs("div",{className:"inventory-item-dialog-div",children:[t.jsx("h2",{children:"Add Inventory Item"}),L==null?t.jsxs(t.Fragment,{children:["  ",t.jsx("label",{htmlFor:"",children:"Premade Items:"}),t.jsx("div",{className:"inventory-item-list",children:Rn.map(I=>t.jsx("div",{className:"inventory-item",onClick:()=>{const x=new ue({quantity:1,item:new y({id:I.name+(Math.random()*1e4).toString(),name:I.name,icon:I.icon,cellsLong:I.cellsLong,cellsTall:I.cellsTall,moveable:!0,starterItem:!1,displayItem:!0})});b(x)},children:t.jsxs("div",{className:"inventory-item-display",children:[t.jsx("img",{src:I.icon,alt:"icon"}),t.jsx("p",{children:I.name}),t.jsxs("p",{className:"quantity",children:[I.cellsLong,"ft x ",I.cellsTall,"ft"]})]})},I.name))}),t.jsx("label",{htmlFor:"",children:"Or:"}),t.jsx("label",{htmlFor:"",children:"Custom Item:"}),t.jsxs("div",{className:"inventory-item-row",children:[t.jsx("label",{htmlFor:"item-name",children:"Name:"}),t.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:I=>C(I.target.value??""),value:E})]}),t.jsxs("div",{className:"inventory-item-row",children:[t.jsx("label",{htmlFor:"item-icon",children:"Count:"}),t.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:T,onChange:I=>G(parseInt(I.target.value)??1)})]}),t.jsxs("div",{className:"inventory-item-row inventory-item-size",children:[t.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),t.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:A,onChange:I=>R(parseFloat(I.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:N,onChange:I=>W(parseFloat(I.target.value)??1)})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),t.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:v,onChange:I=>U(I.target.checked)})]}),t.jsx("br",{})]}):t.jsxs(t.Fragment,{children:[t.jsxs("label",{htmlFor:"",children:["Item: ",L.item.name]}),t.jsxs("div",{className:"inventory-item-row",children:[t.jsx("label",{htmlFor:"item-icon",children:"Count:"}),t.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:T,onChange:I=>G(parseInt(I.target.value)??1)})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),t.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:v,onChange:I=>U(I.target.checked)})]})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{if(E.trim()===""&&L==null){alert("Item name cannot be empty");return}if(T<=0){alert("Item count must be greater than zero");return}let I=L;I==null?I=new ue({quantity:T,item:new y({id:E+(Math.random()*1e4).toString(),name:E,icon:`inventory-${E}`,cellsLong:Math.ceil(A),cellsTall:Math.ceil(N),moveable:v,starterItem:!1,displayItem:!0})}):(I.quantity=T,I.item.moveable=v),F(I),U(!0),b(null),C(""),G(1),R(1),W(1),B()},children:"Add Item"}),t.jsx("button",{className:"action-btn",onClick:B,children:"Close"})]})})}function _n({item:c,setSelectingItem:B,addHighlightedCell:F,canPlaceItem:L,placeItem:b,highlightCells:E,unHighlightCells:C,cellSize:T,placeMultiItem:G}){const[A,R]=d.useState(0),[N,W]=d.useState(0),v=d.useRef(null),[U,I]=d.useState(0),[x,Z]=d.useState(0),[X,H]=d.useState(!1),[k,ce]=d.useState(0),[le,Ae]=d.useState(null),[vt,fe]=d.useState(!0),[Ne,ze]=d.useState(12),[Me,qe]=d.useState(null),$e=d.useRef(null),[Ge,St]=d.useState(!0),[Fe,oe]=d.useState(!1),[re,j]=d.useState(!1),ae=d.useCallback(M=>{const w=M%2===1;return{width:w?c.cellsTall*T:c.cellsLong*T,height:w?c.cellsLong*T:c.cellsTall*T,cellsWide:w?c.cellsTall:c.cellsLong,cellsTall:w?c.cellsLong:c.cellsTall}},[c,T]);function ot(M){const w=v.current,ee=window.getComputedStyle(w),O=document.createElement("span");O.style.font=ee.font,O.style.fontSize=M+"px",O.style.fontFamily=ee.fontFamily,O.style.fontWeight=ee.fontWeight,O.style.position="absolute",O.style.visibility="hidden",O.style.whiteSpace="nowrap",O.textContent=w.textContent,document.body.appendChild(O);const de=O.offsetWidth;return document.body.removeChild(O),de}function Ve(M){if(v.current){const w=v.current;return ot(M-1)>w.offsetWidth&&M-1>8?Ve(M-1):M-1}return M}const ve=()=>{oe(!0)},ke=()=>{oe(!1)};d.useEffect(()=>(setTimeout(()=>{v.current&&ze(Ve(Ne))},100),window.addEventListener("mousedown",ve),window.addEventListener("mouseup",ke),()=>{window.removeEventListener("mousedown",ve),window.removeEventListener("mouseup",ke)}),[]),d.useEffect(()=>{if(c){H(!0);const M=$e.current?.getBoundingClientRect();qe({x:M?M.left-A:0,y:M?M.top-N:0})}else console.log("No item to place, stopping dragging"),H(!1),qe(null),R(0),W(0),I(0),Z(0),ce(0),Ae(null),fe(!0),ze(12),St(!0)},[c]);const Le=M=>{M.preventDefault()},Te=d.useCallback((M,w,ee)=>{if(c==null||!X||!Me)return;console.log("PLACING MOVE",c);const O=ee.target,de=ae(k),Y=y.fromDoc(c.toDoc());Y.cellsLong=de.cellsWide,Y.cellsTall=de.cellsTall,Y.initialElement=c.initialElement,Y.rotation=k,Y.hasMoved=c.hasMoved,Y.id=c.id;let pe=O;if(!pe||!pe.classList?.contains("cell")){const Ie=document.elementFromPoint(M,w);Ie?.classList?.contains("cell")&&(pe=Ie)}pe?.classList?.contains("cell")&&!re?E(h.fromString(pe.id),Y):pe?.classList?.contains("section-modifier")&&!re?E(h.fromString(pe.dataset.cell),Y):re||C(),R(M-Me.x),W(w-Me.y+(c.sectionModifierType?.includes("Door")?10:5)),Fe&&(re||C(),j(!0),F(h.fromString(pe.id)))},[c,X,A,N,re,Fe,Me,L,b,ae,k,E,C,$e]),he=d.useCallback(M=>{if(c==null)return;const w=M.clientX,ee=M.clientY;console.log("Drag ended"),C(),document.body.removeEventListener("touchmove",Le);const O=document.elementFromPoint(w,ee);if(!O?.classList?.contains("cell")&&!O?.classList?.contains("section-modifier")){const de=ae(k),Y={...c,cellsLong:de.cellsWide,cellsTall:de.cellsTall};re?(j(!1),G(Y)):B()}else if(O?.classList?.contains("section-modifier")){if(console.log("Placing item on section modifier cell"),console.log("Target element:",O.dataset.cell),O.dataset.cell=="")return;const de=ae(k),Y={...c,cellsLong:de.cellsWide,cellsTall:de.cellsTall};if(re)j(!1),G(Y);else{if(!L(h.fromString(O.dataset.cell),Y))return;b(h.fromString(O.dataset.cell),Y,le!=null?h.fromString(le.id):null)}console.log("Placed item at cell:",O)}else{const de=ae(k),Y={...c,cellsLong:de.cellsWide,cellsTall:de.cellsTall};if(re)j(!1),G(Y);else{if(!L(h.fromString(O.id),Y))return;b(h.fromString(O.id),Y,le!=null?h.fromString(le.id):null)}console.log("Placed item at cell:",O)}},[c,k,B,re,L,b,le,C,U,x]),Ze=d.useCallback(M=>{const w=M.clientX,ee=M.clientY;Te(w,ee,M)},[Te]),Ye=d.useCallback(M=>{const w=M.touches[0],ee=w.clientX,O=w.clientY;Te(ee,O,M)},[Te]),V=d.useCallback(M=>{const w=M.changedTouches[0],ee=w.clientX,O=w.clientY;he({clientX:ee,clientY:O}),document.body.removeEventListener("touchmove",Le)},[he,Le]);return d.useEffect(()=>{if(X)return document.body.addEventListener("touchmove",Le,{passive:!1}),document.addEventListener("mousemove",Ze),document.addEventListener("mouseup",he),document.addEventListener("touchmove",Ye),document.addEventListener("touchend",V),()=>{document.body.removeEventListener("touchmove",Le),document.removeEventListener("mousemove",Ze),document.removeEventListener("mouseup",he),document.removeEventListener("touchmove",Ye),document.removeEventListener("touchend",V)}},[X,Ze,he,Ye,V,Le]),A==0||N==0||!Ge||c==null?t.jsx(t.Fragment,{}):t.jsx(t.Fragment,{children:t.jsx("div",{id:c.id,ref:$e,className:`draggable-item ${c.isSectionModifier&&!c.moveable?"placed-modifier":""} ${c.isSectionModifier?c.sectionModifierType?.toString():""} ${X?"dragging":""} ${c.moveable?"":"not-moveable"}`,style:{top:`${N}px`,left:`${A}px`,width:`${c.cellsLong*(c.isDisplayItem&&!X&&!c.hasMoved?10:T)-(c.sectionModifierType=="LeftWall"||c.sectionModifierType=="RightWall"||c.sectionModifierType?.includes("Corner")?1:0)}px`,height:`${c.cellsTall*(c.isDisplayItem&&!X&&!c.hasMoved?10:T)-(c.sectionModifierType=="TopWall"||c.sectionModifierType=="BottomWall"||c.sectionModifierType?.includes("Corner")?1:0)}px`,rotate:`${k*90}deg`,transformOrigin:"center center",fontSize:`${Ne}px`,zIndex:X?1e3:1},children:c.isSectionModifier?null:c.icon.includes("custom-")?t.jsx("div",{className:c.isSectionItem?"custom-section":"custom-icon",children:t.jsx("div",{children:t.jsx("p",{ref:v,children:c.icon.split("custom-")[1]})})}):t.jsx("img",{src:c.icon,alt:"icon"})})})}const el="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE02lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTE2PC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmRiZTM1YTM5LWE0MDUtNDM2MC04YzRjLWI3NmJmMTY3Mjc1YjwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5hZGQtaXRlbSAtIDc8L3JkZjpsaT4KICAgPC9yZGY6QWx0PgogIDwvZGM6dGl0bGU+CiA8L3JkZjpEZXNjcmlwdGlvbj4KCiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogIHhtbG5zOnBkZj0naHR0cDovL25zLmFkb2JlLmNvbS9wZGYvMS4zLyc+CiAgPHBkZjpBdXRob3I+U2FyYWggS2VtbWVOYXNoPC9wZGY6QXV0aG9yPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp4bXA9J2h0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8nPgogIDx4bXA6Q3JlYXRvclRvb2w+Q2FudmEgKFJlbmRlcmVyKSBkb2M9REFHdTJ5dUVOWkEgdXNlcj1VQUZqR1c2eHRDUSBicmFuZD1bQVJDSElWRURdIEZvcnQgV2F5bmUgQ29tbXVuaXR5IFNjaG9vbHMgdGVtcGxhdGU9PC94bXA6Q3JlYXRvclRvb2w+CiA8L3JkZjpEZXNjcmlwdGlvbj4KPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0ncic/PupmVZwAAAT8SURBVHic7d1PaBxVHMDxX41Wh6DsE1FcweGltiAUpE7Vanm9BGzGqvGgJ9e/bRSliHrwkIueiif/gShkVFRGLCbR4p8ulSBMEEul7+rJF6jgXqQTFSEiK15m4yTZze7MvJn3m5nf95p9+xv4MLOZycxmB1Co2mF6A6iNEQiyCARZBIIsAkEWgSCLQJBFIMgiEGQRCLIIBFkEgiwCGVCDi7GJydnjbOLQEQC4AQBUqAJfeu6nec4lkD41uLjcmWl/AQBTm38WquAd6bnP5jV7LK83LmsRxucA4Pb7ucXs2xgX13ek/1Ue8wkk1jCMXhaz9zMurutI/2vd20AgUQ0udkaHqW0xekV7yrUd6X+jczsIBNYxFgDgSJJ1Eco1Hemf1rUttQeJYdybZr3F7NsZF1d3pN/WsT21BmlwcZkz016ElBi9LGbfwbhgOlBqDXLwpZ8WAeB+He9lMfsA4+KqjvTPZHmfWoMwLpoWsw/rej+L2XcyLq7MglJrkI70f2Bc/KkZ5S7GxXhH+t+mWV9rEIB1lD80oxxkXFzsSP9c0rW1BwEA6Ej/LOPid4vZWy6VpM1i9oFQLb+2tnrh3yTrLtG1AZhrcLFz8sRfLze4sAa9RnruG6EKXtQ4lrEJsTfposqDROcZ8wDwijPT/rLBxRWDXis99/VQBc9rHP930gWVvto74KTvzPm5qenVleW1QetuPXb6OTZx6M2M439Zmh2/Memiyu4hsT1j80nf3c5M+9SQPeWtUAUvZJmf9vBXyQ/12J5x34CX7Go6rf2hWp5fW73Q7feC6IP+osXskS42xgtV8LT03I+TrgOoIEiCa1M3NZ2WMwTlHOPiN4vZ94w6P1TBU9Jz55Jsc7xKgaS4ULh7BJQfR0UJVXBUeu57SbZ5c5UByXDVdnfTae3LihKq4EnpuR8knL2lSoBkvYQOAHsilIUUKN1QBY9Jz/0o5ewNlR5EA0avNCjdUAWPSs/1M85er9QgGjF67Wk6rVsilL6XPGIoh0MVPKz7tqDSnhjGzjMG/WqbpVPn56YeWl1Z/mfQC/jk7K6VpRM/6x5cSpAc9ox+DUXJo9KdqReEAQAw7cy0Tza4uDTnORsq1WdIgRi9bm46rb2hWl5Mehk9baU5ZEU3JMyDpr+BJ2xhaXb8wSIGleKQFWF8BmYwIFTBd0XNQr+HxDCmTcwPVXBceu7bRc1DDVI3DADEIHXEAEAKUlcMAIQgdcYAQAZSdwwARCAIMJ6RnvuuidnxUIAQxv8ZByGMjRkFIYytGQMhjP4ZASGMwRUOQhjbVygIAoxMN7EVUWEghDFahYAQxujlDkIYycoVhDCSlxsIYaQrFxDCSJ92EAQYx7I+EmAyrSAIMI5Kz33fxGxdaQMhDD1pASEMfWUGIQy9ZQIhDP2lBiGMfEoFggBDywOWGEsM0uBiLLoL/YEctmdooQoel577oYnZRZT47nc2IfaBOYwnqowBAJDm6SAjjzBUfc/oVYrnQ+qCAVACkDphACAHqRsGAF6QbqiCR+qGAZDuQz3vel9X8YnpDTERtj2k1hgAuEBqjwGAB4QwojCAEEYs0yCEsSmTv2V1QxW08v43dGXLFEg3+vKvk4bmo83EIYswtinNHvIrALyadmCogu+l5+byPwCrkPGHPqmNEQiyCARZBIIsAkEWgSCLQJBFIMgiEGQRCLIIBFkEgqz/ADvdpRk/dmKqAAAAAElFTkSuQmCC";function tl({vendor:c,onDelete:B,onEdit:F,boothMap:L}){return t.jsxs("div",{className:"vendor-display-tile",children:[t.jsxs("div",{className:"vendor-info",children:[t.jsx("h3",{className:"vendor-business-name",children:c.businessName}),t.jsxs("p",{className:"vendor-plot-size",children:[c.plotWidth,"ft x ",c.plotHeight,"ft"]})]}),t.jsxs("div",{className:"vendor-actions",children:[t.jsx("img",{src:Zn,alt:"Share",className:"vendor-link",onClick:async b=>{b.stopPropagation();const E=localStorage.getItem("companyId"),C=window.location.origin+`/LayItOut/Layout/?companyId=${E}&areaId=${L.areaId}&type=pick-booth&boothMapId=${L.id}&boothMapName=${L.name}&vendorId=${c.id}`;await navigator.clipboard.writeText(C),alert("BoothMap link copied to clipboard!")}}),t.jsx("img",{src:el,alt:"Edit",className:"vendor-edit",onClick:b=>{b.stopPropagation(),F(c.id)}}),t.jsx("img",{src:Yn,alt:"Delete",className:"vendor-delete",onClick:b=>{b.stopPropagation(),window.confirm("Are you sure you want to delete this vendor?")&&B(c.id)}})]})]})}function nl({maxHeight:c,vendors:B,onAddVendor:F,boothMap:L,onDeleteVendor:b,onEditVendor:E}){return t.jsxs("div",{className:"vendors-tile",style:{maxHeight:c?`${c}px`:"200px"},children:[t.jsx("h2",{children:"Vendors"}),t.jsx("div",{className:"vendors-divider"}),t.jsxs("div",{className:"vendors-tile-content",children:[B.map(C=>t.jsx(tl,{vendor:C,boothMap:L,onDelete:T=>{b(T)},onEdit:T=>{E(C)}},C.id)),t.jsx("div",{className:"add-vendor",onClick:F,children:t.jsx("img",{src:Ft,alt:"Add vendor"})})]})]})}function ll({dialogRef:c,closeDialog:B,addVendor:F}){const[L,b]=d.useState(""),[E,C]=d.useState(1),[T,G]=d.useState(1),[A,R]=d.useState(!1);return t.jsxs("dialog",{ref:c,className:"add-vendor-dialog",children:[t.jsxs("div",{className:"add-vendor-dialog-div",children:[t.jsx("h2",{children:"Add Vendor"}),t.jsxs("div",{className:"add-vendor-row",children:[t.jsx("label",{htmlFor:"business-name",children:"Business Name:"}),t.jsx("input",{type:"text",id:"business-name",name:"business-name",onChange:N=>b(N.target.value??""),value:L})]}),t.jsxs("div",{className:"add-vendor-row add-vendor-size",children:[t.jsx("label",{htmlFor:"item-width",children:"Booth Size (in feet):"}),t.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:E,onChange:N=>C(parseFloat(N.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:T,onChange:N=>G(parseFloat(N.target.value)??1)})]}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:async()=>{if(L.trim()===""){alert("Business name cannot be empty");return}const N=new Gt({id:L+(Math.random()*1e4).toString(),businessName:L,plotWidth:Math.ceil(E),plotHeight:Math.ceil(T)});R(!0),await F(N),b(""),C(1),G(1),R(!1),B()},children:"Add Vendor"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{B(),b(""),C(1),G(1)},children:"Close"})]}),A&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader"})})]})}function ol({dialogRef:c,closeDialog:B,editVendor:F,oldVendor:L}){const[b,E]=d.useState(""),[C,T]=d.useState(1),[G,A]=d.useState(1),[R,N]=d.useState(!1);return d.useEffect(()=>{L&&(E(L.businessName),T(L.plotWidth),A(L.plotHeight))},[L]),t.jsxs("dialog",{ref:c,className:"edit-vendor-dialog",children:[t.jsxs("div",{className:"edit-vendor-dialog-div",children:[t.jsx("h2",{children:"Edit Vendor"}),t.jsxs("div",{className:"edit-vendor-row",children:[t.jsx("label",{htmlFor:"business-name",children:"Business Name:"}),t.jsx("input",{type:"text",id:"business-name",name:"business-name",onChange:W=>E(W.target.value??""),value:b})]}),t.jsxs("div",{className:"edit-vendor-row edit-vendor-size",children:[t.jsx("label",{htmlFor:"item-width",children:"Booth Size (in feet):"}),t.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:C,onChange:W=>T(parseFloat(W.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:G,onChange:W=>A(parseFloat(W.target.value)??1)})]}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:async()=>{if(b.trim()===""){alert("Business name cannot be empty");return}const W=new Gt({id:L.id,businessName:b,plotWidth:Math.ceil(C),plotHeight:Math.ceil(G)});N(!0),await F(W),E(""),T(1),A(1),N(!1),B()},children:"Save Vendor"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{B(),E(L.businessName),T(L.plotWidth),A(L.plotHeight)},children:"Close"})]}),R&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader"})})]})}function sl({maxHeight:c}){return t.jsxs("div",{className:"key-tile",children:[t.jsx("h2",{children:"Key"}),t.jsx("div",{className:"key-divider"}),t.jsxs("div",{className:"key-tile-content",children:[t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"cell cell-border"}),t.jsx("p",{children:"1ft x 1ft"})]}),t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"container",children:t.jsx("div",{className:"wall"})}),t.jsx("p",{children:"Wall"})]}),t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"window-container",children:t.jsx("div",{className:"window"})}),t.jsx("p",{children:"Window"})]}),t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"container",children:t.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fright_door.png?alt=media&token=8c6f3b4d-5e7a-4b9c-8d2f-0a3b5e6f7c8d",alt:"",className:"door"})}),t.jsx("p",{children:"Door"})]}),t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"window-container",children:t.jsx("div",{className:"section-divider"})}),t.jsx("p",{children:"Section Divider"})]})]})]})}function il({dialogRef:c,closeDialog:B,vendors:F,addVendorToBooth:L}){const[b,E]=d.useState(!1),[C,T]=d.useState(null);return t.jsxs("dialog",{ref:c,className:"add-vendor-dialog",children:[t.jsxs("div",{className:"add-vendor-dialog-div",children:[t.jsx("h2",{children:"Select Vendor"}),t.jsxs("div",{className:"add-vendor-row",children:[t.jsx("label",{htmlFor:"boothMap-area",children:"Vendor:"}),t.jsxs("select",{id:"boothMap-area",name:"boothMap-area",onChange:G=>{const A=G.target.value,R=F.find(N=>N.id===A)||null;T(R)},value:C?.id||"",children:[t.jsx("option",{value:"",children:"Select a Vendor"}),F.map(G=>t.jsx("option",{value:G.id,children:G.businessName},G.id))]})]}),t.jsx("button",{className:"action-btn",onClick:()=>{if(!C){alert("Please select a vendor");return}E(!0),L(C)},children:"Select"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{B(),T(null)},children:"Close"})]}),b&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader"})})]})}Nn.createRoot(document.getElementById("root")).render(t.jsx(al,{}));function al(){const[c,B]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[F,L]=d.useState(0),[b,E]=d.useState(0),[C,T]=d.useState(0),[G,A]=d.useState(0),[R,N]=d.useState([]),[W,v]=d.useState([]),[U,I]=d.useState(0),[x,Z]=d.useState(null),[X,H]=d.useState([]),k=/Mobi|Android/i.test(navigator.userAgent)?5:10,[ce,le]=d.useState([]),[Ae,vt]=d.useState(!1),[fe,Ne]=d.useState(null),[ze,Me]=d.useState(null),[qe,$e]=d.useState([new y({id:"left-wall",name:"Left Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWall"}),new y({id:"right-wall",name:"Right Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWall"}),new y({id:"top-wall",name:"Top Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWall"}),new y({id:"bottom-wall",name:"Bottom Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWall"}),new y({id:"left-door",name:"Left Door",cellsLong:1,cellsTall:1,icon:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fleft_door.png?alt=media&token=91fde31c-ebc6-4807-9670-f846c8d75cb6",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftDoor"}),new y({id:"right-door",name:"Right Door",cellsLong:1,cellsTall:1,icon:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fright_door.png?alt=media&token=8c6f3b4d-5e7a-4b9c-8d2f-0a3b5e6f7c8d",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightDoor"}),new y({id:"left-window",name:"Left Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWindow"}),new y({id:"right-window",name:"Right Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWindow"}),new y({id:"top-window",name:"Top Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWindow"}),new y({id:"bottom-window",name:"Bottom Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWindow"})]),Ge=d.useRef(null),[St,Fe]=d.useState(!1),[oe,re]=d.useState([]),[j,ae]=d.useState([]),[ot,Ve]=d.useState([]),[ve,ke]=d.useState([]),[Le,Te]=d.useState(!1),he=d.useRef(null),[Ze,Ye]=d.useState([]),[V,M]=d.useState([]),[w,ee]=d.useState(null),[O,de]=d.useState(!1),[Y,pe]=d.useState(!1),[Ie,Vt]=d.useState(!1),[Je,Zt]=d.useState(!1),[te,Yt]=d.useState(!1),[$,st]=d.useState("placing-sections"),[cl,Jt]=d.useState(!1),[Se,Ut]=d.useState(!1),[Ke,Ht]=d.useState(!1),[Ue,Xt]=d.useState(!1),[Qt,zt]=d.useState(!1),[De,bt]=d.useState(!1),[He,Xe]=d.useState(""),[_e,qt]=d.useState(null),[Oe,jt]=d.useState(""),[J,$t]=d.useState(""),[Kt,_t]=d.useState(null),[q,en]=d.useState(""),[it,tn]=d.useState(null),[at,et]=d.useState(""),[Lt,tt]=d.useState(""),[ne,Ce]=d.useState(null),[ct,Q]=d.useState(!0),[Tt,nn]=d.useState(null),[rt,ye]=d.useState(!1),[ln,on]=d.useState(null),[sn,At]=d.useState([]),[an,Pe]=d.useState(!1),[be,cn]=d.useState(null),[dt,rn]=d.useState(!1),[dn,mn]=d.useState(null),[mt,gn]=d.useState(null),gt=d.useRef(null),ut=d.useRef(null),ft=d.useRef(null),ht=d.useRef(null),pt=d.useRef(null),It=d.useRef(null);function we(n,e){for(const s of e)if(n.x>=s.cellId.x&&n.x<s.cellId.x+s.cellsLong&&n.y>=s.cellId.y&&n.y<s.cellId.y+s.cellsTall)return s;return null}function un(n,e,s,a){re([...n.map(o=>new P({name:o.name,cellId:new h({x:o.cellId.x,y:o.cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,modifierItems:o.modifierItems.map(l=>new z({cell:new h({x:l.cell.x,y:l.cell.y}),item:new y({...l.item,starterItem:!0})})),startingItems:[]}))]);let i=F,r=b;if(c){for(const u of n)console.log("Generating cells for section",u.name,"at",u.cellId,"with size",u.cellsLong,"x",u.cellsTall),console.log("Needed section Width:",(u.cellsLong+u.cellId.x)*k,"Current width:",i),(u.cellsLong+u.cellId.x)*k>i&&(console.log("Added section Width:",u.cellsLong*k+u.cellId.x),i+=(u.cellsLong+u.cellId.x)*k-i),console.log("Needed section Height:",(u.cellsTall+u.cellId.y)*k,"Current height:",r),(u.cellsTall+u.cellId.y)*k>r&&(console.log("Added section Height:",u.cellsTall*k+u.cellId.y),r+=(u.cellsTall+u.cellId.y)*k-r);A(r/k*2),T(i/k*2);let o=0;const l=[],g=[];for(const u of n){const f=[],S={width:u.cellsLong*k,height:u.cellsTall*k,sectionName:u.name};S.height>o&&(o=S.height),Ye(D=>[...D,S]),u.cellId.x=0,u.cellId.y=0,[...Array(S.height/k).keys()].map(D=>{const me=[];[...Array(S.width/k).keys()].map(se=>{me.push({id:new h({x:se,y:D}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:k})}),f.push(me)}),l.push({sectionName:u.name,cells:[...f]}),g.push(u)}M(l),ae(g),I(o),ee(n[0]?n[0].name:null),setTimeout(()=>{Q(!1)},500)}else{const o=[];for(const l of n)console.log("Generating cells for section",l.name,"at",l.cellId,"with size",l.cellsLong,"x",l.cellsTall),console.log("Needed section Width:",l.cellsLong+l.cellId.x,"Current width:",i),l.cellsLong+l.cellId.x>i&&(console.log("Added section Width:",l.cellsLong+l.cellId.x),i+=l.cellsLong+l.cellId.x-i),console.log("Needed section Height:",l.cellsTall+l.cellId.y,"Current height:",r),l.cellsTall+l.cellId.y>r&&(console.log("Added section Height:",l.cellsTall+l.cellId.y),r+=l.cellsTall+l.cellId.y-r);L(e.width),E(e.height),T(e.width),A(e.height),console.log("Final width:",i,"Final height:",r),[...Array(e.height).keys()].map(l=>{const g=[];[...Array(e.width).keys()].map(u=>{console.log("Creating cell at",u,l,"with size",k,s),g.push({id:new h({x:u,y:l}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:s&&a=="placing-sections"?!0:we(new h({x:u,y:l}),n)!=null,size:k})}),o.push(g)}),N([...o]),setTimeout(()=>{const l=[],g=[...n],u=[];for(const f of g)f.cellElement=document.querySelector(`.App #${f.cellId.toId()}.cell:not(.cell-border)`),l.push(...f.startingItems.map(S=>new z({cell:new h({x:f.cellId.x+S.cell.x,y:f.cellId.y+S.cell.y}),item:new y({...S.item,initialElement:document.querySelector(`.App #${S.cell.toId()}.cell:not(.cell-border)`),starterItem:!0})}))),l.push(...f.modifierItems.map(S=>new z({cell:new h({x:f.cellId.x+S.cell.x,y:f.cellId.y+S.cell.y}),item:new y({...S.item,initialElement:document.querySelector(`.App #${S.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1})}))),u.push(...f.booths.map(S=>new je({...S,cell:new h({x:f.cellId.x+S.cell.x,y:f.cellId.y+S.cell.y}),initialElement:document.querySelector(`.App #${S.cell.toId()}.cell:not(.cell-border)`)})));ae([...g]);for(const f of l){const S=se=>{const ge=se%2===1;return{cellsLong:ge?f.item.cellsTall:f.item.cellsLong,cellsTall:ge?f.item.cellsLong:f.item.cellsTall}},D=f.item.rotation||0,me=S(D);for(let se=0;se<me.cellsTall;se++)for(let ge=0;ge<me.cellsLong;ge++)o[f.cell.y+se][f.cell.x+ge].hasItem=!0,o[f.cell.y+se][f.cell.x+ge].itemId=f.item.id;f.item.initialElement=document.querySelector(`.App #${f.cell.toId()}.cell:not(.cell-border)`),v(se=>[...se,f.item])}for(const f of u){for(let S=0;S<f.cellsTall;S++)for(let D=0;D<f.cellsLong;D++)o[f.cell.y+S][f.cell.x+D].hasItem=!0,o[f.cell.y+S][f.cell.x+D].itemId=f.id;f.initialElement=document.querySelector(`.App #${f.cell.toId()}.cell:not(.cell-border)`),Ve(S=>[...S,f])}N([...o]),setTimeout(()=>{Q(!1)},500)},100)}}async function fn(){const n=new URLSearchParams(window.location.search),e=n.get("companyId"),s=n.get("areaId"),a=n.get("areaId")||"",i=n.get("companyId")||"",r=n.get("templateId")||"",o=await On(i,a);if(o===null){window.location.href="/LayItOut/DNF/";return}tn(o),on(o.previewImage||null);const l=n.get("type")||"";let g=!1,u=!1,f="modify-sections",S=!1,D=null;if(l==="public-preview"){bt(!0);const m=n.get("designName")||"";Xe(m);const p=n.get("designId")||"";et(p)}else if(l==="create-template")de(!0);else if(l==="edit-template"){pe(!0);const m=o.templates.find(p=>p.id===r);m&&(nn(m),jt(m.name))}else if(l==="view-design"){g=!0,Vt(!0);const m=n.get("designName")||"";Xe(m);const p=n.get("designId")||"";et(p)}else if(l==="view-area")Zt(!0);else if(l==="edit-design"){g=!0,Jt(!0);const m=n.get("designName")||"";Xe(m);const p=n.get("designId")||"";et(p)}else if(l==="client-edit-design"){g=!0,zt(!0);const m=n.get("designName")||"";Xe(m);const p=n.get("designId")||"";et(p)}else if(l==="create-area"){u=!0,Yt(!0);const m=n.get("stage");m==="placing-sections"?(f="placing-sections",st("placing-sections")):m==="modify-sections"?(st("modify-sections"),f="modify-sections",le(qe.map(p=>new ue({item:new y({...p,displayItem:!0}),quantity:-1})))):m==="placing-items"&&(st("placing-items"),f="placing-items",le(o.inventoryItems.map(p=>new ue({item:new y({...p.item,displayItem:!0}),quantity:p.quantity}))))}else if(l==="view-boothMap"){S=!0,Ut(!0);const m=n.get("boothMapId")||"";tt(m);const p=await nt(i,a,m);if(p===null){window.location.href="/LayItOut/DNF/";return}Ce(p),D=p}else if(l==="pick-booth"){S=!0,Xt(!0);const m=n.get("boothMapId")||"";tt(m);const p=await nt(i,a,m);if(p===null){window.location.href="/LayItOut/DNF/";return}Ce(p),D=p;const ie=n.get("vendorId")||"";if(ie!==""){const _=p.vendors.find(K=>K.id===ie);if(_){cn(_),console.log("Vendor found",_);let K=!1;D.sections.forEach(Tn=>{Tn.booths.forEach(An=>{An.user?.id===_.id&&(K=!0)})}),rn(K);const Ot=await Pn(i);if(Ot===null){window.location.href="/LayItOut/DNF/";return}_t(Ot)}else{window.location.href="/LayItOut/DNF/";return}}}else if(l==="create-boothMap"){S=!0,Ht(!0);const m=n.get("boothMapId")||"";tt(m);const p=await nt(i,a,m);if(p===null){window.location.href="/LayItOut/DNF/";return}Ce(p),D=p}else if(l==="public-preview-boothMap"){S=!0,bt(!0);const m=n.get("boothMapId")||"";tt(m);const p=n.get("designName")||"";Xe(p);const ie=await nt(i,a,m);if(ie===null){window.location.href="/LayItOut/DNF/";return}Ce(ie),D=ie}e&&$t(e),s&&en(s),u||le(o.inventoryItems.map(m=>new ue({item:new y({...m.item,displayItem:!0}),quantity:m.quantity})));const me=[],se=[];for(const m of o.templates){const p=[],ie=[];for(const _ of m.sections)p.push(new P({name:_.name,cellId:new h({x:_.cellId.x,y:_.cellId.y}),cellsLong:_.cellsLong,cellsTall:_.cellsTall,modifierItems:_.modifierItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new y({...K.item,starterItem:!0})})),startingItems:_.startingItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new y({...K.item,starterItem:!0})}))})),ie.push(new P({name:_.name,cellId:new h({x:_.cellId.x,y:_.cellId.y}),cellsLong:_.cellsLong,cellsTall:_.cellsTall,modifierItems:_.modifierItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new y({...K.item,starterItem:!0})})),startingItems:_.startingItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new y({...K.item,starterItem:!0})}))}));me.push(new xe({name:m.name,sections:p,inventoryItems:m.inventoryItems,id:m.id,previewImage:m.previewImage})),se.push(new xe({name:m.name,sections:ie,id:m.id,previewImage:m.previewImage,inventoryItems:m.inventoryItems}))}ke([...me]);const ge=[],We=r===""?void 0:se.find(m=>m.id===r);if(console.log("TEMPLATE",We,"AREA",o),S&&D)le(D.inventoryItems.map(m=>new ue({item:new y({...m.item,displayItem:!0}),quantity:m.quantity}))),re([...D.sections]),ae([...D.sections.map(m=>new P({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,booths:m.booths,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new y({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))]),ge.push(...D.sections.map(m=>new P({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,booths:m.booths,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new y({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))})));else if(g){const m=await Bn(i,a,n.get("designId")||"");if(m===null){window.location.href="/LayItOut/DNF/";return}qt(m),le(m.inventoryItems.map(p=>new ue({item:new y({...p.item,displayItem:!0}),quantity:p.quantity}))),re([...m.sections]),ae([...m.sections.map(p=>new P({name:p.name,cellId:new h({x:p.cellId.x,y:p.cellId.y}),cellsLong:p.cellsLong,cellsTall:p.cellsTall,startingItems:p.startingItems,modifierItems:p.modifierItems,items:p.startingItems.map(ie=>new y({...ie.item,sectionCell:new h({x:ie.cell.x,y:ie.cell.y})}))}))]),ge.push(...m.sections.map(p=>new P({name:p.name,cellId:new h({x:p.cellId.x,y:p.cellId.y}),cellsLong:p.cellsLong,cellsTall:p.cellsTall,startingItems:p.startingItems,modifierItems:p.modifierItems,items:p.startingItems.map(ie=>new y({...ie.item,sectionCell:new h({x:ie.cell.x,y:ie.cell.y})}))})))}else We!==void 0?(le(We.inventoryItems.map(m=>new ue({item:new y({...m.item,displayItem:!0}),quantity:m.quantity}))),re([...We.sections]),ae([...We.sections.map(m=>new P({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new y({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))]),ge.push(...We.sections.map(m=>new P({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,modifierItems:m.modifierItems,startingItems:m.startingItems,items:m.startingItems.map(p=>new y({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))})))):(re([...o.sections]),ae([...o.sections.map(m=>new P({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,modifierItems:m.modifierItems,startingItems:m.startingItems,items:m.startingItems.map(p=>new y({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))]),ge.push(...o.sections.map(m=>new P({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,modifierItems:m.modifierItems,items:m.startingItems.map(p=>new y({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))));console.log("SECTIONS TO GENERATE",ge),un(ge,o,l==="create-area",f)}d.useEffect(()=>{fn()},[]);function hn(n,e,s){if(!c||n==null)return;const a=[...s],i=[],r=[],o=s.find(l=>l.name==n);console.log("NEW SECTION",o),console.log("Adding section",o.name,o.cellId),console.log("MOBILE CELLS",e),o.cellElement=document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${o.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",o.cellElement);for(const l of o.startingItems){console.log("Placing starting item",l.item.name,l.cell);const g=S=>{const D=S%2===1;return{cellsLong:D?l.item.cellsTall:l.item.cellsLong,cellsTall:D?l.item.cellsLong:l.item.cellsTall}},u=l.item.rotation||0,f=g(u);for(let S=0;S<f.cellsTall;S++)for(let D=0;D<f.cellsLong;D++){const me=e.find(se=>se.sectionName===o.name);me.cells[l.cell.y+S][l.cell.x+D].hasItem=!0,me.cells[l.cell.y+S][l.cell.x+D].itemId=l.item.id}l.item.initialElement=document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",l.item.initialElement),i.push(new y({...l.item}))}for(const l of o.modifierItems){console.log("Placing starting item",l.item.name,l.cell);const g=S=>{const D=S%2===1;return{cellsLong:D?l.item.cellsTall:l.item.cellsLong,cellsTall:D?l.item.cellsLong:l.item.cellsTall}},u=l.item.rotation||0,f=g(u);for(let S=0;S<f.cellsTall;S++)for(let D=0;D<f.cellsLong;D++){const me=e.find(se=>se.sectionName===o.name);me.cells[l.cell.y+S][l.cell.x+D].hasItem=!0,me.cells[l.cell.y+S][l.cell.x+D].itemId=l.item.id}console.log("Adding item to items",document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`)),i.push(new y({...l.item,initialElement:document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1}))}console.log("Setting sections",a),ae([...a]),console.log("ITEMS",i),v(l=>[...l.filter(u=>!i.some(f=>f.id===u.id)),...i.map(u=>new y({...u,starterItem:!0}))]),r.push(...o.booths.map(l=>new je({...l,initialElement:document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`)})));for(const l of r){for(let g=0;g<l.cellsTall;g++)for(let u=0;u<l.cellsLong;u++){const f=e.find(S=>S.sectionName===o.name);f.cells[l.cell.y+g][l.cell.x+u].hasItem=!0,f.cells[l.cell.y+g][l.cell.x+u].itemId=l.id}Ve(g=>[...g,l])}}function Nt(n){let e=[];return n.map(s=>e=[...e,...s]),e}function pn(n,e){let s=!1;return e.sections.forEach(a=>{a.booths.forEach(i=>{i.user?.id===n.id&&(s=!0)})}),s}function yt(n,e){console.log(n);const s=c?V.find(o=>o.sectionName===w).cells:R,a=s[n.y].length,i=s.length;if(console.log(a,i),n.x+e.cellsLong>a||n.y+e.cellsTall>i)return!1;const r=we(n,j);if(!r&&!c&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;for(let o=0;o<e.cellsTall;o++)for(let l=0;l<e.cellsLong;l++){if(!c){const g=we(new h({x:n.x+l,y:n.y+o}),j);if(!g&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;if(g?.name!=r?.name&&($!=="placing-sections"||!te))return console.log("Item is crossing section boundaries"),!1}if(s[n.y+o][n.x+l].hasItem&&s[n.y+o][n.x+l].itemId!=e.id){console.log("Something is already here");const g=W.find(u=>u.id==s[n.y+o][n.x+l].itemId);if(g&&g.isSectionModifier){if(g.sectionModifierType==="LeftDoor"||g.sectionModifierType==="RightDoor")return console.log("Item is on door of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),!1;if(g.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),l==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==e.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==0&&l==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==0&&l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==e.cellsTall-1&&l==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==e.cellsTall-1&&l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function Mt(n,e,s){console.log(e),console.log("CELLS",n);const a=n[e.y].length,i=n.length;if(console.log(a,i),e.x+s.cellsLong>a||e.y+s.cellsTall>i)return!1;const r=we(e,j);if(!r&&!c&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;for(let o=0;o<s.cellsTall;o++)for(let l=0;l<s.cellsLong;l++){if(!c){const g=we(new h({x:e.x+l,y:e.y+o}),j);if(!g&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;if(g?.name!=r?.name&&($!=="placing-sections"||!te))return console.log("Item is crossing section boundaries"),!1}if(n[e.y+o][e.x+l].hasItem&&n[e.y+o][e.x+l].itemId!=s.id){console.log("Something is already here");const g=W.find(u=>u.id==n[e.y+o][e.x+l].itemId);if(g&&g.isSectionModifier){if(g.sectionModifierType==="LeftDoor"||g.sectionModifierType==="RightDoor")return console.log("Item is on door of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),!1;if(g.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),l==s.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==s.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==0&&l==s.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==0&&l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==s.cellsTall-1&&l==s.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==s.cellsTall-1&&l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function Ct(n,e,s){const a=Array.from(c?V.find(o=>o.sectionName===w).cells:R);if(Pe(!0),s!=null){console.log("Removing item",e.id,"from cell",s.toId());const o=c?j.find(l=>l.name===w):we(s,j);o.items=o.items.filter(l=>l.id!=e.id);for(let l=0;l<e.cellsTall;l++)for(let g=0;g<e.cellsLong;g++)a[s.y+l][s.x+g].hasItem=!1,a[s.y+l][s.x+g].itemId=""}const i=e.name+Math.floor(Math.random()*1e5).toString();if($!=="placing-sections"||!te){const o=c?j.find(g=>g.name===w):we(n,j),l=new h({x:n.x-o.cellId.x,y:n.y-o.cellId.y});e.sectionCell=l,console.log("Adding item to section",o.name,"at",l,e),o.items.push(Ae?new y({...e,id:i}):e)}else e.sectionCell=new h({x:n.x,y:n.y});for(let o=0;o<e.cellsTall;o++)for(let l=0;l<e.cellsLong;l++)a[n.y+o][n.x+l].hasItem=!0,a[n.y+o][n.x+l].itemId=e.id;if(console.log(a),c){const o=V.find(l=>l.sectionName===w);o&&(o.cells=a.map(l=>l.map(g=>({...g}))),M([...V]))}else N(a);console.log("Removing item from inventory",e.name,e.hasMoved);let r=!1;if(!e.hasMoved){console.log("INVENTORY ITEMs",ce);const o=ce.findIndex(l=>l.item.name==e.name&&!l.item.hasMoved);if(o!==-1){const l=[...ce];console.log("Found item in inventory",l[o]),l[o].quantity>0&&(l[o].quantity-=1,l[o].quantity<=0&&(r=!0,l.splice(o,1)),le(l))}else le(ce)}if(v(o=>(console.log("Placing item",e),console.log("Updating item",e.id),Ae&&fe&&e.id==fe.id?(console.log("Updating placing item",e.id),e.hasMoved=!0,e.starterItem=!0,e.isDisplayItem=!1,e.initialElement=document.querySelector(`.App #${n.toId()}.cell:not(.cell-border)`),console.log("New item id",i),[...o,new y({...e,hasMoved:!0,id:i})]):(o.find(l=>l.id==e.id).hasMoved||(o.find(l=>l.id==e.id).hasMoved=!0,o.find(l=>l.id==e.id).sectionCell=e.sectionCell),o))),Ae&&fe&&r){Ne(null);return}}function In(n){W.find(e=>e.name==n.name&&!e.hasMoved&&!e.starterItem)||v(e=>[...e,n])}d.useEffect(()=>{fe?(console.log("Adding placing item",fe.id),Me(fe.id)):(console.log("Removing placing item",ze),Me(""))},[fe]);function Et(n){console.log("Removing item",n.id),v(e=>e.filter(s=>s.id!=n.id))}function yn(n,e){const s=Array.from(c?V.find(o=>o.sectionName===w).cells:R);Pe(!0);const a=o=>{const l=o%2===1;return{cellsWide:l?n.cellsTall:n.cellsLong,cellsTall:l?n.cellsLong:n.cellsTall}},i=n.rotation||0,r=a(i);for(let o=0;o<r.cellsTall;o++)for(let l=0;l<r.cellsWide;l++)s[e.y+o][e.x+l].hasItem=!1,s[e.y+o][e.x+l].itemId="";if(c){const o=V.find(l=>l.sectionName===w);o&&(o.cells=s.map(l=>l.map(g=>({...g}))),M([...V])),M(l=>l.map(g=>g.sectionName===w?{...g,cells:s}:g))}else N(s);if($!=="placing-sections"||!te){const o=c?j.find(l=>l.name===w):we(e,j);o.items=o.items.filter(l=>l.id!=n.id),console.log("DELETING ITEM section",n.id),console.log("SECTION ITEMS AFTER DELETE",o.items)}v(o=>(console.log("Removing item new",n.id),console.log("ITEMS AFTER REMOVE",o.filter(l=>l.id!=n.id)),o.filter(l=>l.id!=n.id))),le(o=>{const l=o.findIndex(g=>g.item.name==n.name&&!g.item.hasMoved);if(l!==-1){const g=[...o];return g[l].quantity>0&&(g[l].quantity+=1),g}else return[...o,new ue({item:new y({...n,hasMoved:!1}),quantity:1})]})}function wn(n,e){const s=Array.from(c?V.find(g=>g.sectionName===w).cells:R);console.log("DELETING ITEM ROTATE",n.id,n.rotation),Pe(!0);const a=g=>{const u=g%2===1;return{cellsWide:u?n.cellsTall:n.cellsLong,cellsTall:u?n.cellsLong:n.cellsTall}},i=n.rotation||0,r=a(i);for(let g=0;g<r.cellsTall;g++)for(let u=0;u<r.cellsWide;u++)console.log("Deleting cell",e.y+g,e.x+u),s[e.y+g][e.x+u].hasItem=!1,s[e.y+g][e.x+u].itemId="";if(c){const g=V.find(u=>u.sectionName===w);g&&(g.cells=s.map(u=>u.map(f=>({...f}))),M([...V])),M(u=>u.map(f=>f.sectionName===w?{...f,cells:s}:f))}else N(s);console.log("DELETING ITEM",n.id);const o=c?j.find(g=>g.name===w):we(e,j);o.items=o.items.filter(g=>g.id!=n.id);const l=new h({x:e.x-o.cellId.x,y:e.y-o.cellId.y});n.sectionCell=l,o.items.push(n)}function Rt(n,e){const s=c?V.find(r=>r.sectionName===w).cells:R,a=Array.from(s);if(s[n.y]==null){console.log("Start cell is out of bounds",n),wt();return}const i=yt(n,e);a.forEach(r=>r.forEach(o=>{o.mouseOver=!1,o.canPlaceItem=!1,o.mouseOverLocation=""}));for(let r=0;r<e.cellsTall;r++)for(let o=0;o<e.cellsLong;o++)n.y+r<a.length&&n.x+o<a[n.y+r].length&&(e.cellsLong===1&&e.cellsTall===1?a[n.y+r][n.x+o].mouseOverLocation="single":e.cellsTall===1?o===0?a[n.y+r][n.x+o].mouseOverLocation="leftFull":o===e.cellsLong-1?a[n.y+r][n.x+o].mouseOverLocation="rightFull":a[n.y+r][n.x+o].mouseOverLocation="middleFull":e.cellsLong===1?r===0?a[n.y+r][n.x+o].mouseOverLocation="topFull":r===e.cellsTall-1?a[n.y+r][n.x+o].mouseOverLocation="bottomFull":a[n.y+r][n.x+o].mouseOverLocation="middleVFull":r===0&&o===0?a[n.y+r][n.x+o].mouseOverLocation="topLeftCorner":r===0&&o===e.cellsLong-1?a[n.y+r][n.x+o].mouseOverLocation="topRightCorner":r===e.cellsTall-1&&o===0?a[n.y+r][n.x+o].mouseOverLocation="bottomLeftCorner":r===e.cellsTall-1&&o===e.cellsLong-1?a[n.y+r][n.x+o].mouseOverLocation="bottomRightCorner":r===0?a[n.y+r][n.x+o].mouseOverLocation="top":r===e.cellsTall-1?a[n.y+r][n.x+o].mouseOverLocation="bottom":o===0?a[n.y+r][n.x+o].mouseOverLocation="left":o===e.cellsLong-1?a[n.y+r][n.x+o].mouseOverLocation="right":a[n.y+r][n.x+o].mouseOverLocation="middle",a[n.y+r][n.x+o].mouseOver=!0,a[n.y+r][n.x+o].canPlaceItem=i);if(c){const r=V.find(o=>o.sectionName===w);r&&(r.cells=a.map(o=>o.map(l=>({...l}))),M([...V])),M(o=>o.map(l=>l.sectionName===w?{...l,cells:a}:l))}else N(a)}function wt(){console.log("Unhighlighting cells");const n=Array.from(c?V.find(e=>e.sectionName===w).cells:R);if(n.forEach(e=>e.forEach(s=>{s.mouseOver=!1,s.canPlaceItem=!1,s.mouseOverLocation=""})),c){const e=V.find(s=>s.sectionName===w);e&&(e.cells=n.map(s=>s.map(a=>({...a}))),M([...V])),M(s=>s.map(a=>a.sectionName===w?{...a,cells:n}:a))}else N(n)}d.useEffect(()=>{hn(w,V,j)},[w]),d.useEffect(()=>{const n=()=>{const e=W.find(s=>s.id===x);console.log("Unselecting item",x),Z(null),e&&(H(s=>[...s,e.id]),console.log("Unselecting item",e.id),setTimeout(()=>{H(s=>s.filter(a=>a!==e.id))},300))};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[x,W]);function kt(n){Z(null),H(e=>[...e,n]),console.log("Unselecting item",n),setTimeout(()=>{H(e=>e.filter(s=>s!==n))},300)}function Dt(n){const e=W.find(s=>s.id===x);console.log("Unselecting item",x),Z(n),e&&(H(s=>[...s,e.id]),console.log("Unselecting item",e.id),setTimeout(()=>{H(s=>s.filter(a=>a!==e.id))},300))}function xt(n){le(e=>[...e,n])}const Be=n=>{console.log("Preventing scroll"),n.preventDefault(),n.stopPropagation(),window.scrollTo(0,0)};d.useEffect(()=>(rt?(window.addEventListener("scroll",Be),window.addEventListener("touchmove",Be,{passive:!1})):(window.removeEventListener("scroll",Be),window.removeEventListener("touchmove",Be)),()=>{window.removeEventListener("scroll",Be),window.removeEventListener("touchmove",Be)}),[rt]);async function xn(n){const e=[];Q(!0);for(const i of n){const r=i.name,o=new h({x:i.sectionCell.x,y:i.sectionCell.y}),l=new P({name:r,cellId:o,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:[],startingItems:[],items:[]});e.push(l)}let s=0,a=0;for(const i of e)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",i.cellsLong+i.cellId.x,"Current width:",s),i.cellsLong+i.cellId.x>s&&(console.log("Added section Width:",i.cellsLong+i.cellId.x),s+=i.cellsLong+i.cellId.x-s),console.log("Needed section Height:",i.cellsTall+i.cellId.y,"Current height:",a),i.cellsTall+i.cellId.y>a&&(console.log("Added section Height:",i.cellsTall+i.cellId.y),a+=i.cellsTall+i.cellId.y-a);await Wn(J,q,e,s,a),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=create-area&stage=modify-sections`}async function vn(n,e){const s=[];Q(!0);for(const a of e){const i=a.name,r=new h({x:a.cellId.x,y:a.cellId.y});console.log("Saving section modifier items for section",i,a.items.map(l=>l.name),"at cell",r);const o=new P({name:i,cellId:r,cellsLong:a.cellsLong,cellsTall:a.cellsTall,startingItems:[],items:[],modifierItems:a.items.map(l=>new z({cell:new h({x:l.sectionCell.x,y:l.sectionCell.y}),item:new y({...l,isSectionModifier:!0})}))});s.push(o)}console.log("Saving section modifier items",s),await Gn(J,q,s),console.log("Section modifier items saved successfully"),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=create-area&stage=placing-items`}async function Sn(n,e){Q(!0);const s=[];for(const a of n){const i=a.name,r=new h({x:a.cellId.x,y:a.cellId.y}),o=new P({name:i,cellId:r,cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(l=>new z({cell:new h({x:l.sectionCell.x,y:l.sectionCell.y}),item:new y({...l,starterItem:!0})})),items:[]});s.push(o)}console.log("Saving area sections",s),localStorage.setItem("screenshotSections",s.map(a=>JSON.stringify(a.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",s.map(a=>JSON.stringify(a.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async a=>{if(console.log("Storage event",a),a.key==="screenshot"){const i=new Fn({id:q,name:it.name,sections:s,templates:[],previewImage:a.newValue,width:it.width,height:it.height,inventoryItems:e.map(r=>new ue({item:new y({...r.item,starterItem:!0}),quantity:r.quantity}))});await Vn(J,i),console.log("Area saved successfully"),Q(!1),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=view-area`}})}function bn(n){const e=Array.from(c?V.find(s=>s.sectionName===w).cells:R);if(e[n.y]!=null)if(e[n.y][n.x].mouseOver=!0,e[n.y][n.x].canPlaceItem=!0,e[n.y][n.x].mouseOverLocation="single",At(s=>[...s,n]),c){const s=V.find(a=>a.sectionName===w);s&&(s.cells=e.map(a=>a.map(i=>({...i}))),M([...V])),M(a=>a.map(i=>i.sectionName===w?{...i,cells:e}:i))}else console.log("Adding highlighted cell",n.toId()),N(e)}function jn(n){const e=Array.from(c?V.find(o=>o.sectionName===w).cells:R);Pe(!0);const s=[];sn.forEach(o=>{s.some(l=>l.toId()===o.toId())||s.push(o)}),At([]);const a=[],i=ce.findIndex(o=>o.item.name==n.name&&!o.item.hasMoved);let r=i!==-1?ce[i].quantity:0;s.forEach(o=>{const l=new y({...n});if(l.id=l.name+Math.floor(Math.random()*1e5).toString(),console.log("Placing item",l.name,"at",o.toId(),"CAN PLACE?",Mt(e,o,l)),Mt(e,o,l)&&r!=0){if(i!==-1&&(r-=1),$!=="placing-sections"||!te){const u=c?j.find(S=>S.name===w):we(o,j);console.log("Adding item to section",u.name,"at",u.cellId,"with cell",o.toId(),o.x-u.cellId.x,o.y-u.cellId.y);const f=new h({x:o.x-u.cellId.x,y:o.y-u.cellId.y});l.sectionCell=f,console.log("Adding item to section",u.name,"at",f,l),u.items.push(l),console.log("SECTION ITEMS",u.items.map(S=>S.name))}else l.sectionCell=new h({x:o.x,y:o.y});for(let u=0;u<n.cellsTall;u++)for(let f=0;f<n.cellsLong;f++)e[o.y+u][o.x+f].hasItem=!0,e[o.y+u][o.x+f].itemId=l.id;l.hasMoved=!0,l.starterItem=!0,l.isDisplayItem=!1,l.initialElement=document.querySelector(`.App #${o.toId()}.cell:not(.cell-border)`);const g=new y({...l});a.push(g)}});for(const o of a)console.log("Adding item to items",o.id),v(l=>[...l,o]);if(i!==-1&&le(o=>{const l=[...o];return l[i].quantity>0&&(l[i].quantity=r,l[i].quantity==0&&l.splice(i,1)),l}),r==0&&Ne(null),c){const o=V.find(l=>l.sectionName===w);o&&(o.cells=e.map(l=>l.map(g=>({...g}))),M([...V])),M(l=>l.map(g=>g.sectionName===w?{...g,cells:e}:g))}else N(e);ae(j)}function Ln(n,e,s){Q(!0);const a=[];for(const i of n){const r=i.name,o=new h({x:i.cellId.x,y:i.cellId.y}),l=i.items.filter(f=>f.isBooth),g=i.items.filter(f=>!f.isBooth),u=new P({name:r,cellId:o,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:g.map(f=>new z({cell:new h({x:f.sectionCell.x,y:f.sectionCell.y}),item:new y({...f,displayItem:!0})})),booths:l.map(f=>new je({id:f.name+Math.floor(Math.random()*1e5).toString(),name:f.name,cell:new h({x:f.sectionCell.x,y:f.sectionCell.y}),cellsLong:f.cellsLong,cellsTall:f.cellsTall,user:f.boothUser})),items:[]});a.push(u)}console.log("Saving area sections",a),localStorage.setItem("screenshotSections",a.map(i=>JSON.stringify(i.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",a.map(i=>JSON.stringify(i.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async i=>{if(console.log("Storage event",i),i.key==="screenshot"){const r=new Ee({id:s.id,name:s.name,sections:a,areaId:q,previewImage:i.newValue,inventoryItems:e.map(o=>new ue({item:new y({...o.item,starterItem:!0}),quantity:o.quantity}))});await Re(J,r),console.log("Booth Map saved successfully"),Q(!1),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=view-boothMap&boothMapId=${Lt}`}})}return console.log("RENDERING APP",!(te&&$!="placing-items")),t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"App",children:[t.jsx("h1",{className:"title",children:"LayItOut"}),t.jsx("br",{}),Ue&&t.jsxs("div",{className:"area-creation",children:[dt?t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"area-creation-title",children:"You have already picked a booth"}),t.jsxs("label",{htmlFor:"",children:["Contact ",Kt?.supportEmail," to change booths"]})]}):t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"area-creation-title",children:"Picking Booth"}),t.jsx("label",{htmlFor:"",children:"Tap on an open booth then click on the checkmark to pick a booth"})," "]}),t.jsxs("label",{htmlFor:"",children:["Booth Size: ",be?.plotWidth,"ft x ",be?.plotHeight,"ft"]}),t.jsx("br",{})]}),Ke&&t.jsxs("div",{className:"area-creation",children:[t.jsx("h2",{className:"area-creation-title",children:"Create Booth Map"}),t.jsx("label",{htmlFor:"",children:"Create a booth map by placing items and then creating and placing booths, same way you create and place items"})]}),te&&t.jsxs("div",{className:"area-creation",children:[t.jsx("h2",{className:"area-creation-title",children:"Create Area"}),t.jsx("label",{htmlFor:"",children:$=="placing-sections"?"Create new sections and place them":$=="modify-sections"?"Add walls and doors to sections":"Add items to the inventory and place items"})]}),(O||Y)&&t.jsxs("div",{className:"template-name-row",children:[t.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),t.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:n=>jt(n.target.value),value:Oe})]}),(Ie||De)&&t.jsx("div",{className:"design-name-row",children:t.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",He]})}),(O||Y)&&t.jsxs("div",{className:"template-creation",children:[t.jsxs("button",{className:"action-btn",onClick:()=>{if(Oe.trim()==""){alert("Please enter a template name");return}if(ve.some(n=>n.name===Oe&&(Y?n.id!==Tt.id:!0))){alert("Template with this name already exists");return}Y?(Q(!0),setTimeout(async()=>{const n=j.map(e=>new P({name:e.name,cellId:new h({x:oe.find(s=>s.name==e.name).cellId.x,y:oe.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new y({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){ye(!1);const s=ve.map(a=>a.id===Tt.id?(console.log("SECTION",j),new xe({name:Oe,inventoryItems:ce,previewImage:e.newValue,sections:j.map(i=>new P({name:i.name,cellId:new h({x:a.sections.find(r=>r.name==i.name).cellId.x,y:a.sections.find(r=>r.name==i.name).cellId.y}),cellsLong:i.cellsLong,modifierItems:i.modifierItems,cellsTall:i.cellsTall,startingItems:i.items.map(r=>new z({cell:new h({x:r.sectionCell.x,y:r.sectionCell.y}),item:new y({...r,starterItem:!0})}))})),id:a.id})):new xe({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(i=>new P({name:i.name,cellId:new h({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(r=>new z({cell:new h({x:r.cell.x,y:r.cell.y}),item:new y({...r.item})}))})),id:a.id}));Qe(J,q,s).then(()=>{console.log("Template updated successfully"),Q(!1);const a=new URLSearchParams(window.location.search),i=a.get("companyId"),r=a.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${i}&areaId=${r}&type=view-area`})}})},500)):(Q(!0),setTimeout(async()=>{const n=j.map(e=>new P({name:e.name,cellId:new h({x:oe.find(s=>s.name==e.name).cellId.x,y:oe.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new y({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){ye(!1);const s=new xe({name:Oe,previewImage:e.newValue,inventoryItems:ce,sections:j.map(i=>new P({name:i.name,cellId:new h({x:oe.find(r=>r.name==i.name).cellId.x,y:oe.find(r=>r.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.items.map(r=>new z({cell:new h({x:r.sectionCell.x,y:r.sectionCell.y}),item:new y({...r,starterItem:!0})}))})),id:Oe+(Math.random()*1e4).toString()}),a=[...ve.map(i=>new xe({name:i.name,previewImage:i.previewImage,inventoryItems:i.inventoryItems,sections:i.sections.map(r=>new P({name:r.name,cellId:new h({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,modifierItems:r.modifierItems,startingItems:r.startingItems.map(o=>new z({cell:new h({x:o.cell.x,y:o.cell.y}),item:new y({...o.item})}))})),id:i.id})),s];Qe(J,q,a).then(()=>{console.log("Template updated successfully"),Q(!1);const i=new URLSearchParams(window.location.search),r=i.get("companyId"),o=i.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${r}&areaId=${o}&type=view-area`})}})},500))},children:[O?"Create":"Save"," Template"]}),t.jsx("button",{className:"action-btn",onClick:()=>{const n=new URLSearchParams(window.location.search),e=n.get("companyId"),s=n.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${e}&areaId=${s}&type=view-area`},children:"Cancel"})]}),Qt&&t.jsxs("div",{className:"template-creation",children:[an&&t.jsx("button",{className:"action-btn",onClick:()=>{Q(!0),setTimeout(async()=>{const n=j.map(e=>new P({name:e.name,cellId:new h({x:oe.find(s=>s.name==e.name).cellId.x,y:oe.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new y({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){ye(!1);const s=new Bt({name:He,previewImage:e.newValue,areaId:q,inventoryItems:ce,sections:j.map(a=>new P({name:a.name,cellId:new h({x:oe.find(i=>i.name==a.name).cellId.x,y:oe.find(i=>i.name==a.name).cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(i=>new z({cell:new h({x:i.sectionCell.x,y:i.sectionCell.y}),item:new y({...i,starterItem:!0})}))})),id:at});Wt(J,q,s).then(()=>{console.log("Design updated successfully"),Pe(!1),Q(!1)})}})},500)},children:"Save"}),t.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),!Ie&&!Je&&!Se&&!Ue&&!De&&t.jsxs("div",{className:"place-mode-row",children:[t.jsx("label",{htmlFor:"tap-and-place-mode",children:"Place Mode: "}),t.jsxs("select",{id:"tap-and-place-mode",name:"tap-and-place-mode",value:Ae?"tap":"drag",onChange:n=>vt(n.target.value==="tap"),className:"place-mode-select",children:[t.jsx("option",{value:"drag",children:"Drag and Drop"}),t.jsx("option",{value:"tap",children:"Tap and Place"})]})]}),ct&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader-backdrop",children:t.jsx("div",{className:"loader"})})})," ",t.jsxs("div",{className:"layout",children:[!Ie&&!Je&&!Se&&!Ue&&!De&&t.jsx(Un,{setSelectedItem:Ne,tapAndPlaceMode:Ae,isModifyingSections:te&&$=="modify-sections",isViewingDesign:Ie,isEditingTemplate:Y,isCreatingTemplate:O,maxHeight:c?200:b*k,showAddCustomItem:()=>{$=="placing-sections"&&te?ut.current?.showModal():$=="placing-items"&&te?ft.current?.showModal():gt.current?.showModal()},addDraggingItem:In,removeItem:Et,inventoryItems:ce.map(n=>new ue({item:new y({...n.item,displayItem:!0}),quantity:n.quantity}))}),Se&&ne?t.jsx(nl,{onDeleteVendor:async n=>{Q(!0);const e=new Ee({...ne,vendors:ne.vendors.filter(s=>s.id!==n),sections:ne.sections.map(s=>new P({...s,booths:s.booths.map(a=>a.user?.id===n?new je({...a,user:null,initialElement:a.initialElement??void 0}):a)}))});await Re(J,e),Ce(e),window.location.reload()},onEditVendor:n=>{mn(n),pt.current?.showModal()},boothMap:ne,vendors:ne?.vendors??[],maxHeight:c?void 0:b*k,onAddVendor:()=>{ht.current?.showModal()}}):null,c?t.jsxs("div",{className:"mobile-areas",style:{height:U+"px"},children:[j.length>1&&t.jsx("img",{src:lt,onClick:()=>{const n=j.findIndex(s=>s.name==w);if(n===-1)return;const e=(n-1+j.length)%j.length;ee(j[e].name),console.log("Changing viewing section to",j[e].name)},className:"back-mobile-areas"}),Ze.map((n,e)=>t.jsx(Pt,{width:n.width,height:n.height,cells:Nt(V.find(s=>s.sectionName==n.sectionName).cells),id:n.sectionName,visibile:w==null?!0:n.sectionName==w,section:n.sectionName},e)),j.length>1&&t.jsx("img",{src:lt,onClick:()=>{const n=j.findIndex(s=>s.name==w);if(n===-1)return;const e=(n+1)%j.length;ee(j[e].name),console.log("Changing viewing section to",j[e].name)},className:"forward-mobile-areas"})]}):t.jsx(Pt,{width:F*k,height:b*k,cells:Nt(R)}),($=="placing-items"||!te)&&t.jsx(sl,{maxHeight:c?void 0:b*k})]}),Se&&t.jsx("div",{className:"design-view",children:t.jsx("button",{className:"action-btn",onClick:()=>{const n=j.map(e=>new P({name:e.name,cellId:new h({x:oe.find(s=>s.name==e.name).cellId.x,y:oe.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,booths:e.booths,startingItems:e.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new y({...s,starterItem:!0})}))}));localStorage.setItem("printSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/LayItOut/Print/?companyId=${J}&areaId=${q}&designName=${ne?.name}`,"_blank")},children:"Print"})}),Ie&&t.jsxs("div",{className:"design-view",children:[t.jsx("button",{className:"action-btn",onClick:()=>{const n=j.map(e=>new P({name:e.name,cellId:new h({x:oe.find(s=>s.name==e.name).cellId.x,y:oe.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,booths:e.booths,startingItems:e.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new y({...s,starterItem:!0})}))}));localStorage.setItem("printSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/LayItOut/Print/?companyId=${J}&areaId=${q}&designName=${He}&designId=${at}`,"_blank")},children:"Print"}),t.jsx("button",{className:"action-btn",onClick:()=>{const n=new xe({name:He,previewImage:_e.previewImage,inventoryItems:_e.inventoryItems,sections:_e.sections,id:_e.name+(Math.random()*1e4).toString()}),e=[...ve.map(s=>new xe({name:s.name,previewImage:s.previewImage,inventoryItems:s.inventoryItems,sections:s.sections.map(a=>new P({name:a.name,cellId:new h({x:a.cellId.x,y:a.cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.startingItems.map(i=>new z({cell:new h({x:i.cell.x,y:i.cell.y}),item:new y({...i.item})}))})),id:s.id})),n];Qe(J,q,e).then(()=>{console.log("Template updated successfully"),ke(e),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=edit-template&templateId=${n.id}`})},children:"Turn into a Template"}),t.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=desings"},children:"Back"})]}),Se&&t.jsx("div",{className:"design-view",children:t.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=boothmaps"},children:"Back"})}),Je&&t.jsx("div",{className:"design-view",children:t.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=areas"},children:"Back"})}),te&&t.jsxs("div",{className:"design-view",children:[t.jsx("button",{className:"action-btn",onClick:()=>{$=="placing-sections"?xn(W.filter(n=>n.isSectionItem)):$=="modify-sections"?vn(W.filter(n=>n.isSectionModifier),j):$=="placing-items"&&Sn(j,ce)},children:$=="placing-items"?"Create Area":"Next"}),t.jsx("button",{className:"action-btn",onClick:async()=>{Q(!0),await kn(J,q),window.location.href="/LayItOut/"},children:"Cancel"})]}),Ke&&t.jsxs("div",{className:"design-view",children:[t.jsx("button",{className:"action-btn",onClick:()=>{console.log("Creating booth map with sections",j,"and inventory items",ce,"and boothMap",ne),Ln(j,ce,ne)},children:"Create Booth Map"}),t.jsx("button",{className:"action-btn",onClick:async()=>{Q(!0),await Dn(J,q,Lt),window.location.href="/LayItOut/?view=boothmaps"},children:"Cancel"})]})]}),t.jsxs("div",{children:[j.map(n=>t.jsx(Mn,{takingPhoto:!1,section:n,visible:w==null?!0:n.name==w,cellSize:k},n.cellId.toId())),W.map(n=>t.jsx(Cn,{isPlacingItem:fe!=null,isCreatingArea:te,isCreatingTemplate:O||Y,cellSize:k,isViewingDesign:Ie||Je||Se||Ue||De,removeItem:Et,visible:c?!n.hasMoved&&!n.starterItem?!0:w==null?!1:n.isSectionModifier?j.find(e=>e.name==w)?.modifierItems.some(e=>e.item.id===n.id):n.starterItem?j.find(e=>e.name==w)?.startingItems.some(e=>e.item.id===n.id):j.find(e=>e.name==w)?.items.some(e=>e.id===n.id):!0,item:n,canPlaceItem:yt,placeItem:Ct,deleteItemRotate:wn,highlightCells:Rt,unHighlightCells:wt,deleteItem:yn,isSelected:x===n.id,onSelect:Dt,isUnselecting:X.includes(n.id),onDeselect:()=>kt(n.id)},n.id)),ot.map(n=>(console.log("CAN PICK BOOTH",n.cellsLong==be?.plotWidth&&n.cellsTall==be.plotHeight,"BOOTH",n,"VENDOR",be),t.jsx(En,{canPick:Se||dt||n.cellsLong==be?.plotWidth&&n.cellsTall==be.plotHeight,visible:c?w==null?!1:j.find(e=>e.name==w)?.booths.some(e=>e.id===n.id)??!1:!0,booth:n,isViewingBooth:Se,isPublicViewingBooth:De,hasPickedBooth:dt,isSelected:x==n.id,cellSize:k,onSelect:Dt,isUnselecting:X.includes(n.id),onDeselect:()=>kt(n.id),onPickBooth:async e=>{Q(!0);const s=j.map(i=>i.name===w?new P({...i,booths:i.booths.map(r=>r.id===e?new je({...r,user:be,initialElement:r.initialElement??void 0}):r)}):i.booths.some(r=>r.id===e)?new P({...i,booths:i.booths.map(r=>r.id===e?new je({...r,user:be,initialElement:r.initialElement??void 0}):r)}):i);console.log("Updated sections",s),ae(s);const a=new Ee({...ne,sections:s});await Re(J,a),window.location.reload(),Q(!1)},onRemoveVendorFromBooth:()=>{Q(!0);const e=j.map(a=>new P({...a,booths:a.booths.map(i=>i.user?.id===n.user?.id?new je({...i,user:null,initialElement:i.initialElement??void 0}):i)})),s=new Ee({...ne,sections:e});Re(J,s).then(()=>{window.location.reload()})},onAddVendorToBooth:()=>{gn(n),It.current?.showModal()}},n.id)))]}),c&&!ct&&t.jsx("div",{className:"layout-icon",onClick:()=>{Ge.current?.showModal(),Fe(!0),console.log("Showing layout dialog")},children:t.jsx("img",{src:Xn,alt:""})}),!ct&&!(O||Y||Ie||Ke||te||Se||Ue||De)&&t.jsx("div",{className:"template-icon",onClick:()=>{he.current?.showModal(),Te(!0),console.log("Showing template dialog")},children:t.jsx("img",{src:Qn,alt:""})}),t.jsx(zn,{isViewingArea:Je,dialogRef:he,isOpen:Le,closeDialog:()=>{he.current?.close(),Te(!1)},duplicateTemplate:n=>{const e=new xe({name:n.name+" Copy",previewImage:n.previewImage,inventoryItems:n.inventoryItems,sections:n.sections,id:n.name+"Copy"+(Math.random()*1e4).toString()}),s=[...ve.map(a=>new xe({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(i=>new P({name:i.name,cellId:new h({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(r=>new z({cell:new h({x:r.cell.x,y:r.cell.y}),item:new y({...r.item})}))})),id:a.id})),e];Qe(J,q,s).then(()=>{he.current?.close(),console.log("Template updated successfully"),ke(s),Te(!1),window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=edit-template&templateId=${e.id}`})},templates:ve,selectTemplate:n=>{Q(!0),setTimeout(async()=>{const e=n.sections.map(s=>new P({name:s.name,cellId:new h({x:n.sections.find(a=>a.name==s.name).cellId.x,y:n.sections.find(a=>a.name==s.name).cellId.y}),cellsLong:s.cellsLong,cellsTall:s.cellsTall,modifierItems:s.modifierItems,startingItems:s.startingItems.map(a=>new z({cell:new h({x:a.cell.x,y:a.cell.y}),item:new y({...a.item,starterItem:!0})}))}));localStorage.setItem("screenshotSections",e.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async s=>{if(console.log("Storage event",s),s.key==="screenshot"){ye(!1);const a=new Bt({name:He,previewImage:s.newValue,areaId:q,inventoryItems:n.inventoryItems,sections:n.sections.map(i=>new P({name:i.name,cellId:new h({x:n.sections.find(r=>r.name==i.name).cellId.x,y:n.sections.find(r=>r.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(r=>new z({cell:new h({x:r.cell.x,y:r.cell.y}),item:new y({...r.item,starterItem:!0})}))})),id:at});console.log("UPDATED DESIGN",a),Wt(J,q,a).then(()=>{console.log("Design updated successfully"),Pe(!1),Q(!1),window.location.reload()})}})},500)}}),t.jsx(Hn,{dialogRef:Ge,closeDialog:()=>{Ge.current?.close(),Fe(!1)},areaPreview:ln||""}),t.jsx(qn,{canBeBooth:Ke,dialogRef:gt,addInventoryItem:xt,closeDialog:()=>{gt.current?.close()}}),t.jsx($n,{dialogRef:ut,closeDialog:()=>{ut.current?.close()},addSection:xt}),t.jsx(Kn,{dialogRef:ft,closeDialog:()=>{ft.current?.close()},addInventoryItem:xt}),t.jsx(_n,{placeMultiItem:jn,addHighlightedCell:bn,item:fe,setSelectingItem:()=>{Ne(null)},canPlaceItem:yt,placeItem:Ct,highlightCells:Rt,unHighlightCells:wt,cellSize:k}),t.jsx(ll,{dialogRef:ht,closeDialog:()=>{ht.current?.close()},addVendor:async n=>{const e=new Ee({...ne,vendors:[...ne.vendors,n]});Ce(e),await Re(J,e)}}),t.jsx(ol,{oldVendor:dn,dialogRef:pt,closeDialog:()=>{pt.current?.close()},editVendor:async n=>{const e=new Ee({...ne,vendors:ne.vendors.map(s=>s.id===n.id?n:s)});Ce(e),await Re(J,e)}}),t.jsx(il,{dialogRef:It,vendors:ne?.vendors.filter(n=>!pn(n,ne))??[],closeDialog:()=>{It.current?.close()},addVendorToBooth:async n=>{Q(!0);const e=j.map(a=>a.name===w?new P({...a,booths:a.booths.map(i=>i.id===mt.id?new je({...i,user:n,initialElement:i.initialElement??void 0}):i)}):a.booths.some(i=>i.id===mt.id)?new P({...a,booths:a.booths.map(i=>i.id===mt.id?new je({...i,user:n,initialElement:i.initialElement??void 0}):i)}):a);console.log("Updated sections",e),ae(e);const s=new Ee({...ne,sections:e});await Re(J,s),window.location.reload(),Q(!1)}}),rt&&t.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:window.location.origin+"/LayItOut/Preview/",width:C*k+20,height:G*k+20})]})}
