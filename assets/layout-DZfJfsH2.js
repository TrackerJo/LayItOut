import{c as ft,j as p,r as y}from"./index-QIV6qY6h.js";import{A as Ce,S as It,D as pt}from"./section-B7tSJiIr.js";import{_ as ht,C as yt,r as Me,b as wt,e as Tt,f as Lt,h as Te,i as xt,j as vt,p as St,u as bt,F as Nt,k as At,S as j,l as w,m as _,I as b,T as Q,s as Ue,D as Et,n as Ot,o as ye,q as kt,t as Dt}from"./firestore-DkNIo3aX.js";import{T as Pt,F as Fe,L as Rt,a as jt,b as Ct,c as Mt,A as Ut}from"./add_custom_item_dialog-C5K1_xfi.js";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ft="type.googleapis.com/google.protobuf.Int64Value",_t="type.googleapis.com/google.protobuf.UInt64Value";function Je(n,c){const d={};for(const g in n)n.hasOwnProperty(g)&&(d[g]=c(n[g]));return d}function re(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(c=>re(c));if(typeof n=="function"||typeof n=="object")return Je(n,c=>re(c));throw new Error("Data cannot be encoded in JSON: "+n)}function Z(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case Ft:case _t:{const c=Number(n.value);if(isNaN(c))throw new Error("Data cannot be decoded from JSON: "+n);return c}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(c=>Z(c)):typeof n=="function"||typeof n=="object"?Je(n,c=>Z(c)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Le="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _e={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class M extends Nt{constructor(c,d,g){super(`${Le}/${c}`,d||""),this.details=g,Object.setPrototypeOf(this,M.prototype)}}function $t(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function me(n,c){let d=$t(n),g=d,f;try{const T=c&&c.error;if(T){const L=T.status;if(typeof L=="string"){if(!_e[L])return new M("internal","internal");d=_e[L],g=L}const h=T.message;typeof h=="string"&&(g=h),f=T.details,f!==void 0&&(f=Z(f))}}catch{}return d==="ok"?null:new M(d,g,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(c,d,g,f){this.app=c,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,wt(c)&&c.settings.appCheckToken&&(this.serverAppAppCheckToken=c.settings.appCheckToken),this.auth=d.getImmediate({optional:!0}),this.messaging=g.getImmediate({optional:!0}),this.auth||d.get().then(T=>this.auth=T,()=>{}),this.messaging||g.get().then(T=>this.messaging=T,()=>{}),this.appCheck||f?.get().then(T=>this.appCheck=T,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(c){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const d=c?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return d.error?null:d.token}return null}async getContext(c){const d=await this.getAuthToken(),g=await this.getMessagingToken(),f=await this.getAppCheckToken(c);return{authToken:d,messagingToken:g,appCheckToken:f}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const we="us-central1",Jt=/^data: (.*?)(?:\n|$)/;function Ht(n){let c=null;return{promise:new Promise((d,g)=>{c=setTimeout(()=>{g(new M("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{c&&clearTimeout(c)}}}class Vt{constructor(c,d,g,f,T=we,L=(...h)=>fetch(...h)){this.app=c,this.fetchImpl=L,this.emulatorOrigin=null,this.contextProvider=new qt(c,d,g,f),this.cancelAllRequests=new Promise(h=>{this.deleteService=()=>Promise.resolve(h())});try{const h=new URL(T);this.customDomain=h.origin+(h.pathname==="/"?"":h.pathname),this.region=we}catch{this.customDomain=null,this.region=T}}_delete(){return this.deleteService()}_url(c){const d=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${d}/${this.region}/${c}`:this.customDomain!==null?`${this.customDomain}/${c}`:`https://${this.region}-${d}.cloudfunctions.net/${c}`}}function Wt(n,c,d){const g=vt(c);n.emulatorOrigin=`http${g?"s":""}://${c}:${d}`,g&&(St(n.emulatorOrigin),bt("Functions",!0))}function Yt(n,c,d){const g=f=>Gt(n,c,f,{});return g.stream=(f,T)=>Xt(n,c,f,T),g}async function Bt(n,c,d,g){d["Content-Type"]="application/json";let f;try{f=await g(n,{method:"POST",body:JSON.stringify(c),headers:d})}catch{return{status:0,json:null}}let T=null;try{T=await f.json()}catch{}return{status:f.status,json:T}}async function He(n,c){const d={},g=await n.contextProvider.getContext(c.limitedUseAppCheckTokens);return g.authToken&&(d.Authorization="Bearer "+g.authToken),g.messagingToken&&(d["Firebase-Instance-ID-Token"]=g.messagingToken),g.appCheckToken!==null&&(d["X-Firebase-AppCheck"]=g.appCheckToken),d}function Gt(n,c,d,g){const f=n._url(c);return zt(n,f,d,g)}async function zt(n,c,d,g){d=re(d);const f={data:d},T=await He(n,g),L=g.timeout||7e4,h=Ht(L),N=await Promise.race([Bt(c,f,T,n.fetchImpl),h.promise,n.cancelAllRequests]);if(h.cancel(),!N)throw new M("cancelled","Firebase Functions instance was deleted.");const O=me(N.status,N.json);if(O)throw O;if(!N.json)throw new M("internal","Response is not valid JSON object.");let v=N.json.data;if(typeof v>"u"&&(v=N.json.result),typeof v>"u")throw new M("internal","Response is missing data field.");return{data:Z(v)}}function Xt(n,c,d,g){const f=n._url(c);return Kt(n,f,d,g||{})}async function Kt(n,c,d,g){d=re(d);const f={data:d},T=await He(n,g);T["Content-Type"]="application/json",T.Accept="text/event-stream";let L;try{L=await n.fetchImpl(c,{method:"POST",body:JSON.stringify(f),headers:T,signal:g?.signal})}catch(A){if(A instanceof Error&&A.name==="AbortError"){const Y=new M("cancelled","Request was cancelled.");return{data:Promise.reject(Y),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(Y)}}}}}}const J=me(0,null);return{data:Promise.reject(J),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(J)}}}}}}let h,N;const O=new Promise((A,J)=>{h=A,N=J});g?.signal?.addEventListener("abort",()=>{const A=new M("cancelled","Request was cancelled.");N(A)});const v=L.body.getReader(),q=Qt(v,h,N,g?.signal);return{stream:{[Symbol.asyncIterator](){const A=q.getReader();return{async next(){const{value:J,done:Y}=await A.read();return{value:J,done:Y}},async return(){return await A.cancel(),{done:!0,value:void 0}}}}},data:O}}function Qt(n,c,d,g){const f=(L,h)=>{const N=L.match(Jt);if(!N)return;const O=N[1];try{const v=JSON.parse(O);if("result"in v){c(Z(v.result));return}if("message"in v){h.enqueue(Z(v.message));return}if("error"in v){const q=me(0,v);h.error(q),d(q);return}}catch(v){if(v instanceof M){h.error(v),d(v);return}}},T=new TextDecoder;return new ReadableStream({start(L){let h="";return N();async function N(){if(g?.aborted){const O=new M("cancelled","Request was cancelled");return L.error(O),d(O),Promise.resolve()}try{const{value:O,done:v}=await n.read();if(v){h.trim()&&f(h.trim(),L),L.close();return}if(g?.aborted){const A=new M("cancelled","Request was cancelled");L.error(A),d(A),await n.cancel();return}h+=T.decode(O,{stream:!0});const q=h.split(`
`);h=q.pop()||"";for(const A of q)A.trim()&&f(A.trim(),L);return N()}catch(O){const v=O instanceof M?O:me(0,null);L.error(v),d(v)}}},cancel(){return n.cancel()}})}const $e="@firebase/functions",qe="0.13.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zt="auth-internal",en="app-check-internal",tn="messaging-internal";function nn(n){const c=(d,{instanceIdentifier:g})=>{const f=d.getProvider("app").getImmediate(),T=d.getProvider(Zt),L=d.getProvider(tn),h=d.getProvider(en);return new Vt(f,T,L,h,g)};ht(new yt(Le,c,"PUBLIC").setMultipleInstances(!0)),Me($e,qe,n),Me($e,qe,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ln(n=Tt(),c=we){const g=Lt(Te(n),Le).getImmediate({identifier:c}),f=xt("functions");return f&&on(g,...f),g}function on(n,c,d){Wt(Te(n),c,d)}function sn(n,c,d){return Yt(Te(n),c)}nn();const an=ln(At);async function cn(n,c,d){const g=sn(an,"generatePreviewImage");try{return(await g({companyId:n,areaId:c,sections:d.map(T=>T.toJSON())})).data}catch(f){throw console.error("Error generating preview image:",f),f}}ft.createRoot(document.getElementById("root")).render(p.jsx(rn,{}));function rn(){const[n,c]=y.useState(/Mobi|Android/i.test(navigator.userAgent)),[d,g]=y.useState(0),[f,T]=y.useState(0),[L,h]=y.useState([]),[N,O]=y.useState([]),[v,q]=y.useState(0),[A,J]=y.useState(null),[Y,B]=y.useState([]),R=/Mobi|Android/i.test(navigator.userAgent)?5:10,[ae,ee]=y.useState([]),de=y.useRef(null),[Ve,xe]=y.useState(!1),[U,te]=y.useState([]),[x,W]=y.useState([]),[ie,ve]=y.useState([]),[We,Se]=y.useState(!1),ue=y.useRef(null),[Ye,be]=y.useState([]),[$,ne]=y.useState([]),[k,ce]=y.useState(null),[le,Ne]=y.useState(!1),[G,Be]=y.useState(!1),[z,Ge]=y.useState(!1),[ze,Xe]=y.useState(!1),[mn,Ke]=y.useState(!1),[Qe,Ze]=y.useState(!1),[ge,fe]=y.useState(""),[X,Ae]=y.useState(""),[oe,et]=y.useState(""),[K,tt]=y.useState(""),[Ee,Ie]=y.useState(""),[pe,H]=y.useState(!0),[Oe,nt]=y.useState(null),[ke,dn]=y.useState(!1),he=y.useRef(null);function se(t,o){for(const s of o)if(t.x>=s.cellId.x&&t.x<s.cellId.x+s.cellsLong&&t.y>=s.cellId.y&&t.y<s.cellId.y+s.cellsTall)return s;return null}function lt(t){te([...t.map(l=>new j({name:l.name,cellId:new w({x:l.cellId.x/2,y:l.cellId.y/2}),cellsLong:l.cellsLong/2,cellsTall:l.cellsTall/2,startingItems:[]}))]);let o=d,s=f;if(n){let l=0;const r=[],a=[];for(const e of t){const i=[],I={width:e.cellsLong*R,height:e.cellsTall*R,sectionName:e.name};I.height>l&&(l=I.height),be(C=>[...C,I]),e.cellId.x=0,e.cellId.y=0,[...Array(I.height/R).keys()].map(C=>{const D=[];[...Array(I.width/R).keys()].map(S=>{D.push({id:new w({x:S,y:C}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:R})}),i.push(D)}),r.push({sectionName:e.name,cells:[...i]}),a.push(e)}ne(r),W(a),q(l),ce(t[0]?t[0].name:null),setTimeout(()=>{H(!1)},500)}else{const l=[];for(const r of t)console.log("Generating cells for section",r.name,"at",r.cellId,"with size",r.cellsLong,"x",r.cellsTall),console.log("Needed section Width:",(r.cellsLong+r.cellId.x)*R,"Current width:",o),(r.cellsLong+r.cellId.x)*R>o&&(console.log("Added section Width:",r.cellsLong*R+r.cellId.x),o+=(r.cellsLong+r.cellId.x)*R-o),console.log("Needed section Height:",(r.cellsTall+r.cellId.y)*R,"Current height:",s),(r.cellsTall+r.cellId.y)*R>s&&(console.log("Added section Height:",r.cellsTall*R+r.cellId.y),s+=(r.cellsTall+r.cellId.y)*R-s);g(o),T(s),[...Array(s/R).keys()].map(r=>{const a=[];[...Array(o/R).keys()].map(e=>{a.push({id:new w({x:e,y:r}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:se(new w({x:e,y:r}),t)!=null,size:R})}),l.push(a)}),h([...l]),setTimeout(()=>{const r=[],a=[...t];for(const e of a)e.cellElement=document.querySelector(`.App #${e.cellId.toId()}.cell:not(.cell-border)`),r.push(...e.startingItems.map(i=>new _({cell:new w({x:e.cellId.x+i.cell.x,y:e.cellId.y+i.cell.y}),item:new b({id:i.item.id,name:i.item.name,cellsLong:i.item.cellsLong,cellsTall:i.item.cellsTall,icon:i.item.icon,initialElement:document.querySelector(`.App #${i.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:i.item.moveable,rotation:i.item.rotation||0})})));W([...a]);for(const e of r){const i=D=>{const S=D%2===1;return{cellsLong:S?e.item.cellsTall:e.item.cellsLong,cellsTall:S?e.item.cellsLong:e.item.cellsTall}},I=e.item.rotation||0,C=i(I);for(let D=0;D<C.cellsTall;D++)for(let S=0;S<C.cellsLong;S++)l[e.cell.y+D][e.cell.x+S].hasItem=!0,l[e.cell.y+D][e.cell.x+S].itemId=e.item.id;e.item.initialElement=document.querySelector(`.App #${e.cell.toId()}.cell:not(.cell-border)`),O(D=>[...D,e.item])}h([...l]),setTimeout(()=>{H(!1)},500)},100)}}async function ot(){const t=new URLSearchParams(window.location.search),o=t.get("companyId"),s=t.get("areaId"),l=t.get("areaId")||"",r=t.get("companyId")||"",a=t.get("templateId")||"",e=await kt(r,l),i=t.get("type")||"";let I=!1;if(i==="create-template")Ne(!0);else if(i==="edit-template"){Be(!0);const m=e.templates.find(u=>u.id===a);m&&(nt(m),Ae(m.name))}else if(i==="view-design"){I=!0,Ge(!0);const m=t.get("designName")||"";fe(m);const u=t.get("designId")||"";Ie(u)}else if(i==="view-area")Xe(!0);else if(i==="edit-design"){I=!0,Ke(!0);const m=t.get("designName")||"";fe(m);const u=t.get("designId")||"";Ie(u)}else if(i==="client-edit-design"){I=!0,Ze(!0);const m=t.get("designName")||"";fe(m);const u=t.get("designId")||"";Ie(u)}o&&et(o),s&&tt(s),ee(e.inventoryItems.map(m=>new ye({item:new b({id:m.item.id,name:m.item.name,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,initialElement:m.item.initialElement,moveable:m.item.moveable,starterItem:m.item.starterItem,displayItem:!0}),quantity:m.quantity})));const C=[],D=[];for(const m of e.templates){const u=[],E=[];for(const F of m.sections)u.push(new j({name:F.name,cellId:new w({x:F.cellId.x/(n?20:10),y:F.cellId.y/(n?20:10)}),cellsLong:F.cellsLong/(n?20:10),cellsTall:F.cellsTall/(n?20:10),startingItems:F.startingItems.map(P=>new _({cell:new w({x:P.cell.x/(n?2:1),y:P.cell.y/(n?2:1)}),item:new b({id:P.item.id,name:P.item.name,cellsLong:P.item.cellsLong/2,cellsTall:P.item.cellsTall/2,icon:P.item.icon,starterItem:!0,moveable:P.item.moveable,rotation:P.item.rotation||0})}))})),E.push(new j({name:F.name,cellId:new w({x:F.cellId.x,y:F.cellId.y}),cellsLong:F.cellsLong,cellsTall:F.cellsTall,startingItems:F.startingItems.map(P=>new _({cell:new w({x:P.cell.x,y:P.cell.y}),item:new b({id:P.item.id,name:P.item.name,cellsLong:P.item.cellsLong,cellsTall:P.item.cellsTall,icon:P.item.icon,starterItem:!0,moveable:P.item.moveable,rotation:P.item.rotation||0})}))}));C.push(new Q({name:m.name,sections:u,id:m.id,previewImage:m.previewImage})),D.push(new Q({name:m.name,sections:E,id:m.id,previewImage:m.previewImage}))}ve([...C]);const S=[],V=a===""?void 0:D.find(m=>m.id===a);if(console.log("TEMPLATE",V,"AREA",e),I){const m=await Dt(r,l,t.get("designId")||"");if(m===null){window.location.href="/LayItOut/DNF/";return}te([...m.sections]),W([...m.sections.map(u=>new j({name:u.name,cellId:new w({x:u.cellId.x/10,y:u.cellId.y/10}),cellsLong:u.cellsLong/10,cellsTall:u.cellsTall/10,startingItems:u.startingItems,items:u.startingItems.map(E=>new b({id:E.item.id,name:E.item.name,sectionCell:E.cell,cellsLong:E.item.cellsLong,cellsTall:E.item.cellsTall,icon:E.item.icon,moveable:E.item.moveable,starterItem:E.item.starterItem,rotation:E.item.rotation}))}))]),S.push(...m.sections.map(u=>new j({name:u.name,cellId:new w({x:u.cellId.x/10,y:u.cellId.y/10}),cellsLong:u.cellsLong/10,cellsTall:u.cellsTall/10,startingItems:u.startingItems,items:u.startingItems.map(E=>new b({id:E.item.id,name:E.item.name,sectionCell:E.cell,cellsLong:E.item.cellsLong,cellsTall:E.item.cellsTall,icon:E.item.icon,moveable:E.item.moveable,starterItem:E.item.starterItem,rotation:E.item.rotation}))})))}else V!==void 0?(te([...V.sections]),W([...V.sections.map(m=>new j({name:m.name,cellId:new w({x:m.cellId.x/10,y:m.cellId.y/10}),cellsLong:m.cellsLong/10,cellsTall:m.cellsTall/10,startingItems:m.startingItems,items:m.startingItems.map(u=>new b({id:u.item.id,name:u.item.name,sectionCell:u.cell,cellsLong:u.item.cellsLong,cellsTall:u.item.cellsTall,icon:u.item.icon,moveable:u.item.moveable,starterItem:u.item.starterItem,rotation:u.item.rotation}))}))]),S.push(...V.sections.map(m=>new j({name:m.name,cellId:new w({x:m.cellId.x/10,y:m.cellId.y/10}),cellsLong:m.cellsLong/10,cellsTall:m.cellsTall/10,startingItems:m.startingItems,items:m.startingItems.map(u=>new b({id:u.item.id,name:u.item.name,cellsLong:u.item.cellsLong,cellsTall:u.item.cellsTall,icon:u.item.icon,moveable:u.item.moveable,starterItem:u.item.starterItem,rotation:u.item.rotation,sectionCell:u.cell}))})))):(te([...e.sections]),W([...e.sections.map(m=>new j({name:m.name,cellId:new w({x:m.cellId.x/10,y:m.cellId.y/10}),cellsLong:m.cellsLong/10,cellsTall:m.cellsTall/10,startingItems:m.startingItems,items:m.startingItems.map(u=>new b({id:u.item.id,name:u.item.name,sectionCell:u.cell,cellsLong:u.item.cellsLong,cellsTall:u.item.cellsTall,icon:u.item.icon,moveable:u.item.moveable,starterItem:u.item.starterItem,rotation:u.item.rotation}))}))]),S.push(...e.sections.map(m=>new j({name:m.name,cellId:new w({x:m.cellId.x/10,y:m.cellId.y/10}),cellsLong:m.cellsLong/10,cellsTall:m.cellsTall/10,startingItems:m.startingItems,items:m.startingItems.map(u=>new b({id:u.item.id,name:u.item.name,sectionCell:u.cell,cellsLong:u.item.cellsLong,cellsTall:u.item.cellsTall,icon:u.item.icon,moveable:u.item.moveable,starterItem:u.item.starterItem,rotation:u.item.rotation}))}))));console.log("SECTIONS TO GENERATE",S),lt(S)}y.useEffect(()=>{ot()},[]);function st(t,o,s){if(!n||t==null)return;const l=[...s],r=[],a=s.find(e=>e.name==t);console.log("NEW SECTION",a),console.log("Adding section",a.name,a.cellId),console.log("MOBILE CELLS",o),a.cellElement=document.querySelector(`.App #${a.name.split(" ").join("-")} #${a.name.split(" ").join("")}${a.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",a.cellElement);for(const e of a.startingItems){console.log("Placing starting item",e.item.name,e.cell);const i=D=>{const S=D%2===1;return{cellsLong:S?e.item.cellsTall:e.item.cellsLong,cellsTall:S?e.item.cellsLong:e.item.cellsTall}},I=e.item.rotation||0,C=i(I);for(let D=0;D<C.cellsTall;D++)for(let S=0;S<C.cellsLong;S++){const V=o.find(m=>m.sectionName===a.name);V.cells[e.cell.y+D][e.cell.x+S].hasItem=!0,V.cells[e.cell.y+D][e.cell.x+S].itemId=e.item.id}e.item.initialElement=document.querySelector(`.App #${a.name.split(" ").join("-")} #${a.name.split(" ").join("")}${e.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",e.item.initialElement),r.push(new b({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,initialElement:e.item.initialElement,starterItem:!0,moveable:e.item.moveable,rotation:e.item.rotation}))}console.log("Setting sections",l),W([...l]),console.log("ITEMS",r),O(e=>[...e.filter(I=>!r.some(C=>C.id===I.id)),...r.map(I=>new b({id:I.id,name:I.name,cellsLong:I.cellsLong,cellsTall:I.cellsTall,icon:I.icon,initialElement:I.initialElement,starterItem:!0,moveable:I.moveable,rotation:I.rotation}))])}function De(t){let o=[];return t.map(s=>o=[...o,...s]),o}function Pe(t,o){console.log(t);const s=n?$.find(e=>e.sectionName===k).cells:L,l=s[t.y].length,r=s.length;if(console.log(l,r),t.x+o.cellsLong>l||t.y+o.cellsTall>r)return!1;const a=se(t,x);if(!a&&!n)return console.log("Item is out of bounds of any section"),!1;for(let e=0;e<o.cellsTall;e++)for(let i=0;i<o.cellsLong;i++){if(!n){const I=se(new w({x:t.x+i,y:t.y+e}),x);if(!I)return console.log("Item is out of bounds of any section"),!1;if(I.name!=a.name)return console.log("Item is crossing section boundaries"),!1}if(s[t.y+e][t.x+i].hasItem&&s[t.y+e][t.x+i].itemId!=o.id)return console.log("Something is already here"),!1}return!0}function at(t,o,s){const l=Array.from(n?$.find(e=>e.sectionName===k).cells:L);if(s!=null){console.log("Removing item");const e=n?x.find(i=>i.name===k):se(s,x);e.items=e.items.filter(i=>i.id!=o.id);for(let i=0;i<o.cellsTall;i++)for(let I=0;I<o.cellsLong;I++)l[s.y+i][s.x+I].hasItem=!1,l[s.y+i][s.x+I].itemId=""}const r=n?x.find(e=>e.name===k):se(t,x),a=new w({x:t.x-r.cellId.x,y:t.y-r.cellId.y});o.sectionCell=a,r.items.push(o);for(let e=0;e<o.cellsTall;e++)for(let i=0;i<o.cellsLong;i++)l[t.y+e][t.x+i].hasItem=!0,l[t.y+e][t.x+i].itemId=o.id;if(console.log(l),n){const e=$.find(i=>i.sectionName===k);e&&(e.cells=l.map(i=>i.map(I=>({...I}))),ne([...$]))}else h(l);if(console.log("Removing item from inventory",o.name),!o.hasMoved){const e=ae.findIndex(i=>i.item.name==o.name&&!i.item.hasMoved);if(e!==-1){const i=[...ae];i[e].quantity-=1,i[e].quantity<=0&&i.splice(e,1),ee(i)}else ee(ae)}O(e=>(console.log("Placing item",o.id),console.log("Updating item",o.id),e.find(i=>i.id==o.id).hasMoved||(e.find(i=>i.id==o.id).hasMoved=!0),e))}function it(t){N.find(o=>o.name==t.name&&!o.hasMoved&&!o.starterItem)||O(o=>[...o,t])}function Re(t){console.log("Removing item",t.id),O(o=>o.filter(s=>s.id!=t.id))}function ct(t,o){const s=Array.from(L),l=e=>{const i=e%2===1;return{cellsWide:i?t.cellsTall:t.cellsLong,cellsTall:i?t.cellsLong:t.cellsTall}},r=t.rotation||0,a=l(r);for(let e=0;e<a.cellsTall;e++)for(let i=0;i<a.cellsWide;i++)s[o.y+e][o.x+i].hasItem=!1,s[o.y+e][o.x+i].itemId="";h(s),console.log("DELETING ITEM",t.id),O(e=>(console.log(),e.filter(i=>i.id!=t.id))),ee(e=>{const i=e.findIndex(I=>I.item.name==t.name&&!I.item.hasMoved);if(i!==-1){const I=[...e];return I[i].quantity+=1,I}else return[...e,new ye({item:new b({id:t.id,name:t.name,cellsLong:a.cellsWide,cellsTall:a.cellsTall,icon:t.icon}),quantity:1})]})}function rt(t,o){const s=Array.from(n?$.find(e=>e.sectionName===k).cells:L);console.log("DELETING ITEM ROTATE",t.id,t.rotation);const l=e=>{const i=e%2===1;return{cellsWide:i?t.cellsTall:t.cellsLong,cellsTall:i?t.cellsLong:t.cellsTall}},r=t.rotation||0,a=l(r);for(let e=0;e<a.cellsTall;e++)for(let i=0;i<a.cellsWide;i++)console.log("Deleting cell",o.y+e,o.x+i),s[o.y+e][o.x+i].hasItem=!1,s[o.y+e][o.x+i].itemId="";h([...s]),console.log("DELETING ITEM",t.id)}function mt(t,o){const s=n?$.find(a=>a.sectionName===k).cells:L,l=Array.from(s);if(s[t.y]==null){je();return}const r=Pe(t,o);l.forEach(a=>a.forEach(e=>{e.mouseOver=!1,e.canPlaceItem=!1,e.mouseOverLocation=""}));for(let a=0;a<o.cellsTall;a++)for(let e=0;e<o.cellsLong;e++)t.y+a<l.length&&t.x+e<l[t.y+a].length&&(o.cellsLong===1&&o.cellsTall===1?l[t.y+a][t.x+e].mouseOverLocation="single":o.cellsTall===1?e===0?l[t.y+a][t.x+e].mouseOverLocation="leftFull":e===o.cellsLong-1?l[t.y+a][t.x+e].mouseOverLocation="rightFull":l[t.y+a][t.x+e].mouseOverLocation="middleFull":o.cellsLong===1?a===0?l[t.y+a][t.x+e].mouseOverLocation="topFull":a===o.cellsTall-1?l[t.y+a][t.x+e].mouseOverLocation="bottomFull":l[t.y+a][t.x+e].mouseOverLocation="middleVFull":a===0&&e===0?l[t.y+a][t.x+e].mouseOverLocation="topLeftCorner":a===0&&e===o.cellsLong-1?l[t.y+a][t.x+e].mouseOverLocation="topRightCorner":a===o.cellsTall-1&&e===0?l[t.y+a][t.x+e].mouseOverLocation="bottomLeftCorner":a===o.cellsTall-1&&e===o.cellsLong-1?l[t.y+a][t.x+e].mouseOverLocation="bottomRightCorner":a===0?l[t.y+a][t.x+e].mouseOverLocation="top":a===o.cellsTall-1?l[t.y+a][t.x+e].mouseOverLocation="bottom":e===0?l[t.y+a][t.x+e].mouseOverLocation="left":e===o.cellsLong-1?l[t.y+a][t.x+e].mouseOverLocation="right":l[t.y+a][t.x+e].mouseOverLocation="middle",l[t.y+a][t.x+e].mouseOver=!0,l[t.y+a][t.x+e].canPlaceItem=r);if(n){const a=$.find(e=>e.sectionName===k);a&&(a.cells=l.map(e=>e.map(i=>({...i}))),ne([...$])),ne(e=>e.map(i=>i.sectionName===k?{...i,cells:l}:i))}else h(l)}function je(){const t=Array.from(n?$.find(o=>o.sectionName===k).cells:L);t.forEach(o=>o.forEach(s=>{s.mouseOver=!1,s.canPlaceItem=!1,s.mouseOverLocation=""})),h(t)}y.useEffect(()=>{st(k,$,x)},[k]),y.useEffect(()=>{const t=()=>{const o=N.find(s=>s.id===A);console.log("Unselecting item",A),J(null),o&&(B(s=>[...s,o.id]),console.log("Unselecting item",o.id),setTimeout(()=>{B(s=>s.filter(l=>l!==o.id))},300))};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[A,N]);function dt(t){J(null),B(o=>[...o,t]),console.log("Unselecting item",t),setTimeout(()=>{B(o=>o.filter(s=>s!==t))},300)}function ut(t){const o=N.find(s=>s.id===A);console.log("Unselecting item",A),J(t),o&&(B(s=>[...s,o.id]),console.log("Unselecting item",o.id),setTimeout(()=>{B(s=>s.filter(l=>l!==o.id))},300))}function gt(t){ee(o=>[...o,t])}return p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"App",children:[p.jsx("h1",{className:"title",children:"LayItOut"}),p.jsx("br",{}),(le||G)&&p.jsxs("div",{className:"template-name-row",children:[p.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),p.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:t=>Ae(t.target.value),value:X})]}),z&&p.jsx("div",{className:"design-name-row",children:p.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",ge]})}),p.jsx("button",{onClick:async()=>{const t=x.map(s=>new j({name:s.name,cellId:new w({x:U.find(l=>l.name==s.name).cellId.x*20,y:U.find(l=>l.name==s.name).cellId.y*20}),cellsLong:s.cellsLong*10,cellsTall:s.cellsTall*10,startingItems:s.items.map(l=>new _({cell:new w({x:l.sectionCell.x,y:l.sectionCell.y}),item:new b({id:l.id,name:l.name,cellsLong:l.cellsLong,cellsTall:l.cellsTall,icon:l.icon,starterItem:!0,moveable:l.moveable,rotation:l.rotation})}))})),o=await cn(oe,K,t);console.log("Preview image generated",o)},children:"Test"}),(le||G)&&p.jsxs("div",{className:"template-creation",children:[p.jsxs("button",{className:"action-btn",onClick:()=>{if(X.trim()==""){alert("Please enter a template name");return}if(ie.some(t=>t.name===X&&(G?t.id!==Oe.id:!0))){alert("Template with this name already exists");return}G?(H(!0),setTimeout(async()=>{const t=window.location.origin+"/LayItOut/Preview/"+window.location.search,o=x.map(s=>new j({name:s.name,cellId:new w({x:U.find(l=>l.name==s.name).cellId.x*20,y:U.find(l=>l.name==s.name).cellId.y*20}),cellsLong:s.cellsLong*10,cellsTall:s.cellsTall*10,startingItems:s.items.map(l=>new _({cell:new w({x:l.sectionCell.x,y:l.sectionCell.y}),item:new b({id:l.id,name:l.name,cellsLong:l.cellsLong,cellsTall:l.cellsTall,icon:l.icon,starterItem:!0,moveable:l.moveable,rotation:l.rotation})}))}));localStorage.setItem("screenshotSections",o.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",o.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),window.addEventListener("storage",async s=>{if(console.log("Storage event",s),s.key==="screenshot"){const l=ie.map(r=>r.id===Oe.id?(console.log("SECTION",x),new Q({name:X,previewImage:s.newValue,sections:x.map(a=>new j({name:a.name,cellId:new w({x:r.sections.find(e=>e.name==a.name).cellId.x*(n?20:10),y:r.sections.find(e=>e.name==a.name).cellId.y*(n?20:10)}),cellsLong:a.cellsLong*10,cellsTall:a.cellsTall*10,startingItems:a.items.map(e=>new _({cell:new w({x:e.sectionCell.x,y:e.sectionCell.y}),item:new b({id:e.id,name:e.name,cellsLong:e.cellsLong,cellsTall:e.cellsTall,icon:e.icon,starterItem:!0,moveable:e.moveable,rotation:e.rotation})}))})),id:r.id})):new Q({name:r.name,previewImage:r.previewImage,sections:r.sections.map(a=>new j({name:a.name,cellId:new w({x:a.cellId.x*(n?20:10),y:a.cellId.y*(n?20:10)}),cellsLong:a.cellsLong*(n?20:10),cellsTall:a.cellsTall*(n?20:10),startingItems:a.startingItems.map(e=>new _({cell:new w({x:e.cell.x*(n?2:1),y:e.cell.y*(n?2:1)}),item:new b({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong*2,cellsTall:e.item.cellsTall*2,icon:e.item.icon,starterItem:e.item.starterItem,moveable:e.item.moveable,rotation:e.item.rotation})}))})),id:r.id}));Ue(oe,K,l).then(()=>{console.log("Template updated successfully"),H(!1);const r=new URLSearchParams(window.location.search),a=r.get("companyId"),e=r.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${a}&areaId=${e}&type=view-area`})}}),window.open(t,"_blank")},500)):(H(!0),setTimeout(async()=>{const t=window.location.origin+"/LayItOut/Preview/"+window.location.search,o=x.map(s=>new j({name:s.name,cellId:new w({x:U.find(l=>l.name==s.name).cellId.x*20,y:U.find(l=>l.name==s.name).cellId.y*20}),cellsLong:s.cellsLong*10,cellsTall:s.cellsTall*10,startingItems:s.items.map(l=>new _({cell:new w({x:l.sectionCell.x,y:l.sectionCell.y}),item:new b({id:l.id,name:l.name,cellsLong:l.cellsLong,cellsTall:l.cellsTall,icon:l.icon,starterItem:!0,moveable:l.moveable,rotation:l.rotation})}))}));localStorage.setItem("screenshotSections",o.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",o.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),window.addEventListener("storage",async s=>{if(console.log("Storage event",s),s.key==="screenshot"){const l=new Q({name:X,previewImage:s.newValue,sections:x.map(a=>new j({name:a.name,cellId:new w({x:U.find(e=>e.name==a.name).cellId.x*20,y:U.find(e=>e.name==a.name).cellId.y*20}),cellsLong:a.cellsLong*10,cellsTall:a.cellsTall*10,startingItems:a.items.map(e=>new _({cell:new w({x:e.sectionCell.x,y:e.sectionCell.y}),item:new b({id:e.id,name:e.name,cellsLong:e.cellsLong,cellsTall:e.cellsTall,icon:e.icon,starterItem:!0,moveable:e.moveable,rotation:e.rotation})}))})),id:X+(Math.random()*1e4).toString()}),r=[...ie.map(a=>new Q({name:a.name,previewImage:a.previewImage,sections:a.sections.map(e=>new j({name:e.name,cellId:new w({x:e.cellId.x*(n?20:10),y:e.cellId.y*(n?20:10)}),cellsLong:e.cellsLong*(n?20:10),cellsTall:e.cellsTall*(n?20:10),startingItems:e.startingItems.map(i=>new _({cell:new w({x:i.cell.x*(n?2:1),y:i.cell.y*(n?2:1)}),item:new b({id:i.item.id,name:i.item.name,cellsLong:i.item.cellsLong*2,cellsTall:i.item.cellsTall*2,icon:i.item.icon,starterItem:i.item.starterItem,moveable:i.item.moveable,rotation:i.item.rotation})}))})),id:a.id})),l];Ue(oe,K,r).then(()=>{console.log("Template updated successfully"),H(!1);const a=new URLSearchParams(window.location.search),e=a.get("companyId"),i=a.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${e}&areaId=${i}&type=view-area`})}}),window.open(t,"_blank")},500))},children:[le?"Create":"Save"," Template"]}),p.jsx("button",{className:"action-btn",onClick:()=>{Ne(!1),ve([]),te([]),W([]),ne([]),be([]),ce(null)},children:"Cancel"})]}),Qe&&p.jsxs("div",{className:"template-creation",children:[p.jsx("button",{className:"action-btn",onClick:()=>{H(!0),setTimeout(async()=>{const t=window.location.origin+"/LayItOut/Preview/"+window.location.search,o=x.map(s=>new j({name:s.name,cellId:new w({x:U.find(l=>l.name==s.name).cellId.x*20,y:U.find(l=>l.name==s.name).cellId.y*20}),cellsLong:s.cellsLong*10,cellsTall:s.cellsTall*10,startingItems:s.items.map(l=>new _({cell:new w({x:l.sectionCell.x,y:l.sectionCell.y}),item:new b({id:l.id,name:l.name,cellsLong:l.cellsLong,cellsTall:l.cellsTall,icon:l.icon,starterItem:!0,moveable:l.moveable,rotation:l.rotation})}))}));localStorage.setItem("screenshotSections",o.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",o.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),window.addEventListener("storage",async s=>{if(console.log("Storage event",s),s.key==="screenshot"){const l=new Et({name:ge,previewImage:s.newValue,areaId:K,sections:x.map(r=>new j({name:r.name,cellId:new w({x:U.find(a=>a.name==r.name).cellId.x*20,y:U.find(a=>a.name==r.name).cellId.y*20}),cellsLong:r.cellsLong*10,cellsTall:r.cellsTall*10,startingItems:r.items.map(a=>new _({cell:new w({x:a.sectionCell.x,y:a.sectionCell.y}),item:new b({id:a.id,name:a.name,cellsLong:a.cellsLong,cellsTall:a.cellsTall,icon:a.icon,starterItem:!0,moveable:a.moveable,rotation:a.rotation})}))})),id:Ee});Ot(oe,K,l).then(()=>{console.log("Design updated successfully"),H(!1)})}}),window.open(t,"_blank")},500)},children:"Save"}),p.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),pe&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"loader-backdrop"}),p.jsx("div",{className:"loader"})]})," ",p.jsxs("div",{className:"layout",children:[!z&&p.jsx(Pt,{isViewingDesign:z,isEditingTemplate:G,isCreatingTemplate:le,maxHeight:n?200:f,showAddCustomItem:()=>{he.current?.showModal()},addDraggingItem:it,removeItem:Re,inventoryItems:ae.map(t=>new ye({item:new b({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,displayItem:!0}),quantity:t.quantity}))}),n?p.jsxs("div",{className:"mobile-areas",style:{height:v+"px"},children:[p.jsx("img",{src:Fe,onClick:()=>{const t=x.findIndex(s=>s.name==k);if(t===-1)return;const o=(t-1+x.length)%x.length;ce(x[o].name),console.log("Changing viewing section to",x[o].name)},className:"back-mobile-areas"}),Ye.map((t,o)=>p.jsx(Ce,{width:t.width,height:t.height,cells:De($.find(s=>s.sectionName==t.sectionName).cells),id:t.sectionName,visibile:k==null?!0:t.sectionName==k,section:t.sectionName},o)),p.jsx("img",{src:Fe,onClick:()=>{const t=x.findIndex(s=>s.name==k);if(t===-1)return;const o=(t+1)%x.length;ce(x[o].name),console.log("Changing viewing section to",x[o].name)},className:"forward-mobile-areas"})]}):p.jsx(Ce,{width:d,height:f,cells:De(L)})]}),z&&p.jsx("div",{className:"design-view",children:p.jsx("button",{className:"action-btn",onClick:()=>{window.location.href=`/LayItOut/Print/?companyId=${oe}&areaId=${K}&designName=${ge}&designId=${Ee}`},children:"Print"})})]}),p.jsxs("div",{id:ke?"capture":"",children:[x.map(t=>p.jsx(It,{takingPhoto:ke,section:t,visible:k==null?!0:t.name==k,cellSize:R},t.cellId.toId())),N.map(t=>p.jsx(pt,{cellSize:R,isViewingDesign:z,removeItem:Re,visible:n?!t.hasMoved&&!t.starterItem?!0:k==null?!1:t.starterItem?x.find(o=>o.name==k)?.startingItems.some(o=>o.item.id===t.id):x.find(o=>o.name==k)?.items.some(o=>o.id===t.id):!0,item:t,canPlaceItem:Pe,placeItem:at,deleteItemRotate:rt,highlightCells:mt,unHighlightCells:je,deleteItem:ct,isSelected:A===t.id,onSelect:ut,isUnselecting:Y.includes(t.id),onDeselect:()=>dt(t.id)},t.id))]}),n&&!pe&&p.jsx("div",{className:"layout-icon",onClick:()=>{de.current?.showModal(),xe(!0),console.log("Showing layout dialog")},children:p.jsx("img",{src:Rt,alt:""})}),!pe&&!(le||G||z)&&p.jsx("div",{className:"template-icon",onClick:()=>{ue.current?.showModal(),Se(!0),console.log("Showing template dialog")},children:p.jsx("img",{src:jt,alt:""})}),p.jsx(Ct,{isViewingArea:ze,dialogRef:ue,isOpen:We,closeDialog:()=>{ue.current?.close(),Se(!1)},templates:ie}),p.jsx(Mt,{dialogRef:de,isOpen:Ve,closeDialog:()=>{de.current?.close(),xe(!1)},layoutSections:U}),p.jsx(Ut,{dialogRef:he,addInventoryItem:gt,closeDialog:()=>{he.current?.close()}})]})}
