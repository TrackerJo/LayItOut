import{r as d,j as t,c as Nn}from"./index-_mSZXrjJ.js";import{A as Pt,S as Mn,D as Cn,B as En}from"./booth_item-D84XmIIk.js";import{I as ue,E as p,G as Qe,z as Rn,H as h,V as Gt,J as W,K as z,T as xe,D as Bt,L as Wt,B as Ee,M as je,N as Re,k as kn,n as Dn,O as On,P as nt,Q as Pn,R as Bn,U as Wn,W as Gn,A as Fn,X as Vn}from"./firestore-CT4Y-ESF.js";import{F as lt}from"./template_dialog-Db99BGZi.js";/* empty css                               */import{I as Zn,L as Yn,T as Jn}from"./inventory_item_tile-B4HhHPul.js";function Un({dialogRef:c,closeDialog:G,addInventoryItem:V,canBeBooth:L}){const[b,R]=d.useState(""),[C,T]=d.useState(1),[F,A]=d.useState(1),[E,N]=d.useState(1),[B,x]=d.useState(!1);return t.jsx("dialog",{ref:c,className:"custom-item-dialog",children:t.jsxs("div",{className:"custom-item-dialog-div",children:[t.jsx("h2",{children:"Add Custom Item"}),t.jsxs("div",{className:"custom-item-row",children:[t.jsx("label",{htmlFor:"item-name",children:"Name:"}),t.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:Y=>R(Y.target.value??""),value:b})]}),t.jsxs("div",{className:"custom-item-row",children:[t.jsx("label",{htmlFor:"item-icon",children:"Count:"}),t.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:C,onChange:Y=>T(parseInt(Y.target.value)??1)})]}),t.jsxs("div",{className:"custom-item-row custom-item-size",children:[t.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),t.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:F,onChange:Y=>A(parseFloat(Y.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:E,onChange:Y=>N(parseFloat(Y.target.value)??1)})]}),L?t.jsxs("div",{className:"custom-item-row",children:[t.jsx("label",{htmlFor:"is-booth",children:"Is Booth:"}),t.jsx("input",{type:"checkbox",id:"is-booth",name:"is-booth",checked:B,onChange:Y=>x(Y.target.checked)})]}):null,t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{if(b.trim()===""){alert("Item name cannot be empty");return}const Y=new ue({quantity:C,item:new p({id:b+(Math.random()*1e4).toString(),name:b,icon:`custom-${b}`,cellsLong:Math.ceil(F),cellsTall:Math.ceil(E),moveable:!0,starterItem:!1,displayItem:!0,isBooth:B})});V(Y),R(""),T(1),A(1),N(1),x(!1),G()},children:"Add Item"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{G(),R(""),T(1),A(1),N(1),x(!1)},children:"Close"})]})})}function Hn({inventoryItem:c,addDraggingItem:G,removeItem:V,setSelectedItem:L,tapAndPlaceMode:b}){const R=d.useRef(null),C=d.useRef(null),[T,F]=d.useState(12),[A,E]=d.useState(c.item),[N,B]=d.useState(!1);function x(w){const v=C.current,J=window.getComputedStyle(v),X=document.createElement("span");X.style.font=J.font,X.style.fontSize=w+"px",X.style.fontFamily=J.fontFamily,X.style.fontWeight=J.fontWeight,X.style.position="absolute",X.style.visibility="hidden",X.style.whiteSpace="nowrap",X.textContent=v.textContent,document.body.appendChild(X);const D=X.offsetWidth;return document.body.removeChild(X),D}function Y(w){if(C.current){const v=C.current;return x(w-1)>v.offsetWidth&&w-1>8?Y(w-1):w-1}return w}d.useEffect(()=>{setTimeout(()=>{C.current&&F(Y(T))},100)},[]);const k=d.useCallback(()=>{if(console.log("MOUSE MOVE",N),N){if(B(!1),b)return;c.item.initialElement=R.current,c.item.id=c.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",c.item.id,"to initialElement",c.item.initialElement),E(new p({...c.item})),G(c.item),window.removeEventListener("mousemove",k),window.removeEventListener("touchmove",k)}},[N,b]);return d.useEffect(()=>(N?(window.addEventListener("touchmove",k),window.addEventListener("mousemove",k)):(window.removeEventListener("touchmove",k),window.removeEventListener("mousemove",k)),()=>{window.removeEventListener("touchmove",k),window.removeEventListener("mousemove",k)}),[N,k]),t.jsxs("div",{className:"display",children:[t.jsx("div",{ref:R,id:c.item.id,className:c.item.isSectionItem?"display-section":`display-item ${c.item.isSectionModifier?c.item.sectionModifierType.toString():""}`,style:{width:`${c.item.cellsLong*10}px`,height:`${c.item.cellsTall*10}px`},onMouseDown:w=>{B(!0)},onMouseUp:()=>{console.log("MOUSE UP"),B(!1)},onClick:w=>{if(!b){w.preventDefault(),w.stopPropagation();return}console.log("CLICKED ON ITEM",c.item.id,"with tap and place mode"),w.preventDefault(),w.stopPropagation(),c.item.initialElement=R.current,c.item.id=c.item.name+(Math.random()*1e4).toString(),L(c.item)},onTouchStart:w=>{b||(w.preventDefault(),w.stopPropagation(),c.item.initialElement=R.current,c.item.id=c.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",c.item.id,"to initialElement",c.item.initialElement),E(new p({...c.item})),G(c.item))},children:c.item.isSectionModifier?c.item.sectionModifierType==="LeftDoor"||c.item.sectionModifierType==="RightDoor"?t.jsx("img",{src:c.item.icon,alt:"icon"}):null:c.item.icon.includes("custom-")?t.jsx("div",{className:c.item.isSectionItem?"custom-section":"custom-icon",children:t.jsx("div",{children:t.jsx("p",{ref:C,style:{fontSize:`${T}px`},children:c.item.icon.split("custom-")[1]})})}):t.jsx("img",{src:c.item.icon,alt:"icon"})}),t.jsx("p",{children:c.item.name}),c.quantity>0&&t.jsxs("p",{className:"quantity",children:["x",c.quantity]})]})}const Ft="/LayItOut/assets/plus.circle-Ce3xm00a.png";function Xn({inventoryItems:c,addDraggingItem:G,maxHeight:V,removeItem:L,showAddCustomItem:b,isCreatingTemplate:R,isEditingTemplate:C,isViewingDesign:T,tapAndPlaceMode:F,setSelectedItem:A,isModifyingSections:E}){return t.jsxs("div",{className:"toolbox",style:{maxHeight:V?`${V}px`:"200px"},children:[c.map(N=>t.jsx(Hn,{setSelectedItem:A,tapAndPlaceMode:F,inventoryItem:N,addDraggingItem:G,removeItem:L})),!(R||C||T||E)&&t.jsx("div",{className:"add-item",onClick:()=>{b()},children:t.jsx("img",{src:Ft,alt:"Add Item"})})]})}function Qn({dialogRef:c,closeDialog:G,areaPreview:V}){return t.jsx("dialog",{ref:c,className:"layout-dialog",children:t.jsxs("div",{className:"layout-dialog-div",children:[t.jsx("h2",{children:"Layout"}),t.jsx("img",{src:V,alt:"Layout preview",className:"layout-dialog-preview"}),t.jsx("br",{}),t.jsx("button",{className:"layout-dialog-close",onClick:G,children:"Close"})]})})}const zn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",qn="/LayItOut/assets/template-Cjj8EPhc.png";function $n({dialogRef:c,closeDialog:G,templates:V,isOpen:L,isViewingArea:b,selectTemplate:R,duplicateTemplate:C}){const[T,F]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[A,E]=d.useState([]),[N,B]=d.useState(!1),[x,Y]=d.useState([]);return d.useEffect(()=>{Y(V)},[V]),d.useEffect(()=>{if(L&&(console.log("Layout dialog opened, generating cells and sections",x),x.length!==0)){if(x.length==1){E([x[0].name]);return}E(T?[x[0].name]:[x[0].name,x[1].name])}},[L,x]),d.useEffect(()=>{const k=x.filter(w=>A.includes(w.name));console.log("Viewing templates:",A),k.sort((w,v)=>A.indexOf(w.name)-A.indexOf(v.name)),console.log("Generating templates for",k.map(w=>w.name))},[A,x]),t.jsx(t.Fragment,{children:t.jsx("dialog",{ref:c,className:"template-dialog",children:t.jsxs("div",{className:"template-dialog-div",children:[t.jsx("h2",{children:"Templates"}),t.jsxs("div",{className:"templates",children:[x.length>1&&x.filter(k=>!A.includes(k.name)).length>0&&t.jsx("img",{src:lt,onClick:()=>{if(T){const w=(x.findIndex(v=>v.name===A[0])-1+x.length)%x.length;E([x[w].name])}else E(k=>{const v=(x.findIndex(J=>J.name===k[0])-1+x.length)%x.length;return[x[v].name,k[0]]})},className:"back-mobile-areas"}),A.length===0&&t.jsx("div",{className:"no-templates",children:"No templates available"}),A.map(k=>t.jsxs("div",{className:"template",children:[t.jsx("img",{src:x.find(w=>w.name===k).previewImage,alt:k,className:"template-preview"}),t.jsx("h3",{children:k}),t.jsxs("div",{className:"template-actions",children:[t.jsx("button",{className:"template-select-btn",onClick:()=>{if(b){const w=new URLSearchParams(window.location.search),v=w.get("companyId"),J=w.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${v}&areaId=${J}&type=edit-template&templateId=${x.find(X=>X.name==k).id}`}else G(),R&&R(x.find(w=>w.name===k))},children:b?"Edit":"Select"}),b&&t.jsx("button",{className:"action-btn",onClick:()=>{N||(B(!0),C&&C(x.find(w=>w.name===k)))},children:"Duplicate"}),b&&t.jsx("button",{className:"action-btn",onClick:()=>{if(N)return;B(!0);const w=x.filter(D=>D.name!==k);Y(w),w.length==1?E([w[0].name]):w.length==0?E([]):E(T?[w[0].name]:[w[0].name,w[1].name]);const v=new URLSearchParams(window.location.search),J=v.get("companyId"),X=v.get("areaId");Qe(J,X,w).then(()=>{B(!1)})},children:"Delete"})]})]})),x.length>1&&x.filter(k=>!A.includes(k.name)).length>0&&t.jsx("img",{src:lt,onClick:()=>{if(T){const w=(x.findIndex(v=>v.name===A[0])+1)%x.length;E([x[w].name])}else E(k=>{const v=(x.findIndex(J=>J.name===k[k.length-1])+1)%x.length;return[k[1],x[v].name]})},className:"forward-mobile-areas"})]}),b&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"action-btn",onClick:()=>{const k=new URLSearchParams(window.location.search),w=k.get("companyId"),v=k.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${w}&areaId=${v}&type=create-template`},children:"Create new Template"})," ",t.jsx("br",{})]}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:G,children:"Close"}),N&&L&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader"})})]})})})}function Kn({dialogRef:c,closeDialog:G,addSection:V}){const[L,b]=d.useState(""),[R,C]=d.useState(1),[T,F]=d.useState(1);return t.jsx("dialog",{ref:c,className:"section-dialog",children:t.jsxs("div",{className:"section-dialog-div",children:[t.jsx("h2",{children:"Add Section"}),t.jsxs("div",{className:"section-row",children:[t.jsx("label",{htmlFor:"section-name",children:"Name:"}),t.jsx("input",{type:"text",id:"section-name",name:"section-name",onChange:A=>b(A.target.value??""),value:L})]}),t.jsxs("div",{className:"section-row section-size",children:[t.jsx("label",{htmlFor:"section-width",children:"Size (in feet):"}),t.jsx("input",{type:"number",id:"section-width",name:"section-width",min:"1",value:R,onChange:A=>C(parseFloat(A.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"section-height",name:"section-height",min:"1",value:T,onChange:A=>F(parseFloat(A.target.value)??1)})]}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{if(L.trim()===""){alert("Section name cannot be empty");return}const A=new ue({quantity:1,item:new p({id:L+(Math.random()*1e4).toString(),name:L,icon:`custom-${L}`,cellsLong:Math.ceil(R),cellsTall:Math.ceil(T),moveable:!0,starterItem:!1,displayItem:!0,isSectionItem:!0})});V(A),b(""),C(1),F(1),G()},children:"Add Section"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:G,children:"Close"})]})})}function _n({dialogRef:c,closeDialog:G,addInventoryItem:V}){const[L,b]=d.useState(null),[R,C]=d.useState(""),[T,F]=d.useState(1),[A,E]=d.useState(1),[N,B]=d.useState(1),[x,Y]=d.useState(!0),[k,w]=d.useState([]);return d.useEffect(()=>{Rn(localStorage.getItem("companyId")||"").then(v=>{w(v)})},[]),t.jsx("dialog",{ref:c,className:"inventory-item-dialog",children:t.jsxs("div",{className:"inventory-item-dialog-div",children:[t.jsx("h2",{children:"Add Inventory Item"}),L==null?t.jsxs(t.Fragment,{children:["  ",t.jsx("label",{htmlFor:"",children:"Premade Items:"}),t.jsx("div",{className:"inventory-item-list",children:k.map(v=>t.jsx(Zn,{item:v,onSelect:()=>{const J=new ue({quantity:1,item:new p({id:v.name+(Math.random()*1e4).toString(),name:v.name,icon:v.icon,cellsLong:v.cellsLong,cellsTall:v.cellsTall,moveable:!0,starterItem:!1,displayItem:!0})});b(J)}},v.id))}),t.jsx("label",{htmlFor:"",children:"Or:"}),t.jsx("label",{htmlFor:"",children:"Custom Item:"}),t.jsxs("div",{className:"inventory-item-row",children:[t.jsx("label",{htmlFor:"item-name",children:"Name:"}),t.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:v=>C(v.target.value??""),value:R})]}),t.jsxs("div",{className:"inventory-item-row",children:[t.jsx("label",{htmlFor:"item-icon",children:"Count:"}),t.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:T,onChange:v=>F(parseInt(v.target.value)??1)})]}),t.jsxs("div",{className:"inventory-item-row inventory-item-size",children:[t.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),t.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:A,onChange:v=>E(parseFloat(v.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:N,onChange:v=>B(parseFloat(v.target.value)??1)})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),t.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:x,onChange:v=>Y(v.target.checked)})]}),t.jsx("br",{})]}):t.jsxs(t.Fragment,{children:[t.jsxs("label",{htmlFor:"",children:["Item: ",L.item.name]}),t.jsxs("div",{className:"inventory-item-row",children:[t.jsx("label",{htmlFor:"item-icon",children:"Count:"}),t.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:T,onChange:v=>F(parseInt(v.target.value)??1)})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),t.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:x,onChange:v=>Y(v.target.checked)})]})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{if(R.trim()===""&&L==null){alert("Item name cannot be empty");return}if(T<=0){alert("Item count must be greater than zero");return}let v=L;v==null?v=new ue({quantity:T,item:new p({id:R+(Math.random()*1e4).toString(),name:R,icon:`inventory-${R}`,cellsLong:Math.ceil(A),cellsTall:Math.ceil(N),moveable:x,starterItem:!1,displayItem:!0})}):(v.quantity=T,v.item.moveable=x),V(v),Y(!0),b(null),C(""),F(1),E(1),B(1),G()},children:"Add Item"}),t.jsx("button",{className:"action-btn",onClick:()=>{Y(!0),b(null),C(""),F(1),E(1),B(1),G()},children:"Close"})]})})}function el({item:c,setSelectingItem:G,addHighlightedCell:V,canPlaceItem:L,placeItem:b,highlightCells:R,unHighlightCells:C,cellSize:T,placeMultiItem:F}){const[A,E]=d.useState(0),[N,B]=d.useState(0),x=d.useRef(null),[Y,k]=d.useState(0),[w,v]=d.useState(0),[J,X]=d.useState(!1),[D,ce]=d.useState(0),[le,Ae]=d.useState(null),[vt,fe]=d.useState(!0),[Ne,ze]=d.useState(12),[Me,qe]=d.useState(null),$e=d.useRef(null),[Ge,St]=d.useState(!0),[Fe,oe]=d.useState(!1),[re,j]=d.useState(!1),ae=d.useCallback(M=>{const y=M%2===1;return{width:y?c.cellsTall*T:c.cellsLong*T,height:y?c.cellsLong*T:c.cellsTall*T,cellsWide:y?c.cellsTall:c.cellsLong,cellsTall:y?c.cellsLong:c.cellsTall}},[c,T]);function ot(M){const y=x.current,ee=window.getComputedStyle(y),P=document.createElement("span");P.style.font=ee.font,P.style.fontSize=M+"px",P.style.fontFamily=ee.fontFamily,P.style.fontWeight=ee.fontWeight,P.style.position="absolute",P.style.visibility="hidden",P.style.whiteSpace="nowrap",P.textContent=y.textContent,document.body.appendChild(P);const de=P.offsetWidth;return document.body.removeChild(P),de}function Ve(M){if(x.current){const y=x.current;return ot(M-1)>y.offsetWidth&&M-1>8?Ve(M-1):M-1}return M}const ve=()=>{oe(!0)},ke=()=>{oe(!1)};d.useEffect(()=>(setTimeout(()=>{x.current&&ze(Ve(Ne))},100),window.addEventListener("mousedown",ve),window.addEventListener("mouseup",ke),()=>{window.removeEventListener("mousedown",ve),window.removeEventListener("mouseup",ke)}),[]),d.useEffect(()=>{if(c){X(!0);const M=$e.current?.getBoundingClientRect();qe({x:M?M.left-A:0,y:M?M.top-N:0})}else console.log("No item to place, stopping dragging"),X(!1),qe(null),E(0),B(0),k(0),v(0),ce(0),Ae(null),fe(!0),ze(12),St(!0)},[c]);const Le=M=>{M.preventDefault()},Te=d.useCallback((M,y,ee)=>{if(c==null||!J||!Me)return;console.log("PLACING MOVE",c);const P=ee.target,de=ae(D),U=p.fromDoc(c.toDoc());U.cellsLong=de.cellsWide,U.cellsTall=de.cellsTall,U.initialElement=c.initialElement,U.rotation=D,U.hasMoved=c.hasMoved,U.id=c.id;let Ie=P;if(!Ie||!Ie.classList?.contains("cell")){const pe=document.elementFromPoint(M,y);pe?.classList?.contains("cell")&&(Ie=pe)}Ie?.classList?.contains("cell")&&!re?R(h.fromString(Ie.id),U):Ie?.classList?.contains("section-modifier")&&!re?R(h.fromString(Ie.dataset.cell),U):re||C(),E(M-Me.x),B(y-Me.y+(c.sectionModifierType?.includes("Door")?10:5)),Fe&&(re||C(),j(!0),V(h.fromString(Ie.id)))},[c,J,A,N,re,Fe,Me,L,b,ae,D,R,C,$e]),he=d.useCallback(M=>{if(c==null)return;const y=M.clientX,ee=M.clientY;console.log("Drag ended"),C(),document.body.removeEventListener("touchmove",Le);const P=document.elementFromPoint(y,ee);if(!P?.classList?.contains("cell")&&!P?.classList?.contains("section-modifier")){const de=ae(D),U={...c,cellsLong:de.cellsWide,cellsTall:de.cellsTall};re?(j(!1),F(U)):G()}else if(P?.classList?.contains("section-modifier")){if(console.log("Placing item on section modifier cell"),console.log("Target element:",P.dataset.cell),P.dataset.cell=="")return;const de=ae(D),U={...c,cellsLong:de.cellsWide,cellsTall:de.cellsTall};if(re)j(!1),F(U);else{if(!L(h.fromString(P.dataset.cell),U))return;b(h.fromString(P.dataset.cell),U,le!=null?h.fromString(le.id):null)}console.log("Placed item at cell:",P)}else{const de=ae(D),U={...c,cellsLong:de.cellsWide,cellsTall:de.cellsTall};if(re)j(!1),F(U);else{if(!L(h.fromString(P.id),U))return;b(h.fromString(P.id),U,le!=null?h.fromString(le.id):null)}console.log("Placed item at cell:",P)}},[c,D,G,re,L,b,le,C,Y,w]),Ze=d.useCallback(M=>{const y=M.clientX,ee=M.clientY;Te(y,ee,M)},[Te]),Ye=d.useCallback(M=>{const y=M.touches[0],ee=y.clientX,P=y.clientY;Te(ee,P,M)},[Te]),Z=d.useCallback(M=>{const y=M.changedTouches[0],ee=y.clientX,P=y.clientY;he({clientX:ee,clientY:P}),document.body.removeEventListener("touchmove",Le)},[he,Le]);return d.useEffect(()=>{if(J)return document.body.addEventListener("touchmove",Le,{passive:!1}),document.addEventListener("mousemove",Ze),document.addEventListener("mouseup",he),document.addEventListener("touchmove",Ye),document.addEventListener("touchend",Z),()=>{document.body.removeEventListener("touchmove",Le),document.removeEventListener("mousemove",Ze),document.removeEventListener("mouseup",he),document.removeEventListener("touchmove",Ye),document.removeEventListener("touchend",Z)}},[J,Ze,he,Ye,Z,Le]),A==0||N==0||!Ge||c==null?t.jsx(t.Fragment,{}):t.jsx(t.Fragment,{children:t.jsx("div",{id:c.id,ref:$e,className:`draggable-item ${c.isSectionModifier&&!c.moveable?"placed-modifier":""} ${c.isSectionModifier?c.sectionModifierType?.toString():""} ${J?"dragging":""} ${c.moveable?"":"not-moveable"}`,style:{top:`${N}px`,left:`${A}px`,width:`${c.cellsLong*(c.isDisplayItem&&!J&&!c.hasMoved?10:T)-(c.sectionModifierType=="LeftWall"||c.sectionModifierType=="RightWall"||c.sectionModifierType?.includes("Corner")?1:0)}px`,height:`${c.cellsTall*(c.isDisplayItem&&!J&&!c.hasMoved?10:T)-(c.sectionModifierType=="TopWall"||c.sectionModifierType=="BottomWall"||c.sectionModifierType?.includes("Corner")?1:0)}px`,rotate:`${D*90}deg`,transformOrigin:"center center",fontSize:`${Ne}px`,zIndex:J?1e3:1},children:c.isSectionModifier?null:c.icon.includes("custom-")?t.jsx("div",{className:c.isSectionItem?"custom-section":"custom-icon",children:t.jsx("div",{children:t.jsx("p",{ref:x,children:c.icon.split("custom-")[1]})})}):t.jsx("img",{src:c.icon,alt:"icon"})})})}const tl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE02lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTE2PC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmRiZTM1YTM5LWE0MDUtNDM2MC04YzRjLWI3NmJmMTY3Mjc1YjwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5hZGQtaXRlbSAtIDc8L3JkZjpsaT4KICAgPC9yZGY6QWx0PgogIDwvZGM6dGl0bGU+CiA8L3JkZjpEZXNjcmlwdGlvbj4KCiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogIHhtbG5zOnBkZj0naHR0cDovL25zLmFkb2JlLmNvbS9wZGYvMS4zLyc+CiAgPHBkZjpBdXRob3I+U2FyYWggS2VtbWVOYXNoPC9wZGY6QXV0aG9yPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp4bXA9J2h0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8nPgogIDx4bXA6Q3JlYXRvclRvb2w+Q2FudmEgKFJlbmRlcmVyKSBkb2M9REFHdTJ5dUVOWkEgdXNlcj1VQUZqR1c2eHRDUSBicmFuZD1bQVJDSElWRURdIEZvcnQgV2F5bmUgQ29tbXVuaXR5IFNjaG9vbHMgdGVtcGxhdGU9PC94bXA6Q3JlYXRvclRvb2w+CiA8L3JkZjpEZXNjcmlwdGlvbj4KPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0ncic/PupmVZwAAAT8SURBVHic7d1PaBxVHMDxX41Wh6DsE1FcweGltiAUpE7Vanm9BGzGqvGgJ9e/bRSliHrwkIueiif/gShkVFRGLCbR4p8ulSBMEEul7+rJF6jgXqQTFSEiK15m4yTZze7MvJn3m5nf95p9+xv4MLOZycxmB1Co2mF6A6iNEQiyCARZBIIsAkEWgSCLQJBFIMgiEGQRCLIIBFkEgiwCGVCDi7GJydnjbOLQEQC4AQBUqAJfeu6nec4lkD41uLjcmWl/AQBTm38WquAd6bnP5jV7LK83LmsRxucA4Pb7ucXs2xgX13ek/1Ue8wkk1jCMXhaz9zMurutI/2vd20AgUQ0udkaHqW0xekV7yrUd6X+jczsIBNYxFgDgSJJ1Eco1Hemf1rUttQeJYdybZr3F7NsZF1d3pN/WsT21BmlwcZkz016ElBi9LGbfwbhgOlBqDXLwpZ8WAeB+He9lMfsA4+KqjvTPZHmfWoMwLpoWsw/rej+L2XcyLq7MglJrkI70f2Bc/KkZ5S7GxXhH+t+mWV9rEIB1lD80oxxkXFzsSP9c0rW1BwEA6Ej/LOPid4vZWy6VpM1i9oFQLb+2tnrh3yTrLtG1AZhrcLFz8sRfLze4sAa9RnruG6EKXtQ4lrEJsTfposqDROcZ8wDwijPT/rLBxRWDXis99/VQBc9rHP930gWVvto74KTvzPm5qenVleW1QetuPXb6OTZx6M2M439Zmh2/Memiyu4hsT1j80nf3c5M+9SQPeWtUAUvZJmf9vBXyQ/12J5x34CX7Go6rf2hWp5fW73Q7feC6IP+osXskS42xgtV8LT03I+TrgOoIEiCa1M3NZ2WMwTlHOPiN4vZ94w6P1TBU9Jz55Jsc7xKgaS4ULh7BJQfR0UJVXBUeu57SbZ5c5UByXDVdnfTae3LihKq4EnpuR8knL2lSoBkvYQOAHsilIUUKN1QBY9Jz/0o5ewNlR5EA0avNCjdUAWPSs/1M85er9QgGjF67Wk6rVsilL6XPGIoh0MVPKz7tqDSnhjGzjMG/WqbpVPn56YeWl1Z/mfQC/jk7K6VpRM/6x5cSpAc9ox+DUXJo9KdqReEAQAw7cy0Tza4uDTnORsq1WdIgRi9bm46rb2hWl5Mehk9baU5ZEU3JMyDpr+BJ2xhaXb8wSIGleKQFWF8BmYwIFTBd0XNQr+HxDCmTcwPVXBceu7bRc1DDVI3DADEIHXEAEAKUlcMAIQgdcYAQAZSdwwARCAIMJ6RnvuuidnxUIAQxv8ZByGMjRkFIYytGQMhjP4ZASGMwRUOQhjbVygIAoxMN7EVUWEghDFahYAQxujlDkIYycoVhDCSlxsIYaQrFxDCSJ92EAQYx7I+EmAyrSAIMI5Kz33fxGxdaQMhDD1pASEMfWUGIQy9ZQIhDP2lBiGMfEoFggBDywOWGEsM0uBiLLoL/YEctmdooQoel577oYnZRZT47nc2IfaBOYwnqowBAJDm6SAjjzBUfc/oVYrnQ+qCAVACkDphACAHqRsGAF6QbqiCR+qGAZDuQz3vel9X8YnpDTERtj2k1hgAuEBqjwGAB4QwojCAEEYs0yCEsSmTv2V1QxW08v43dGXLFEg3+vKvk4bmo83EIYswtinNHvIrALyadmCogu+l5+byPwCrkPGHPqmNEQiyCARZBIIsAkEWgSCLQJBFIMgiEGQRCLIIBFkEgqz/ADvdpRk/dmKqAAAAAElFTkSuQmCC";function nl({vendor:c,onDelete:G,onEdit:V,boothMap:L}){return t.jsxs("div",{className:"vendor-display-tile",children:[t.jsxs("div",{className:"vendor-info",children:[t.jsx("h3",{className:"vendor-business-name",children:c.businessName}),t.jsxs("p",{className:"vendor-plot-size",children:[c.plotWidth,"ft x ",c.plotHeight,"ft"]})]}),t.jsxs("div",{className:"vendor-actions",children:[t.jsx("img",{src:Yn,alt:"Share",className:"vendor-link",onClick:async b=>{b.stopPropagation();const R=localStorage.getItem("companyId"),C=window.location.origin+`/LayItOut/Layout/?companyId=${R}&areaId=${L.areaId}&type=pick-booth&boothMapId=${L.id}&boothMapName=${L.name}&vendorId=${c.id}`;await navigator.clipboard.writeText(C),alert("BoothMap link copied to clipboard!")}}),t.jsx("img",{src:tl,alt:"Edit",className:"vendor-edit",onClick:b=>{b.stopPropagation(),V(c.id)}}),t.jsx("img",{src:Jn,alt:"Delete",className:"vendor-delete",onClick:b=>{b.stopPropagation(),window.confirm("Are you sure you want to delete this vendor?")&&G(c.id)}})]})]})}function ll({maxHeight:c,vendors:G,onAddVendor:V,boothMap:L,onDeleteVendor:b,onEditVendor:R}){return t.jsxs("div",{className:"vendors-tile",style:{maxHeight:c?`${c}px`:"200px"},children:[t.jsx("h2",{children:"Vendors"}),t.jsx("div",{className:"vendors-divider"}),t.jsxs("div",{className:"vendors-tile-content",children:[G.map(C=>t.jsx(nl,{vendor:C,boothMap:L,onDelete:T=>{b(T)},onEdit:T=>{R(C)}},C.id)),t.jsx("div",{className:"add-vendor",onClick:V,children:t.jsx("img",{src:Ft,alt:"Add vendor"})})]})]})}function ol({dialogRef:c,closeDialog:G,addVendor:V}){const[L,b]=d.useState(""),[R,C]=d.useState(1),[T,F]=d.useState(1),[A,E]=d.useState(!1);return t.jsxs("dialog",{ref:c,className:"add-vendor-dialog",children:[t.jsxs("div",{className:"add-vendor-dialog-div",children:[t.jsx("h2",{children:"Add Vendor"}),t.jsxs("div",{className:"add-vendor-row",children:[t.jsx("label",{htmlFor:"business-name",children:"Business Name:"}),t.jsx("input",{type:"text",id:"business-name",name:"business-name",onChange:N=>b(N.target.value??""),value:L})]}),t.jsxs("div",{className:"add-vendor-row add-vendor-size",children:[t.jsx("label",{htmlFor:"item-width",children:"Booth Size (in feet):"}),t.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:R,onChange:N=>C(parseFloat(N.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:T,onChange:N=>F(parseFloat(N.target.value)??1)})]}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:async()=>{if(L.trim()===""){alert("Business name cannot be empty");return}const N=new Gt({id:L+(Math.random()*1e4).toString(),businessName:L,plotWidth:Math.ceil(R),plotHeight:Math.ceil(T)});E(!0),await V(N),b(""),C(1),F(1),E(!1),G()},children:"Add Vendor"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{G(),b(""),C(1),F(1)},children:"Close"})]}),A&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader"})})]})}function sl({dialogRef:c,closeDialog:G,editVendor:V,oldVendor:L}){const[b,R]=d.useState(""),[C,T]=d.useState(1),[F,A]=d.useState(1),[E,N]=d.useState(!1);return d.useEffect(()=>{L&&(R(L.businessName),T(L.plotWidth),A(L.plotHeight))},[L]),t.jsxs("dialog",{ref:c,className:"edit-vendor-dialog",children:[t.jsxs("div",{className:"edit-vendor-dialog-div",children:[t.jsx("h2",{children:"Edit Vendor"}),t.jsxs("div",{className:"edit-vendor-row",children:[t.jsx("label",{htmlFor:"business-name",children:"Business Name:"}),t.jsx("input",{type:"text",id:"business-name",name:"business-name",onChange:B=>R(B.target.value??""),value:b})]}),t.jsxs("div",{className:"edit-vendor-row edit-vendor-size",children:[t.jsx("label",{htmlFor:"item-width",children:"Booth Size (in feet):"}),t.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:C,onChange:B=>T(parseFloat(B.target.value)??1)}),t.jsx("span",{children:" x "}),t.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:F,onChange:B=>A(parseFloat(B.target.value)??1)})]}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:async()=>{if(b.trim()===""){alert("Business name cannot be empty");return}const B=new Gt({id:L.id,businessName:b,plotWidth:Math.ceil(C),plotHeight:Math.ceil(F)});N(!0),await V(B),R(""),T(1),A(1),N(!1),G()},children:"Save Vendor"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{G(),R(L.businessName),T(L.plotWidth),A(L.plotHeight)},children:"Close"})]}),E&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader"})})]})}function il({maxHeight:c}){return t.jsxs("div",{className:"key-tile",children:[t.jsx("h2",{children:"Key"}),t.jsx("div",{className:"key-divider"}),t.jsxs("div",{className:"key-tile-content",children:[t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"cell cell-border"}),t.jsx("p",{children:"1ft x 1ft"})]}),t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"container",children:t.jsx("div",{className:"wall"})}),t.jsx("p",{children:"Wall"})]}),t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"window-container",children:t.jsx("div",{className:"window"})}),t.jsx("p",{children:"Window"})]}),t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"container",children:t.jsx("img",{src:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fright_door.png?alt=media&token=8c6f3b4d-5e7a-4b9c-8d2f-0a3b5e6f7c8d",alt:"",className:"door"})}),t.jsx("p",{children:"Door"})]}),t.jsxs("div",{className:"key-item",children:[t.jsx("div",{className:"window-container",children:t.jsx("div",{className:"section-divider"})}),t.jsx("p",{children:"Section Divider"})]})]})]})}function al({dialogRef:c,closeDialog:G,vendors:V,addVendorToBooth:L}){const[b,R]=d.useState(!1),[C,T]=d.useState(null);return t.jsxs("dialog",{ref:c,className:"add-vendor-dialog",children:[t.jsxs("div",{className:"add-vendor-dialog-div",children:[t.jsx("h2",{children:"Select Vendor"}),t.jsxs("div",{className:"add-vendor-row",children:[t.jsx("label",{htmlFor:"boothMap-area",children:"Vendor:"}),t.jsxs("select",{id:"boothMap-area",name:"boothMap-area",onChange:F=>{const A=F.target.value,E=V.find(N=>N.id===A)||null;T(E)},value:C?.id||"",children:[t.jsx("option",{value:"",children:"Select a Vendor"}),V.map(F=>t.jsx("option",{value:F.id,children:F.businessName},F.id))]})]}),t.jsx("button",{className:"action-btn",onClick:()=>{if(!C){alert("Please select a vendor");return}R(!0),L(C)},children:"Select"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("button",{className:"action-btn",onClick:()=>{G(),T(null)},children:"Close"})]}),b&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader"})})]})}Nn.createRoot(document.getElementById("root")).render(t.jsx(cl,{}));function cl(){const[c,G]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[V,L]=d.useState(0),[b,R]=d.useState(0),[C,T]=d.useState(0),[F,A]=d.useState(0),[E,N]=d.useState([]),[B,x]=d.useState([]),[Y,k]=d.useState(0),[w,v]=d.useState(null),[J,X]=d.useState([]),D=/Mobi|Android/i.test(navigator.userAgent)?5:10,[ce,le]=d.useState([]),[Ae,vt]=d.useState(!1),[fe,Ne]=d.useState(null),[ze,Me]=d.useState(null),[qe,$e]=d.useState([new p({id:"left-wall",name:"Left Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWall"}),new p({id:"right-wall",name:"Right Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWall"}),new p({id:"top-wall",name:"Top Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWall"}),new p({id:"bottom-wall",name:"Bottom Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWall"}),new p({id:"left-door",name:"Left Door",cellsLong:1,cellsTall:1,icon:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fleft_door.png?alt=media&token=91fde31c-ebc6-4807-9670-f846c8d75cb6",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftDoor"}),new p({id:"right-door",name:"Right Door",cellsLong:1,cellsTall:1,icon:"https://firebasestorage.googleapis.com/v0/b/kazoom-layitout.firebasestorage.app/o/public%2Fright_door.png?alt=media&token=8c6f3b4d-5e7a-4b9c-8d2f-0a3b5e6f7c8d",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightDoor"}),new p({id:"left-window",name:"Left Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWindow"}),new p({id:"right-window",name:"Right Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWindow"}),new p({id:"top-window",name:"Top Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWindow"}),new p({id:"bottom-window",name:"Bottom Window",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWindow"})]),Ge=d.useRef(null),[St,Fe]=d.useState(!1),[oe,re]=d.useState([]),[j,ae]=d.useState([]),[ot,Ve]=d.useState([]),[ve,ke]=d.useState([]),[Le,Te]=d.useState(!1),he=d.useRef(null),[Ze,Ye]=d.useState([]),[Z,M]=d.useState([]),[y,ee]=d.useState(null),[P,de]=d.useState(!1),[U,Ie]=d.useState(!1),[pe,Vt]=d.useState(!1),[Je,Zt]=d.useState(!1),[te,Yt]=d.useState(!1),[$,st]=d.useState("placing-sections"),[rl,Jt]=d.useState(!1),[Se,Ut]=d.useState(!1),[Ke,Ht]=d.useState(!1),[Ue,Xt]=d.useState(!1),[Qt,zt]=d.useState(!1),[De,bt]=d.useState(!1),[He,Xe]=d.useState(""),[_e,qt]=d.useState(null),[Oe,jt]=d.useState(""),[H,$t]=d.useState(""),[Kt,_t]=d.useState(null),[q,en]=d.useState(""),[it,tn]=d.useState(null),[at,et]=d.useState(""),[Lt,tt]=d.useState(""),[ne,Ce]=d.useState(null),[ct,Q]=d.useState(!0),[Tt,nn]=d.useState(null),[rt,ye]=d.useState(!1),[ln,on]=d.useState(null),[sn,At]=d.useState([]),[an,Pe]=d.useState(!1),[be,cn]=d.useState(null),[dt,rn]=d.useState(!1),[dn,mn]=d.useState(null),[mt,gn]=d.useState(null),gt=d.useRef(null),ut=d.useRef(null),ft=d.useRef(null),ht=d.useRef(null),It=d.useRef(null),pt=d.useRef(null);function we(n,e){for(const s of e)if(n.x>=s.cellId.x&&n.x<s.cellId.x+s.cellsLong&&n.y>=s.cellId.y&&n.y<s.cellId.y+s.cellsTall)return s;return null}function un(n,e,s,a){re([...n.map(o=>new W({name:o.name,cellId:new h({x:o.cellId.x,y:o.cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,modifierItems:o.modifierItems.map(l=>new z({cell:new h({x:l.cell.x,y:l.cell.y}),item:new p({...l.item,starterItem:!0})})),startingItems:[]}))]);let i=V,r=b;if(c){for(const u of n)console.log("Generating cells for section",u.name,"at",u.cellId,"with size",u.cellsLong,"x",u.cellsTall),console.log("Needed section Width:",(u.cellsLong+u.cellId.x)*D,"Current width:",i),(u.cellsLong+u.cellId.x)*D>i&&(console.log("Added section Width:",u.cellsLong*D+u.cellId.x),i+=(u.cellsLong+u.cellId.x)*D-i),console.log("Needed section Height:",(u.cellsTall+u.cellId.y)*D,"Current height:",r),(u.cellsTall+u.cellId.y)*D>r&&(console.log("Added section Height:",u.cellsTall*D+u.cellId.y),r+=(u.cellsTall+u.cellId.y)*D-r);A(r/D*2),T(i/D*2);let o=0;const l=[],g=[];for(const u of n){const f=[],S={width:u.cellsLong*D,height:u.cellsTall*D,sectionName:u.name};S.height>o&&(o=S.height),Ye(O=>[...O,S]),u.cellId.x=0,u.cellId.y=0,[...Array(S.height/D).keys()].map(O=>{const me=[];[...Array(S.width/D).keys()].map(se=>{me.push({id:new h({x:se,y:O}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:D})}),f.push(me)}),l.push({sectionName:u.name,cells:[...f]}),g.push(u)}M(l),ae(g),k(o),ee(n[0]?n[0].name:null),setTimeout(()=>{Q(!1)},500)}else{const o=[];for(const l of n)console.log("Generating cells for section",l.name,"at",l.cellId,"with size",l.cellsLong,"x",l.cellsTall),console.log("Needed section Width:",l.cellsLong+l.cellId.x,"Current width:",i),l.cellsLong+l.cellId.x>i&&(console.log("Added section Width:",l.cellsLong+l.cellId.x),i+=l.cellsLong+l.cellId.x-i),console.log("Needed section Height:",l.cellsTall+l.cellId.y,"Current height:",r),l.cellsTall+l.cellId.y>r&&(console.log("Added section Height:",l.cellsTall+l.cellId.y),r+=l.cellsTall+l.cellId.y-r);L(e.width),R(e.height),T(e.width),A(e.height),console.log("Final width:",i,"Final height:",r),[...Array(e.height).keys()].map(l=>{const g=[];[...Array(e.width).keys()].map(u=>{console.log("Creating cell at",u,l,"with size",D,s),g.push({id:new h({x:u,y:l}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:s&&a=="placing-sections"?!0:we(new h({x:u,y:l}),n)!=null,size:D})}),o.push(g)}),N([...o]),setTimeout(()=>{const l=[],g=[...n],u=[];for(const f of g)f.cellElement=document.querySelector(`.App #${f.cellId.toId()}.cell:not(.cell-border)`),l.push(...f.startingItems.map(S=>new z({cell:new h({x:f.cellId.x+S.cell.x,y:f.cellId.y+S.cell.y}),item:new p({...S.item,initialElement:document.querySelector(`.App #${S.cell.toId()}.cell:not(.cell-border)`),starterItem:!0})}))),l.push(...f.modifierItems.map(S=>new z({cell:new h({x:f.cellId.x+S.cell.x,y:f.cellId.y+S.cell.y}),item:new p({...S.item,initialElement:document.querySelector(`.App #${S.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1})}))),u.push(...f.booths.map(S=>new je({...S,cell:new h({x:f.cellId.x+S.cell.x,y:f.cellId.y+S.cell.y}),initialElement:document.querySelector(`.App #${S.cell.toId()}.cell:not(.cell-border)`)})));ae([...g]);for(const f of l){const S=se=>{const ge=se%2===1;return{cellsLong:ge?f.item.cellsTall:f.item.cellsLong,cellsTall:ge?f.item.cellsLong:f.item.cellsTall}},O=f.item.rotation||0,me=S(O);for(let se=0;se<me.cellsTall;se++)for(let ge=0;ge<me.cellsLong;ge++)o[f.cell.y+se][f.cell.x+ge].hasItem=!0,o[f.cell.y+se][f.cell.x+ge].itemId=f.item.id;f.item.initialElement=document.querySelector(`.App #${f.cell.toId()}.cell:not(.cell-border)`),x(se=>[...se,f.item])}for(const f of u){for(let S=0;S<f.cellsTall;S++)for(let O=0;O<f.cellsLong;O++)o[f.cell.y+S][f.cell.x+O].hasItem=!0,o[f.cell.y+S][f.cell.x+O].itemId=f.id;f.initialElement=document.querySelector(`.App #${f.cell.toId()}.cell:not(.cell-border)`),Ve(S=>[...S,f])}N([...o]),setTimeout(()=>{Q(!1)},500)},100)}}async function fn(){const n=new URLSearchParams(window.location.search),e=n.get("companyId"),s=n.get("areaId"),a=n.get("areaId")||"",i=n.get("companyId")||"",r=n.get("templateId")||"",o=await On(i,a);if(o===null){window.location.href="/LayItOut/DNF/";return}tn(o),on(o.previewImage||null);const l=n.get("type")||"";let g=!1,u=!1,f="modify-sections",S=!1,O=null;if(l==="public-preview"){bt(!0);const m=n.get("designName")||"";Xe(m);const I=n.get("designId")||"";et(I)}else if(l==="create-template")de(!0);else if(l==="edit-template"){Ie(!0);const m=o.templates.find(I=>I.id===r);m&&(nn(m),jt(m.name))}else if(l==="view-design"){g=!0,Vt(!0);const m=n.get("designName")||"";Xe(m);const I=n.get("designId")||"";et(I)}else if(l==="view-area")Zt(!0);else if(l==="edit-design"){g=!0,Jt(!0);const m=n.get("designName")||"";Xe(m);const I=n.get("designId")||"";et(I)}else if(l==="client-edit-design"){g=!0,zt(!0);const m=n.get("designName")||"";Xe(m);const I=n.get("designId")||"";et(I)}else if(l==="create-area"){u=!0,Yt(!0);const m=n.get("stage");m==="placing-sections"?(f="placing-sections",st("placing-sections")):m==="modify-sections"?(st("modify-sections"),f="modify-sections",le(qe.map(I=>new ue({item:new p({...I,displayItem:!0}),quantity:-1})))):m==="placing-items"&&(st("placing-items"),f="placing-items",le(o.inventoryItems.map(I=>new ue({item:new p({...I.item,displayItem:!0}),quantity:I.quantity}))))}else if(l==="view-boothMap"){S=!0,Ut(!0);const m=n.get("boothMapId")||"";tt(m);const I=await nt(i,a,m);if(I===null){window.location.href="/LayItOut/DNF/";return}Ce(I),O=I}else if(l==="pick-booth"){S=!0,Xt(!0);const m=n.get("boothMapId")||"";tt(m);const I=await nt(i,a,m);if(I===null){window.location.href="/LayItOut/DNF/";return}Ce(I),O=I;const ie=n.get("vendorId")||"";if(ie!==""){const _=I.vendors.find(K=>K.id===ie);if(_){cn(_),console.log("Vendor found",_);let K=!1;O.sections.forEach(Tn=>{Tn.booths.forEach(An=>{An.user?.id===_.id&&(K=!0)})}),rn(K);const Ot=await Pn(i);if(Ot===null){window.location.href="/LayItOut/DNF/";return}_t(Ot)}else{window.location.href="/LayItOut/DNF/";return}}}else if(l==="create-boothMap"){S=!0,Ht(!0);const m=n.get("boothMapId")||"";tt(m);const I=await nt(i,a,m);if(I===null){window.location.href="/LayItOut/DNF/";return}Ce(I),O=I}else if(l==="public-preview-boothMap"){S=!0,bt(!0);const m=n.get("boothMapId")||"";tt(m);const I=n.get("designName")||"";Xe(I);const ie=await nt(i,a,m);if(ie===null){window.location.href="/LayItOut/DNF/";return}Ce(ie),O=ie}e&&$t(e),s&&en(s),u||le(o.inventoryItems.map(m=>new ue({item:new p({...m.item,displayItem:!0}),quantity:m.quantity})));const me=[],se=[];for(const m of o.templates){const I=[],ie=[];for(const _ of m.sections)I.push(new W({name:_.name,cellId:new h({x:_.cellId.x,y:_.cellId.y}),cellsLong:_.cellsLong,cellsTall:_.cellsTall,modifierItems:_.modifierItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new p({...K.item,starterItem:!0})})),startingItems:_.startingItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new p({...K.item,starterItem:!0})}))})),ie.push(new W({name:_.name,cellId:new h({x:_.cellId.x,y:_.cellId.y}),cellsLong:_.cellsLong,cellsTall:_.cellsTall,modifierItems:_.modifierItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new p({...K.item,starterItem:!0})})),startingItems:_.startingItems.map(K=>new z({cell:new h({x:K.cell.x,y:K.cell.y}),item:new p({...K.item,starterItem:!0})}))}));me.push(new xe({name:m.name,sections:I,inventoryItems:m.inventoryItems,id:m.id,previewImage:m.previewImage})),se.push(new xe({name:m.name,sections:ie,id:m.id,previewImage:m.previewImage,inventoryItems:m.inventoryItems}))}ke([...me]);const ge=[],We=r===""?void 0:se.find(m=>m.id===r);if(console.log("TEMPLATE",We,"AREA",o),S&&O)le(O.inventoryItems.map(m=>new ue({item:new p({...m.item,displayItem:!0}),quantity:m.quantity}))),re([...O.sections]),ae([...O.sections.map(m=>new W({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,booths:m.booths,modifierItems:m.modifierItems,items:m.startingItems.map(I=>new p({...I.item,sectionCell:new h({x:I.cell.x,y:I.cell.y})}))}))]),ge.push(...O.sections.map(m=>new W({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,booths:m.booths,modifierItems:m.modifierItems,items:m.startingItems.map(I=>new p({...I.item,sectionCell:new h({x:I.cell.x,y:I.cell.y})}))})));else if(g){const m=await Bn(i,a,n.get("designId")||"");if(m===null){window.location.href="/LayItOut/DNF/";return}qt(m),le(m.inventoryItems.map(I=>new ue({item:new p({...I.item,displayItem:!0}),quantity:I.quantity}))),re([...m.sections]),ae([...m.sections.map(I=>new W({name:I.name,cellId:new h({x:I.cellId.x,y:I.cellId.y}),cellsLong:I.cellsLong,cellsTall:I.cellsTall,startingItems:I.startingItems,modifierItems:I.modifierItems,items:I.startingItems.map(ie=>new p({...ie.item,sectionCell:new h({x:ie.cell.x,y:ie.cell.y})}))}))]),ge.push(...m.sections.map(I=>new W({name:I.name,cellId:new h({x:I.cellId.x,y:I.cellId.y}),cellsLong:I.cellsLong,cellsTall:I.cellsTall,startingItems:I.startingItems,modifierItems:I.modifierItems,items:I.startingItems.map(ie=>new p({...ie.item,sectionCell:new h({x:ie.cell.x,y:ie.cell.y})}))})))}else We!==void 0?(le(We.inventoryItems.map(m=>new ue({item:new p({...m.item,displayItem:!0}),quantity:m.quantity}))),re([...We.sections]),ae([...We.sections.map(m=>new W({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,modifierItems:m.modifierItems,items:m.startingItems.map(I=>new p({...I.item,sectionCell:new h({x:I.cell.x,y:I.cell.y})}))}))]),ge.push(...We.sections.map(m=>new W({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,modifierItems:m.modifierItems,startingItems:m.startingItems,items:m.startingItems.map(I=>new p({...I.item,sectionCell:new h({x:I.cell.x,y:I.cell.y})}))})))):(re([...o.sections]),ae([...o.sections.map(m=>new W({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,modifierItems:m.modifierItems,startingItems:m.startingItems,items:m.startingItems.map(I=>new p({...I.item,sectionCell:new h({x:I.cell.x,y:I.cell.y})}))}))]),ge.push(...o.sections.map(m=>new W({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,modifierItems:m.modifierItems,items:m.startingItems.map(I=>new p({...I.item,sectionCell:new h({x:I.cell.x,y:I.cell.y})}))}))));console.log("SECTIONS TO GENERATE",ge),un(ge,o,l==="create-area",f)}d.useEffect(()=>{fn()},[]);function hn(n,e,s){if(!c||n==null)return;const a=[...s],i=[],r=[],o=s.find(l=>l.name==n);console.log("NEW SECTION",o),console.log("Adding section",o.name,o.cellId),console.log("MOBILE CELLS",e),o.cellElement=document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${o.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",o.cellElement);for(const l of o.startingItems){console.log("Placing starting item",l.item.name,l.cell);const g=S=>{const O=S%2===1;return{cellsLong:O?l.item.cellsTall:l.item.cellsLong,cellsTall:O?l.item.cellsLong:l.item.cellsTall}},u=l.item.rotation||0,f=g(u);for(let S=0;S<f.cellsTall;S++)for(let O=0;O<f.cellsLong;O++){const me=e.find(se=>se.sectionName===o.name);me.cells[l.cell.y+S][l.cell.x+O].hasItem=!0,me.cells[l.cell.y+S][l.cell.x+O].itemId=l.item.id}l.item.initialElement=document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",l.item.initialElement),i.push(new p({...l.item}))}for(const l of o.modifierItems){console.log("Placing starting item",l.item.name,l.cell);const g=S=>{const O=S%2===1;return{cellsLong:O?l.item.cellsTall:l.item.cellsLong,cellsTall:O?l.item.cellsLong:l.item.cellsTall}},u=l.item.rotation||0,f=g(u);for(let S=0;S<f.cellsTall;S++)for(let O=0;O<f.cellsLong;O++){const me=e.find(se=>se.sectionName===o.name);me.cells[l.cell.y+S][l.cell.x+O].hasItem=!0,me.cells[l.cell.y+S][l.cell.x+O].itemId=l.item.id}console.log("Adding item to items",document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`)),i.push(new p({...l.item,initialElement:document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1}))}console.log("Setting sections",a),ae([...a]),console.log("ITEMS",i),x(l=>[...l.filter(u=>!i.some(f=>f.id===u.id)),...i.map(u=>new p({...u,starterItem:!0}))]),r.push(...o.booths.map(l=>new je({...l,initialElement:document.querySelector(`.App #${o.name.split(" ").join("-")} #${o.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`)})));for(const l of r){for(let g=0;g<l.cellsTall;g++)for(let u=0;u<l.cellsLong;u++){const f=e.find(S=>S.sectionName===o.name);f.cells[l.cell.y+g][l.cell.x+u].hasItem=!0,f.cells[l.cell.y+g][l.cell.x+u].itemId=l.id}Ve(g=>[...g,l])}}function Nt(n){let e=[];return n.map(s=>e=[...e,...s]),e}function In(n,e){let s=!1;return e.sections.forEach(a=>{a.booths.forEach(i=>{i.user?.id===n.id&&(s=!0)})}),s}function yt(n,e){console.log(n);const s=c?Z.find(o=>o.sectionName===y).cells:E,a=s[n.y].length,i=s.length;if(console.log(a,i),n.x+e.cellsLong>a||n.y+e.cellsTall>i)return!1;const r=we(n,j);if(!r&&!c&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;for(let o=0;o<e.cellsTall;o++)for(let l=0;l<e.cellsLong;l++){if(!c){const g=we(new h({x:n.x+l,y:n.y+o}),j);if(!g&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;if(g?.name!=r?.name&&($!=="placing-sections"||!te))return console.log("Item is crossing section boundaries"),!1}if(s[n.y+o][n.x+l].hasItem&&s[n.y+o][n.x+l].itemId!=e.id){console.log("Something is already here");const g=B.find(u=>u.id==s[n.y+o][n.x+l].itemId);if(g&&g.isSectionModifier){if(g.sectionModifierType==="LeftDoor"||g.sectionModifierType==="RightDoor")return console.log("Item is on door of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),!1;if(g.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),l==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==e.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==0&&l==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==0&&l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==e.cellsTall-1&&l==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",o,l,e.cellsTall,e.cellsLong),o==e.cellsTall-1&&l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function Mt(n,e,s){console.log(e),console.log("CELLS",n);const a=n[e.y].length,i=n.length;if(console.log(a,i),e.x+s.cellsLong>a||e.y+s.cellsTall>i)return!1;const r=we(e,j);if(!r&&!c&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;for(let o=0;o<s.cellsTall;o++)for(let l=0;l<s.cellsLong;l++){if(!c){const g=we(new h({x:e.x+l,y:e.y+o}),j);if(!g&&($!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;if(g?.name!=r?.name&&($!=="placing-sections"||!te))return console.log("Item is crossing section boundaries"),!1}if(n[e.y+o][e.x+l].hasItem&&n[e.y+o][e.x+l].itemId!=s.id){console.log("Something is already here");const g=B.find(u=>u.id==n[e.y+o][e.x+l].itemId);if(g&&g.isSectionModifier){if(g.sectionModifierType==="LeftDoor"||g.sectionModifierType==="RightDoor")return console.log("Item is on door of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),!1;if(g.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),l==s.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==s.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==0&&l==s.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==0&&l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==s.cellsTall-1&&l==s.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",o,l,s.cellsTall,s.cellsLong),o==s.cellsTall-1&&l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function Ct(n,e,s){const a=Array.from(c?Z.find(o=>o.sectionName===y).cells:E);if(Pe(!0),s!=null){console.log("Removing item",e.id,"from cell",s.toId());const o=c?j.find(l=>l.name===y):we(s,j);o.items=o.items.filter(l=>l.id!=e.id);for(let l=0;l<e.cellsTall;l++)for(let g=0;g<e.cellsLong;g++)a[s.y+l][s.x+g].hasItem=!1,a[s.y+l][s.x+g].itemId=""}const i=e.name+Math.floor(Math.random()*1e5).toString();if($!=="placing-sections"||!te){const o=c?j.find(g=>g.name===y):we(n,j),l=new h({x:n.x-o.cellId.x,y:n.y-o.cellId.y});e.sectionCell=l,console.log("Adding item to section",o.name,"at",l,e),o.items.push(Ae?new p({...e,id:i}):e)}else e.sectionCell=new h({x:n.x,y:n.y});for(let o=0;o<e.cellsTall;o++)for(let l=0;l<e.cellsLong;l++)a[n.y+o][n.x+l].hasItem=!0,a[n.y+o][n.x+l].itemId=e.id;if(console.log(a),c){const o=Z.find(l=>l.sectionName===y);o&&(o.cells=a.map(l=>l.map(g=>({...g}))),M([...Z]))}else N(a);console.log("Removing item from inventory",e.name,e.hasMoved);let r=!1;if(!e.hasMoved){console.log("INVENTORY ITEMs",ce);const o=ce.findIndex(l=>l.item.name==e.name&&!l.item.hasMoved);if(o!==-1){const l=[...ce];console.log("Found item in inventory",l[o]),l[o].quantity>0&&(l[o].quantity-=1,l[o].quantity<=0&&(r=!0,l.splice(o,1)),le(l))}else le(ce)}if(x(o=>(console.log("Placing item",e),console.log("Updating item",e.id),Ae&&fe&&e.id==fe.id?(console.log("Updating placing item",e.id),e.hasMoved=!0,e.starterItem=!0,e.isDisplayItem=!1,e.initialElement=document.querySelector(`.App #${n.toId()}.cell:not(.cell-border)`),console.log("New item id",i),[...o,new p({...e,hasMoved:!0,id:i})]):(o.find(l=>l.id==e.id).hasMoved||(o.find(l=>l.id==e.id).hasMoved=!0,o.find(l=>l.id==e.id).sectionCell=e.sectionCell),o))),Ae&&fe&&r){Ne(null);return}}function pn(n){B.find(e=>e.name==n.name&&!e.hasMoved&&!e.starterItem)||x(e=>[...e,n])}d.useEffect(()=>{fe?(console.log("Adding placing item",fe.id),Me(fe.id)):(console.log("Removing placing item",ze),Me(""))},[fe]);function Et(n){console.log("Removing item",n.id),x(e=>e.filter(s=>s.id!=n.id))}function yn(n,e){const s=Array.from(c?Z.find(o=>o.sectionName===y).cells:E);Pe(!0);const a=o=>{const l=o%2===1;return{cellsWide:l?n.cellsTall:n.cellsLong,cellsTall:l?n.cellsLong:n.cellsTall}},i=n.rotation||0,r=a(i);for(let o=0;o<r.cellsTall;o++)for(let l=0;l<r.cellsWide;l++)s[e.y+o][e.x+l].hasItem=!1,s[e.y+o][e.x+l].itemId="";if(c){const o=Z.find(l=>l.sectionName===y);o&&(o.cells=s.map(l=>l.map(g=>({...g}))),M([...Z])),M(l=>l.map(g=>g.sectionName===y?{...g,cells:s}:g))}else N(s);if($!=="placing-sections"||!te){const o=c?j.find(l=>l.name===y):we(e,j);o.items=o.items.filter(l=>l.id!=n.id),console.log("DELETING ITEM section",n.id),console.log("SECTION ITEMS AFTER DELETE",o.items)}x(o=>(console.log("Removing item new",n.id),console.log("ITEMS AFTER REMOVE",o.filter(l=>l.id!=n.id)),o.filter(l=>l.id!=n.id))),le(o=>{const l=o.findIndex(g=>g.item.name==n.name&&!g.item.hasMoved);if(l!==-1){const g=[...o];return g[l].quantity>0&&(g[l].quantity+=1),g}else return[...o,new ue({item:new p({...n,hasMoved:!1}),quantity:1})]})}function wn(n,e){const s=Array.from(c?Z.find(g=>g.sectionName===y).cells:E);console.log("DELETING ITEM ROTATE",n.id,n.rotation),Pe(!0);const a=g=>{const u=g%2===1;return{cellsWide:u?n.cellsTall:n.cellsLong,cellsTall:u?n.cellsLong:n.cellsTall}},i=n.rotation||0,r=a(i);for(let g=0;g<r.cellsTall;g++)for(let u=0;u<r.cellsWide;u++)console.log("Deleting cell",e.y+g,e.x+u),s[e.y+g][e.x+u].hasItem=!1,s[e.y+g][e.x+u].itemId="";if(c){const g=Z.find(u=>u.sectionName===y);g&&(g.cells=s.map(u=>u.map(f=>({...f}))),M([...Z])),M(u=>u.map(f=>f.sectionName===y?{...f,cells:s}:f))}else N(s);console.log("DELETING ITEM",n.id);const o=c?j.find(g=>g.name===y):we(e,j);o.items=o.items.filter(g=>g.id!=n.id);const l=new h({x:e.x-o.cellId.x,y:e.y-o.cellId.y});n.sectionCell=l,o.items.push(n)}function Rt(n,e){const s=c?Z.find(r=>r.sectionName===y).cells:E,a=Array.from(s);if(s[n.y]==null){console.log("Start cell is out of bounds",n),wt();return}const i=yt(n,e);a.forEach(r=>r.forEach(o=>{o.mouseOver=!1,o.canPlaceItem=!1,o.mouseOverLocation=""}));for(let r=0;r<e.cellsTall;r++)for(let o=0;o<e.cellsLong;o++)n.y+r<a.length&&n.x+o<a[n.y+r].length&&(e.cellsLong===1&&e.cellsTall===1?a[n.y+r][n.x+o].mouseOverLocation="single":e.cellsTall===1?o===0?a[n.y+r][n.x+o].mouseOverLocation="leftFull":o===e.cellsLong-1?a[n.y+r][n.x+o].mouseOverLocation="rightFull":a[n.y+r][n.x+o].mouseOverLocation="middleFull":e.cellsLong===1?r===0?a[n.y+r][n.x+o].mouseOverLocation="topFull":r===e.cellsTall-1?a[n.y+r][n.x+o].mouseOverLocation="bottomFull":a[n.y+r][n.x+o].mouseOverLocation="middleVFull":r===0&&o===0?a[n.y+r][n.x+o].mouseOverLocation="topLeftCorner":r===0&&o===e.cellsLong-1?a[n.y+r][n.x+o].mouseOverLocation="topRightCorner":r===e.cellsTall-1&&o===0?a[n.y+r][n.x+o].mouseOverLocation="bottomLeftCorner":r===e.cellsTall-1&&o===e.cellsLong-1?a[n.y+r][n.x+o].mouseOverLocation="bottomRightCorner":r===0?a[n.y+r][n.x+o].mouseOverLocation="top":r===e.cellsTall-1?a[n.y+r][n.x+o].mouseOverLocation="bottom":o===0?a[n.y+r][n.x+o].mouseOverLocation="left":o===e.cellsLong-1?a[n.y+r][n.x+o].mouseOverLocation="right":a[n.y+r][n.x+o].mouseOverLocation="middle",a[n.y+r][n.x+o].mouseOver=!0,a[n.y+r][n.x+o].canPlaceItem=i);if(c){const r=Z.find(o=>o.sectionName===y);r&&(r.cells=a.map(o=>o.map(l=>({...l}))),M([...Z])),M(o=>o.map(l=>l.sectionName===y?{...l,cells:a}:l))}else N(a)}function wt(){console.log("Unhighlighting cells");const n=Array.from(c?Z.find(e=>e.sectionName===y).cells:E);if(n.forEach(e=>e.forEach(s=>{s.mouseOver=!1,s.canPlaceItem=!1,s.mouseOverLocation=""})),c){const e=Z.find(s=>s.sectionName===y);e&&(e.cells=n.map(s=>s.map(a=>({...a}))),M([...Z])),M(s=>s.map(a=>a.sectionName===y?{...a,cells:n}:a))}else N(n)}d.useEffect(()=>{hn(y,Z,j)},[y]),d.useEffect(()=>{const n=()=>{const e=B.find(s=>s.id===w);console.log("Unselecting item",w),v(null),e&&(X(s=>[...s,e.id]),console.log("Unselecting item",e.id),setTimeout(()=>{X(s=>s.filter(a=>a!==e.id))},300))};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)},[w,B]);function kt(n){v(null),X(e=>[...e,n]),console.log("Unselecting item",n),setTimeout(()=>{X(e=>e.filter(s=>s!==n))},300)}function Dt(n){const e=B.find(s=>s.id===w);console.log("Unselecting item",w),v(n),e&&(X(s=>[...s,e.id]),console.log("Unselecting item",e.id),setTimeout(()=>{X(s=>s.filter(a=>a!==e.id))},300))}function xt(n){le(e=>[...e,n])}const Be=n=>{console.log("Preventing scroll"),n.preventDefault(),n.stopPropagation(),window.scrollTo(0,0)};d.useEffect(()=>(rt?(window.addEventListener("scroll",Be),window.addEventListener("touchmove",Be,{passive:!1})):(window.removeEventListener("scroll",Be),window.removeEventListener("touchmove",Be)),()=>{window.removeEventListener("scroll",Be),window.removeEventListener("touchmove",Be)}),[rt]);async function xn(n){const e=[];Q(!0);for(const i of n){const r=i.name,o=new h({x:i.sectionCell.x,y:i.sectionCell.y}),l=new W({name:r,cellId:o,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:[],startingItems:[],items:[]});e.push(l)}let s=0,a=0;for(const i of e)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",i.cellsLong+i.cellId.x,"Current width:",s),i.cellsLong+i.cellId.x>s&&(console.log("Added section Width:",i.cellsLong+i.cellId.x),s+=i.cellsLong+i.cellId.x-s),console.log("Needed section Height:",i.cellsTall+i.cellId.y,"Current height:",a),i.cellsTall+i.cellId.y>a&&(console.log("Added section Height:",i.cellsTall+i.cellId.y),a+=i.cellsTall+i.cellId.y-a);await Wn(H,q,e,s,a),window.location.href=`/LayItOut/Layout/?companyId=${H}&areaId=${q}&type=create-area&stage=modify-sections`}async function vn(n,e){const s=[];Q(!0);for(const a of e){const i=a.name,r=new h({x:a.cellId.x,y:a.cellId.y});console.log("Saving section modifier items for section",i,a.items.map(l=>l.name),"at cell",r);const o=new W({name:i,cellId:r,cellsLong:a.cellsLong,cellsTall:a.cellsTall,startingItems:[],items:[],modifierItems:a.items.map(l=>new z({cell:new h({x:l.sectionCell.x,y:l.sectionCell.y}),item:new p({...l,isSectionModifier:!0})}))});s.push(o)}console.log("Saving section modifier items",s),await Gn(H,q,s),console.log("Section modifier items saved successfully"),window.location.href=`/LayItOut/Layout/?companyId=${H}&areaId=${q}&type=create-area&stage=placing-items`}async function Sn(n,e){Q(!0);const s=[];for(const a of n){const i=a.name,r=new h({x:a.cellId.x,y:a.cellId.y}),o=new W({name:i,cellId:r,cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(l=>new z({cell:new h({x:l.sectionCell.x,y:l.sectionCell.y}),item:new p({...l,starterItem:!0})})),items:[]});s.push(o)}console.log("Saving area sections",s),localStorage.setItem("screenshotSections",s.map(a=>JSON.stringify(a.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",s.map(a=>JSON.stringify(a.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async a=>{if(console.log("Storage event",a),a.key==="screenshot"){const i=new Fn({id:q,name:it.name,sections:s,templates:[],previewImage:a.newValue,width:it.width,height:it.height,inventoryItems:e.map(r=>new ue({item:new p({...r.item,starterItem:!0}),quantity:r.quantity}))});await Vn(H,i),console.log("Area saved successfully"),Q(!1),window.location.href=`/LayItOut/Layout/?companyId=${H}&areaId=${q}&type=view-area`}})}function bn(n){const e=Array.from(c?Z.find(s=>s.sectionName===y).cells:E);if(e[n.y]!=null)if(e[n.y][n.x].mouseOver=!0,e[n.y][n.x].canPlaceItem=!0,e[n.y][n.x].mouseOverLocation="single",At(s=>[...s,n]),c){const s=Z.find(a=>a.sectionName===y);s&&(s.cells=e.map(a=>a.map(i=>({...i}))),M([...Z])),M(a=>a.map(i=>i.sectionName===y?{...i,cells:e}:i))}else console.log("Adding highlighted cell",n.toId()),N(e)}function jn(n){const e=Array.from(c?Z.find(o=>o.sectionName===y).cells:E);Pe(!0);const s=[];sn.forEach(o=>{s.some(l=>l.toId()===o.toId())||s.push(o)}),At([]);const a=[],i=ce.findIndex(o=>o.item.name==n.name&&!o.item.hasMoved);let r=i!==-1?ce[i].quantity:0;s.forEach(o=>{const l=new p({...n});if(l.id=l.name+Math.floor(Math.random()*1e5).toString(),console.log("Placing item",l.name,"at",o.toId(),"CAN PLACE?",Mt(e,o,l)),Mt(e,o,l)&&r!=0){if(i!==-1&&(r-=1),$!=="placing-sections"||!te){const u=c?j.find(S=>S.name===y):we(o,j);console.log("Adding item to section",u.name,"at",u.cellId,"with cell",o.toId(),o.x-u.cellId.x,o.y-u.cellId.y);const f=new h({x:o.x-u.cellId.x,y:o.y-u.cellId.y});l.sectionCell=f,console.log("Adding item to section",u.name,"at",f,l),u.items.push(l),console.log("SECTION ITEMS",u.items.map(S=>S.name))}else l.sectionCell=new h({x:o.x,y:o.y});for(let u=0;u<n.cellsTall;u++)for(let f=0;f<n.cellsLong;f++)e[o.y+u][o.x+f].hasItem=!0,e[o.y+u][o.x+f].itemId=l.id;l.hasMoved=!0,l.starterItem=!0,l.isDisplayItem=!1,l.initialElement=document.querySelector(`.App #${o.toId()}.cell:not(.cell-border)`);const g=new p({...l});a.push(g)}});for(const o of a)console.log("Adding item to items",o.id),x(l=>[...l,o]);if(i!==-1&&le(o=>{const l=[...o];return l[i].quantity>0&&(l[i].quantity=r,l[i].quantity==0&&l.splice(i,1)),l}),r==0&&Ne(null),c){const o=Z.find(l=>l.sectionName===y);o&&(o.cells=e.map(l=>l.map(g=>({...g}))),M([...Z])),M(l=>l.map(g=>g.sectionName===y?{...g,cells:e}:g))}else N(e);ae(j)}function Ln(n,e,s){Q(!0);const a=[];for(const i of n){const r=i.name,o=new h({x:i.cellId.x,y:i.cellId.y}),l=i.items.filter(f=>f.isBooth),g=i.items.filter(f=>!f.isBooth),u=new W({name:r,cellId:o,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:g.map(f=>new z({cell:new h({x:f.sectionCell.x,y:f.sectionCell.y}),item:new p({...f,displayItem:!0})})),booths:l.map(f=>new je({id:f.name+Math.floor(Math.random()*1e5).toString(),name:f.name,cell:new h({x:f.sectionCell.x,y:f.sectionCell.y}),cellsLong:f.cellsLong,cellsTall:f.cellsTall,user:f.boothUser})),items:[]});a.push(u)}console.log("Saving area sections",a),localStorage.setItem("screenshotSections",a.map(i=>JSON.stringify(i.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",a.map(i=>JSON.stringify(i.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async i=>{if(console.log("Storage event",i),i.key==="screenshot"){const r=new Ee({id:s.id,name:s.name,sections:a,areaId:q,previewImage:i.newValue,inventoryItems:e.map(o=>new ue({item:new p({...o.item,starterItem:!0}),quantity:o.quantity}))});await Re(H,r),console.log("Booth Map saved successfully"),Q(!1),window.location.href=`/LayItOut/Layout/?companyId=${H}&areaId=${q}&type=view-boothMap&boothMapId=${Lt}`}})}return console.log("RENDERING APP",!(te&&$!="placing-items")),t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"App",children:[t.jsx("h1",{className:"title",children:"LayItOut"}),t.jsx("br",{}),Ue&&t.jsxs("div",{className:"area-creation",children:[dt?t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"area-creation-title",children:"You have already picked a booth"}),t.jsxs("label",{htmlFor:"",children:["Contact ",Kt?.supportEmail," to change booths"]})]}):t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"area-creation-title",children:"Picking Booth"}),t.jsx("label",{htmlFor:"",children:"Tap on an open booth then click on the checkmark to pick a booth"})," "]}),t.jsxs("label",{htmlFor:"",children:["Booth Size: ",be?.plotWidth,"ft x ",be?.plotHeight,"ft"]}),t.jsx("br",{})]}),Ke&&t.jsxs("div",{className:"area-creation",children:[t.jsx("h2",{className:"area-creation-title",children:"Create Booth Map"}),t.jsx("label",{htmlFor:"",children:"Create a booth map by placing items and then creating and placing booths, same way you create and place items"})]}),te&&t.jsxs("div",{className:"area-creation",children:[t.jsx("h2",{className:"area-creation-title",children:"Create Area"}),t.jsx("label",{htmlFor:"",children:$=="placing-sections"?"Create new sections and place them":$=="modify-sections"?"Add walls and doors to sections":"Add items to the inventory and place items"})]}),(P||U)&&t.jsxs("div",{className:"template-name-row",children:[t.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),t.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:n=>jt(n.target.value),value:Oe})]}),(pe||De)&&t.jsx("div",{className:"design-name-row",children:t.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",He]})}),(P||U)&&t.jsxs("div",{className:"template-creation",children:[t.jsxs("button",{className:"action-btn",onClick:()=>{if(Oe.trim()==""){alert("Please enter a template name");return}if(ve.some(n=>n.name===Oe&&(U?n.id!==Tt.id:!0))){alert("Template with this name already exists");return}U?(Q(!0),setTimeout(async()=>{const n=j.map(e=>new W({name:e.name,cellId:new h({x:oe.find(s=>s.name==e.name).cellId.x,y:oe.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new p({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){ye(!1);const s=ve.map(a=>a.id===Tt.id?(console.log("SECTION",j),new xe({name:Oe,inventoryItems:ce,previewImage:e.newValue,sections:j.map(i=>new W({name:i.name,cellId:new h({x:a.sections.find(r=>r.name==i.name).cellId.x,y:a.sections.find(r=>r.name==i.name).cellId.y}),cellsLong:i.cellsLong,modifierItems:i.modifierItems,cellsTall:i.cellsTall,startingItems:i.items.map(r=>new z({cell:new h({x:r.sectionCell.x,y:r.sectionCell.y}),item:new p({...r,starterItem:!0})}))})),id:a.id})):new xe({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(i=>new W({name:i.name,cellId:new h({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(r=>new z({cell:new h({x:r.cell.x,y:r.cell.y}),item:new p({...r.item})}))})),id:a.id}));Qe(H,q,s).then(()=>{console.log("Template updated successfully"),Q(!1);const a=new URLSearchParams(window.location.search),i=a.get("companyId"),r=a.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${i}&areaId=${r}&type=view-area`})}})},500)):(Q(!0),setTimeout(async()=>{const n=j.map(e=>new W({name:e.name,cellId:new h({x:oe.find(s=>s.name==e.name).cellId.x,y:oe.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new p({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){ye(!1);const s=new xe({name:Oe,previewImage:e.newValue,inventoryItems:ce,sections:j.map(i=>new W({name:i.name,cellId:new h({x:oe.find(r=>r.name==i.name).cellId.x,y:oe.find(r=>r.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.items.map(r=>new z({cell:new h({x:r.sectionCell.x,y:r.sectionCell.y}),item:new p({...r,starterItem:!0})}))})),id:Oe+(Math.random()*1e4).toString()}),a=[...ve.map(i=>new xe({name:i.name,previewImage:i.previewImage,inventoryItems:i.inventoryItems,sections:i.sections.map(r=>new W({name:r.name,cellId:new h({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,modifierItems:r.modifierItems,startingItems:r.startingItems.map(o=>new z({cell:new h({x:o.cell.x,y:o.cell.y}),item:new p({...o.item})}))})),id:i.id})),s];Qe(H,q,a).then(()=>{console.log("Template updated successfully"),Q(!1);const i=new URLSearchParams(window.location.search),r=i.get("companyId"),o=i.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${r}&areaId=${o}&type=view-area`})}})},500))},children:[P?"Create":"Save"," Template"]}),t.jsx("button",{className:"action-btn",onClick:()=>{const n=new URLSearchParams(window.location.search),e=n.get("companyId"),s=n.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${e}&areaId=${s}&type=view-area`},children:"Cancel"})]}),Qt&&t.jsxs("div",{className:"template-creation",children:[an&&t.jsx("button",{className:"action-btn",onClick:()=>{Q(!0),setTimeout(async()=>{const n=j.map(e=>new W({name:e.name,cellId:new h({x:oe.find(s=>s.name==e.name).cellId.x,y:oe.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new p({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){ye(!1);const s=new Bt({name:He,previewImage:e.newValue,areaId:q,inventoryItems:ce,sections:j.map(a=>new W({name:a.name,cellId:new h({x:oe.find(i=>i.name==a.name).cellId.x,y:oe.find(i=>i.name==a.name).cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(i=>new z({cell:new h({x:i.sectionCell.x,y:i.sectionCell.y}),item:new p({...i,starterItem:!0})}))})),id:at});Wt(H,q,s).then(()=>{console.log("Design updated successfully"),Pe(!1),Q(!1)})}})},500)},children:"Save"}),t.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),!pe&&!Je&&!Se&&!Ue&&!De&&t.jsxs("div",{className:"place-mode-row",children:[t.jsx("label",{htmlFor:"tap-and-place-mode",children:"Place Mode: "}),t.jsxs("select",{id:"tap-and-place-mode",name:"tap-and-place-mode",value:Ae?"tap":"drag",onChange:n=>vt(n.target.value==="tap"),className:"place-mode-select",children:[t.jsx("option",{value:"drag",children:"Drag and Drop"}),t.jsx("option",{value:"tap",children:"Tap and Place"})]})]}),ct&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"loader-backdrop",children:t.jsx("div",{className:"loader"})})})," ",t.jsxs("div",{className:"layout",children:[!pe&&!Je&&!Se&&!Ue&&!De&&t.jsx(Xn,{setSelectedItem:Ne,tapAndPlaceMode:Ae,isModifyingSections:te&&$=="modify-sections",isViewingDesign:pe,isEditingTemplate:U,isCreatingTemplate:P,maxHeight:c?200:b*D,showAddCustomItem:()=>{$=="placing-sections"&&te?ut.current?.showModal():$=="placing-items"&&te?ft.current?.showModal():gt.current?.showModal()},addDraggingItem:pn,removeItem:Et,inventoryItems:ce.map(n=>new ue({item:new p({...n.item,displayItem:!0}),quantity:n.quantity}))}),Se&&ne?t.jsx(ll,{onDeleteVendor:async n=>{Q(!0);const e=new Ee({...ne,vendors:ne.vendors.filter(s=>s.id!==n),sections:ne.sections.map(s=>new W({...s,booths:s.booths.map(a=>a.user?.id===n?new je({...a,user:null,initialElement:a.initialElement??void 0}):a)}))});await Re(H,e),Ce(e),window.location.reload()},onEditVendor:n=>{mn(n),It.current?.showModal()},boothMap:ne,vendors:ne?.vendors??[],maxHeight:c?void 0:b*D,onAddVendor:()=>{ht.current?.showModal()}}):null,c?t.jsxs("div",{className:"mobile-areas",style:{height:Y+"px"},children:[j.length>1&&t.jsx("img",{src:lt,onClick:()=>{const n=j.findIndex(s=>s.name==y);if(n===-1)return;const e=(n-1+j.length)%j.length;ee(j[e].name),console.log("Changing viewing section to",j[e].name)},className:"back-mobile-areas"}),Ze.map((n,e)=>t.jsx(Pt,{width:n.width,height:n.height,cells:Nt(Z.find(s=>s.sectionName==n.sectionName).cells),id:n.sectionName,visibile:y==null?!0:n.sectionName==y,section:n.sectionName},e)),j.length>1&&t.jsx("img",{src:lt,onClick:()=>{const n=j.findIndex(s=>s.name==y);if(n===-1)return;const e=(n+1)%j.length;ee(j[e].name),console.log("Changing viewing section to",j[e].name)},className:"forward-mobile-areas"})]}):t.jsx(Pt,{width:V*D,height:b*D,cells:Nt(E)}),($=="placing-items"||!te)&&t.jsx(il,{maxHeight:c?void 0:b*D})]}),Se&&t.jsx("div",{className:"design-view",children:t.jsx("button",{className:"action-btn",onClick:()=>{const n=j.map(e=>new W({name:e.name,cellId:new h({x:oe.find(s=>s.name==e.name).cellId.x,y:oe.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,booths:e.booths,startingItems:e.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new p({...s,starterItem:!0})}))}));localStorage.setItem("printSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/LayItOut/Print/?companyId=${H}&areaId=${q}&designName=${ne?.name}`,"_blank")},children:"Print"})}),pe&&t.jsxs("div",{className:"design-view",children:[t.jsx("button",{className:"action-btn",onClick:()=>{const n=j.map(e=>new W({name:e.name,cellId:new h({x:oe.find(s=>s.name==e.name).cellId.x,y:oe.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,booths:e.booths,startingItems:e.items.map(s=>new z({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new p({...s,starterItem:!0})}))}));localStorage.setItem("printSections",n.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/LayItOut/Print/?companyId=${H}&areaId=${q}&designName=${He}&designId=${at}`,"_blank")},children:"Print"}),t.jsx("button",{className:"action-btn",onClick:()=>{const n=new xe({name:He,previewImage:_e.previewImage,inventoryItems:_e.inventoryItems,sections:_e.sections,id:_e.name+(Math.random()*1e4).toString()}),e=[...ve.map(s=>new xe({name:s.name,previewImage:s.previewImage,inventoryItems:s.inventoryItems,sections:s.sections.map(a=>new W({name:a.name,cellId:new h({x:a.cellId.x,y:a.cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.startingItems.map(i=>new z({cell:new h({x:i.cell.x,y:i.cell.y}),item:new p({...i.item})}))})),id:s.id})),n];Qe(H,q,e).then(()=>{console.log("Template updated successfully"),ke(e),window.location.href=`/LayItOut/Layout/?companyId=${H}&areaId=${q}&type=edit-template&templateId=${n.id}`})},children:"Turn into a Template"}),t.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=desings"},children:"Back"})]}),Se&&t.jsx("div",{className:"design-view",children:t.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=boothmaps"},children:"Back"})}),Je&&t.jsx("div",{className:"design-view",children:t.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=areas"},children:"Back"})}),te&&t.jsxs("div",{className:"design-view",children:[t.jsx("button",{className:"action-btn",onClick:()=>{$=="placing-sections"?xn(B.filter(n=>n.isSectionItem)):$=="modify-sections"?vn(B.filter(n=>n.isSectionModifier),j):$=="placing-items"&&Sn(j,ce)},children:$=="placing-items"?"Create Area":"Next"}),t.jsx("button",{className:"action-btn",onClick:async()=>{Q(!0),await kn(H,q),window.location.href="/LayItOut/"},children:"Cancel"})]}),Ke&&t.jsxs("div",{className:"design-view",children:[t.jsx("button",{className:"action-btn",onClick:()=>{console.log("Creating booth map with sections",j,"and inventory items",ce,"and boothMap",ne),Ln(j,ce,ne)},children:"Create Booth Map"}),t.jsx("button",{className:"action-btn",onClick:async()=>{Q(!0),await Dn(H,q,Lt),window.location.href="/LayItOut/?view=boothmaps"},children:"Cancel"})]})]}),t.jsxs("div",{children:[j.map(n=>t.jsx(Mn,{takingPhoto:!1,section:n,visible:y==null?!0:n.name==y,cellSize:D},n.cellId.toId())),B.map(n=>t.jsx(Cn,{isPlacingItem:fe!=null,isCreatingArea:te,isCreatingTemplate:P||U,cellSize:D,isViewingDesign:pe||Je||Se||Ue||De,removeItem:Et,visible:c?!n.hasMoved&&!n.starterItem?!0:y==null?!1:n.isSectionModifier?j.find(e=>e.name==y)?.modifierItems.some(e=>e.item.id===n.id):n.starterItem?j.find(e=>e.name==y)?.startingItems.some(e=>e.item.id===n.id):j.find(e=>e.name==y)?.items.some(e=>e.id===n.id):!0,item:n,canPlaceItem:yt,placeItem:Ct,deleteItemRotate:wn,highlightCells:Rt,unHighlightCells:wt,deleteItem:yn,isSelected:w===n.id,onSelect:Dt,isUnselecting:J.includes(n.id),onDeselect:()=>kt(n.id)},n.id)),ot.map(n=>(console.log("CAN PICK BOOTH",n.cellsLong==be?.plotWidth&&n.cellsTall==be.plotHeight,"BOOTH",n,"VENDOR",be),t.jsx(En,{canPick:Se||dt||n.cellsLong==be?.plotWidth&&n.cellsTall==be.plotHeight,visible:c?y==null?!1:j.find(e=>e.name==y)?.booths.some(e=>e.id===n.id)??!1:!0,booth:n,isViewingBooth:Se,isPublicViewingBooth:De,hasPickedBooth:dt,isSelected:w==n.id,cellSize:D,onSelect:Dt,isUnselecting:J.includes(n.id),onDeselect:()=>kt(n.id),onPickBooth:async e=>{Q(!0);const s=j.map(i=>i.name===y?new W({...i,booths:i.booths.map(r=>r.id===e?new je({...r,user:be,initialElement:r.initialElement??void 0}):r)}):i.booths.some(r=>r.id===e)?new W({...i,booths:i.booths.map(r=>r.id===e?new je({...r,user:be,initialElement:r.initialElement??void 0}):r)}):i);console.log("Updated sections",s),ae(s);const a=new Ee({...ne,sections:s});await Re(H,a),window.location.reload(),Q(!1)},onRemoveVendorFromBooth:()=>{Q(!0);const e=j.map(a=>new W({...a,booths:a.booths.map(i=>i.user?.id===n.user?.id?new je({...i,user:null,initialElement:i.initialElement??void 0}):i)})),s=new Ee({...ne,sections:e});Re(H,s).then(()=>{window.location.reload()})},onAddVendorToBooth:()=>{gn(n),pt.current?.showModal()}},n.id)))]}),c&&!ct&&t.jsx("div",{className:"layout-icon",onClick:()=>{Ge.current?.showModal(),Fe(!0),console.log("Showing layout dialog")},children:t.jsx("img",{src:zn,alt:""})}),!ct&&!(P||U||pe||Ke||te||Se||Ue||De)&&t.jsx("div",{className:"template-icon",onClick:()=>{he.current?.showModal(),Te(!0),console.log("Showing template dialog")},children:t.jsx("img",{src:qn,alt:""})}),t.jsx($n,{isViewingArea:Je,dialogRef:he,isOpen:Le,closeDialog:()=>{he.current?.close(),Te(!1)},duplicateTemplate:n=>{const e=new xe({name:n.name+" Copy",previewImage:n.previewImage,inventoryItems:n.inventoryItems,sections:n.sections,id:n.name+"Copy"+(Math.random()*1e4).toString()}),s=[...ve.map(a=>new xe({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(i=>new W({name:i.name,cellId:new h({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(r=>new z({cell:new h({x:r.cell.x,y:r.cell.y}),item:new p({...r.item})}))})),id:a.id})),e];Qe(H,q,s).then(()=>{he.current?.close(),console.log("Template updated successfully"),ke(s),Te(!1),window.location.href=`/LayItOut/Layout/?companyId=${H}&areaId=${q}&type=edit-template&templateId=${e.id}`})},templates:ve,selectTemplate:n=>{Q(!0),setTimeout(async()=>{const e=n.sections.map(s=>new W({name:s.name,cellId:new h({x:n.sections.find(a=>a.name==s.name).cellId.x,y:n.sections.find(a=>a.name==s.name).cellId.y}),cellsLong:s.cellsLong,cellsTall:s.cellsTall,modifierItems:s.modifierItems,startingItems:s.startingItems.map(a=>new z({cell:new h({x:a.cell.x,y:a.cell.y}),item:new p({...a.item,starterItem:!0})}))}));localStorage.setItem("screenshotSections",e.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ye(!0),window.addEventListener("storage",async s=>{if(console.log("Storage event",s),s.key==="screenshot"){ye(!1);const a=new Bt({name:He,previewImage:s.newValue,areaId:q,inventoryItems:n.inventoryItems,sections:n.sections.map(i=>new W({name:i.name,cellId:new h({x:n.sections.find(r=>r.name==i.name).cellId.x,y:n.sections.find(r=>r.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(r=>new z({cell:new h({x:r.cell.x,y:r.cell.y}),item:new p({...r.item,starterItem:!0})}))})),id:at});console.log("UPDATED DESIGN",a),Wt(H,q,a).then(()=>{console.log("Design updated successfully"),Pe(!1),Q(!1),window.location.reload()})}})},500)}}),t.jsx(Qn,{dialogRef:Ge,closeDialog:()=>{Ge.current?.close(),Fe(!1)},areaPreview:ln||""}),t.jsx(Un,{canBeBooth:Ke,dialogRef:gt,addInventoryItem:xt,closeDialog:()=>{gt.current?.close()}}),t.jsx(Kn,{dialogRef:ut,closeDialog:()=>{ut.current?.close()},addSection:xt}),t.jsx(_n,{dialogRef:ft,closeDialog:()=>{ft.current?.close()},addInventoryItem:xt}),t.jsx(el,{placeMultiItem:jn,addHighlightedCell:bn,item:fe,setSelectingItem:()=>{Ne(null)},canPlaceItem:yt,placeItem:Ct,highlightCells:Rt,unHighlightCells:wt,cellSize:D}),t.jsx(ol,{dialogRef:ht,closeDialog:()=>{ht.current?.close()},addVendor:async n=>{const e=new Ee({...ne,vendors:[...ne.vendors,n]});Ce(e),await Re(H,e)}}),t.jsx(sl,{oldVendor:dn,dialogRef:It,closeDialog:()=>{It.current?.close()},editVendor:async n=>{const e=new Ee({...ne,vendors:ne.vendors.map(s=>s.id===n.id?n:s)});Ce(e),await Re(H,e)}}),t.jsx(al,{dialogRef:pt,vendors:ne?.vendors.filter(n=>!In(n,ne))??[],closeDialog:()=>{pt.current?.close()},addVendorToBooth:async n=>{Q(!0);const e=j.map(a=>a.name===y?new W({...a,booths:a.booths.map(i=>i.id===mt.id?new je({...i,user:n,initialElement:i.initialElement??void 0}):i)}):a.booths.some(i=>i.id===mt.id)?new W({...a,booths:a.booths.map(i=>i.id===mt.id?new je({...i,user:n,initialElement:i.initialElement??void 0}):i)}):a);console.log("Updated sections",e),ae(e);const s=new Ee({...ne,sections:e});await Re(H,s),window.location.reload(),Q(!1)}}),rt&&t.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:window.location.origin+"/LayItOut/Preview/",width:C*D+20,height:F*D+20})]})}
