import{c as ye,j as g,r}from"./index-_mSZXrjJ.js";import{A as Y,S as xe,D as pe,B as Se}from"./booth_item-HD65K4xB.js";import{S as q,C as S,I as v,j as Le,k as K,l as Te}from"./firestore-BIrJGVi9.js";import{F as Q}from"./add_custom_item_dialog-B83re6ox.js";ye.createRoot(document.getElementById("root")).render(g.jsx(we,{}));function we(){const[f,ve]=r.useState(!1),[U,X]=r.useState(0),[$,Z]=r.useState(0),[L,T]=r.useState([]),[O,b]=r.useState([]),[_,C]=r.useState(0),[w,R]=r.useState(null),[B,E]=r.useState([]),y=10,[k,M]=r.useState([]);r.useRef(null);const[Ee,be]=r.useState(!1),[Ae,Oe]=r.useState([]),[d,N]=r.useState([]),[Ne,je]=r.useState([]),[De,Re]=r.useState(!1);r.useRef(null);const[ee,le]=r.useState([]),[x,j]=r.useState([]),[m,P]=r.useState(null),[ke,Me]=r.useState(!1),[Pe,qe]=r.useState(!1),[te,Ue]=r.useState(!1),[$e,Be]=r.useState(!1),[Fe,We]=r.useState(!1),[He,Ve]=r.useState(!1),[ze,Ge]=r.useState(""),[Je,Ye]=r.useState(""),[Ke,Qe]=r.useState(""),[Xe,Ze]=r.useState(""),[_e,Ce]=r.useState(""),[ne,D]=r.useState(!0),[el,ll]=r.useState(null),[F,W]=r.useState(!1),[tl,oe]=r.useState(!1),[se,ie]=r.useState([]);r.useRef(null);function A(e,t){for(const s of t)if(e.x>=s.cellId.x&&e.x<s.cellId.x+s.cellsLong&&e.y>=s.cellId.y&&e.y<s.cellId.y+s.cellsTall)return s;return null}function ce(e){let t=U,s=$;if(f){let o=0;const c=[],i=[];for(const l of e){const n=[],a={width:l.cellsLong*y,height:l.cellsTall*y,sectionName:l.name};a.height>o&&(o=a.height),le(I=>[...I,a]),l.cellId.x=0,l.cellId.y=0,[...Array(a.height/y).keys()].map(I=>{const h=[];[...Array(a.width/y).keys()].map(u=>{h.push({id:new S({x:u,y:I}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:y})}),n.push(h)}),c.push({sectionName:l.name,cells:[...n]}),i.push(l)}j(c),N(i),C(o),P(e[0]?e[0].name:null),setTimeout(()=>{D(!1)},500)}else{const o=[];for(const c of e)console.log("Generating cells for section",c.name,"at",c.cellId,"with size",c.cellsLong,"x",c.cellsTall),console.log("Needed section Width:",c.cellsLong+c.cellId.x,"Current width:",t),c.cellsLong+c.cellId.x>t&&(console.log("Added section Width:",c.cellsLong+c.cellId.x),t+=c.cellsLong+c.cellId.x-t),console.log("Needed section Height:",c.cellsTall+c.cellId.y,"Current height:",s),c.cellsTall+c.cellId.y>s&&(console.log("Added section Height:",c.cellsTall+c.cellId.y),s+=c.cellsTall+c.cellId.y-s);X(t),Z(s),[...Array(s).keys()].map(c=>{const i=[];[...Array(t).keys()].map(l=>{i.push({id:new S({x:l,y:c}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:A(new S({x:l,y:c}),e)!=null,size:y})}),o.push(i)}),T([...o]),setTimeout(()=>{const c=[],i=[],l=[...e];for(const n of l)n.cellElement=document.querySelector(`.App #${n.cellId.toId()}.cell:not(.cell-border)`),c.push(...n.startingItems.map(a=>new K({cell:new S({x:n.cellId.x+a.cell.x,y:n.cellId.y+a.cell.y}),item:new v({...a.item,initialElement:document.querySelector(`.App #${a.cell.toId()}.cell:not(.cell-border)`),starterItem:!0})}))),c.push(...n.modifierItems.map(a=>new K({cell:new S({x:n.cellId.x+a.cell.x,y:n.cellId.y+a.cell.y}),item:new v({...a.item,initialElement:document.querySelector(`.App #${a.cell.toId()}.cell:not(.cell-border)`),starterItem:!0})}))),i.push(...n.booths.map(a=>new Te({...a,cell:new S({x:n.cellId.x+a.cell.x,y:n.cellId.y+a.cell.y}),initialElement:document.querySelector(`.App #${a.cell.toId()}.cell:not(.cell-border)`)})));N([...l]);for(const n of c){const a=u=>{const p=u%2===1;return{cellsLong:p?n.item.cellsTall:n.item.cellsLong,cellsTall:p?n.item.cellsLong:n.item.cellsTall}},I=n.item.rotation||0,h=a(I);for(let u=0;u<h.cellsTall;u++)for(let p=0;p<h.cellsLong;p++)o[n.cell.y+u][n.cell.x+p].hasItem=!0,o[n.cell.y+u][n.cell.x+p].itemId=n.item.id;n.item.initialElement=document.querySelector(`.App #${n.cell.toId()}.cell:not(.cell-border)`),b(u=>[...u,n.item])}for(const n of i){for(let a=0;a<n.cellsTall;a++)for(let I=0;I<n.cellsLong;I++)o[n.cell.y+a][n.cell.x+I].hasItem=!0,o[n.cell.y+a][n.cell.x+I].itemId=n.id;n.initialElement=document.querySelector(`.App #${n.cell.toId()}.cell:not(.cell-border)`),ie(a=>[...a,n])}T([...o]),setTimeout(()=>{D(!1),ae()},500)},100)}}async function ae(e,t){D(!0),W(!0),setTimeout(async()=>{const s=document.getElementById("capture"),o=await domtoimage.toPng(s);W(!1),localStorage.setItem("screenshot",o),oe(!0),D(!1)},500)}async function re(){new URLSearchParams(window.location.search);const e=[];let t=localStorage.getItem("screenshotSections");console.log("Screenshot sections from localStorage",t),t=t?.split("LAYOUTSEPARATOR")||"";const s=[];for(const o of t)console.log("Section string",o),s.push(q.fromJSON(o));N([...s.map(o=>new q({name:o.name,cellId:new S({x:o.cellId.x,y:o.cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,startingItems:o.startingItems,modifierItems:o.modifierItems,booths:o.booths,items:o.startingItems.map(c=>new v({...c.item}))}))]),e.push(...s.map(o=>new q({name:o.name,cellId:new S({x:o.cellId.x,y:o.cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,startingItems:o.startingItems,modifierItems:o.modifierItems,booths:o.booths,items:o.startingItems.map(c=>new v({...c.item}))}))),console.log("SECTIONS TO GENERATE",e),ce(e)}r.useEffect(()=>{re()},[]);function me(e,t,s){if(!f||e==null)return;const o=[...s],c=[],i=s.find(l=>l.name==e);console.log("NEW SECTION",i),console.log("Adding section",i.name,i.cellId),console.log("MOBILE CELLS",t),i.cellElement=document.querySelector(`.App #${i.name.split(" ").join("-")} #${i.name.split(" ").join("")}${i.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",i.cellElement);for(const l of i.startingItems){console.log("Placing starting item",l.item.name,l.cell);const n=h=>{const u=h%2===1;return{cellsLong:u?l.item.cellsTall:l.item.cellsLong,cellsTall:u?l.item.cellsLong:l.item.cellsTall}},a=l.item.rotation||0,I=n(a);for(let h=0;h<I.cellsTall;h++)for(let u=0;u<I.cellsLong;u++){const p=t.find(he=>he.sectionName===i.name);p.cells[l.cell.y+h][l.cell.x+u].hasItem=!0,p.cells[l.cell.y+h][l.cell.x+u].itemId=l.item.id}l.item.initialElement=document.querySelector(`.App #${i.name.split(" ").join("-")} #${i.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",l.item.initialElement),c.push(new v({...l.item,starterItem:!0}))}console.log("Setting sections",o),N([...o]),console.log("ITEMS",c),b(l=>[...l.filter(a=>!c.some(I=>I.id===a.id)),...c.map(a=>new v({...a,starterItem:!0}))])}function H(e){let t=[];return e.map(s=>t=[...t,...s]),t}function V(e,t){console.log(e);const s=f?x.find(l=>l.sectionName===m).cells:L,o=s[e.y].length,c=s.length;if(console.log(o,c),e.x+t.cellsLong>o||e.y+t.cellsTall>c)return!1;const i=A(e,d);if(!i&&!f)return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<t.cellsTall;l++)for(let n=0;n<t.cellsLong;n++){if(!f){const a=A(new S({x:e.x+n,y:e.y+l}),d);if(!a)return console.log("Item is out of bounds of any section"),!1;if(a.name!=i.name)return console.log("Item is crossing section boundaries"),!1}if(s[e.y+l][e.x+n].hasItem&&s[e.y+l][e.x+n].itemId!=t.id)return console.log("Something is already here"),!1}return!0}function de(e,t,s){const o=Array.from(f?x.find(l=>l.sectionName===m).cells:L);if(s!=null){console.log("Removing item");const l=f?d.find(n=>n.name===m):A(s,d);l.items=l.items.filter(n=>n.id!=t.id);for(let n=0;n<t.cellsTall;n++)for(let a=0;a<t.cellsLong;a++)o[s.y+n][s.x+a].hasItem=!1,o[s.y+n][s.x+a].itemId=""}const c=f?d.find(l=>l.name===m):A(e,d),i=new S({x:e.x-c.cellId.x,y:e.y-c.cellId.y});t.sectionCell=i,c.items.push(t);for(let l=0;l<t.cellsTall;l++)for(let n=0;n<t.cellsLong;n++)o[e.y+l][e.x+n].hasItem=!0,o[e.y+l][e.x+n].itemId=t.id;if(console.log(o),f){const l=x.find(n=>n.sectionName===m);l&&(l.cells=o.map(n=>n.map(a=>({...a}))),j([...x]))}else T(o);if(console.log("Removing item from inventory",t.name),!t.hasMoved){const l=k.findIndex(n=>n.item.name==t.name&&!n.item.hasMoved);if(l!==-1){const n=[...k];n[l].quantity-=1,n[l].quantity<=0&&n.splice(l,1),M(n)}else M(k)}b(l=>(console.log("Placing item",t.id),console.log("Updating item",t.id),l.find(n=>n.id==t.id).hasMoved||(l.find(n=>n.id==t.id).hasMoved=!0),l))}function ue(e){console.log("Removing item",e.id),b(t=>t.filter(s=>s.id!=e.id))}function ge(e,t){const s=Array.from(L),o=l=>{const n=l%2===1;return{cellsWide:n?e.cellsTall:e.cellsLong,cellsTall:n?e.cellsLong:e.cellsTall}},c=e.rotation||0,i=o(c);for(let l=0;l<i.cellsTall;l++)for(let n=0;n<i.cellsWide;n++)s[t.y+l][t.x+n].hasItem=!1,s[t.y+l][t.x+n].itemId="";T(s),console.log("DELETING ITEM",e.id),b(l=>(console.log(),l.filter(n=>n.id!=e.id))),M(l=>{const n=l.findIndex(a=>a.item.name==e.name&&!a.item.hasMoved);if(n!==-1){const a=[...l];return a[n].quantity+=1,a}else return[...l,new Le({item:new v({...e}),quantity:1})]})}function fe(e,t){const s=Array.from(f?x.find(l=>l.sectionName===m).cells:L);console.log("DELETING ITEM ROTATE",e.id,e.rotation);const o=l=>{const n=l%2===1;return{cellsWide:n?e.cellsTall:e.cellsLong,cellsTall:n?e.cellsLong:e.cellsTall}},c=e.rotation||0,i=o(c);for(let l=0;l<i.cellsTall;l++)for(let n=0;n<i.cellsWide;n++)console.log("Deleting cell",t.y+l,t.x+n),s[t.y+l][t.x+n].hasItem=!1,s[t.y+l][t.x+n].itemId="";T([...s]),console.log("DELETING ITEM",e.id)}function Ie(e,t){const s=f?x.find(i=>i.sectionName===m).cells:L,o=Array.from(s);if(s[e.y]==null){z();return}const c=V(e,t);o.forEach(i=>i.forEach(l=>{l.mouseOver=!1,l.canPlaceItem=!1,l.mouseOverLocation=""}));for(let i=0;i<t.cellsTall;i++)for(let l=0;l<t.cellsLong;l++)e.y+i<o.length&&e.x+l<o[e.y+i].length&&(t.cellsLong===1&&t.cellsTall===1?o[e.y+i][e.x+l].mouseOverLocation="single":t.cellsTall===1?l===0?o[e.y+i][e.x+l].mouseOverLocation="leftFull":l===t.cellsLong-1?o[e.y+i][e.x+l].mouseOverLocation="rightFull":o[e.y+i][e.x+l].mouseOverLocation="middleFull":t.cellsLong===1?i===0?o[e.y+i][e.x+l].mouseOverLocation="topFull":i===t.cellsTall-1?o[e.y+i][e.x+l].mouseOverLocation="bottomFull":o[e.y+i][e.x+l].mouseOverLocation="middleVFull":i===0&&l===0?o[e.y+i][e.x+l].mouseOverLocation="topLeftCorner":i===0&&l===t.cellsLong-1?o[e.y+i][e.x+l].mouseOverLocation="topRightCorner":i===t.cellsTall-1&&l===0?o[e.y+i][e.x+l].mouseOverLocation="bottomLeftCorner":i===t.cellsTall-1&&l===t.cellsLong-1?o[e.y+i][e.x+l].mouseOverLocation="bottomRightCorner":i===0?o[e.y+i][e.x+l].mouseOverLocation="top":i===t.cellsTall-1?o[e.y+i][e.x+l].mouseOverLocation="bottom":l===0?o[e.y+i][e.x+l].mouseOverLocation="left":l===t.cellsLong-1?o[e.y+i][e.x+l].mouseOverLocation="right":o[e.y+i][e.x+l].mouseOverLocation="middle",o[e.y+i][e.x+l].mouseOver=!0,o[e.y+i][e.x+l].canPlaceItem=c);if(f){const i=x.find(l=>l.sectionName===m);i&&(i.cells=o.map(l=>l.map(n=>({...n}))),j([...x])),j(l=>l.map(n=>n.sectionName===m?{...n,cells:o}:n))}else T(o)}function z(){const e=Array.from(f?x.find(t=>t.sectionName===m).cells:L);e.forEach(t=>t.forEach(s=>{s.mouseOver=!1,s.canPlaceItem=!1,s.mouseOverLocation=""})),T(e)}r.useEffect(()=>{me(m,x,d)},[m]),r.useEffect(()=>{const e=()=>{const t=O.find(s=>s.id===w);console.log("Unselecting item",w),R(null),t&&(E(s=>[...s,t.id]),console.log("Unselecting item",t.id),setTimeout(()=>{E(s=>s.filter(o=>o!==t.id))},300))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[w,O]);function G(e){R(null),E(t=>[...t,e]),console.log("Unselecting item",e),setTimeout(()=>{E(t=>t.filter(s=>s!==e))},300)}function J(e){const t=O.find(s=>s.id===w);console.log("Unselecting item",w),R(e),t&&(E(s=>[...s,t.id]),console.log("Unselecting item",t.id),setTimeout(()=>{E(s=>s.filter(o=>o!==t.id))},300))}return g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"App",children:[ne&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"loader-backdrop"}),g.jsx("div",{className:"loader"})]})," ",g.jsx("div",{className:"layout",children:f?g.jsxs("div",{className:"mobile-areas",style:{height:_+"px"},children:[g.jsx("img",{src:Q,onClick:()=>{const e=d.findIndex(s=>s.name==m);if(e===-1)return;const t=(e-1+d.length)%d.length;P(d[t].name),console.log("Changing viewing section to",d[t].name)},className:"back-mobile-areas"}),ee.map((e,t)=>g.jsx(Y,{width:e.width,height:e.height,cells:H(x.find(s=>s.sectionName==e.sectionName).cells),id:e.sectionName,visibile:m==null?!0:e.sectionName==m,section:e.sectionName},t)),g.jsx("img",{src:Q,onClick:()=>{const e=d.findIndex(s=>s.name==m);if(e===-1)return;const t=(e+1)%d.length;P(d[t].name),console.log("Changing viewing section to",d[t].name)},className:"forward-mobile-areas"})]}):g.jsx(Y,{width:U*y,height:$*y,cells:H(L)})})]}),g.jsxs("div",{id:F?"capture":"",children:[d.map(e=>g.jsx(xe,{takingPhoto:F,section:e,visible:m==null?!0:e.name==m,cellSize:y},e.cellId.toId())),O.map(e=>g.jsx(pe,{isPlacingItem:!1,isCreatingArea:!1,isCreatingTemplate:!1,cellSize:y,isViewingDesign:te,removeItem:ue,visible:f?!e.hasMoved&&!e.starterItem?!0:m==null?!1:e.starterItem?d.find(t=>t.name==m)?.startingItems.some(t=>t.item.id===e.id):d.find(t=>t.name==m)?.items.some(t=>t.id===e.id):!0,item:e,canPlaceItem:V,placeItem:de,deleteItemRotate:fe,highlightCells:Ie,unHighlightCells:z,deleteItem:ge,isSelected:w===e.id,onSelect:J,isUnselecting:B.includes(e.id),onDeselect:()=>G(e.id)},e.id)),se.map(e=>g.jsx(Se,{canPick:!0,visible:f?m==null?!1:d.find(t=>t.name==m)?.booths.some(t=>t.id===e.id)??!1:!0,booth:e,isViewingBooth:!1,isSelected:w==e.id,cellSize:y,onSelect:J,isUnselecting:B.includes(e.id),onDeselect:()=>G(e.id),onPickBooth:async t=>{}},e.id))]})]})}
