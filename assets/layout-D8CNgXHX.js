import{r as d,j as o,c as Pt}from"./index-QIV6qY6h.js";import{A as it,S as Wt,D as Ft}from"./section-Bl4_lSg3.js";import{I as w,s as Ee,e as ae,p as Gt,C as y,S as W,f as U,T as ue,D as at,u as ct,h as Yt,i as Ut,j as Jt,k as Ht,l as Bt,A as Zt,m as Xt}from"./firestore-Bko8voo4.js";import{F as De}from"./add_custom_item_dialog-DQtvLDx8.js";function $t({inventoryItem:m,addDraggingItem:G,removeItem:J,setSelectedItem:C,tapAndPlaceMode:k}){const O=d.useRef(null),M=d.useRef(null),[E,B]=d.useState(12),[L,b]=d.useState(m.item);function S(p){const ee=M.current,I=window.getComputedStyle(ee),h=document.createElement("span");h.style.font=I.font,h.style.fontSize=p+"px",h.style.fontFamily=I.fontFamily,h.style.fontWeight=I.fontWeight,h.style.position="absolute",h.style.visibility="hidden",h.style.whiteSpace="nowrap",h.textContent=ee.textContent,document.body.appendChild(h);const P=h.offsetWidth;return document.body.removeChild(h),P}function H(p){if(M.current){const ee=M.current;return S(p-1)>ee.offsetWidth&&p-1>8?H(p-1):p-1}return p}return d.useEffect(()=>{setTimeout(()=>{M.current&&B(H(E))},100)},[]),o.jsxs("div",{className:"display",children:[o.jsx("div",{ref:O,id:m.item.id,className:m.item.isSectionItem?"display-section":`display-item ${m.item.isSectionModifier?m.item.sectionModifierType.toString():""}`,style:{width:`${m.item.cellsLong*10}px`,height:`${m.item.cellsTall*10}px`},onMouseDown:p=>{k||(p.preventDefault(),p.stopPropagation(),m.item.initialElement=O.current,m.item.id=m.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",m.item.id,"to initialElement",m.item.initialElement),b(new w({id:m.item.id,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,name:m.item.name,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,displayItem:m.item.isDisplayItem,isSectionItem:m.item.isSectionItem})),G(m.item))},onClick:p=>{k&&(p.preventDefault(),p.stopPropagation(),m.item.initialElement=O.current,m.item.id=m.item.name+(Math.random()*1e4).toString(),C(m.item))},onTouchStart:p=>{k||(p.preventDefault(),p.stopPropagation(),m.item.initialElement=O.current,m.item.id=m.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",m.item.id,"to initialElement",m.item.initialElement),b(new w({id:m.item.id,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,name:m.item.name,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,displayItem:m.item.isDisplayItem})),G(m.item))},children:m.item.isSectionModifier?null:m.item.icon.includes("custom-")?o.jsx("div",{className:m.item.isSectionItem?"custom-section":"custom-icon",children:o.jsx("div",{children:o.jsx("p",{ref:M,style:{fontSize:`${E}px`},children:m.item.icon.split("custom-")[1]})})}):o.jsx("img",{src:m.item.icon,alt:"icon"})}),o.jsx("p",{children:m.item.name}),m.quantity>0&&o.jsxs("p",{className:"quantity",children:["x",m.quantity]})]})}const zt="/LayItOut/assets/plus.circle-Ce3xm00a.png";function Vt({inventoryItems:m,addDraggingItem:G,maxHeight:J,removeItem:C,showAddCustomItem:k,isCreatingTemplate:O,isEditingTemplate:M,isViewingDesign:E,tapAndPlaceMode:B,setSelectedItem:L,isModifyingSections:b}){return o.jsxs("div",{className:"toolbox",style:{maxHeight:J?`${J}px`:"200px"},children:[m.map(S=>o.jsx($t,{setSelectedItem:L,tapAndPlaceMode:B,inventoryItem:S,addDraggingItem:G,removeItem:C})),!(O||M||E||b)&&o.jsx("div",{className:"add-item",onClick:()=>{k()},children:o.jsx("img",{src:zt,alt:"Add Item"})})]})}function qt({dialogRef:m,closeDialog:G,areaPreview:J}){return o.jsx("dialog",{ref:m,className:"layout-dialog",children:o.jsxs("div",{className:"layout-dialog-div",children:[o.jsx("h2",{children:"Layout"}),o.jsx("img",{src:J,alt:"Layout preview",className:"layout-dialog-preview"}),o.jsx("br",{}),o.jsx("button",{className:"layout-dialog-close",onClick:G,children:"Close"})]})})}const Qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",Kt="/LayItOut/assets/template-Cjj8EPhc.png";function _t({dialogRef:m,closeDialog:G,templates:J,isOpen:C,isViewingArea:k,selectTemplate:O,duplicateTemplate:M}){const[E,B]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[L,b]=d.useState([]),[S,H]=d.useState(!1),[p,ee]=d.useState([]);return d.useEffect(()=>{ee(J)},[J]),d.useEffect(()=>{if(C&&(console.log("Layout dialog opened, generating cells and sections",p),p.length!==0)){if(p.length==1){b([p[0].name]);return}b(E?[p[0].name]:[p[0].name,p[1].name])}},[C,p]),d.useEffect(()=>{const I=p.filter(h=>L.includes(h.name));console.log("Viewing templates:",L),I.sort((h,P)=>L.indexOf(h.name)-L.indexOf(P.name)),console.log("Generating templates for",I.map(h=>h.name))},[L,p]),o.jsx(o.Fragment,{children:o.jsx("dialog",{ref:m,className:"template-dialog",children:o.jsxs("div",{className:"template-dialog-div",children:[o.jsx("h2",{children:"Templates"}),o.jsxs("div",{className:"templates",children:[p.length>1&&p.filter(I=>!L.includes(I.name)).length>0&&o.jsx("img",{src:De,onClick:()=>{if(E){const h=(p.findIndex(P=>P.name===L[0])-1+p.length)%p.length;b([p[h].name])}else b(I=>{const P=(p.findIndex(q=>q.name===I[0])-1+p.length)%p.length;return[p[P].name,I[0]]})},className:"back-mobile-areas"}),L.length===0&&o.jsx("div",{className:"no-templates",children:"No templates available"}),L.map(I=>o.jsxs("div",{className:"template",children:[o.jsx("img",{src:p.find(h=>h.name===I).previewImage,alt:I,className:"template-preview"}),o.jsx("h3",{children:I}),o.jsxs("div",{className:"template-actions",children:[o.jsx("button",{className:"template-select-btn",onClick:()=>{if(k){const h=new URLSearchParams(window.location.search),P=h.get("companyId"),q=h.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${P}&areaId=${q}&type=edit-template&templateId=${p.find(oe=>oe.name==I).id}`}else G(),O&&O(p.find(h=>h.name===I))},children:k?"Edit":"Select"}),k&&o.jsx("button",{className:"action-btn",onClick:()=>{S||(H(!0),M&&M(p.find(h=>h.name===I)))},children:"Duplicate"}),k&&o.jsx("button",{className:"action-btn",onClick:()=>{if(S)return;H(!0);const h=p.filter(A=>A.name!==I);ee(h),h.length==1?b([h[0].name]):h.length==0?b([]):b(E?[h[0].name]:[h[0].name,h[1].name]);const P=new URLSearchParams(window.location.search),q=P.get("companyId"),oe=P.get("areaId");Ee(q,oe,h).then(()=>{H(!1)})},children:"Delete"})]})]})),p.length>1&&p.filter(I=>!L.includes(I.name)).length>0&&o.jsx("img",{src:De,onClick:()=>{if(E){const h=(p.findIndex(P=>P.name===L[0])+1)%p.length;b([p[h].name])}else b(I=>{const P=(p.findIndex(q=>q.name===I[I.length-1])+1)%p.length;return[I[1],p[P].name]})},className:"forward-mobile-areas"})]}),k&&o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"action-btn",onClick:()=>{const I=new URLSearchParams(window.location.search),h=I.get("companyId"),P=I.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${h}&areaId=${P}&type=create-template`},children:"Create new Template"})," ",o.jsx("br",{})]}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:G,children:"Close"}),S&&C&&o.jsx(o.Fragment,{children:o.jsx("div",{className:"loader"})})]})})})}function el({dialogRef:m,closeDialog:G,addInventoryItem:J}){const[C,k]=d.useState(""),[O,M]=d.useState(1),[E,B]=d.useState(1),[L,b]=d.useState(1);return o.jsx("dialog",{ref:m,className:"custom-item-dialog",children:o.jsxs("div",{className:"custom-item-dialog-div",children:[o.jsx("h2",{children:"Add Custom Item"}),o.jsxs("div",{className:"custom-item-row",children:[o.jsx("label",{htmlFor:"item-name",children:"Name:"}),o.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:S=>k(S.target.value??""),value:C})]}),o.jsxs("div",{className:"custom-item-row",children:[o.jsx("label",{htmlFor:"item-icon",children:"Count:"}),o.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:O,onChange:S=>M(parseInt(S.target.value)??1)})]}),o.jsxs("div",{className:"custom-item-row custom-item-size",children:[o.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),o.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:E,onChange:S=>B(parseFloat(S.target.value)??1)}),o.jsx("span",{children:" x "}),o.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:L,onChange:S=>b(parseFloat(S.target.value)??1)})]}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:()=>{if(C.trim()===""){alert("Item name cannot be empty");return}const S=new ae({quantity:O,item:new w({id:C+(Math.random()*1e4).toString(),name:C,icon:`custom-${C}`,cellsLong:Math.ceil(E),cellsTall:Math.ceil(L),moveable:!0,starterItem:!1,displayItem:!0})});J(S),k(""),M(1),B(1),b(1),G()},children:"Add Item"}),o.jsx("br",{}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:G,children:"Close"})]})})}function tl({dialogRef:m,closeDialog:G,addSection:J}){const[C,k]=d.useState(""),[O,M]=d.useState(1),[E,B]=d.useState(1);return o.jsx("dialog",{ref:m,className:"section-dialog",children:o.jsxs("div",{className:"section-dialog-div",children:[o.jsx("h2",{children:"Add Section"}),o.jsxs("div",{className:"section-row",children:[o.jsx("label",{htmlFor:"section-name",children:"Name:"}),o.jsx("input",{type:"text",id:"section-name",name:"section-name",onChange:L=>k(L.target.value??""),value:C})]}),o.jsxs("div",{className:"section-row section-size",children:[o.jsx("label",{htmlFor:"section-width",children:"Size (in feet):"}),o.jsx("input",{type:"number",id:"section-width",name:"section-width",min:"1",value:O,onChange:L=>M(parseFloat(L.target.value)??1)}),o.jsx("span",{children:" x "}),o.jsx("input",{type:"number",id:"section-height",name:"section-height",min:"1",value:E,onChange:L=>B(parseFloat(L.target.value)??1)})]}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:()=>{if(C.trim()===""){alert("Section name cannot be empty");return}const L=new ae({quantity:1,item:new w({id:C+(Math.random()*1e4).toString(),name:C,icon:`custom-${C}`,cellsLong:Math.ceil(O),cellsTall:Math.ceil(E),moveable:!0,starterItem:!1,displayItem:!0,isSectionItem:!0})});J(L),k(""),M(1),B(1),G()},children:"Add Section"}),o.jsx("br",{}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:G,children:"Close"})]})})}function ll({dialogRef:m,closeDialog:G,addInventoryItem:J}){const[C,k]=d.useState(null),[O,M]=d.useState(""),[E,B]=d.useState(1),[L,b]=d.useState(1),[S,H]=d.useState(1),[p,ee]=d.useState(!0);return o.jsx("dialog",{ref:m,className:"inventory-item-dialog",children:o.jsxs("div",{className:"inventory-item-dialog-div",children:[o.jsx("h2",{children:"Add Inventory Item"}),C==null?o.jsxs(o.Fragment,{children:["  ",o.jsx("label",{htmlFor:"",children:"Premade Items:"}),o.jsx("div",{className:"inventory-item-list",children:Gt.map(I=>o.jsx("div",{className:"inventory-item",onClick:()=>{const h=new ae({quantity:1,item:new w({id:I.name+(Math.random()*1e4).toString(),name:I.name,icon:I.icon,cellsLong:I.cellsLong,cellsTall:I.cellsTall,moveable:!0,starterItem:!1,displayItem:!0})});k(h)},children:o.jsxs("div",{className:"inventory-item-display",children:[o.jsx("img",{src:I.icon,alt:"icon"}),o.jsx("p",{children:I.name}),o.jsxs("p",{className:"quantity",children:[I.cellsLong,"ft x ",I.cellsTall,"ft"]})]})},I.name))}),o.jsx("label",{htmlFor:"",children:"Or:"}),o.jsx("label",{htmlFor:"",children:"Custom Item:"}),o.jsxs("div",{className:"inventory-item-row",children:[o.jsx("label",{htmlFor:"item-name",children:"Name:"}),o.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:I=>M(I.target.value??""),value:O})]}),o.jsxs("div",{className:"inventory-item-row",children:[o.jsx("label",{htmlFor:"item-icon",children:"Count:"}),o.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:E,onChange:I=>B(parseInt(I.target.value)??1)})]}),o.jsxs("div",{className:"inventory-item-row inventory-item-size",children:[o.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),o.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:L,onChange:I=>b(parseFloat(I.target.value)??1)}),o.jsx("span",{children:" x "}),o.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:S,onChange:I=>H(parseFloat(I.target.value)??1)})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),o.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:p,onChange:I=>ee(I.target.checked)})]}),o.jsx("br",{})]}):o.jsxs(o.Fragment,{children:[o.jsxs("label",{htmlFor:"",children:["Item: ",C.item.name]}),o.jsxs("div",{className:"inventory-item-row",children:[o.jsx("label",{htmlFor:"item-icon",children:"Count:"}),o.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:E,onChange:I=>B(parseInt(I.target.value)??1)})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),o.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:p,onChange:I=>ee(I.target.checked)})]})]}),o.jsx("br",{}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:()=>{if(O.trim()===""&&C==null){alert("Item name cannot be empty");return}if(E<=0){alert("Item count must be greater than zero");return}let I=C;I==null?I=new ae({quantity:E,item:new w({id:O+(Math.random()*1e4).toString(),name:O,icon:`inventory-${O}`,cellsLong:Math.ceil(L),cellsTall:Math.ceil(S),moveable:p,starterItem:!1,displayItem:!0})}):(I.quantity=E,I.item.moveable=p),J(I),ee(!0),k(null),M(""),B(1),b(1),H(1),G()},children:"Add Item"}),o.jsx("button",{className:"action-btn",onClick:G,children:"Close"})]})})}function nl({item:m,setSelectingItem:G,canPlaceItem:J,placeItem:C,highlightCells:k,unHighlightCells:O,cellSize:M}){const[E,B]=d.useState(0),[L,b]=d.useState(0),S=d.useRef(null),[H,p]=d.useState(0),[ee,I]=d.useState(0),[h,P]=d.useState(!1),[q,oe]=d.useState(0),[A,me]=d.useState(null),[re,ve]=d.useState(!0),[Re,ce]=d.useState(12),[he,Oe]=d.useState(null),Le=d.useRef(null),[Pe,Qe]=d.useState(!0),ye=d.useCallback(j=>{const D=j%2===1;return{width:D?m.cellsTall*M:m.cellsLong*M,height:D?m.cellsLong*M:m.cellsTall*M,cellsWide:D?m.cellsTall:m.cellsLong,cellsTall:D?m.cellsLong:m.cellsTall}},[m,M]);function Ke(j){const D=S.current,X=window.getComputedStyle(D),F=document.createElement("span");F.style.font=X.font,F.style.fontSize=j+"px",F.style.fontFamily=X.fontFamily,F.style.fontWeight=X.fontWeight,F.style.position="absolute",F.style.visibility="hidden",F.style.whiteSpace="nowrap",F.textContent=D.textContent,document.body.appendChild(F);const Ie=F.offsetWidth;return document.body.removeChild(F),Ie}function Ae(j){if(S.current){const D=S.current;return Ke(j-1)>D.offsetWidth&&j-1>8?Ae(j-1):j-1}return j}d.useEffect(()=>{setTimeout(()=>{S.current&&ce(Ae(Re))},100)},[]),d.useEffect(()=>{if(m){P(!0);const j=Le.current?.getBoundingClientRect();Oe({x:j?j.left-E:0,y:j?j.top-L:0})}else console.log("No item to place, stopping dragging"),P(!1),Oe(null),B(0),b(0),p(0),I(0),oe(0),me(null),ve(!0),ce(12),Qe(!0)},[m]);const Z=j=>{j.preventDefault()},fe=d.useCallback((j,D,X)=>{if(m==null||!h||!he)return;console.log("PLACING MOVE",m);const F=X.target,Ie=ye(q),R=w.fromDoc(m.toDoc());R.cellsLong=Ie.cellsWide,R.cellsTall=Ie.cellsTall,R.initialElement=m.initialElement,R.rotation=q,R.hasMoved=m.hasMoved,R.id=m.id;let Q=F;if(!Q||!Q.classList?.contains("cell")){const N=document.elementFromPoint(j,D);N?.classList?.contains("cell")&&(Q=N)}Q?.classList?.contains("cell")?k(y.fromString(Q.id),R):O(),B(j-he.x),b(D-he.y+5)},[m,h,E,L,he,ye,q,k,O,Le]),v=d.useCallback(j=>{if(m==null)return;const D=j.clientX,X=j.clientY;console.log("Drag ended"),O(),document.body.removeEventListener("touchmove",Z);const F=document.elementFromPoint(D,X);if(!F?.classList?.contains("cell"))G();else{const Ie=ye(q),R={...m,cellsLong:Ie.cellsWide,cellsTall:Ie.cellsTall};if(!J(y.fromString(F.id),R))return;C(y.fromString(F.id),R,A!=null?y.fromString(A.id):null),console.log("Placed item at cell:",F)}},[m,q,G,J,C,A,O,H,ee]),de=d.useCallback(j=>{const D=j.clientX,X=j.clientY;fe(D,X,j)},[fe]),ge=d.useCallback(j=>{const D=j.touches[0],X=D.clientX,F=D.clientY;fe(X,F,j)},[fe]),we=d.useCallback(j=>{const D=j.changedTouches[0],X=D.clientX,F=D.clientY;v({clientX:X,clientY:F}),document.body.removeEventListener("touchmove",Z)},[v,Z]);return d.useEffect(()=>{if(h)return document.body.addEventListener("touchmove",Z,{passive:!1}),document.addEventListener("mousemove",de),document.addEventListener("mouseup",v),document.addEventListener("touchmove",ge),document.addEventListener("touchend",we),()=>{document.body.removeEventListener("touchmove",Z),document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",v),document.removeEventListener("touchmove",ge),document.removeEventListener("touchend",we)}},[h,de,v,ge,we,Z]),E==0||L==0||!Pe||m==null?o.jsx(o.Fragment,{}):o.jsx(o.Fragment,{children:o.jsx("div",{id:m.id,ref:Le,className:`draggable-item ${m.isSectionModifier&&!m.moveable?"placed-modifier":""} ${m.isSectionModifier?m.sectionModifierType?.toString():""} ${h?"dragging":""} ${m.moveable?"":"not-moveable"}`,style:{top:`${L}px`,left:`${E}px`,width:`${m.cellsLong*(m.isDisplayItem&&!h&&!m.hasMoved?10:M)-(m.sectionModifierType=="LeftWall"||m.sectionModifierType=="RightWall"||m.sectionModifierType?.includes("Corner")?1:0)}px`,height:`${m.cellsTall*(m.isDisplayItem&&!h&&!m.hasMoved?10:M)-(m.sectionModifierType=="TopWall"||m.sectionModifierType=="BottomWall"||m.sectionModifierType?.includes("Corner")?1:0)}px`,rotate:`${q*90}deg`,transformOrigin:"center center",fontSize:`${Re}px`,zIndex:h?1e3:1},children:m.isSectionModifier?null:m.icon.includes("custom-")?o.jsx("div",{className:m.isSectionItem?"custom-section":"custom-icon",children:o.jsx("div",{children:o.jsx("p",{ref:S,children:m.icon.split("custom-")[1]})})}):o.jsx("img",{src:m.icon,alt:"icon"})})})}Pt.createRoot(document.getElementById("root")).render(o.jsx(ol,{}));function ol(){const[m,G]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[J,C]=d.useState(0),[k,O]=d.useState(0),[M,E]=d.useState(0),[B,L]=d.useState(0),[b,S]=d.useState([]),[H,p]=d.useState([]),[ee,I]=d.useState(0),[h,P]=d.useState(null),[q,oe]=d.useState([]),A=/Mobi|Android/i.test(navigator.userAgent)?5:10,[me,re]=d.useState([]),[ve,Re]=d.useState(!0),[ce,he]=d.useState(null),[Oe,Le]=d.useState(null),[Pe,Qe]=d.useState([new w({id:"left-wall",name:"Left Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWall"}),new w({id:"right-wall",name:"Right Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWall"}),new w({id:"top-wall",name:"Top Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWall"}),new w({id:"bottom-wall",name:"Bottom Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWall"}),new w({id:"top-left-corner-wall",name:"Top Left Corner Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopLeftCornerWall"}),new w({id:"top-right-corner-wall",name:"Top Right Corner Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopRightCornerWall"}),new w({id:"bottom-left-corner-wall",name:"Bottom Left Corner Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomLeftCornerWall"}),new w({id:"bottom-right-corner-wall",name:"Bottom Right Corner Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomRightCornerWall"})]),ye=d.useRef(null),[Ke,Ae]=d.useState(!1),[Z,fe]=d.useState([]),[v,de]=d.useState([]),[ge,we]=d.useState([]),[j,D]=d.useState(!1),X=d.useRef(null),[F,Ie]=d.useState([]),[R,Q]=d.useState([]),[N,We]=d.useState(null),[Se,mt]=d.useState(!1),[xe,rt]=d.useState(!1),[be,dt]=d.useState(!1),[_e,gt]=d.useState(!1),[se,ut]=d.useState(!1),[le,Fe]=d.useState("placing-sections"),[sl,ft]=d.useState(!1),[It,pt]=d.useState(!1),[Ce,Ge]=d.useState(""),[ke,ht]=d.useState(null),[je,et]=d.useState(""),[K,yt]=d.useState(""),[z,wt]=d.useState(""),[Ye,xt]=d.useState(null),[Ue,Je]=d.useState(""),[He,te]=d.useState(!0),[tt,Tt]=d.useState(null),[Be,pe]=d.useState(!1),[vt,Lt]=d.useState(null),[St,Me]=d.useState(!1),Ze=d.useRef(null),Xe=d.useRef(null),$e=d.useRef(null);function Te(t,e){for(const s of e)if(t.x>=s.cellId.x&&t.x<s.cellId.x+s.cellsLong&&t.y>=s.cellId.y&&t.y<s.cellId.y+s.cellsTall)return s;return null}function bt(t,e,s,a){fe([...t.map(l=>new W({name:l.name,cellId:new y({x:l.cellId.x,y:l.cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,modifierItems:l.modifierItems.map(i=>new U({cell:new y({x:i.cell.x,y:i.cell.y}),item:new w({id:i.item.id,name:i.item.name,cellsLong:i.item.cellsLong,cellsTall:i.item.cellsTall,icon:i.item.icon,starterItem:!0,moveable:i.item.moveable,rotation:i.item.rotation||0,isSectionItem:i.item.isSectionItem,isSectionModifier:i.item.isSectionModifier,sectionModifierType:i.item.sectionModifierType,displayItem:i.item.isDisplayItem})})),startingItems:[]}))]);let c=J,n=k;if(m){for(const u of t)console.log("Generating cells for section",u.name,"at",u.cellId,"with size",u.cellsLong,"x",u.cellsTall),console.log("Needed section Width:",(u.cellsLong+u.cellId.x)*A,"Current width:",c),(u.cellsLong+u.cellId.x)*A>c&&(console.log("Added section Width:",u.cellsLong*A+u.cellId.x),c+=(u.cellsLong+u.cellId.x)*A-c),console.log("Needed section Height:",(u.cellsTall+u.cellId.y)*A,"Current height:",n),(u.cellsTall+u.cellId.y)*A>n&&(console.log("Added section Height:",u.cellsTall*A+u.cellId.y),n+=(u.cellsTall+u.cellId.y)*A-n);L(n/A*2),E(c/A*2);let l=0;const i=[],f=[];for(const u of t){const T=[],V={width:u.cellsLong*A,height:u.cellsTall*A,sectionName:u.name};V.height>l&&(l=V.height),Ie(ie=>[...ie,V]),u.cellId.x=0,u.cellId.y=0,[...Array(V.height/A).keys()].map(ie=>{const $=[];[...Array(V.width/A).keys()].map(_=>{$.push({id:new y({x:_,y:ie}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:A})}),T.push($)}),i.push({sectionName:u.name,cells:[...T]}),f.push(u)}Q(i),de(f),I(l),We(t[0]?t[0].name:null),setTimeout(()=>{te(!1)},500)}else{const l=[];for(const i of t)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",i.cellsLong+i.cellId.x,"Current width:",c),i.cellsLong+i.cellId.x>c&&(console.log("Added section Width:",i.cellsLong+i.cellId.x),c+=i.cellsLong+i.cellId.x-c),console.log("Needed section Height:",i.cellsTall+i.cellId.y,"Current height:",n),i.cellsTall+i.cellId.y>n&&(console.log("Added section Height:",i.cellsTall+i.cellId.y),n+=i.cellsTall+i.cellId.y-n);C(e.width),O(e.height),E(e.width),L(e.height),console.log("Final width:",c,"Final height:",n),[...Array(e.height).keys()].map(i=>{const f=[];[...Array(e.width).keys()].map(u=>{console.log("Creating cell at",u,i,"with size",A,s),f.push({id:new y({x:u,y:i}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:s&&a=="placing-sections"?!0:Te(new y({x:u,y:i}),t)!=null,size:A})}),l.push(f)}),S([...l]),setTimeout(()=>{const i=[],f=[...t];for(const u of f)u.cellElement=document.querySelector(`.App #${u.cellId.toId()}.cell:not(.cell-border)`),i.push(...u.startingItems.map(T=>new U({cell:new y({x:u.cellId.x+T.cell.x,y:u.cellId.y+T.cell.y}),item:new w({id:T.item.id,name:T.item.name,cellsLong:T.item.cellsLong,cellsTall:T.item.cellsTall,icon:T.item.icon,initialElement:document.querySelector(`.App #${T.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:T.item.moveable,rotation:T.item.rotation||0})}))),i.push(...u.modifierItems.map(T=>new U({cell:new y({x:u.cellId.x+T.cell.x,y:u.cellId.y+T.cell.y}),item:new w({id:T.item.id,name:T.item.name,cellsLong:T.item.cellsLong,cellsTall:T.item.cellsTall,icon:T.item.icon,initialElement:document.querySelector(`.App #${T.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1,isSectionItem:T.item.isSectionItem,isSectionModifier:T.item.isSectionModifier,sectionModifierType:T.item.sectionModifierType,rotation:T.item.rotation||0})})));de([...f]);for(const u of i){const T=$=>{const _=$%2===1;return{cellsLong:_?u.item.cellsTall:u.item.cellsLong,cellsTall:_?u.item.cellsLong:u.item.cellsTall}},V=u.item.rotation||0,ie=T(V);for(let $=0;$<ie.cellsTall;$++)for(let _=0;_<ie.cellsLong;_++)l[u.cell.y+$][u.cell.x+_].hasItem=!0,l[u.cell.y+$][u.cell.x+_].itemId=u.item.id;u.item.initialElement=document.querySelector(`.App #${u.cell.toId()}.cell:not(.cell-border)`),p($=>[...$,u.item])}S([...l]),setTimeout(()=>{te(!1)},500)},100)}}async function jt(){const t=new URLSearchParams(window.location.search),e=t.get("companyId"),s=t.get("areaId"),a=t.get("areaId")||"",c=t.get("companyId")||"",n=t.get("templateId")||"",l=await Ut(c,a);if(l===null){window.location.href="/LayItOut/DNF/";return}xt(l),Lt(l.previewImage||null);const i=t.get("type")||"";let f=!1,u=!1,T="modify-sections";if(i==="create-template")mt(!0);else if(i==="edit-template"){rt(!0);const g=l.templates.find(r=>r.id===n);g&&(Tt(g),et(g.name))}else if(i==="view-design"){f=!0,dt(!0);const g=t.get("designName")||"";Ge(g);const r=t.get("designId")||"";Je(r)}else if(i==="view-area")gt(!0);else if(i==="edit-design"){f=!0,ft(!0);const g=t.get("designName")||"";Ge(g);const r=t.get("designId")||"";Je(r)}else if(i==="client-edit-design"){f=!0,pt(!0);const g=t.get("designName")||"";Ge(g);const r=t.get("designId")||"";Je(r)}else if(i==="create-area"){u=!0,ut(!0);const g=t.get("stage");g==="placing-sections"?(T="placing-sections",Fe("placing-sections")):g==="modify-sections"?(Fe("modify-sections"),T="modify-sections",re(Pe.map(r=>new ae({item:new w({id:r.id,name:r.name,cellsLong:r.cellsLong,cellsTall:r.cellsTall,icon:r.icon,initialElement:r.initialElement,moveable:r.moveable,starterItem:r.starterItem,displayItem:!0,isSectionItem:r.isSectionItem,isSectionModifier:r.isSectionModifier,sectionModifierType:r.sectionModifierType}),quantity:-1})))):g==="placing-items"&&(Fe("placing-items"),T="placing-items",re(l.inventoryItems.map(r=>new ae({item:new w({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,initialElement:r.item.initialElement,moveable:r.item.moveable,starterItem:r.item.starterItem,displayItem:!0}),quantity:r.quantity}))))}e&&yt(e),s&&wt(s),u||re(l.inventoryItems.map(g=>new ae({item:new w({id:g.item.id,name:g.item.name,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,initialElement:g.item.initialElement,moveable:g.item.moveable,starterItem:g.item.starterItem,displayItem:!0}),quantity:g.quantity})));const V=[],ie=[];for(const g of l.templates){const r=[],Y=[];for(const ne of g.sections)r.push(new W({name:ne.name,cellId:new y({x:ne.cellId.x,y:ne.cellId.y}),cellsLong:ne.cellsLong,cellsTall:ne.cellsTall,modifierItems:ne.modifierItems.map(x=>new U({cell:new y({x:x.cell.x,y:x.cell.y}),item:new w({id:x.item.id,name:x.item.name,cellsLong:x.item.cellsLong,cellsTall:x.item.cellsTall,icon:x.item.icon,starterItem:!0,moveable:x.item.moveable,rotation:x.item.rotation||0,isSectionItem:x.item.isSectionItem,isSectionModifier:x.item.isSectionModifier,sectionModifierType:x.item.sectionModifierType,displayItem:x.item.isDisplayItem})})),startingItems:ne.startingItems.map(x=>new U({cell:new y({x:x.cell.x,y:x.cell.y}),item:new w({id:x.item.id,name:x.item.name,cellsLong:x.item.cellsLong,cellsTall:x.item.cellsTall,icon:x.item.icon,starterItem:!0,moveable:x.item.moveable,rotation:x.item.rotation||0})}))})),Y.push(new W({name:ne.name,cellId:new y({x:ne.cellId.x,y:ne.cellId.y}),cellsLong:ne.cellsLong,cellsTall:ne.cellsTall,modifierItems:ne.modifierItems.map(x=>new U({cell:new y({x:x.cell.x,y:x.cell.y}),item:new w({id:x.item.id,name:x.item.name,cellsLong:x.item.cellsLong,cellsTall:x.item.cellsTall,icon:x.item.icon,starterItem:!0,moveable:x.item.moveable,rotation:x.item.rotation||0,isSectionItem:x.item.isSectionItem,isSectionModifier:x.item.isSectionModifier,sectionModifierType:x.item.sectionModifierType,displayItem:x.item.isDisplayItem})})),startingItems:ne.startingItems.map(x=>new U({cell:new y({x:x.cell.x,y:x.cell.y}),item:new w({id:x.item.id,name:x.item.name,cellsLong:x.item.cellsLong,cellsTall:x.item.cellsTall,icon:x.item.icon,starterItem:!0,moveable:x.item.moveable,rotation:x.item.rotation||0})}))}));V.push(new ue({name:g.name,sections:r,inventoryItems:g.inventoryItems,id:g.id,previewImage:g.previewImage})),ie.push(new ue({name:g.name,sections:Y,id:g.id,previewImage:g.previewImage,inventoryItems:g.inventoryItems}))}we([...V]);const $=[],_=n===""?void 0:ie.find(g=>g.id===n);if(console.log("TEMPLATE",_,"AREA",l),f){const g=await Jt(c,a,t.get("designId")||"");if(g===null){window.location.href="/LayItOut/DNF/";return}ht(g),re(g.inventoryItems.map(r=>new ae({item:new w({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,initialElement:r.item.initialElement,moveable:r.item.moveable,starterItem:r.item.starterItem,displayItem:!0}),quantity:r.quantity}))),fe([...g.sections]),de([...g.sections.map(r=>new W({name:r.name,cellId:new y({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,startingItems:r.startingItems,modifierItems:r.modifierItems,items:r.startingItems.map(Y=>new w({id:Y.item.id,name:Y.item.name,sectionCell:Y.cell,cellsLong:Y.item.cellsLong,cellsTall:Y.item.cellsTall,icon:Y.item.icon,moveable:Y.item.moveable,starterItem:Y.item.starterItem,rotation:Y.item.rotation}))}))]),$.push(...g.sections.map(r=>new W({name:r.name,cellId:new y({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,startingItems:r.startingItems,modifierItems:r.modifierItems,items:r.startingItems.map(Y=>new w({id:Y.item.id,name:Y.item.name,sectionCell:Y.cell,cellsLong:Y.item.cellsLong,cellsTall:Y.item.cellsTall,icon:Y.item.icon,moveable:Y.item.moveable,starterItem:Y.item.starterItem,rotation:Y.item.rotation}))})))}else _!==void 0?(re(_.inventoryItems.map(g=>new ae({item:new w({id:g.item.id,name:g.item.name,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,initialElement:g.item.initialElement,moveable:g.item.moveable,starterItem:g.item.starterItem,displayItem:!0}),quantity:g.quantity}))),fe([..._.sections]),de([..._.sections.map(g=>new W({name:g.name,cellId:new y({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,modifierItems:g.modifierItems,items:g.startingItems.map(r=>new w({id:r.item.id,name:r.item.name,sectionCell:r.cell,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,rotation:r.item.rotation}))}))]),$.push(..._.sections.map(g=>new W({name:g.name,cellId:new y({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,modifierItems:g.modifierItems,startingItems:g.startingItems,items:g.startingItems.map(r=>new w({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,rotation:r.item.rotation,sectionCell:r.cell}))})))):(fe([...l.sections]),de([...l.sections.map(g=>new W({name:g.name,cellId:new y({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,modifierItems:g.modifierItems,startingItems:g.startingItems,items:g.startingItems.map(r=>new w({id:r.item.id,name:r.item.name,sectionCell:r.cell,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,rotation:r.item.rotation}))}))]),$.push(...l.sections.map(g=>new W({name:g.name,cellId:new y({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,modifierItems:g.modifierItems,items:g.startingItems.map(r=>new w({id:r.item.id,name:r.item.name,sectionCell:r.cell,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,rotation:r.item.rotation}))}))));console.log("SECTIONS TO GENERATE",$),bt($,l,i==="create-area",T)}d.useEffect(()=>{jt()},[]);function Nt(t,e,s){if(!m||t==null)return;const a=[...s],c=[],n=s.find(l=>l.name==t);console.log("NEW SECTION",n),console.log("Adding section",n.name,n.cellId),console.log("MOBILE CELLS",e),n.cellElement=document.querySelector(`.App #${n.name.split(" ").join("-")} #${n.name.split(" ").join("")}${n.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",n.cellElement);for(const l of n.startingItems){console.log("Placing starting item",l.item.name,l.cell);const i=T=>{const V=T%2===1;return{cellsLong:V?l.item.cellsTall:l.item.cellsLong,cellsTall:V?l.item.cellsLong:l.item.cellsTall}},f=l.item.rotation||0,u=i(f);for(let T=0;T<u.cellsTall;T++)for(let V=0;V<u.cellsLong;V++){const ie=e.find($=>$.sectionName===n.name);ie.cells[l.cell.y+T][l.cell.x+V].hasItem=!0,ie.cells[l.cell.y+T][l.cell.x+V].itemId=l.item.id}l.item.initialElement=document.querySelector(`.App #${n.name.split(" ").join("-")} #${n.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",l.item.initialElement),c.push(new w({id:l.item.id,name:l.item.name,cellsLong:l.item.cellsLong,cellsTall:l.item.cellsTall,icon:l.item.icon,initialElement:l.item.initialElement,starterItem:!0,moveable:l.item.moveable,rotation:l.item.rotation}))}console.log("Setting sections",a),de([...a]),console.log("ITEMS",c),p(l=>[...l.filter(f=>!c.some(u=>u.id===f.id)),...c.map(f=>new w({id:f.id,name:f.name,cellsLong:f.cellsLong,cellsTall:f.cellsTall,icon:f.icon,initialElement:f.initialElement,starterItem:!0,moveable:f.moveable,rotation:f.rotation}))])}function lt(t){let e=[];return t.map(s=>e=[...e,...s]),e}function ze(t,e){console.log(t);const s=m?R.find(l=>l.sectionName===N).cells:b,a=s[t.y].length,c=s.length;if(console.log(a,c),t.x+e.cellsLong>a||t.y+e.cellsTall>c)return!1;const n=Te(t,v);if(!n&&!m&&(le!=="placing-sections"||!se))return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<e.cellsTall;l++)for(let i=0;i<e.cellsLong;i++){if(!m){const f=Te(new y({x:t.x+i,y:t.y+l}),v);if(!f&&(le!=="placing-sections"||!se))return console.log("Item is out of bounds of any section"),!1;if(f?.name!=n?.name&&(le!=="placing-sections"||!se))return console.log("Item is crossing section boundaries"),!1}if(s[t.y+l][t.x+i].hasItem&&s[t.y+l][t.x+i].itemId!=e.id){console.log("Something is already here");const f=H.find(u=>u.id==s[t.y+l][t.x+i].itemId);if(f&&f.isSectionModifier){if(f.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",l,i,e.cellsTall,e.cellsLong),i==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(f.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",l,i,e.cellsTall,e.cellsLong),i==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(f.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",l,i,e.cellsTall,e.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(f.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",l,i,e.cellsTall,e.cellsLong),l==e.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(f.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",l,i,e.cellsTall,e.cellsLong),l==0&&i==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(f.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",l,i,e.cellsTall,e.cellsLong),l==0&&i==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(f.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",l,i,e.cellsTall,e.cellsLong),l==e.cellsTall-1&&i==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(f.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",l,i,e.cellsTall,e.cellsLong),l==e.cellsTall-1&&i==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function nt(t,e,s){const a=Array.from(m?R.find(n=>n.sectionName===N).cells:b);if(Me(!0),s!=null){console.log("Removing item");const n=m?v.find(l=>l.name===N):Te(s,v);n.items=n.items.filter(l=>l.id!=e.id);for(let l=0;l<e.cellsTall;l++)for(let i=0;i<e.cellsLong;i++)a[s.y+l][s.x+i].hasItem=!1,a[s.y+l][s.x+i].itemId=""}if(le!=="placing-sections"||!se){const n=m?v.find(i=>i.name===N):Te(t,v),l=new y({x:t.x-n.cellId.x,y:t.y-n.cellId.y});e.sectionCell=l,console.log("Adding item to section",n.name,"at",l,e),n.items.push(e)}else e.sectionCell=new y({x:t.x,y:t.y});for(let n=0;n<e.cellsTall;n++)for(let l=0;l<e.cellsLong;l++)a[t.y+n][t.x+l].hasItem=!0,a[t.y+n][t.x+l].itemId=e.id;if(console.log(a),m){const n=R.find(l=>l.sectionName===N);n&&(n.cells=a.map(l=>l.map(i=>({...i}))),Q([...R]))}else S(a);console.log("Removing item from inventory",e.name);let c=!1;if(!e.hasMoved){const n=me.findIndex(l=>l.item.name==e.name&&!l.item.hasMoved);if(n!==-1){const l=[...me];l[n].quantity>0&&(l[n].quantity-=1,l[n].quantity<=0&&(c=!0,l.splice(n,1)),re(l))}else re(me)}if(p(n=>(console.log("Placing item",e),console.log("Updating item",e.id),ve&&ce&&e.id==ce.id?(console.log("Updating placing item",e.id),e.hasMoved=!0,e.starterItem=!0,e.isDisplayItem=!1,e.initialElement=document.querySelector(`.App #${t.toId()}.cell:not(.cell-border)`),[...n,new w({id:e.name+Math.floor(Math.random()*1e5).toString(),name:e.name,cellsLong:e.cellsLong,cellsTall:e.cellsTall,icon:e.icon,initialElement:e.initialElement,moveable:e.moveable,starterItem:e.starterItem,displayItem:e.isDisplayItem,isSectionItem:e.isSectionItem,isSectionModifier:e.isSectionModifier,sectionModifierType:e.sectionModifierType,sectionCell:e.sectionCell,rotation:e.rotation})]):(n.find(l=>l.id==e.id).hasMoved||(n.find(l=>l.id==e.id).hasMoved=!0,n.find(l=>l.id==e.id).sectionCell=e.sectionCell),n))),ve&&ce&&c){he(null);return}}function At(t){H.find(e=>e.name==t.name&&!e.hasMoved&&!e.starterItem)||p(e=>[...e,t])}d.useEffect(()=>{ce?(console.log("Adding placing item",ce.id),Le(ce.id)):(console.log("Removing placing item",Oe),Le(""))},[ce]);function ot(t){console.log("Removing item",t.id),p(e=>e.filter(s=>s.id!=t.id))}function Ct(t,e){const s=Array.from(m?R.find(l=>l.sectionName===N).cells:b);Me(!0);const a=l=>{const i=l%2===1;return{cellsWide:i?t.cellsTall:t.cellsLong,cellsTall:i?t.cellsLong:t.cellsTall}},c=t.rotation||0,n=a(c);for(let l=0;l<n.cellsTall;l++)for(let i=0;i<n.cellsWide;i++)s[e.y+l][e.x+i].hasItem=!1,s[e.y+l][e.x+i].itemId="";if(m){const l=R.find(i=>i.sectionName===N);l&&(l.cells=s.map(i=>i.map(f=>({...f}))),Q([...R])),Q(i=>i.map(f=>f.sectionName===N?{...f,cells:s}:f))}else S(s);if(le!=="placing-sections"||!se){const l=m?v.find(i=>i.name===N):Te(e,v);l.items=l.items.filter(i=>i.id!=t.id),console.log("DELETING ITEM",t.id)}p(l=>(console.log(),l.filter(i=>i.id!=t.id))),re(l=>{const i=l.findIndex(f=>f.item.name==t.name&&!f.item.hasMoved);if(i!==-1){const f=[...l];return f[i].quantity>0&&(f[i].quantity+=1),f}else return[...l,new ae({item:new w({id:t.id,name:t.name,cellsLong:n.cellsWide,cellsTall:n.cellsTall,icon:t.icon,isSectionItem:t.isSectionItem}),quantity:1})]})}function Mt(t,e){const s=Array.from(m?R.find(f=>f.sectionName===N).cells:b);console.log("DELETING ITEM ROTATE",t.id,t.rotation),Me(!0);const a=f=>{const u=f%2===1;return{cellsWide:u?t.cellsTall:t.cellsLong,cellsTall:u?t.cellsLong:t.cellsTall}},c=t.rotation||0,n=a(c);for(let f=0;f<n.cellsTall;f++)for(let u=0;u<n.cellsWide;u++)console.log("Deleting cell",e.y+f,e.x+u),s[e.y+f][e.x+u].hasItem=!1,s[e.y+f][e.x+u].itemId="";if(m){const f=R.find(u=>u.sectionName===N);f&&(f.cells=s.map(u=>u.map(T=>({...T}))),Q([...R])),Q(u=>u.map(T=>T.sectionName===N?{...T,cells:s}:T))}else S(s);console.log("DELETING ITEM",t.id);const l=m?v.find(f=>f.name===N):Te(e,v);l.items=l.items.filter(f=>f.id!=t.id);const i=new y({x:e.x-l.cellId.x,y:e.y-l.cellId.y});t.sectionCell=i,l.items.push(t)}function st(t,e){const s=m?R.find(n=>n.sectionName===N).cells:b,a=Array.from(s);if(s[t.y]==null){Ve();return}const c=ze(t,e);a.forEach(n=>n.forEach(l=>{l.mouseOver=!1,l.canPlaceItem=!1,l.mouseOverLocation=""}));for(let n=0;n<e.cellsTall;n++)for(let l=0;l<e.cellsLong;l++)t.y+n<a.length&&t.x+l<a[t.y+n].length&&(e.cellsLong===1&&e.cellsTall===1?a[t.y+n][t.x+l].mouseOverLocation="single":e.cellsTall===1?l===0?a[t.y+n][t.x+l].mouseOverLocation="leftFull":l===e.cellsLong-1?a[t.y+n][t.x+l].mouseOverLocation="rightFull":a[t.y+n][t.x+l].mouseOverLocation="middleFull":e.cellsLong===1?n===0?a[t.y+n][t.x+l].mouseOverLocation="topFull":n===e.cellsTall-1?a[t.y+n][t.x+l].mouseOverLocation="bottomFull":a[t.y+n][t.x+l].mouseOverLocation="middleVFull":n===0&&l===0?a[t.y+n][t.x+l].mouseOverLocation="topLeftCorner":n===0&&l===e.cellsLong-1?a[t.y+n][t.x+l].mouseOverLocation="topRightCorner":n===e.cellsTall-1&&l===0?a[t.y+n][t.x+l].mouseOverLocation="bottomLeftCorner":n===e.cellsTall-1&&l===e.cellsLong-1?a[t.y+n][t.x+l].mouseOverLocation="bottomRightCorner":n===0?a[t.y+n][t.x+l].mouseOverLocation="top":n===e.cellsTall-1?a[t.y+n][t.x+l].mouseOverLocation="bottom":l===0?a[t.y+n][t.x+l].mouseOverLocation="left":l===e.cellsLong-1?a[t.y+n][t.x+l].mouseOverLocation="right":a[t.y+n][t.x+l].mouseOverLocation="middle",a[t.y+n][t.x+l].mouseOver=!0,a[t.y+n][t.x+l].canPlaceItem=c);if(m){const n=R.find(l=>l.sectionName===N);n&&(n.cells=a.map(l=>l.map(i=>({...i}))),Q([...R])),Q(l=>l.map(i=>i.sectionName===N?{...i,cells:a}:i))}else S(a)}function Ve(){console.log("Unhighlighting cells");const t=Array.from(m?R.find(e=>e.sectionName===N).cells:b);if(t.forEach(e=>e.forEach(s=>{s.mouseOver=!1,s.canPlaceItem=!1,s.mouseOverLocation=""})),m){const e=R.find(s=>s.sectionName===N);e&&(e.cells=t.map(s=>s.map(a=>({...a}))),Q([...R])),Q(s=>s.map(a=>a.sectionName===N?{...a,cells:t}:a))}else S(t)}d.useEffect(()=>{Nt(N,R,v)},[N]),d.useEffect(()=>{const t=()=>{const e=H.find(s=>s.id===h);console.log("Unselecting item",h),P(null),e&&(oe(s=>[...s,e.id]),console.log("Unselecting item",e.id),setTimeout(()=>{oe(s=>s.filter(a=>a!==e.id))},300))};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[h,H]);function Et(t){P(null),oe(e=>[...e,t]),console.log("Unselecting item",t),setTimeout(()=>{oe(e=>e.filter(s=>s!==t))},300)}function Rt(t){const e=H.find(s=>s.id===h);console.log("Unselecting item",h),P(t),e&&(oe(s=>[...s,e.id]),console.log("Unselecting item",e.id),setTimeout(()=>{oe(s=>s.filter(a=>a!==e.id))},300))}function qe(t){re(e=>[...e,t])}const Ne=t=>{console.log("Preventing scroll"),t.preventDefault(),t.stopPropagation(),window.scrollTo(0,0)};d.useEffect(()=>(Be?(window.addEventListener("scroll",Ne),window.addEventListener("touchmove",Ne,{passive:!1})):(window.removeEventListener("scroll",Ne),window.removeEventListener("touchmove",Ne)),()=>{window.removeEventListener("scroll",Ne),window.removeEventListener("touchmove",Ne)}),[Be]);async function Ot(t){const e=[];te(!0);for(const c of t){const n=c.name,l=new y({x:c.sectionCell.x,y:c.sectionCell.y}),i=new W({name:n,cellId:l,cellsLong:c.cellsLong,cellsTall:c.cellsTall,modifierItems:[],startingItems:[],items:[]});e.push(i)}let s=0,a=0;for(const c of e)console.log("Generating cells for section",c.name,"at",c.cellId,"with size",c.cellsLong,"x",c.cellsTall),console.log("Needed section Width:",c.cellsLong+c.cellId.x,"Current width:",s),c.cellsLong+c.cellId.x>s&&(console.log("Added section Width:",c.cellsLong+c.cellId.x),s+=c.cellsLong+c.cellId.x-s),console.log("Needed section Height:",c.cellsTall+c.cellId.y,"Current height:",a),c.cellsTall+c.cellId.y>a&&(console.log("Added section Height:",c.cellsTall+c.cellId.y),a+=c.cellsTall+c.cellId.y-a);await Ht(K,z,e,s,a),window.location.href=`/LayItOut/Layout/?companyId=${K}&areaId=${z}&type=create-area&stage=modify-sections`}async function kt(t,e){const s=[];te(!0);for(const a of e){const c=a.name,n=new y({x:a.cellId.x,y:a.cellId.y}),l=new W({name:c,cellId:n,cellsLong:a.cellsLong,cellsTall:a.cellsTall,startingItems:[],items:[],modifierItems:a.items.map(i=>new U({cell:new y({x:i.sectionCell.x,y:i.sectionCell.y}),item:new w({id:i.id,name:i.name,cellsLong:i.cellsLong,cellsTall:i.cellsTall,icon:i.icon,rotation:i.rotation,moveable:i.moveable,starterItem:i.starterItem,isSectionItem:i.isSectionItem,isSectionModifier:!0,sectionModifierType:i.sectionModifierType})}))});s.push(l)}console.log("Saving section modifier items",s),await Bt(K,z,s),console.log("Section modifier items saved successfully"),window.location.href=`/LayItOut/Layout/?companyId=${K}&areaId=${z}&type=create-area&stage=placing-items`}async function Dt(t,e){te(!0);const s=[];for(const a of t){const c=a.name,n=new y({x:a.cellId.x,y:a.cellId.y}),l=new W({name:c,cellId:n,cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(i=>new U({cell:new y({x:i.sectionCell.x,y:i.sectionCell.y}),item:new w({id:i.id,name:i.name,cellsLong:i.cellsLong,cellsTall:i.cellsTall,icon:i.icon,starterItem:!0,moveable:i.moveable,rotation:i.rotation})})),items:[]});s.push(l)}console.log("Saving area sections",s),localStorage.setItem("screenshotSections",s.map(a=>JSON.stringify(a.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",s.map(a=>JSON.stringify(a.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),pe(!0),window.addEventListener("storage",async a=>{if(console.log("Storage event",a),a.key==="screenshot"){const c=new Zt({id:z,name:Ye.name,sections:s,templates:[],previewImage:a.newValue,width:Ye.width,height:Ye.height,inventoryItems:e.map(n=>new ae({item:new w({id:n.item.id,name:n.item.name,cellsLong:n.item.cellsLong,cellsTall:n.item.cellsTall,icon:n.item.icon,starterItem:!0,moveable:n.item.moveable,rotation:n.item.rotation}),quantity:n.quantity}))});await Xt(K,c),console.log("Area saved successfully"),te(!1),window.location.href=`/LayItOut/Layout/?companyId=${K}&areaId=${z}&type=view-area`}})}return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"App",children:[o.jsx("h1",{className:"title",children:"LayItOut"}),o.jsx("br",{}),se&&o.jsxs("div",{className:"area-creation",children:[o.jsx("h2",{className:"area-creation-title",children:"Create Area"}),o.jsx("label",{htmlFor:"",children:le=="placing-sections"?"Create new sections and place them":le=="modify-sections"?"Add walls and doors to sections":"Add items to the inventory and place items"})]}),(Se||xe)&&o.jsxs("div",{className:"template-name-row",children:[o.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),o.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:t=>et(t.target.value),value:je})]}),be&&o.jsx("div",{className:"design-name-row",children:o.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",Ce]})}),(Se||xe)&&o.jsxs("div",{className:"template-creation",children:[o.jsxs("button",{className:"action-btn",onClick:()=>{if(je.trim()==""){alert("Please enter a template name");return}if(ge.some(t=>t.name===je&&(xe?t.id!==tt.id:!0))){alert("Template with this name already exists");return}xe?(te(!0),setTimeout(async()=>{const t=v.map(e=>new W({name:e.name,cellId:new y({x:Z.find(s=>s.name==e.name).cellId.x,y:Z.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new U({cell:new y({x:s.sectionCell.x,y:s.sectionCell.y}),item:new w({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))}));localStorage.setItem("screenshotSections",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),pe(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){pe(!1);const s=ge.map(a=>a.id===tt.id?(console.log("SECTION",v),new ue({name:je,inventoryItems:me,previewImage:e.newValue,sections:v.map(c=>new W({name:c.name,cellId:new y({x:a.sections.find(n=>n.name==c.name).cellId.x,y:a.sections.find(n=>n.name==c.name).cellId.y}),cellsLong:c.cellsLong,modifierItems:c.modifierItems,cellsTall:c.cellsTall,startingItems:c.items.map(n=>new U({cell:new y({x:n.sectionCell.x,y:n.sectionCell.y}),item:new w({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))})),id:a.id})):new ue({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(c=>new W({name:c.name,cellId:new y({x:c.cellId.x,y:c.cellId.y}),cellsLong:c.cellsLong,cellsTall:c.cellsTall,modifierItems:c.modifierItems,startingItems:c.startingItems.map(n=>new U({cell:new y({x:n.cell.x,y:n.cell.y}),item:new w({id:n.item.id,name:n.item.name,cellsLong:n.item.cellsLong,cellsTall:n.item.cellsTall,icon:n.item.icon,starterItem:n.item.starterItem,moveable:n.item.moveable,rotation:n.item.rotation})}))})),id:a.id}));Ee(K,z,s).then(()=>{console.log("Template updated successfully"),te(!1);const a=new URLSearchParams(window.location.search),c=a.get("companyId"),n=a.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${c}&areaId=${n}&type=view-area`})}})},500)):(te(!0),setTimeout(async()=>{const t=v.map(e=>new W({name:e.name,cellId:new y({x:Z.find(s=>s.name==e.name).cellId.x,y:Z.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new U({cell:new y({x:s.sectionCell.x,y:s.sectionCell.y}),item:new w({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))}));localStorage.setItem("screenshotSections",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),pe(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){pe(!1);const s=new ue({name:je,previewImage:e.newValue,inventoryItems:me,sections:v.map(c=>new W({name:c.name,cellId:new y({x:Z.find(n=>n.name==c.name).cellId.x,y:Z.find(n=>n.name==c.name).cellId.y}),cellsLong:c.cellsLong,cellsTall:c.cellsTall,modifierItems:c.modifierItems,startingItems:c.items.map(n=>new U({cell:new y({x:n.sectionCell.x,y:n.sectionCell.y}),item:new w({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))})),id:je+(Math.random()*1e4).toString()}),a=[...ge.map(c=>new ue({name:c.name,previewImage:c.previewImage,inventoryItems:c.inventoryItems,sections:c.sections.map(n=>new W({name:n.name,cellId:new y({x:n.cellId.x,y:n.cellId.y}),cellsLong:n.cellsLong,cellsTall:n.cellsTall,modifierItems:n.modifierItems,startingItems:n.startingItems.map(l=>new U({cell:new y({x:l.cell.x,y:l.cell.y}),item:new w({id:l.item.id,name:l.item.name,cellsLong:l.item.cellsLong,cellsTall:l.item.cellsTall,icon:l.item.icon,starterItem:l.item.starterItem,moveable:l.item.moveable,rotation:l.item.rotation})}))})),id:c.id})),s];Ee(K,z,a).then(()=>{console.log("Template updated successfully"),te(!1);const c=new URLSearchParams(window.location.search),n=c.get("companyId"),l=c.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${n}&areaId=${l}&type=view-area`})}})},500))},children:[Se?"Create":"Save"," Template"]}),o.jsx("button",{className:"action-btn",onClick:()=>{const t=new URLSearchParams(window.location.search),e=t.get("companyId"),s=t.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${e}&areaId=${s}&type=view-area`},children:"Cancel"})]}),It&&o.jsxs("div",{className:"template-creation",children:[St&&o.jsx("button",{className:"action-btn",onClick:()=>{te(!0),setTimeout(async()=>{const t=v.map(e=>new W({name:e.name,cellId:new y({x:Z.find(s=>s.name==e.name).cellId.x,y:Z.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new U({cell:new y({x:s.sectionCell.x,y:s.sectionCell.y}),item:new w({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))}));localStorage.setItem("screenshotSections",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),pe(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){pe(!1);const s=new at({name:Ce,previewImage:e.newValue,areaId:z,inventoryItems:me,sections:v.map(a=>new W({name:a.name,cellId:new y({x:Z.find(c=>c.name==a.name).cellId.x,y:Z.find(c=>c.name==a.name).cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.items.map(c=>new U({cell:new y({x:c.sectionCell.x,y:c.sectionCell.y}),item:new w({id:c.id,name:c.name,cellsLong:c.cellsLong,cellsTall:c.cellsTall,icon:c.icon,starterItem:!0,moveable:c.moveable,rotation:c.rotation})}))})),id:Ue});ct(K,z,s).then(()=>{console.log("Design updated successfully"),Me(!1),te(!1)})}})},500)},children:"Save"}),o.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),o.jsxs("div",{className:"place-mode-row",children:[o.jsx("label",{htmlFor:"tap-and-place-mode",children:"Place Mode: "}),o.jsxs("select",{id:"tap-and-place-mode",name:"tap-and-place-mode",value:ve?"tap":"drag",onChange:t=>Re(t.target.value==="tap"),className:"place-mode-select",children:[o.jsx("option",{value:"drag",children:"Drag and Drop"}),o.jsx("option",{value:"tap",children:"Tap and Place"})]})]}),He&&o.jsx(o.Fragment,{children:o.jsx("div",{className:"loader-backdrop",children:o.jsx("div",{className:"loader"})})})," ",o.jsxs("div",{className:"layout",children:[!be&&o.jsx(Vt,{setSelectedItem:he,tapAndPlaceMode:ve,isModifyingSections:se&&le=="modify-sections",isViewingDesign:be,isEditingTemplate:xe,isCreatingTemplate:Se,maxHeight:m?200:k*A,showAddCustomItem:()=>{le=="placing-sections"&&se?Xe.current?.showModal():le=="placing-items"&&se?$e.current?.showModal():Ze.current?.showModal()},addDraggingItem:At,removeItem:ot,inventoryItems:me.map(t=>new ae({item:new w({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,displayItem:!0,isSectionItem:t.item.isSectionItem,isSectionModifier:t.item.isSectionModifier,moveable:t.item.moveable,rotation:t.item.rotation,sectionModifierType:t.item.sectionModifierType}),quantity:t.quantity}))}),m?o.jsxs("div",{className:"mobile-areas",style:{height:ee+"px"},children:[o.jsx("img",{src:De,onClick:()=>{const t=v.findIndex(s=>s.name==N);if(t===-1)return;const e=(t-1+v.length)%v.length;We(v[e].name),console.log("Changing viewing section to",v[e].name)},className:"back-mobile-areas"}),F.map((t,e)=>o.jsx(it,{width:t.width,height:t.height,cells:lt(R.find(s=>s.sectionName==t.sectionName).cells),id:t.sectionName,visibile:N==null?!0:t.sectionName==N,section:t.sectionName},e)),o.jsx("img",{src:De,onClick:()=>{const t=v.findIndex(s=>s.name==N);if(t===-1)return;const e=(t+1)%v.length;We(v[e].name),console.log("Changing viewing section to",v[e].name)},className:"forward-mobile-areas"})]}):o.jsx(it,{width:J*A,height:k*A,cells:lt(b)})]}),be&&o.jsxs("div",{className:"design-view",children:[o.jsx("button",{className:"action-btn",onClick:()=>{const t=v.map(e=>new W({name:e.name,cellId:new y({x:Z.find(s=>s.name==e.name).cellId.x,y:Z.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new U({cell:new y({x:s.sectionCell.x,y:s.sectionCell.y}),item:new w({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))}));localStorage.setItem("printSections",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/LayItOut/Print/?companyId=${K}&areaId=${z}&designName=${Ce}&designId=${Ue}`,"_blank")},children:"Print"}),o.jsx("button",{className:"action-btn",onClick:()=>{const t=new ue({name:Ce,previewImage:ke.previewImage,inventoryItems:ke.inventoryItems,sections:ke.sections,id:ke.name+(Math.random()*1e4).toString()}),e=[...ge.map(s=>new ue({name:s.name,previewImage:s.previewImage,inventoryItems:s.inventoryItems,sections:s.sections.map(a=>new W({name:a.name,cellId:new y({x:a.cellId.x,y:a.cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.startingItems.map(c=>new U({cell:new y({x:c.cell.x,y:c.cell.y}),item:new w({id:c.item.id,name:c.item.name,cellsLong:c.item.cellsLong,cellsTall:c.item.cellsTall,icon:c.item.icon,starterItem:c.item.starterItem,moveable:c.item.moveable,rotation:c.item.rotation})}))})),id:s.id})),t];Ee(K,z,e).then(()=>{console.log("Template updated successfully"),we(e),window.location.href=`/LayItOut/Layout/?companyId=${K}&areaId=${z}&type=edit-template&templateId=${t.id}`})},children:"Turn into a Template"}),o.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=desings"},children:"Back"})]}),_e&&o.jsx("div",{className:"design-view",children:o.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=areas"},children:"Back"})}),se&&o.jsxs("div",{className:"design-view",children:[o.jsx("button",{className:"action-btn",onClick:()=>{le=="placing-sections"?Ot(H.filter(t=>t.isSectionItem)):le=="modify-sections"?kt(H.filter(t=>t.isSectionModifier),v):le=="placing-items"&&Dt(v,me)},children:le=="placing-items"?"Create Area":"Next"}),o.jsx("button",{className:"action-btn",onClick:async()=>{te(!0),await Yt(K,z),window.location.href="/LayItOut/"},children:"Cancel"})]})]}),o.jsxs("div",{children:[v.map(t=>o.jsx(Wt,{takingPhoto:!1,section:t,visible:N==null?!0:t.name==N,cellSize:A},t.cellId.toId())),H.map(t=>o.jsx(Ft,{isCreatingArea:se,isCreatingTemplate:Se||xe,cellSize:A,isViewingDesign:be,removeItem:ot,visible:m?!t.hasMoved&&!t.starterItem?!0:N==null?!1:t.starterItem?v.find(e=>e.name==N)?.startingItems.some(e=>e.item.id===t.id):v.find(e=>e.name==N)?.items.some(e=>e.id===t.id):!0,item:t,canPlaceItem:ze,placeItem:nt,deleteItemRotate:Mt,highlightCells:st,unHighlightCells:Ve,deleteItem:Ct,isSelected:h===t.id,onSelect:Rt,isUnselecting:q.includes(t.id),onDeselect:()=>Et(t.id)},t.id))]}),m&&!He&&o.jsx("div",{className:"layout-icon",onClick:()=>{ye.current?.showModal(),Ae(!0),console.log("Showing layout dialog")},children:o.jsx("img",{src:Qt,alt:""})}),!He&&!(Se||xe||be||se)&&o.jsx("div",{className:"template-icon",onClick:()=>{X.current?.showModal(),D(!0),console.log("Showing template dialog")},children:o.jsx("img",{src:Kt,alt:""})}),o.jsx(_t,{isViewingArea:_e,dialogRef:X,isOpen:j,closeDialog:()=>{X.current?.close(),D(!1)},duplicateTemplate:t=>{const e=new ue({name:t.name+" Copy",previewImage:t.previewImage,inventoryItems:t.inventoryItems,sections:t.sections,id:t.name+"Copy"+(Math.random()*1e4).toString()}),s=[...ge.map(a=>new ue({name:a.name,previewImage:a.previewImage,inventoryItems:a.inventoryItems,sections:a.sections.map(c=>new W({name:c.name,cellId:new y({x:c.cellId.x,y:c.cellId.y}),cellsLong:c.cellsLong,cellsTall:c.cellsTall,modifierItems:c.modifierItems,startingItems:c.startingItems.map(n=>new U({cell:new y({x:n.cell.x,y:n.cell.y}),item:new w({id:n.item.id,name:n.item.name,cellsLong:n.item.cellsLong,cellsTall:n.item.cellsTall,icon:n.item.icon,starterItem:n.item.starterItem,moveable:n.item.moveable,rotation:n.item.rotation})}))})),id:a.id})),e];Ee(K,z,s).then(()=>{X.current?.close(),console.log("Template updated successfully"),we(s),D(!1),window.location.href=`/LayItOut/Layout/?companyId=${K}&areaId=${z}&type=edit-template&templateId=${e.id}`})},templates:ge,selectTemplate:t=>{te(!0),setTimeout(async()=>{const e=t.sections.map(s=>new W({name:s.name,cellId:new y({x:t.sections.find(a=>a.name==s.name).cellId.x,y:t.sections.find(a=>a.name==s.name).cellId.y}),cellsLong:s.cellsLong,cellsTall:s.cellsTall,modifierItems:s.modifierItems,startingItems:s.startingItems.map(a=>new U({cell:new y({x:a.cell.x,y:a.cell.y}),item:new w({id:a.item.id,name:a.item.name,cellsLong:a.item.cellsLong,cellsTall:a.item.cellsTall,icon:a.item.icon,starterItem:!0,moveable:a.item.moveable,rotation:a.item.rotation})}))}));localStorage.setItem("screenshotSections",e.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),pe(!0),window.addEventListener("storage",async s=>{if(console.log("Storage event",s),s.key==="screenshot"){pe(!1);const a=new at({name:Ce,previewImage:s.newValue,areaId:z,inventoryItems:t.inventoryItems,sections:t.sections.map(c=>new W({name:c.name,cellId:new y({x:t.sections.find(n=>n.name==c.name).cellId.x,y:t.sections.find(n=>n.name==c.name).cellId.y}),cellsLong:c.cellsLong,cellsTall:c.cellsTall,modifierItems:c.modifierItems,startingItems:c.startingItems.map(n=>new U({cell:new y({x:n.cell.x,y:n.cell.y}),item:new w({id:n.item.id,name:n.item.name,cellsLong:n.item.cellsLong,cellsTall:n.item.cellsTall,icon:n.item.icon,starterItem:!0,moveable:n.item.moveable,rotation:n.item.rotation})}))})),id:Ue});console.log("UPDATED DESIGN",a),ct(K,z,a).then(()=>{console.log("Design updated successfully"),Me(!1),te(!1),window.location.reload()})}})},500)}}),o.jsx(qt,{dialogRef:ye,closeDialog:()=>{ye.current?.close(),Ae(!1)},areaPreview:vt||""}),o.jsx(el,{dialogRef:Ze,addInventoryItem:qe,closeDialog:()=>{Ze.current?.close()}}),o.jsx(tl,{dialogRef:Xe,closeDialog:()=>{Xe.current?.close()},addSection:qe}),o.jsx(ll,{dialogRef:$e,closeDialog:()=>{$e.current?.close()},addInventoryItem:qe}),o.jsx(nl,{item:ce,setSelectingItem:()=>{he(null)},canPlaceItem:ze,placeItem:nt,highlightCells:st,unHighlightCells:Ve,cellSize:A}),Be&&o.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:window.location.origin+"/LayItOut/Preview/",width:M*A+20,height:B*A+20})]})}
