import{c as me,j as I,r as a}from"./index-QIV6qY6h.js";import{A as z,S as re,D as de}from"./section-Cmi4yfhz.js";import{S as N,C as h,I as E,e as ge,b as ue}from"./firestore-DmwLrE3V.js";import{F as B}from"./add_custom_item_dialog-DgwAOwWV.js";me.createRoot(document.getElementById("root")).render(I.jsx(fe,{}));function fe(){const[f,Ie]=a.useState(!1),[P,G]=a.useState(0),[k,J]=a.useState(0),[L,S]=a.useState([]),[O,w]=a.useState([]),[Y,ye]=a.useState(0),[p,A]=a.useState(null),[K,v]=a.useState([]),y=10,[D,j]=a.useState([]);a.useRef(null);const[xe,he]=a.useState(!1),[Le,U]=a.useState([]),[d,R]=a.useState([]),[Se,Te]=a.useState([]),[pe,ve]=a.useState(!1);a.useRef(null);const[Q,Ee]=a.useState([]),[x,M]=a.useState([]),[r,W]=a.useState(null),[we,be]=a.useState(!1),[Oe,Ne]=a.useState(!1),[X,Ae]=a.useState(!1),[De,je]=a.useState(!1),[Re,Me]=a.useState(!1),[Pe,ke]=a.useState(!1),[Ue,We]=a.useState(""),[qe,Fe]=a.useState(""),[$e,He]=a.useState(""),[Ve,ze]=a.useState(""),[Be,Ge]=a.useState(""),[Je,Z]=a.useState(!0),[Ye,Ke]=a.useState(null),[q,Qe]=a.useState(!1);a.useRef(null);function b(l,n){for(const o of n)if(l.x>=o.cellId.x&&l.x<o.cellId.x+o.cellsLong&&l.y>=o.cellId.y&&l.y<o.cellId.y+o.cellsTall)return o;return null}function _(l){U([...l.map(i=>new N({name:i.name,cellId:new h({x:i.cellId.x/2,y:i.cellId.y/2}),cellsLong:i.cellsLong/2,cellsTall:i.cellsTall/2,startingItems:[]}))]);let n=P,o=k;const s=[];for(const i of l)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",(i.cellsLong+i.cellId.x)*y,"Current width:",n),(i.cellsLong+i.cellId.x)*y>n&&(console.log("Added section Width:",i.cellsLong*y+i.cellId.x),n+=(i.cellsLong+i.cellId.x)*y-n),console.log("Needed section Height:",(i.cellsTall+i.cellId.y)*y,"Current height:",o),(i.cellsTall+i.cellId.y)*y>o&&(console.log("Added section Height:",i.cellsTall*y+i.cellId.y),o+=(i.cellsTall+i.cellId.y)*y-o);G(n),J(o),[...Array(o/y).keys()].map(i=>{const c=[];[...Array(n/y).keys()].map(e=>{c.push({id:new h({x:e,y:i}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:b(new h({x:e,y:i}),l)!=null,size:y})}),s.push(c)}),S([...s]),setTimeout(()=>{const i=[],c=[...l];for(const e of c)e.cellElement=document.querySelector(`.App #${e.cellId.toId()}.cell:not(.cell-border)`),i.push(...e.startingItems.map(t=>new ue({cell:new h({x:e.cellId.x+t.cell.x,y:e.cellId.y+t.cell.y}),item:new E({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,initialElement:document.querySelector(`.App #${t.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:t.item.moveable,rotation:t.item.rotation||0})})));R([...c]);for(const e of i){const t=g=>{const u=g%2===1;return{cellsLong:u?e.item.cellsTall:e.item.cellsLong,cellsTall:u?e.item.cellsLong:e.item.cellsTall}},m=e.item.rotation||0,T=t(m);for(let g=0;g<T.cellsTall;g++)for(let u=0;u<T.cellsLong;u++)s[e.cell.y+g][e.cell.x+u].hasItem=!0,s[e.cell.y+g][e.cell.x+u].itemId=e.item.id;e.item.initialElement=document.querySelector(`.App #${e.cell.toId()}.cell:not(.cell-border)`),w(g=>[...g,e.item])}S([...s]),setTimeout(()=>{Z(!1)},500)},100)}async function C(){new URLSearchParams(window.location.search);const l=[];let n=localStorage.getItem("screenshotSections");console.log("Screenshot sections from localStorage",n),n=n?.split("LAYOUTSEPARATOR")||"";const o=[];for(const s of n)console.log("Section string",s),o.push(N.fromJSON(s));U([...o]),R([...o.map(s=>new N({name:s.name,cellId:new h({x:s.cellId.x/10,y:s.cellId.y/10}),cellsLong:s.cellsLong/10,cellsTall:s.cellsTall/10,startingItems:s.startingItems,items:s.startingItems.map(i=>new E({id:i.item.id,name:i.item.name,sectionCell:i.cell,cellsLong:i.item.cellsLong,cellsTall:i.item.cellsTall,icon:i.item.icon,moveable:i.item.moveable,starterItem:i.item.starterItem,rotation:i.item.rotation}))}))]),l.push(...o.map(s=>new N({name:s.name,cellId:new h({x:s.cellId.x/10,y:s.cellId.y/10}),cellsLong:s.cellsLong/10,cellsTall:s.cellsTall/10,startingItems:s.startingItems,items:s.startingItems.map(i=>new E({id:i.item.id,name:i.item.name,sectionCell:i.cell,cellsLong:i.item.cellsLong,cellsTall:i.item.cellsTall,icon:i.item.icon,moveable:i.item.moveable,starterItem:i.item.starterItem,rotation:i.item.rotation}))}))),console.log("SECTIONS TO GENERATE",l),_(l)}a.useEffect(()=>{C()},[]);function ee(l,n,o){if(!f||l==null)return;const s=[...o],i=[],c=o.find(e=>e.name==l);console.log("NEW SECTION",c),console.log("Adding section",c.name,c.cellId),console.log("MOBILE CELLS",n),c.cellElement=document.querySelector(`.App #${c.name.split(" ").join("-")} #${c.name.split(" ").join("")}${c.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",c.cellElement);for(const e of c.startingItems){console.log("Placing starting item",e.item.name,e.cell);const t=g=>{const u=g%2===1;return{cellsLong:u?e.item.cellsTall:e.item.cellsLong,cellsTall:u?e.item.cellsLong:e.item.cellsTall}},m=e.item.rotation||0,T=t(m);for(let g=0;g<T.cellsTall;g++)for(let u=0;u<T.cellsLong;u++){const V=n.find(ae=>ae.sectionName===c.name);V.cells[e.cell.y+g][e.cell.x+u].hasItem=!0,V.cells[e.cell.y+g][e.cell.x+u].itemId=e.item.id}e.item.initialElement=document.querySelector(`.App #${c.name.split(" ").join("-")} #${c.name.split(" ").join("")}${e.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",e.item.initialElement),i.push(new E({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,initialElement:e.item.initialElement,starterItem:!0,moveable:e.item.moveable,rotation:e.item.rotation}))}console.log("Setting sections",s),R([...s]),console.log("ITEMS",i),w(e=>[...e.filter(m=>!i.some(T=>T.id===m.id)),...i.map(m=>new E({id:m.id,name:m.name,cellsLong:m.cellsLong,cellsTall:m.cellsTall,icon:m.icon,initialElement:m.initialElement,starterItem:!0,moveable:m.moveable,rotation:m.rotation}))])}function F(l){let n=[];return l.map(o=>n=[...n,...o]),n}function $(l,n){console.log(l);const o=f?x.find(e=>e.sectionName===r).cells:L,s=o[l.y].length,i=o.length;if(console.log(s,i),l.x+n.cellsLong>s||l.y+n.cellsTall>i)return!1;const c=b(l,d);if(!c&&!f)return console.log("Item is out of bounds of any section"),!1;for(let e=0;e<n.cellsTall;e++)for(let t=0;t<n.cellsLong;t++){if(!f){const m=b(new h({x:l.x+t,y:l.y+e}),d);if(!m)return console.log("Item is out of bounds of any section"),!1;if(m.name!=c.name)return console.log("Item is crossing section boundaries"),!1}if(o[l.y+e][l.x+t].hasItem&&o[l.y+e][l.x+t].itemId!=n.id)return console.log("Something is already here"),!1}return!0}function le(l,n,o){const s=Array.from(f?x.find(e=>e.sectionName===r).cells:L);if(o!=null){console.log("Removing item");const e=f?d.find(t=>t.name===r):b(o,d);e.items=e.items.filter(t=>t.id!=n.id);for(let t=0;t<n.cellsTall;t++)for(let m=0;m<n.cellsLong;m++)s[o.y+t][o.x+m].hasItem=!1,s[o.y+t][o.x+m].itemId=""}const i=f?d.find(e=>e.name===r):b(l,d),c=new h({x:l.x-i.cellId.x,y:l.y-i.cellId.y});n.sectionCell=c,i.items.push(n);for(let e=0;e<n.cellsTall;e++)for(let t=0;t<n.cellsLong;t++)s[l.y+e][l.x+t].hasItem=!0,s[l.y+e][l.x+t].itemId=n.id;if(console.log(s),f){const e=x.find(t=>t.sectionName===r);e&&(e.cells=s.map(t=>t.map(m=>({...m}))),M([...x]))}else S(s);if(console.log("Removing item from inventory",n.name),!n.hasMoved){const e=D.findIndex(t=>t.item.name==n.name&&!t.item.hasMoved);if(e!==-1){const t=[...D];t[e].quantity-=1,t[e].quantity<=0&&t.splice(e,1),j(t)}else j(D)}w(e=>(console.log("Placing item",n.id),console.log("Updating item",n.id),e.find(t=>t.id==n.id).hasMoved||(e.find(t=>t.id==n.id).hasMoved=!0),e))}function ne(l){console.log("Removing item",l.id),w(n=>n.filter(o=>o.id!=l.id))}function te(l,n){const o=Array.from(L),s=e=>{const t=e%2===1;return{cellsWide:t?l.cellsTall:l.cellsLong,cellsTall:t?l.cellsLong:l.cellsTall}},i=l.rotation||0,c=s(i);for(let e=0;e<c.cellsTall;e++)for(let t=0;t<c.cellsWide;t++)o[n.y+e][n.x+t].hasItem=!1,o[n.y+e][n.x+t].itemId="";S(o),console.log("DELETING ITEM",l.id),w(e=>(console.log(),e.filter(t=>t.id!=l.id))),j(e=>{const t=e.findIndex(m=>m.item.name==l.name&&!m.item.hasMoved);if(t!==-1){const m=[...e];return m[t].quantity+=1,m}else return[...e,new ge({item:new E({id:l.id,name:l.name,cellsLong:c.cellsWide,cellsTall:c.cellsTall,icon:l.icon}),quantity:1})]})}function oe(l,n){const o=Array.from(f?x.find(e=>e.sectionName===r).cells:L);console.log("DELETING ITEM ROTATE",l.id,l.rotation);const s=e=>{const t=e%2===1;return{cellsWide:t?l.cellsTall:l.cellsLong,cellsTall:t?l.cellsLong:l.cellsTall}},i=l.rotation||0,c=s(i);for(let e=0;e<c.cellsTall;e++)for(let t=0;t<c.cellsWide;t++)console.log("Deleting cell",n.y+e,n.x+t),o[n.y+e][n.x+t].hasItem=!1,o[n.y+e][n.x+t].itemId="";S([...o]),console.log("DELETING ITEM",l.id)}function se(l,n){const o=f?x.find(c=>c.sectionName===r).cells:L,s=Array.from(o);if(o[l.y]==null){H();return}const i=$(l,n);s.forEach(c=>c.forEach(e=>{e.mouseOver=!1,e.canPlaceItem=!1,e.mouseOverLocation=""}));for(let c=0;c<n.cellsTall;c++)for(let e=0;e<n.cellsLong;e++)l.y+c<s.length&&l.x+e<s[l.y+c].length&&(n.cellsLong===1&&n.cellsTall===1?s[l.y+c][l.x+e].mouseOverLocation="single":n.cellsTall===1?e===0?s[l.y+c][l.x+e].mouseOverLocation="leftFull":e===n.cellsLong-1?s[l.y+c][l.x+e].mouseOverLocation="rightFull":s[l.y+c][l.x+e].mouseOverLocation="middleFull":n.cellsLong===1?c===0?s[l.y+c][l.x+e].mouseOverLocation="topFull":c===n.cellsTall-1?s[l.y+c][l.x+e].mouseOverLocation="bottomFull":s[l.y+c][l.x+e].mouseOverLocation="middleVFull":c===0&&e===0?s[l.y+c][l.x+e].mouseOverLocation="topLeftCorner":c===0&&e===n.cellsLong-1?s[l.y+c][l.x+e].mouseOverLocation="topRightCorner":c===n.cellsTall-1&&e===0?s[l.y+c][l.x+e].mouseOverLocation="bottomLeftCorner":c===n.cellsTall-1&&e===n.cellsLong-1?s[l.y+c][l.x+e].mouseOverLocation="bottomRightCorner":c===0?s[l.y+c][l.x+e].mouseOverLocation="top":c===n.cellsTall-1?s[l.y+c][l.x+e].mouseOverLocation="bottom":e===0?s[l.y+c][l.x+e].mouseOverLocation="left":e===n.cellsLong-1?s[l.y+c][l.x+e].mouseOverLocation="right":s[l.y+c][l.x+e].mouseOverLocation="middle",s[l.y+c][l.x+e].mouseOver=!0,s[l.y+c][l.x+e].canPlaceItem=i);if(f){const c=x.find(e=>e.sectionName===r);c&&(c.cells=s.map(e=>e.map(t=>({...t}))),M([...x])),M(e=>e.map(t=>t.sectionName===r?{...t,cells:s}:t))}else S(s)}function H(){const l=Array.from(f?x.find(n=>n.sectionName===r).cells:L);l.forEach(n=>n.forEach(o=>{o.mouseOver=!1,o.canPlaceItem=!1,o.mouseOverLocation=""})),S(l)}a.useEffect(()=>{ee(r,x,d)},[r]),a.useEffect(()=>{const l=()=>{const n=O.find(o=>o.id===p);console.log("Unselecting item",p),A(null),n&&(v(o=>[...o,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{v(o=>o.filter(s=>s!==n.id))},300))};return document.addEventListener("click",l),()=>document.removeEventListener("click",l)},[p,O]);function ie(l){A(null),v(n=>[...n,l]),console.log("Unselecting item",l),setTimeout(()=>{v(n=>n.filter(o=>o!==l))},300)}function ce(l){const n=O.find(o=>o.id===p);console.log("Unselecting item",p),A(l),n&&(v(o=>[...o,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{v(o=>o.filter(s=>s!==n.id))},300))}return I.jsxs(I.Fragment,{children:[I.jsx("div",{className:"App",children:I.jsx("div",{className:"layout",children:f?I.jsxs("div",{className:"mobile-areas",style:{height:Y+"px"},children:[I.jsx("img",{src:B,onClick:()=>{const l=d.findIndex(o=>o.name==r);if(l===-1)return;const n=(l-1+d.length)%d.length;W(d[n].name),console.log("Changing viewing section to",d[n].name)},className:"back-mobile-areas"}),Q.map((l,n)=>I.jsx(z,{width:l.width,height:l.height,cells:F(x.find(o=>o.sectionName==l.sectionName).cells),id:l.sectionName,visibile:r==null?!0:l.sectionName==r,section:l.sectionName},n)),I.jsx("img",{src:B,onClick:()=>{const l=d.findIndex(o=>o.name==r);if(l===-1)return;const n=(l+1)%d.length;W(d[n].name),console.log("Changing viewing section to",d[n].name)},className:"forward-mobile-areas"})]}):I.jsx(z,{width:P,height:k,cells:F(L)})})}),I.jsx("p",{children:"Empty"}),I.jsxs("div",{id:q?"capture":"",children:[d.map(l=>I.jsx(re,{takingPhoto:q,section:l,visible:r==null?!0:l.name==r,cellSize:y},l.cellId.toId())),O.map(l=>I.jsx(de,{cellSize:y,isViewingDesign:X,removeItem:ne,visible:f?!l.hasMoved&&!l.starterItem?!0:r==null?!1:l.starterItem?d.find(n=>n.name==r)?.startingItems.some(n=>n.item.id===l.id):d.find(n=>n.name==r)?.items.some(n=>n.id===l.id):!0,item:l,canPlaceItem:$,placeItem:le,deleteItemRotate:oe,highlightCells:se,unHighlightCells:H,deleteItem:te,isSelected:p===l.id,onSelect:ce,isUnselecting:K.includes(l.id),onDeselect:()=>ie(l.id)},l.id))]})]})}
