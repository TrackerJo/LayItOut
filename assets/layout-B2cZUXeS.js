import{j as o,r as m,c as Ue}from"./firebase-DtZ8f9mJ.js";import{C as S,I as U,T as Te,S as me,a as Ae,b as je,s as Xe,g as Qe,c as Je,d as Ke}from"./firestore-DShTjJnp.js";function Ve({id:e,mouseOver:F,canPlaceItem:f,hasItem:W,mouseOverLocation:O,inSection:B,section:b,size:k}){return o.jsx("div",{className:`cell ${F?"hovered":""} ${f?"legal":"illegal"} ${W?"hasItem":""} ${O} ${B?"":"outside"}`,id:`${b==null?"":b.split(" ").join("")}${e.toId()}`,style:{width:`${k}px`,height:`${k}px`},children:o.jsx("div",{className:"cell cell-border",id:`${b==null?"":b.split(" ").join("")}${e.toId()}`})})}function Se({width:e,height:F,cells:f,id:W,visibile:O,section:B}){return o.jsx("div",{className:`area ${O??!0?"":"invisible"}`,style:{width:`${e}px`,height:`${F}px`},id:W!=null?W.split(" ").join("-"):"",children:f.map(b=>o.jsx(Ve,{size:b.size,id:b.id,canPlaceItem:b.canPlaceItem,mouseOver:b.mouseOver,hasItem:b.hasItem,itemId:b.itemId,mouseOverLocation:b.mouseOverLocation,inSection:b.inSection,section:B}))})}const Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAPCAYAAADtc08vAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAEKADAAQAAAABAAAADwAAAADW5XGhAAABRUlEQVQoFY2Tz0oDMRDGv4lgPXkUPAiCvfUBbD3VLoJoBUuPPoI+jlffQIqiUC9tb/45+QIF7bXFB9jDZjrZNptN090a2M0km++XyZdZ4rPGH4AdaN2mwddI4tLGtdo29nd7ILqExq2S1w1AW1DqlaPj0zK1Jwb3MZk+kBFw1DiHoieJkqJMAvHPrEPjcZwCNkGKxEaXAYogZeIAEELQlS3uUsPMmZdpm3W2eRnYSecJKou59WLzTVmR109mIzC+3Zy+N4a5sYsCAFerFRzuyT2jLpBPWRqD1aPUS+RkLvIAOfGFXGkfv9MmNF+LB0pgL9w6aTnpIso8CMQ5wzJPmDU0tWn4PrSgFLDpqsziDGKKLaErC6H/iO1uHmT575CY05N66qRnzqVtRau9D6GmMedInud1RbIqNmMafLwh0bIhxSB9MAfmu9CGVRsdYgAAAABJRU5ErkJggg==",Oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAGaADAAQAAAABAAAAGQAAAABY85deAAABrUlEQVRIDe1VPUsDQRB9ezk0GO0FwVhFBQtDWot09oqFCGopgp1ILoWNEEHRRmy0EmwEK7XxB1gIfjQWdmlFLEQRDcaM7y4f3O4lmJw2QhYuu29m3szeu2ECmGtZYsjKAVZk0HSFxVaAqNBL2ywiuIYjcwF/CIMqc0QhgwkoTBEnuCd9udaQU6s+3PKRbyIWsjhi4n2y83wOfVnyKOLEh0MdLb7BIgRpfCKFdeWghGMvk7DwK0axoa5CZdZIWbml9hnDNqLhXwKb/CFKdanlyak7D89LFB0INocWTLCHD0CVTHMVu0Wi1P29avD2jEyz8DYft9N+Xg4KUHJGeWewowomweb3uOddn2qOtNheEyg80rZJ/1fN1/iQoGsS3Tjn7jaQtmx+7GHNkkIfi8Ro22Xrbmm+RmBJOtHjSsb2r7OCeltwJXRXsbw18ftQi61yNVKwiOb+G9Au0pKObbn+g1w2XrxrlhBv+rpx9Fdiy1yDWPlnNKyO3HC0JDm33uhpOF19rC7GRxg/xjF14bN7x7pjgJ5xpl7g4BwgMWKSAljwzCKn9QoEYtuGnxT4Bng+WDuZ4k7PAAAAAElFTkSuQmCC";function Pe({item:e,canPlaceItem:F,placeItem:f,deleteItem:W,deleteItemRotate:O,isSelected:B,onSelect:b,onDeselect:k,isUnselecting:R,highlightCells:X,unHighlightCells:V,visible:y,removeItem:G}){const[E,L]=m.useState(0),[w,d]=m.useState(0),u=m.useRef(null),[x,v]=m.useState(0),[Q,J]=m.useState(0),[M,D]=m.useState(!1),[I,K]=m.useState(0),[r,H]=m.useState(null),[ie,re]=m.useState(!0),[ye,Re]=m.useState(12),$=/Mobi|Android/i.test(navigator.userAgent)?5:10,ne=m.useRef(null),[fe,z]=m.useState(!0),ce=h=>{const C=h%2===1;return{width:C?e.cellsTall*$:e.cellsLong*$,height:C?e.cellsLong*$:e.cellsTall*$,cellsWide:C?e.cellsTall:e.cellsLong,cellsTall:C?e.cellsLong:e.cellsTall}},ae=h=>{const C=e.cellsLong*$,j=e.cellsTall*$;switch(h%4){case 0:return{x:0,y:0};case 1:return{x:(j-C)/2,y:(C-j)/2};case 2:return{x:0,y:0};case 3:return{x:(j-C)/2,y:(C-j)/2};default:return{x:0,y:0}}},we=()=>{if(!e.hasMoved)return;const h=I+1,C=ce(h),j=U.fromDoc(e.toDoc());j.cellsLong=C.cellsWide,j.cellsTall=C.cellsTall,j.initialElement=e.initialElement,j.rotation=h,j.hasMoved=e.hasMoved;let N=r;if(!e.hasMoved&&e.rotation!=0||N&&F(S.fromString(N.id),j)){N==null&&(N=e.initialElement),console.log("ROTATE ITEM",e.id,"to rotation:",h,"at cell:",N?.id),K(h),O(e,S.fromString(N.id)),e.rotation=h;const ee=ae(h),P=N.offsetLeft,q=N.offsetTop;L(P+ee.x),d(q+ee.y),v(P+ee.x),J(q+ee.y)}};function ue(h){const C=u.current,j=window.getComputedStyle(C),N=document.createElement("span");N.style.font=j.font,N.style.fontSize=h+"px",N.style.fontFamily=j.fontFamily,N.style.fontWeight=j.fontWeight,N.style.position="absolute",N.style.visibility="hidden",N.style.whiteSpace="nowrap",N.textContent=C.textContent,document.body.appendChild(N);const ee=N.offsetWidth;return document.body.removeChild(N),ee}function ve(h){if(u.current){const C=u.current;return ue(h-1)>C.offsetWidth&&h-1>8?ve(h-1):h-1}return h}m.useEffect(()=>{setTimeout(()=>{u.current&&Re(ve(ye)),e.isDisplayItem&&!e.hasMoved&&(console.log("Starting item as dragging item"),D(!0))},100)},[]),m.useEffect(()=>{if(e.initialElement!=null&&!e.hasMoved&&(console.log("Item initial element:",e.rotation),e.rotation&&setTimeout(()=>{console.log("Rotating item to initial rotation:",e.rotation);for(let h=0;h<e.rotation;h++)console.log("Rotating item",h+1,"times"),K(C=>{const j=(C+1)%4,N=ae(j),ee=e.initialElement.offsetLeft,P=e.initialElement.offsetTop;return L(ee+N.x),d(P+N.y),v(ee+N.x),J(P+N.y),j})},100),e.initialElement&&!e.hasMoved)){e.initialElement.classList.contains("cell")&&(console.log("Setting cell to initial element:",e.initialElement.children[0]),H(e.initialElement.children[0]));const h=document.querySelector(".toolbox"),C=h.scrollLeft,j=h.scrollTop;e.isDisplayItem?(L(e.initialElement.offsetLeft-C),d(e.initialElement.offsetTop-j),v(e.initialElement.offsetLeft-C),J(e.initialElement.offsetTop-j)):(L(e.initialElement.offsetLeft),d(e.initialElement.offsetTop),v(e.initialElement.offsetLeft),J(e.initialElement.offsetTop))}},[e]);const he=()=>{if(M)return;if(r==null){L(e.initialElement.offsetLeft),v(e.initialElement.offsetLeft),d(e.initialElement.offsetTop),J(e.initialElement.offsetTop);return}const h=r.offsetTop,C=r.offsetLeft,j=ae(I);L(C+j.x),d(h+j.y),v(C+j.x),J(h+j.y)};m.useEffect(()=>(window.addEventListener("resize",he),()=>{window.removeEventListener("resize",he)}),[r,I,M]);const ge=h=>{h.preventDefault()};m.useEffect(()=>{if(console.log("IS Dragging: ",M),M){v(E),J(w),document.body.addEventListener("touchmove",ge,{passive:!1});const h=document.getElementById(e.id)?.getBoundingClientRect(),C=h?h.left-E:0,j=h?h.top-w:0;B&&k();const N=(P,q,le)=>{const pe=ce(I),oe=U.fromDoc(e.toDoc());oe.cellsLong=pe.cellsWide,oe.cellsTall=pe.cellsTall,oe.initialElement=e.initialElement,oe.rotation=I,oe.hasMoved=e.hasMoved,oe.id=e.id;let de=le;if(!de||!de.classList?.contains("cell")){const xe=document.elementFromPoint(P,q);xe?.classList?.contains("cell")&&(de=xe)}de?.classList?.contains("cell")?X(S.fromString(de.id),oe):V(),L(P-C),d(q-j+5)},ee=(P,q)=>{console.log("Drag ended"),V(),document.body.removeEventListener("touchmove",ge);const le=document.elementFromPoint(P,q);if(le?.classList?.contains("cell")){const pe=ce(I),oe={...e,cellsLong:pe.cellsWide,cellsTall:pe.cellsTall};if(!F(S.fromString(le.id),oe)){if(e.isDisplayItem&&!e.hasMoved){console.log("Removing item from toolbox"),G(e);return}L(x),d(Q),D(!1);return}const de=le.offsetTop,xe=le.offsetLeft,Le=ae(I),be=xe+Le.x,Ee=de+Le.y;L(be),d(Ee),v(be),J(Ee),f(S.fromString(le.id),oe,r!=null?S.fromString(r.id):null),console.log("Placed item at cell:",le),H(le)}else{if(e.isDisplayItem&&!e.hasMoved){console.log("Removing item from toolbox"),G(e);return}L(x),d(Q)}D(!1)};return document.onmousemove=P=>{P.preventDefault(),N(P.clientX,P.clientY,P.target)},document.onmouseup=P=>{ee(P.clientX,P.clientY),document.onmousemove=null,document.onmouseup=null,document.ontouchmove=null,document.ontouchend=null},document.ontouchmove=P=>{P.preventDefault();const q=P.touches[0];N(q.clientX,q.clientY,P.target)},document.ontouchend=P=>{const q=P.changedTouches[0];ee(q.clientX,q.clientY),document.removeEventListener("touchmove",ge),document.onmousemove=null,document.onmouseup=null,document.ontouchmove=null,document.ontouchend=null},()=>{document.removeEventListener("touchmove",ge)}}else document.onmousemove=null,document.onmouseup=null,document.ontouchmove=null,document.ontouchend=null,document.body.removeEventListener("touchmove",ge)},[M,r,I]);const Ie=ce(I);function Ce(){if(r){const h=I+1,C=ce(h),j={...e,cellsLong:C.cellsWide,cellsTall:C.cellsTall};console.log("Can place item at cell:",F(S.fromString(r?.id||""),j)),re(F(S.fromString(r.id),j))}else re(!1)}return E==0||w==0||!fe?null:o.jsxs(o.Fragment,{children:[o.jsx("div",{id:e.id,ref:ne,className:`draggable-item ${M?"dragging":B?"selected":""} ${e.moveable?"":"not-moveable"} ${y?"":"invisible"}`,style:{top:`${w}px`,left:`${E}px`,width:`${e.cellsLong*(e.isDisplayItem&&!M&&!e.hasMoved?10:$)-(B?4:0)}px`,height:`${e.cellsTall*(e.isDisplayItem&&!M&&!e.hasMoved?10:$)-(B?4:0)}px`,rotate:`${I*90}deg`,transformOrigin:"center center",fontSize:`${ye}px`},onMouseDown:e.moveable?()=>D(!0):void 0,onTouchStart:e.moveable?h=>{h.preventDefault(),D(!0)}:void 0,onClick:h=>{h.stopPropagation(),e.hasMoved&&(B?k():(Ce(),b(e.id)))},children:e.icon.includes("custom-")?o.jsx("div",{className:"custom-icon",children:o.jsx("div",{children:o.jsx("p",{ref:u,children:e.icon.split("custom-")[1]})})}):o.jsx("img",{src:e.icon,alt:"icon"})}),(B||R)&&o.jsx(o.Fragment,{children:/Mobi|Android/i.test(navigator.userAgent)?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:`draggable-item-options mobile-left ${R?"exiting":""}`,style:{top:`${w+e.cellsTall*$/2-10}px`,left:`${E+e.cellsLong*$/2-Ie.width/2-20}px`,width:"10px"},children:o.jsx("img",{src:Oe,alt:"rotate",className:"rotate-icon"+(ie?" can-rotate":" cannot-rotate"),onClick:h=>{h.stopPropagation(),we()}})}),o.jsx("div",{className:`draggable-item-options mobile-right ${R?"exiting":""}`,style:{top:`${w+e.cellsTall*$/2-10}px`,left:`${E+e.cellsLong*$/2+Ie.width/2+10}px`,width:"10px"},children:o.jsx("img",{src:Ge,alt:"delete",className:"delete-icon",onClick:h=>{h.stopPropagation(),W(e,S.fromString(r?.id||""))}})})]}):o.jsxs("div",{className:`draggable-item-options ${R?"exiting":""}`,style:{top:`${w+e.cellsTall*$/2-Ie.height/2-20}px`,left:`${E+e.cellsLong*$/2-Ie.width/2}px`,width:`${Ie.width}px`},children:[o.jsx("img",{src:Oe,alt:"rotate",className:"rotate-icon"+(ie?" can-rotate":" cannot-rotate"),onClick:h=>{h.stopPropagation(),we()}}),o.jsx("img",{src:Ge,alt:"delete",className:"delete-icon",onClick:h=>{h.stopPropagation(),W(e,S.fromString(r?.id||""))}})]})})]})}function $e({inventoryItem:e,addDraggingItem:F,removeItem:f}){const W=m.useRef(null),O=m.useRef(null),[B,b]=m.useState(12),[k,R]=m.useState(e.item);function X(y){const G=O.current,E=window.getComputedStyle(G),L=document.createElement("span");L.style.font=E.font,L.style.fontSize=y+"px",L.style.fontFamily=E.fontFamily,L.style.fontWeight=E.fontWeight,L.style.position="absolute",L.style.visibility="hidden",L.style.whiteSpace="nowrap",L.textContent=G.textContent,document.body.appendChild(L);const w=L.offsetWidth;return document.body.removeChild(L),w}function V(y){if(O.current){const G=O.current;return X(y-1)>G.offsetWidth&&y-1>8?V(y-1):y-1}return y}return m.useEffect(()=>{setTimeout(()=>{O.current&&b(V(B))},100)},[]),o.jsxs("div",{className:"display",children:[o.jsx("div",{ref:W,id:e.item.id,className:"display-item",style:{width:`${e.item.cellsLong*10}px`,height:`${e.item.cellsTall*10}px`},onMouseDown:y=>{y.preventDefault(),y.stopPropagation(),e.item.initialElement=W.current,e.item.id=e.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",e.item.id,"to initialElement",e.item.initialElement),R(new U({id:e.item.id,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,name:e.item.name,icon:e.item.icon,moveable:e.item.moveable,starterItem:e.item.starterItem,displayItem:e.item.isDisplayItem})),F(e.item)},onTouchStart:y=>{y.preventDefault(),y.stopPropagation(),e.item.initialElement=W.current,e.item.id=e.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",e.item.id,"to initialElement",e.item.initialElement),R(new U({id:e.item.id,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,name:e.item.name,icon:e.item.icon,moveable:e.item.moveable,starterItem:e.item.starterItem,displayItem:e.item.isDisplayItem})),F(e.item)},children:e.item.icon.includes("custom-")?o.jsx("div",{className:"custom-icon",children:o.jsx("div",{children:o.jsx("p",{ref:O,style:{fontSize:`${B}px`},children:e.item.icon.split("custom-")[1]})})}):o.jsx("img",{src:e.item.icon,alt:"icon"})}),o.jsx("p",{children:e.item.name}),o.jsxs("p",{className:"quantity",children:["x",e.quantity]})]})}const qe="/LayItOut/assets/plus.circle-Ce3xm00a.png";function _e({inventoryItems:e,addDraggingItem:F,maxHeight:f,removeItem:W,showAddCustomItem:O,isCreatingTemplate:B,isEditingTemplate:b}){return o.jsxs("div",{className:"toolbox",style:{maxHeight:f?`${f}px`:"200px"},children:[e.map(k=>o.jsx($e,{inventoryItem:k,addDraggingItem:F,removeItem:W})),!(B||b)&&o.jsx("div",{className:"add-item",onClick:()=>{O()},children:o.jsx("img",{src:qe,alt:"Add Item"})})]})}function De({section:e,visible:F,cellSize:f}){const[W,O]=m.useState(e.cellElement?.offsetLeft??0),[B,b]=m.useState(e.cellElement?.offsetTop??0),k=m.useRef(null),[R,X]=m.useState(16);function V(E){const L=k.current,w=window.getComputedStyle(L),d=document.createElement("span");d.style.font=w.font,d.style.fontSize=E+"px",d.style.fontFamily=w.fontFamily,d.style.fontWeight=w.fontWeight,d.style.position="absolute",d.style.visibility="hidden",d.style.whiteSpace="no-wrap",d.textContent=L.textContent,document.body.appendChild(d);const u=d.offsetWidth;return document.body.removeChild(d),u}function y(E){if(k.current){const L=k.current,w=V(E-1);return console.log("Current text width:",w),console.log("Paragraph width:",L.offsetWidth),w>L.offsetWidth&&R>6?(console.log("Decreasing font size to:",E-1),y(E-1)):E-1}return E}m.useEffect(()=>{setTimeout(()=>{k.current&&X(y(R))},100)},[]);const G=()=>{e.cellElement!=null&&(O(e.cellElement.offsetLeft),b(e.cellElement.offsetTop))};return m.useEffect(()=>(window.addEventListener("resize",G),()=>{window.removeEventListener("resize",G)}),[e.cellElement]),e.cellElement&&o.jsx("div",{className:`section ${F??!0?"":"invisible"}`,style:{top:`${e.cellElement.offsetTop}px`,left:`${e.cellElement.offsetLeft}px`,width:`${e.cellsLong*f-2}px`,height:`${e.cellsTall*f-2}px`},children:o.jsx("h2",{className:"section-title",style:{fontSize:`${R}px`},ref:k,children:e.name})})}const Ne="/LayItOut/assets/forward-Drovs4r6.png";function el({dialogRef:e,closeDialog:F,layoutSections:f,isOpen:W}){const[O,B]=m.useState(0),[b,k]=m.useState(0),[R,X]=m.useState([]),[V,y]=m.useState([...f]),G=/Mobi|Android/i.test(navigator.userAgent)?5:10;function E(w){for(const d of V)if(w.x>=d.cellId.x&&w.x<d.cellId.x+d.cellsLong&&w.y>=d.cellId.y&&w.y<d.cellId.y+d.cellsTall)return d;return null}m.useEffect(()=>{if(!W)return;console.log("Layout dialog opened, generating cells and sections",f);const w=[];let d=0,u=0;for(const x of f)console.log("Generating cells for section",x.name,"at",x.cellId,"with size",x.cellsLong,"x",x.cellsTall),console.log("Added section Length:",x.cellsLong*G+x.cellId.x),(x.cellsLong+x.cellId.x)*G>d&&(d+=x.cellsLong*G),(x.cellsTall+x.cellId.y)*G>u&&(u+=x.cellsTall*G);console.log("Current width:",d,"Current height:",u),B(d),k(u),[...Array(u/G).keys()].map(x=>{const v=[];[...Array(d/G).keys()].map(Q=>{console.log(E(new S({x:Q,y:x}))!=null?"In section":"Outside section"),v.push({id:new S({x:Q,y:x}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!1,size:G})}),w.push(v)}),X([...w]),setTimeout(()=>{const x=[...f];for(const v of x)console.log("Adding section",v.name,v.cellId),v.cellElement=document.querySelector(`.layout-dialog #${v.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",v.cellElement);console.log("Setting sections",x),y([...x]),X([...w])},100)},[W,f]);function L(w){let d=[];return w.map(u=>d=[...d,...u]),d}return o.jsxs("dialog",{ref:e,className:"layout-dialog",children:[o.jsxs("div",{className:"layout-dialog-div",children:[o.jsx("h2",{children:"Layout"}),o.jsx(Se,{width:O,height:b,cells:L(R)}),o.jsx("br",{}),o.jsx("button",{className:"layout-dialog-close",onClick:F,children:"Close"})]}),V.map(w=>o.jsx(De,{section:w,visible:!0,cellSize:G},w.cellId.toId()))]})}const ll="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",tl="/LayItOut/assets/template-Cjj8EPhc.png";function nl({dialogRef:e,closeDialog:F,templates:f,isOpen:W}){const[O,B]=m.useState([]),[b,k]=m.useState([]),R=5,[X,V]=m.useState([]),[y,G]=m.useState(/Mobi|Android/i.test(navigator.userAgent)),[E,L]=m.useState([]);function w(u,x,v){const Q=[],J=f.filter(M=>u.some(D=>D.name===M.name));J.sort((M,D)=>u.indexOf(M)-u.indexOf(D));for(const M of J){const D=[];let I=0,K=0;for(const r of M.sections)console.log("Generating cells for section",r.name,"at",r.cellId,"with size",r.cellsLong,"x",r.cellsTall),console.log("Added section Length:",r.cellsLong*R+r.cellId.x),(r.cellsLong+r.cellId.x)*R>I&&(I+=r.cellsLong*R),(r.cellsTall+r.cellId.y)*R>K&&(K+=r.cellsTall*R);console.log("Current width:",I,"Current height:",K),[...Array(K/R).keys()].map(r=>{const H=[];[...Array(I/R).keys()].map(ie=>{H.push({id:new S({x:ie,y:r}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!1,size:R})}),D.push(H)}),Q.push({width:I,height:K,templateName:M.name,cells:D})}k([...Q]),setTimeout(()=>{const M=[],D=[];for(const I of J){const K=[];for(const r of I.sections)console.log("Adding section",r.name,r.cellId,I.name.split(" ").join("-")),r.cellElement=document.querySelector(`.template-dialog #${I.name.split(" ").join("-")} #${r.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",r.cellElement),M.push(r),K.push(...r.startingItems.map(H=>new Ae({cell:new S({x:r.cellId.x+H.cell.x,y:r.cellId.y+H.cell.y}),item:new U({id:H.item.id,name:H.item.name,cellsLong:H.item.cellsLong,cellsTall:H.item.cellsTall,icon:H.item.icon,initialElement:document.querySelector(`.template-dialog #${I.name.split(" ").join("-")} #${H.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1})})));for(const r of K){console.log("Placing starting item",r.item.name,r.cell);for(let H=0;H<r.item.cellsTall;H++)for(let ie=0;ie<r.item.cellsLong;ie++)Q[Q.findIndex(re=>re.templateName==I.name)].cells[r.cell.y+H][r.cell.x+ie].hasItem=!0,Q[Q.findIndex(re=>re.templateName==I.name)].cells[r.cell.y+H][r.cell.x+ie].itemId=r.item.id;r.item.initialElement=document.querySelector(`.template-dialog #${I.name.split(" ").join("-")} #${r.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",r.item.initialElement),D.push(new U({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,initialElement:r.item.initialElement,starterItem:!0,moveable:!1}))}}V(I=>[...I,...D]),B([...M])},100)}m.useEffect(()=>{if(W&&(console.log("Layout dialog opened, generating cells and sections",f),f.length!==0)){if(f.length==1){w([f[0]]);return}L(y?[f[0].name]:[f[0].name,f[1].name])}},[W,f]),m.useEffect(()=>{const u=f.filter(x=>E.includes(x.name));console.log("Viewing templates:",E),u.sort((x,v)=>E.indexOf(x.name)-E.indexOf(v.name)),console.log("Generating templates for",u.map(x=>x.name)),w(u)},[E]);function d(u){let x=[];return u.map(v=>x=[...x,...v]),x}return o.jsxs("dialog",{ref:e,className:"template-dialog",children:[o.jsxs("div",{className:"template-dialog-div",children:[o.jsx("h2",{children:"Templates"}),o.jsxs("div",{className:"templates",children:[f.length>1&&f.filter(u=>!E.includes(u.name)).length>0&&o.jsx("img",{src:Ne,onClick:()=>{if(y){const x=(f.findIndex(v=>v.name===E[0])-1+f.length)%f.length;L([f[x].name])}else L(u=>{const v=(f.findIndex(Q=>Q.name===u[0])-1+f.length)%f.length;return[f[v].name,u[0]]})},className:"back-mobile-areas"}),b.map((u,x)=>o.jsxs("div",{children:[o.jsx(Se,{width:u.width,height:u.height,cells:d(u.cells),id:u.templateName.split(" ").join("-"),visibile:!0},x),o.jsx("h3",{children:u.templateName}),o.jsx("button",{className:"template-select-btn",onClick:()=>{const v=f.find(M=>M.name===u.templateName),Q=new Te({name:v.name,id:v.id,sections:v.sections.map(M=>new me({name:M.name,cellId:new S({x:M.cellId.x*(y?20:10),y:M.cellId.y*(y?20:10)}),cellsLong:M.cellsLong*(y?20:10),cellsTall:M.cellsTall*(y?20:10),startingItems:M.startingItems.map(D=>new Ae({cell:new S({x:D.cell.x*(y?2:1),y:D.cell.y*(y?2:1)}),item:new U({id:D.item.id,name:D.item.name,icon:D.item.icon,cellsLong:D.item.cellsLong*2,cellsTall:D.item.cellsTall*2,starterItem:D.item.starterItem,moveable:D.item.moveable})}))}))}),J=new URLSearchParams(window.location.search);J.set("templateName",Q.name),window.location.search=J.toString()},children:" Select"})]})),f.length>1&&f.filter(u=>!E.includes(u.name)).length>0&&o.jsx("img",{src:Ne,onClick:()=>{if(y){const x=(f.findIndex(v=>v.name===E[0])+1)%f.length;L([f[x].name])}else L(u=>{const v=(f.findIndex(Q=>Q.name===u[u.length-1])+1)%f.length;return[u[1],f[v].name]})},className:"forward-mobile-areas"})]}),o.jsx("br",{}),o.jsx("button",{className:"template-dialog-close",onClick:F,children:"Close"})]}),O.map(u=>o.jsx(De,{section:u,visible:!0,cellSize:R},u.cellId.toId())),X.map(u=>o.jsx(Pe,{removeItem:()=>{},visible:!0,item:u,canPlaceItem:()=>!1,placeItem:()=>{},deleteItemRotate:()=>{},highlightCells:()=>{},unHighlightCells:()=>{},deleteItem:()=>{},isSelected:!1,onSelect:x=>{},isUnselecting:!1,onDeselect:()=>{}},u.id))]})}function ol({dialogRef:e,closeDialog:F,addInventoryItem:f}){const[W,O]=m.useState(""),[B,b]=m.useState(1),[k,R]=m.useState(1),[X,V]=m.useState(1);return o.jsx("dialog",{ref:e,className:"custom-item-dialog",children:o.jsxs("div",{className:"custom-item-dialog-div",children:[o.jsx("h2",{children:"Add Custom Item"}),o.jsxs("div",{className:"custom-item-row",children:[o.jsx("label",{htmlFor:"item-name",children:"Name:"}),o.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:y=>O(y.target.value??""),value:W})]}),o.jsxs("div",{className:"custom-item-row",children:[o.jsx("label",{htmlFor:"item-icon",children:"Count:"}),o.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:B,onChange:y=>b(parseInt(y.target.value)??1)})]}),o.jsxs("div",{className:"custom-item-row custom-item-size",children:[o.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),o.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:k,onChange:y=>R(parseFloat(y.target.value)??1)}),o.jsx("span",{children:" x "}),o.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:X,onChange:y=>V(parseFloat(y.target.value)??1)})]}),o.jsx("br",{}),o.jsx("button",{className:"custom-item-dialog-add",onClick:()=>{if(W.trim()===""){alert("Item name cannot be empty");return}const y=new je({quantity:B,item:new U({id:W+(Math.random()*1e4).toString(),name:W,icon:`custom-${W}`,cellsLong:Math.ceil(k),cellsTall:Math.ceil(X),moveable:!0,starterItem:!1,displayItem:!0})});f(y),O(""),b(1),R(1),V(1),F()},children:"Add Item"}),o.jsx("br",{}),o.jsx("br",{}),o.jsx("button",{className:"custom-item-dialog-close",onClick:F,children:"Close"})]})})}Ue.createRoot(document.getElementById("root")).render(o.jsx(sl,{}));function sl(){const[e,F]=m.useState(/Mobi|Android/i.test(navigator.userAgent)),[f,W]=m.useState(0),[O,B]=m.useState(0),[b,k]=m.useState([]),[R,X]=m.useState([]),[V,y]=m.useState(0),[G,E]=m.useState(null),[L,w]=m.useState([]),d=/Mobi|Android/i.test(navigator.userAgent)?5:10,[u,x]=m.useState([]),v=m.useRef(null),[Q,J]=m.useState(!1),[M,D]=m.useState([]),[I,K]=m.useState([]),[r,H]=m.useState([]),[ie,re]=m.useState(!1),ye=m.useRef(null),[Re,$]=m.useState([]),[ne,fe]=m.useState([]),[z,ce]=m.useState(null),[ae,we]=m.useState(!1),[ue,ve]=m.useState(!1),[he,ge]=m.useState(""),[Ie,Ce]=m.useState(""),[h,C]=m.useState(""),[j,N]=m.useState(!0),[ee,P]=m.useState(null),q=m.useRef(null);function le(l,n){for(const i of n)if(l.x>=i.cellId.x&&l.x<i.cellId.x+i.cellsLong&&l.y>=i.cellId.y&&l.y<i.cellId.y+i.cellsTall)return i;return null}function pe(l){D([...l.map(s=>new me({name:s.name,cellId:new S({x:s.cellId.x/2,y:s.cellId.y/2}),cellsLong:s.cellsLong/2,cellsTall:s.cellsTall/2,startingItems:[]}))]);let n=f,i=O;if(e){let s=0;const p=[],a=[];for(const t of l){const c=[],T={width:t.cellsLong*d,height:t.cellsTall*d,sectionName:t.name};T.height>s&&(s=T.height),$(te=>[...te,T]),t.cellId.x=0,t.cellId.y=0,[...Array(T.height/d).keys()].map(te=>{const Y=[];[...Array(T.width/d).keys()].map(Z=>{Y.push({id:new S({x:Z,y:te}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:d})}),c.push(Y)}),p.push({sectionName:t.name,cells:[...c]}),a.push(t)}fe(p),K(a),y(s),ce(l[0]?l[0].name:null),setTimeout(()=>{N(!1)},500)}else{const s=[];for(const p of l)console.log("Generating cells for section",p.name,"at",p.cellId,"with size",p.cellsLong,"x",p.cellsTall),console.log("Needed section Width:",(p.cellsLong+p.cellId.x)*d,"Current width:",n),(p.cellsLong+p.cellId.x)*d>n&&(console.log("Added section Width:",p.cellsLong*d+p.cellId.x),n+=(p.cellsLong+p.cellId.x)*d-n),console.log("Needed section Height:",(p.cellsTall+p.cellId.y)*d,"Current height:",i),(p.cellsTall+p.cellId.y)*d>i&&(console.log("Added section Height:",p.cellsTall*d+p.cellId.y),i+=(p.cellsTall+p.cellId.y)*d-i);W(n),B(i),[...Array(i/d).keys()].map(p=>{const a=[];[...Array(n/d).keys()].map(t=>{a.push({id:new S({x:t,y:p}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:le(new S({x:t,y:p}),l)!=null,size:d})}),s.push(a)}),k([...s]),setTimeout(()=>{const p=[],a=[...l];for(const t of a)t.cellElement=document.querySelector(`.App #${t.cellId.toId()}.cell:not(.cell-border)`),p.push(...t.startingItems.map(c=>new Ae({cell:new S({x:t.cellId.x+c.cell.x,y:t.cellId.y+c.cell.y}),item:new U({id:c.item.id,name:c.item.name,cellsLong:c.item.cellsLong,cellsTall:c.item.cellsTall,icon:c.item.icon,initialElement:document.querySelector(`.App #${c.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:c.item.moveable,rotation:c.item.rotation||0})})));K([...a]);for(const t of p){const c=Y=>{const Z=Y%2===1;return{cellsLong:Z?t.item.cellsTall:t.item.cellsLong,cellsTall:Z?t.item.cellsLong:t.item.cellsTall}},T=t.item.rotation||0,te=c(T);for(let Y=0;Y<te.cellsTall;Y++)for(let Z=0;Z<te.cellsLong;Z++)s[t.cell.y+Y][t.cell.x+Z].hasItem=!0,s[t.cell.y+Y][t.cell.x+Z].itemId=t.item.id;t.item.initialElement=document.querySelector(`.App #${t.cell.toId()}.cell:not(.cell-border)`),X(Y=>[...Y,t.item])}k([...s]),setTimeout(()=>{N(!1)},500)},100)}}async function oe(){const l=new URLSearchParams(window.location.search),n=l.get("companyId"),i=l.get("areaId"),s=l.get("areaId")||"",p=l.get("companyId")||"",a=l.get("templateId")||"",t=await Qe(p,s),c=l.get("type")||"";if(c==="create-template")we(!0);else if(c==="edit-template"){ve(!0);const g=t.templates.find(A=>A.id===a);g&&(P(g),ge(g.name))}n&&Ce(n),i&&C(i),x(t.inventoryItems.map(g=>new je({item:new U({id:g.item.id,name:g.item.name,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,initialElement:g.item.initialElement,moveable:g.item.moveable,starterItem:g.item.starterItem,displayItem:!0}),quantity:g.quantity})));const T=[],te=[];for(const g of t.templates){const A=[],We=[];for(const se of g.sections)A.push(new me({name:se.name,cellId:new S({x:se.cellId.x/(e?20:10),y:se.cellId.y/(e?20:10)}),cellsLong:se.cellsLong/(e?20:10),cellsTall:se.cellsTall/(e?20:10),startingItems:se.startingItems.map(_=>new Ae({cell:new S({x:_.cell.x/(e?2:1),y:_.cell.y/(e?2:1)}),item:new U({id:_.item.id,name:_.item.name,cellsLong:_.item.cellsLong/2,cellsTall:_.item.cellsTall/2,icon:_.item.icon,starterItem:!0,moveable:_.item.moveable})}))})),We.push(new me({name:se.name,cellId:new S({x:se.cellId.x,y:se.cellId.y}),cellsLong:se.cellsLong,cellsTall:se.cellsTall,startingItems:se.startingItems.map(_=>new Ae({cell:new S({x:_.cell.x,y:_.cell.y}),item:new U({id:_.item.id,name:_.item.name,cellsLong:_.item.cellsLong,cellsTall:_.item.cellsTall,icon:_.item.icon,starterItem:!0,moveable:_.item.moveable})}))}));T.push(new Te({name:g.name,sections:A,id:g.id})),te.push(new Te({name:g.name,sections:We,id:g.id}))}H([...T]);const Y=[],Z=a===""?void 0:te.find(g=>g.id===a);console.log("TEMPLATE",Z,"AREA",t),Z!==void 0?(D([...Z.sections]),K([...Z.sections.map(g=>new me({name:g.name,cellId:new S({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(A=>new U({id:A.item.id,name:A.item.name,sectionCell:A.cell,cellsLong:A.item.cellsLong,cellsTall:A.item.cellsTall,icon:A.item.icon,moveable:A.item.moveable,starterItem:A.item.starterItem,rotation:A.item.rotation}))}))]),Y.push(...Z.sections.map(g=>new me({name:g.name,cellId:new S({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(A=>new U({id:A.item.id,name:A.item.name,cellsLong:A.item.cellsLong,cellsTall:A.item.cellsTall,icon:A.item.icon,moveable:A.item.moveable,starterItem:A.item.starterItem,rotation:A.item.rotation,sectionCell:A.cell}))})))):(D([...t.sections]),K([...t.sections.map(g=>new me({name:g.name,cellId:new S({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(A=>new U({id:A.item.id,name:A.item.name,sectionCell:A.cell,cellsLong:A.item.cellsLong,cellsTall:A.item.cellsTall,icon:A.item.icon,moveable:A.item.moveable,starterItem:A.item.starterItem,rotation:A.item.rotation}))}))]),Y.push(...t.sections.map(g=>new me({name:g.name,cellId:new S({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(A=>new U({id:A.item.id,name:A.item.name,sectionCell:A.cell,cellsLong:A.item.cellsLong,cellsTall:A.item.cellsTall,icon:A.item.icon,moveable:A.item.moveable,starterItem:A.item.starterItem,rotation:A.item.rotation}))})))),console.log("SECTIONS TO GENERATE",Y),pe(Y)}m.useEffect(()=>{oe();async function l(){const n=Ke();Je("dMjfwNN0XFes0WxUH8h1",n)}l()},[]);function de(l,n,i){if(!e||l==null)return;const s=[...i],p=[],a=i.find(t=>t.name==l);console.log("NEW SECTION",a),console.log("Adding section",a.name,a.cellId),console.log("MOBILE CELLS",n),a.cellElement=document.querySelector(`.App #${a.name.split(" ").join("-")} #${a.name.split(" ").join("")}${a.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",a.cellElement);for(const t of a.startingItems){console.log("Placing starting item",t.item.name,t.cell);const c=Y=>{const Z=Y%2===1;return{cellsLong:Z?t.item.cellsTall:t.item.cellsLong,cellsTall:Z?t.item.cellsLong:t.item.cellsTall}},T=t.item.rotation||0,te=c(T);for(let Y=0;Y<te.cellsTall;Y++)for(let Z=0;Z<te.cellsLong;Z++){const g=n.find(A=>A.sectionName===a.name);g.cells[t.cell.y+Y][t.cell.x+Z].hasItem=!0,g.cells[t.cell.y+Y][t.cell.x+Z].itemId=t.item.id}t.item.initialElement=document.querySelector(`.App #${a.name.split(" ").join("-")} #${a.name.split(" ").join("")}${t.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",t.item.initialElement),p.push(new U({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,initialElement:t.item.initialElement,starterItem:!0,moveable:t.item.moveable,rotation:t.item.rotation}))}console.log("Setting sections",s),K([...s]),console.log("ITEMS",p),X(t=>[...t.filter(T=>!p.some(te=>te.id===T.id)),...p.map(T=>new U({id:T.id,name:T.name,cellsLong:T.cellsLong,cellsTall:T.cellsTall,icon:T.icon,initialElement:T.initialElement,starterItem:!0,moveable:T.moveable,rotation:T.rotation}))])}function xe(l){let n=[];return l.map(i=>n=[...n,...i]),n}function Le(l,n){console.log(l);const i=e?ne.find(t=>t.sectionName===z).cells:b,s=i[l.y].length,p=i.length;if(console.log(s,p),l.x+n.cellsLong>s||l.y+n.cellsTall>p)return!1;const a=le(l,I);if(!a&&!e)return console.log("Item is out of bounds of any section"),!1;for(let t=0;t<n.cellsTall;t++)for(let c=0;c<n.cellsLong;c++){if(!e){const T=le(new S({x:l.x+c,y:l.y+t}),I);if(!T)return console.log("Item is out of bounds of any section"),!1;if(T.name!=a.name)return console.log("Item is crossing section boundaries"),!1}if(i[l.y+t][l.x+c].hasItem&&i[l.y+t][l.x+c].itemId!=n.id)return console.log("Something is already here"),!1}return!0}function be(l,n,i){const s=Array.from(e?ne.find(t=>t.sectionName===z).cells:b);if(i!=null){console.log("Removing item");const t=e?I.find(c=>c.name===z):le(i,I);t.items=t.items.filter(c=>c.id!=n.id);for(let c=0;c<n.cellsTall;c++)for(let T=0;T<n.cellsLong;T++)s[i.y+c][i.x+T].hasItem=!1,s[i.y+c][i.x+T].itemId=""}const p=e?I.find(t=>t.name===z):le(l,I),a=new S({x:l.x-p.cellId.x,y:l.y-p.cellId.y});n.sectionCell=a,p.items.push(n);for(let t=0;t<n.cellsTall;t++)for(let c=0;c<n.cellsLong;c++)s[l.y+t][l.x+c].hasItem=!0,s[l.y+t][l.x+c].itemId=n.id;if(console.log(s),e){const t=ne.find(c=>c.sectionName===z);t&&(t.cells=s.map(c=>c.map(T=>({...T}))),fe([...ne]))}else k(s);if(console.log("Removing item from inventory",n.name),!n.hasMoved){const t=u.findIndex(c=>c.item.name==n.name&&!c.item.hasMoved);if(t!==-1){const c=[...u];c[t].quantity-=1,c[t].quantity<=0&&c.splice(t,1),x(c)}else x(u)}X(t=>(console.log("Placing item",n.id),console.log("Updating item",n.id),t.find(c=>c.id==n.id).hasMoved||(t.find(c=>c.id==n.id).hasMoved=!0),t))}function Ee(l){R.find(n=>n.name==l.name&&!n.hasMoved&&!n.starterItem)||X(n=>[...n,l])}function ke(l){console.log("Removing item",l.id),X(n=>n.filter(i=>i.id!=l.id))}function Be(l,n){const i=Array.from(b),s=t=>{const c=t%2===1;return{cellsWide:c?l.cellsTall:l.cellsLong,cellsTall:c?l.cellsLong:l.cellsTall}},p=l.rotation||0,a=s(p);for(let t=0;t<a.cellsTall;t++)for(let c=0;c<a.cellsWide;c++)i[n.y+t][n.x+c].hasItem=!1,i[n.y+t][n.x+c].itemId="";k(i),console.log("DELETING ITEM",l.id),X(t=>(console.log(),t.filter(c=>c.id!=l.id))),x(t=>{const c=t.findIndex(T=>T.item.name==l.name&&!T.item.hasMoved);if(c!==-1){const T=[...t];return T[c].quantity+=1,T}else return[...t,new je({item:new U({id:l.id,name:l.name,cellsLong:a.cellsWide,cellsTall:a.cellsTall,icon:l.icon}),quantity:1})]})}function Fe(l,n){const i=Array.from(e?ne.find(t=>t.sectionName===z).cells:b);console.log("DELETING ITEM ROTATE",l.id,l.rotation);const s=t=>{const c=t%2===1;return{cellsWide:c?l.cellsTall:l.cellsLong,cellsTall:c?l.cellsLong:l.cellsTall}},p=l.rotation||0,a=s(p);for(let t=0;t<a.cellsTall;t++)for(let c=0;c<a.cellsWide;c++)console.log("Deleting cell",n.y+t,n.x+c),i[n.y+t][n.x+c].hasItem=!1,i[n.y+t][n.x+c].itemId="";k([...i]),console.log("DELETING ITEM",l.id)}function Ye(l,n){const i=e?ne.find(a=>a.sectionName===z).cells:b,s=Array.from(i);if(i[l.y]==null){Me();return}const p=Le(l,n);s.forEach(a=>a.forEach(t=>{t.mouseOver=!1,t.canPlaceItem=!1,t.mouseOverLocation=""}));for(let a=0;a<n.cellsTall;a++)for(let t=0;t<n.cellsLong;t++)l.y+a<s.length&&l.x+t<s[l.y+a].length&&(n.cellsLong===1&&n.cellsTall===1?s[l.y+a][l.x+t].mouseOverLocation="single":n.cellsTall===1?t===0?s[l.y+a][l.x+t].mouseOverLocation="leftFull":t===n.cellsLong-1?s[l.y+a][l.x+t].mouseOverLocation="rightFull":s[l.y+a][l.x+t].mouseOverLocation="middleFull":n.cellsLong===1?a===0?s[l.y+a][l.x+t].mouseOverLocation="topFull":a===n.cellsTall-1?s[l.y+a][l.x+t].mouseOverLocation="bottomFull":s[l.y+a][l.x+t].mouseOverLocation="middleVFull":a===0&&t===0?s[l.y+a][l.x+t].mouseOverLocation="topLeftCorner":a===0&&t===n.cellsLong-1?s[l.y+a][l.x+t].mouseOverLocation="topRightCorner":a===n.cellsTall-1&&t===0?s[l.y+a][l.x+t].mouseOverLocation="bottomLeftCorner":a===n.cellsTall-1&&t===n.cellsLong-1?s[l.y+a][l.x+t].mouseOverLocation="bottomRightCorner":a===0?s[l.y+a][l.x+t].mouseOverLocation="top":a===n.cellsTall-1?s[l.y+a][l.x+t].mouseOverLocation="bottom":t===0?s[l.y+a][l.x+t].mouseOverLocation="left":t===n.cellsLong-1?s[l.y+a][l.x+t].mouseOverLocation="right":s[l.y+a][l.x+t].mouseOverLocation="middle",s[l.y+a][l.x+t].mouseOver=!0,s[l.y+a][l.x+t].canPlaceItem=p);if(e){const a=ne.find(t=>t.sectionName===z);a&&(a.cells=s.map(t=>t.map(c=>({...c}))),fe([...ne])),fe(t=>t.map(c=>c.sectionName===z?{...c,cells:s}:c))}else k(s)}function Me(){const l=Array.from(e?ne.find(n=>n.sectionName===z).cells:b);l.forEach(n=>n.forEach(i=>{i.mouseOver=!1,i.canPlaceItem=!1,i.mouseOverLocation=""})),k(l)}m.useEffect(()=>{de(z,ne,I)},[z]),m.useEffect(()=>{const l=()=>{const n=R.find(i=>i.id===G);console.log("Unselecting item",G),E(null),n&&(w(i=>[...i,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{w(i=>i.filter(s=>s!==n.id))},300))};return document.addEventListener("click",l),()=>document.removeEventListener("click",l)},[G,R]);function Ze(l){E(null),w(n=>[...n,l]),console.log("Unselecting item",l),setTimeout(()=>{w(n=>n.filter(i=>i!==l))},300)}function He(l){const n=R.find(i=>i.id===G);console.log("Unselecting item",G),E(l),n&&(w(i=>[...i,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{w(i=>i.filter(s=>s!==n.id))},300))}function ze(l){x(n=>[...n,l])}return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"App",children:[o.jsx("h1",{className:"title",children:"LayItOut"}),o.jsx("br",{}),(ae||ue)&&o.jsxs("div",{className:"template-name-row",children:[o.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),o.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:l=>ge(l.target.value),value:he})]}),(ae||ue)&&o.jsxs("div",{className:"template-creation",children:[o.jsxs("button",{className:"action-btn",onClick:()=>{if(he.trim()==""){alert("Please enter a template name");return}if(r.some(l=>l.name===he&&(ue?l.id!==ee.id:!0))){alert("Template with this name already exists");return}if(ue){const l=r.map(n=>n.id===ee.id?(console.log("SECTION",I),new Te({name:he,sections:I.map(i=>new me({name:i.name,cellId:new S({x:n.sections.find(s=>s.name==i.name).cellId.x*(e?20:10),y:n.sections.find(s=>s.name==i.name).cellId.y*(e?20:10)}),cellsLong:i.cellsLong*10,cellsTall:i.cellsTall*10,startingItems:i.items.map(s=>new Ae({cell:new S({x:s.sectionCell.x,y:s.sectionCell.y}),item:new U({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable})}))})),id:n.id})):new Te({name:n.name,sections:n.sections.map(i=>new me({name:i.name,cellId:new S({x:i.cellId.x*(e?20:10),y:i.cellId.y*(e?20:10)}),cellsLong:i.cellsLong*(e?20:10),cellsTall:i.cellsTall*(e?20:10),startingItems:i.startingItems.map(s=>new Ae({cell:new S({x:s.cell.x*(e?2:1),y:s.cell.y*(e?2:1)}),item:new U({id:s.item.id,name:s.item.name,cellsLong:s.item.cellsLong,cellsTall:s.item.cellsTall,icon:s.item.icon,starterItem:s.item.starterItem,moveable:s.item.moveable})}))})),id:n.id}));N(!0),Xe(Ie,h,l).then(()=>{console.log("Template updated successfully"),N(!1)})}},children:[ae?"Create":"Save"," Template"]}),o.jsx("button",{className:"action-btn",onClick:()=>{we(!1),H([]),D([]),K([]),fe([]),$([]),ce(null)},children:"Cancel"})]}),j&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"loader-backdrop"}),o.jsx("div",{className:"loader"})]})," ",o.jsxs("div",{className:"layout",children:[o.jsx(_e,{isEditingTemplate:ue,isCreatingTemplate:ae,maxHeight:e?200:O,showAddCustomItem:()=>{q.current?.showModal()},addDraggingItem:Ee,removeItem:ke,inventoryItems:u.map(l=>new je({item:new U({id:l.item.id,name:l.item.name,cellsLong:l.item.cellsLong,cellsTall:l.item.cellsTall,icon:l.item.icon,displayItem:!0}),quantity:l.quantity}))}),e?o.jsxs("div",{className:"mobile-areas",style:{height:V+"px"},children:[o.jsx("img",{src:Ne,onClick:()=>{const l=I.findIndex(i=>i.name==z);if(l===-1)return;const n=(l-1+I.length)%I.length;ce(I[n].name),console.log("Changing viewing section to",I[n].name)},className:"back-mobile-areas"}),Re.map((l,n)=>o.jsx(Se,{width:l.width,height:l.height,cells:xe(ne.find(i=>i.sectionName==l.sectionName).cells),id:l.sectionName,visibile:z==null?!0:l.sectionName==z,section:l.sectionName},n)),o.jsx("img",{src:Ne,onClick:()=>{const l=I.findIndex(i=>i.name==z);if(l===-1)return;const n=(l+1)%I.length;ce(I[n].name),console.log("Changing viewing section to",I[n].name)},className:"forward-mobile-areas"})]}):o.jsx(Se,{width:f,height:O,cells:xe(b)})]})]}),I.map(l=>o.jsx(De,{section:l,visible:z==null?!0:l.name==z,cellSize:d},l.cellId.toId())),R.map(l=>o.jsx(Pe,{removeItem:ke,visible:e?!l.hasMoved&&!l.starterItem?!0:z==null?!1:l.starterItem?I.find(n=>n.name==z)?.startingItems.some(n=>n.item.id===l.id):I.find(n=>n.name==z)?.items.some(n=>n.id===l.id):!0,item:l,canPlaceItem:Le,placeItem:be,deleteItemRotate:Fe,highlightCells:Ye,unHighlightCells:Me,deleteItem:Be,isSelected:G===l.id,onSelect:He,isUnselecting:L.includes(l.id),onDeselect:()=>Ze(l.id)},l.id)),e&&!j&&o.jsx("div",{className:"layout-icon",onClick:()=>{v.current?.showModal(),J(!0),console.log("Showing layout dialog")},children:o.jsx("img",{src:ll,alt:""})}),!j&&!(ae||ue)&&o.jsx("div",{className:"template-icon",onClick:()=>{ye.current?.showModal(),re(!0),console.log("Showing template dialog")},children:o.jsx("img",{src:tl,alt:""})}),o.jsx(nl,{dialogRef:ye,isOpen:ie,closeDialog:()=>{ye.current?.close(),re(!1)},templates:r}),o.jsx(el,{dialogRef:v,isOpen:Q,closeDialog:()=>{v.current?.close(),J(!1)},layoutSections:M}),o.jsx(ol,{dialogRef:q,addInventoryItem:ze,closeDialog:()=>{q.current?.close()}})]})}
