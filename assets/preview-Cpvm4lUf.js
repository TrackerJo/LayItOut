import{c as ye,j as f,r as m}from"./index-BNCXs9B3.js";import{A as K,S as xe,D as pe,B as Se}from"./booth_item-BAf2Q2gR.js";import{J as q,H as S,I as v,G as Le,K as Y,M as we}from"./firestore-DnikGjYO.js";import{F as Q}from"./forward-An_qFV6V.js";ye.createRoot(document.getElementById("root")).render(f.jsx(Te,{}));function Te(){const[g,ve]=m.useState(!1),[U,X]=m.useState(0),[$,Z]=m.useState(0),[L,w]=m.useState([]),[O,b]=m.useState([]),[_,C]=m.useState(0),[T,D]=m.useState(null),[B,E]=m.useState([]),y=10,[M,k]=m.useState([]),[d,N]=m.useState([]),[ee,le]=m.useState([]),[x,j]=m.useState([]),[r,P]=m.useState(null),[ne,Ee]=m.useState(!1),[oe,R]=m.useState(!0),[F,H]=m.useState(!1),[be,te]=m.useState(!1),[se,ce]=m.useState([]);function A(e,n){for(const s of n)if(e.x>=s.cellId.x&&e.x<s.cellId.x+s.cellsLong&&e.y>=s.cellId.y&&e.y<s.cellId.y+s.cellsTall)return s;return null}function ie(e){let n=U,s=$;if(g){let t=0;const i=[],c=[];for(const l of e){const o=[],a={width:l.cellsLong*y,height:l.cellsTall*y,sectionName:l.name};a.height>t&&(t=a.height),le(I=>[...I,a]),l.cellId.x=0,l.cellId.y=0,[...Array(a.height/y).keys()].map(I=>{const h=[];[...Array(a.width/y).keys()].map(u=>{h.push({id:new S({x:u,y:I}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:y})}),o.push(h)}),i.push({sectionName:l.name,cells:[...o]}),c.push(l)}j(i),N(c),C(t),P(e[0]?e[0].name:null),setTimeout(()=>{R(!1)},500)}else{const t=[];for(const i of e)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",i.cellsLong+i.cellId.x,"Current width:",n),i.cellsLong+i.cellId.x>n&&(console.log("Added section Width:",i.cellsLong+i.cellId.x),n+=i.cellsLong+i.cellId.x-n),console.log("Needed section Height:",i.cellsTall+i.cellId.y,"Current height:",s),i.cellsTall+i.cellId.y>s&&(console.log("Added section Height:",i.cellsTall+i.cellId.y),s+=i.cellsTall+i.cellId.y-s);X(n),Z(s),[...Array(s).keys()].map(i=>{const c=[];[...Array(n).keys()].map(l=>{c.push({id:new S({x:l,y:i}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:A(new S({x:l,y:i}),e)!=null,size:y})}),t.push(c)}),w([...t]),setTimeout(()=>{const i=[],c=[],l=[...e];for(const o of l)o.cellElement=document.querySelector(`.App #${o.cellId.toId()}.cell:not(.cell-border)`),i.push(...o.startingItems.map(a=>new Y({cell:new S({x:o.cellId.x+a.cell.x,y:o.cellId.y+a.cell.y}),item:new v({...a.item,initialElement:document.querySelector(`.App #${a.cell.toId()}.cell:not(.cell-border)`),starterItem:!0})}))),i.push(...o.modifierItems.map(a=>new Y({cell:new S({x:o.cellId.x+a.cell.x,y:o.cellId.y+a.cell.y}),item:new v({...a.item,initialElement:document.querySelector(`.App #${a.cell.toId()}.cell:not(.cell-border)`),starterItem:!0})}))),c.push(...o.booths.map(a=>new we({...a,cell:new S({x:o.cellId.x+a.cell.x,y:o.cellId.y+a.cell.y}),initialElement:document.querySelector(`.App #${a.cell.toId()}.cell:not(.cell-border)`)})));N([...l]);for(const o of i){const a=u=>{const p=u%2===1;return{cellsLong:p?o.item.cellsTall:o.item.cellsLong,cellsTall:p?o.item.cellsLong:o.item.cellsTall}},I=o.item.rotation||0,h=a(I);for(let u=0;u<h.cellsTall;u++)for(let p=0;p<h.cellsLong;p++)t[o.cell.y+u][o.cell.x+p].hasItem=!0,t[o.cell.y+u][o.cell.x+p].itemId=o.item.id;o.item.initialElement=document.querySelector(`.App #${o.cell.toId()}.cell:not(.cell-border)`),b(u=>[...u,o.item])}for(const o of c){for(let a=0;a<o.cellsTall;a++)for(let I=0;I<o.cellsLong;I++)t[o.cell.y+a][o.cell.x+I].hasItem=!0,t[o.cell.y+a][o.cell.x+I].itemId=o.id;o.initialElement=document.querySelector(`.App #${o.cell.toId()}.cell:not(.cell-border)`),ce(a=>[...a,o])}w([...t]),setTimeout(()=>{R(!1),ae()},500)},100)}}async function ae(e,n){R(!0),H(!0),setTimeout(async()=>{const s=document.getElementById("capture"),t=await domtoimage.toPng(s);H(!1),localStorage.setItem("screenshot",t),te(!0),R(!1)},500)}async function re(){new URLSearchParams(window.location.search);const e=[];let n=localStorage.getItem("screenshotSections");console.log("Screenshot sections from localStorage",n),n=n?.split("LAYOUTSEPARATOR")||"";const s=[];for(const t of n)console.log("Section string",t),s.push(q.fromJSON(t));N([...s.map(t=>new q({name:t.name,cellId:new S({x:t.cellId.x,y:t.cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,startingItems:t.startingItems,modifierItems:t.modifierItems,booths:t.booths,items:t.startingItems.map(i=>new v({...i.item}))}))]),e.push(...s.map(t=>new q({name:t.name,cellId:new S({x:t.cellId.x,y:t.cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,startingItems:t.startingItems,modifierItems:t.modifierItems,booths:t.booths,items:t.startingItems.map(i=>new v({...i.item}))}))),console.log("SECTIONS TO GENERATE",e),ie(e)}m.useEffect(()=>{re()},[]);function me(e,n,s){if(!g||e==null)return;const t=[...s],i=[],c=s.find(l=>l.name==e);console.log("NEW SECTION",c),console.log("Adding section",c.name,c.cellId),console.log("MOBILE CELLS",n),c.cellElement=document.querySelector(`.App #${c.name.split(" ").join("-")} #${c.name.split(" ").join("")}${c.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",c.cellElement);for(const l of c.startingItems){console.log("Placing starting item",l.item.name,l.cell);const o=h=>{const u=h%2===1;return{cellsLong:u?l.item.cellsTall:l.item.cellsLong,cellsTall:u?l.item.cellsLong:l.item.cellsTall}},a=l.item.rotation||0,I=o(a);for(let h=0;h<I.cellsTall;h++)for(let u=0;u<I.cellsLong;u++){const p=n.find(he=>he.sectionName===c.name);p.cells[l.cell.y+h][l.cell.x+u].hasItem=!0,p.cells[l.cell.y+h][l.cell.x+u].itemId=l.item.id}l.item.initialElement=document.querySelector(`.App #${c.name.split(" ").join("-")} #${c.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",l.item.initialElement),i.push(new v({...l.item,starterItem:!0}))}console.log("Setting sections",t),N([...t]),console.log("ITEMS",i),b(l=>[...l.filter(a=>!i.some(I=>I.id===a.id)),...i.map(a=>new v({...a,starterItem:!0}))])}function W(e){let n=[];return e.map(s=>n=[...n,...s]),n}function V(e,n){console.log(e);const s=g?x.find(l=>l.sectionName===r).cells:L,t=s[e.y].length,i=s.length;if(console.log(t,i),e.x+n.cellsLong>t||e.y+n.cellsTall>i)return!1;const c=A(e,d);if(!c&&!g)return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<n.cellsTall;l++)for(let o=0;o<n.cellsLong;o++){if(!g){const a=A(new S({x:e.x+o,y:e.y+l}),d);if(!a)return console.log("Item is out of bounds of any section"),!1;if(a.name!=c.name)return console.log("Item is crossing section boundaries"),!1}if(s[e.y+l][e.x+o].hasItem&&s[e.y+l][e.x+o].itemId!=n.id)return console.log("Something is already here"),!1}return!0}function de(e,n,s){const t=Array.from(g?x.find(l=>l.sectionName===r).cells:L);if(s!=null){console.log("Removing item");const l=g?d.find(o=>o.name===r):A(s,d);l.items=l.items.filter(o=>o.id!=n.id);for(let o=0;o<n.cellsTall;o++)for(let a=0;a<n.cellsLong;a++)t[s.y+o][s.x+a].hasItem=!1,t[s.y+o][s.x+a].itemId=""}const i=g?d.find(l=>l.name===r):A(e,d),c=new S({x:e.x-i.cellId.x,y:e.y-i.cellId.y});n.sectionCell=c,i.items.push(n);for(let l=0;l<n.cellsTall;l++)for(let o=0;o<n.cellsLong;o++)t[e.y+l][e.x+o].hasItem=!0,t[e.y+l][e.x+o].itemId=n.id;if(console.log(t),g){const l=x.find(o=>o.sectionName===r);l&&(l.cells=t.map(o=>o.map(a=>({...a}))),j([...x]))}else w(t);if(console.log("Removing item from inventory",n.name),!n.hasMoved){const l=M.findIndex(o=>o.item.name==n.name&&!o.item.hasMoved);if(l!==-1){const o=[...M];o[l].quantity-=1,o[l].quantity<=0&&o.splice(l,1),k(o)}else k(M)}b(l=>(console.log("Placing item",n.id),console.log("Updating item",n.id),l.find(o=>o.id==n.id).hasMoved||(l.find(o=>o.id==n.id).hasMoved=!0),l))}function ue(e){console.log("Removing item",e.id),b(n=>n.filter(s=>s.id!=e.id))}function fe(e,n){const s=Array.from(L),t=l=>{const o=l%2===1;return{cellsWide:o?e.cellsTall:e.cellsLong,cellsTall:o?e.cellsLong:e.cellsTall}},i=e.rotation||0,c=t(i);for(let l=0;l<c.cellsTall;l++)for(let o=0;o<c.cellsWide;o++)s[n.y+l][n.x+o].hasItem=!1,s[n.y+l][n.x+o].itemId="";w(s),console.log("DELETING ITEM",e.id),b(l=>(console.log(),l.filter(o=>o.id!=e.id))),k(l=>{const o=l.findIndex(a=>a.item.name==e.name&&!a.item.hasMoved);if(o!==-1){const a=[...l];return a[o].quantity+=1,a}else return[...l,new Le({item:new v({...e}),quantity:1})]})}function ge(e,n){const s=Array.from(g?x.find(l=>l.sectionName===r).cells:L);console.log("DELETING ITEM ROTATE",e.id,e.rotation);const t=l=>{const o=l%2===1;return{cellsWide:o?e.cellsTall:e.cellsLong,cellsTall:o?e.cellsLong:e.cellsTall}},i=e.rotation||0,c=t(i);for(let l=0;l<c.cellsTall;l++)for(let o=0;o<c.cellsWide;o++)console.log("Deleting cell",n.y+l,n.x+o),s[n.y+l][n.x+o].hasItem=!1,s[n.y+l][n.x+o].itemId="";w([...s]),console.log("DELETING ITEM",e.id)}function Ie(e,n){const s=g?x.find(c=>c.sectionName===r).cells:L,t=Array.from(s);if(s[e.y]==null){z();return}const i=V(e,n);t.forEach(c=>c.forEach(l=>{l.mouseOver=!1,l.canPlaceItem=!1,l.mouseOverLocation=""}));for(let c=0;c<n.cellsTall;c++)for(let l=0;l<n.cellsLong;l++)e.y+c<t.length&&e.x+l<t[e.y+c].length&&(n.cellsLong===1&&n.cellsTall===1?t[e.y+c][e.x+l].mouseOverLocation="single":n.cellsTall===1?l===0?t[e.y+c][e.x+l].mouseOverLocation="leftFull":l===n.cellsLong-1?t[e.y+c][e.x+l].mouseOverLocation="rightFull":t[e.y+c][e.x+l].mouseOverLocation="middleFull":n.cellsLong===1?c===0?t[e.y+c][e.x+l].mouseOverLocation="topFull":c===n.cellsTall-1?t[e.y+c][e.x+l].mouseOverLocation="bottomFull":t[e.y+c][e.x+l].mouseOverLocation="middleVFull":c===0&&l===0?t[e.y+c][e.x+l].mouseOverLocation="topLeftCorner":c===0&&l===n.cellsLong-1?t[e.y+c][e.x+l].mouseOverLocation="topRightCorner":c===n.cellsTall-1&&l===0?t[e.y+c][e.x+l].mouseOverLocation="bottomLeftCorner":c===n.cellsTall-1&&l===n.cellsLong-1?t[e.y+c][e.x+l].mouseOverLocation="bottomRightCorner":c===0?t[e.y+c][e.x+l].mouseOverLocation="top":c===n.cellsTall-1?t[e.y+c][e.x+l].mouseOverLocation="bottom":l===0?t[e.y+c][e.x+l].mouseOverLocation="left":l===n.cellsLong-1?t[e.y+c][e.x+l].mouseOverLocation="right":t[e.y+c][e.x+l].mouseOverLocation="middle",t[e.y+c][e.x+l].mouseOver=!0,t[e.y+c][e.x+l].canPlaceItem=i);if(g){const c=x.find(l=>l.sectionName===r);c&&(c.cells=t.map(l=>l.map(o=>({...o}))),j([...x])),j(l=>l.map(o=>o.sectionName===r?{...o,cells:t}:o))}else w(t)}function z(){const e=Array.from(g?x.find(n=>n.sectionName===r).cells:L);e.forEach(n=>n.forEach(s=>{s.mouseOver=!1,s.canPlaceItem=!1,s.mouseOverLocation=""})),w(e)}m.useEffect(()=>{me(r,x,d)},[r]),m.useEffect(()=>{const e=()=>{const n=O.find(s=>s.id===T);console.log("Unselecting item",T),D(null),n&&(E(s=>[...s,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{E(s=>s.filter(t=>t!==n.id))},300))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[T,O]);function G(e){D(null),E(n=>[...n,e]),console.log("Unselecting item",e),setTimeout(()=>{E(n=>n.filter(s=>s!==e))},300)}function J(e){const n=O.find(s=>s.id===T);console.log("Unselecting item",T),D(e),n&&(E(s=>[...s,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{E(s=>s.filter(t=>t!==n.id))},300))}return f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"App",children:[oe&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"loader-backdrop"}),f.jsx("div",{className:"loader"})]})," ",f.jsx("div",{className:"layout",children:g?f.jsxs("div",{className:"mobile-areas",style:{height:_+"px"},children:[f.jsx("img",{src:Q,onClick:()=>{const e=d.findIndex(s=>s.name==r);if(e===-1)return;const n=(e-1+d.length)%d.length;P(d[n].name),console.log("Changing viewing section to",d[n].name)},className:"back-mobile-areas"}),ee.map((e,n)=>f.jsx(K,{width:e.width,height:e.height,cells:W(x.find(s=>s.sectionName==e.sectionName).cells),id:e.sectionName,visibile:r==null?!0:e.sectionName==r,section:e.sectionName},n)),f.jsx("img",{src:Q,onClick:()=>{const e=d.findIndex(s=>s.name==r);if(e===-1)return;const n=(e+1)%d.length;P(d[n].name),console.log("Changing viewing section to",d[n].name)},className:"forward-mobile-areas"})]}):f.jsx(K,{width:U*y,height:$*y,cells:W(L)})})]}),f.jsxs("div",{id:F?"capture":"",children:[d.map(e=>f.jsx(xe,{takingPhoto:F,section:e,visible:r==null?!0:e.name==r,cellSize:y},e.cellId.toId())),O.map(e=>f.jsx(pe,{isPlacingItem:!1,isCreatingArea:!1,isCreatingTemplate:!1,cellSize:y,isViewingDesign:ne,removeItem:ue,visible:g?!e.hasMoved&&!e.starterItem?!0:r==null?!1:e.starterItem?d.find(n=>n.name==r)?.startingItems.some(n=>n.item.id===e.id):d.find(n=>n.name==r)?.items.some(n=>n.id===e.id):!0,item:e,canPlaceItem:V,placeItem:de,deleteItemRotate:ge,highlightCells:Ie,unHighlightCells:z,deleteItem:fe,isSelected:T===e.id,onSelect:J,isUnselecting:B.includes(e.id),onDeselect:()=>G(e.id)},e.id)),se.map(e=>f.jsx(Se,{canPick:!0,visible:g?r==null?!1:d.find(n=>n.name==r)?.booths.some(n=>n.id===e.id)??!1:!0,booth:e,isViewingBooth:!1,isSelected:T==e.id,cellSize:y,onSelect:J,isUnselecting:B.includes(e.id),onDeselect:()=>G(e.id),onPickBooth:async n=>{}},e.id))]})]})}
