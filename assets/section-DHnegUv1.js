import{j as i,r as a,C as y,I as le}from"./firestore-DhivQkY_.js";function ue({id:e,mouseOver:x,canPlaceItem:D,hasItem:R,mouseOverLocation:I,inSection:g,section:d,size:h}){return i.jsx("div",{className:`cell ${x?"hovered":""} ${D?"legal":"illegal"} ${R?"hasItem":""} ${I} ${g?"":"outside"}`,id:`${d==null?"":d.split(" ").join("")}${e.toId()}`,style:{width:`${h}px`,height:`${h}px`},children:i.jsx("div",{className:"cell cell-border",id:`${d==null?"":d.split(" ").join("")}${e.toId()}`})})}function ge({width:e,height:x,cells:D,id:R,visibile:I,section:g}){return i.jsx("div",{className:`area ${I??!0?"":"invisible"}`,style:{width:`${e}px`,height:`${x}px`},id:R!=null?R.split(" ").join("-"):"",children:D.map(d=>i.jsx(ue,{size:d.size,id:d.id,canPlaceItem:d.canPlaceItem,mouseOver:d.mouseOver,hasItem:d.hasItem,itemId:d.itemId,mouseOverLocation:d.mouseOverLocation,inSection:d.inSection,section:g}))})}const se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAPCAYAAADtc08vAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAEKADAAQAAAABAAAADwAAAADW5XGhAAABRUlEQVQoFY2Tz0oDMRDGv4lgPXkUPAiCvfUBbD3VLoJoBUuPPoI+jlffQIqiUC9tb/45+QIF7bXFB9jDZjrZNptN090a2M0km++XyZdZ4rPGH4AdaN2mwddI4tLGtdo29nd7ILqExq2S1w1AW1DqlaPj0zK1Jwb3MZk+kBFw1DiHoieJkqJMAvHPrEPjcZwCNkGKxEaXAYogZeIAEELQlS3uUsPMmZdpm3W2eRnYSecJKou59WLzTVmR109mIzC+3Zy+N4a5sYsCAFerFRzuyT2jLpBPWRqD1aPUS+RkLvIAOfGFXGkfv9MmNF+LB0pgL9w6aTnpIso8CMQ5wzJPmDU0tWn4PrSgFLDpqsziDGKKLaErC6H/iO1uHmT575CY05N66qRnzqVtRau9D6GmMedInud1RbIqNmMafLwh0bIhxSB9MAfmu9CGVRsdYgAAAABJRU5ErkJggg==",ie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAGaADAAQAAAABAAAAGQAAAABY85deAAABrUlEQVRIDe1VPUsDQRB9ezk0GO0FwVhFBQtDWot09oqFCGopgp1ILoWNEEHRRmy0EmwEK7XxB1gIfjQWdmlFLEQRDcaM7y4f3O4lmJw2QhYuu29m3szeu2ECmGtZYsjKAVZk0HSFxVaAqNBL2ywiuIYjcwF/CIMqc0QhgwkoTBEnuCd9udaQU6s+3PKRbyIWsjhi4n2y83wOfVnyKOLEh0MdLb7BIgRpfCKFdeWghGMvk7DwK0axoa5CZdZIWbml9hnDNqLhXwKb/CFKdanlyak7D89LFB0INocWTLCHD0CVTHMVu0Wi1P29avD2jEyz8DYft9N+Xg4KUHJGeWewowomweb3uOddn2qOtNheEyg80rZJ/1fN1/iQoGsS3Tjn7jaQtmx+7GHNkkIfi8Ro22Xrbmm+RmBJOtHjSsb2r7OCeltwJXRXsbw18ftQi61yNVKwiOb+G9Au0pKObbn+g1w2XrxrlhBv+rpx9Fdiy1yDWPlnNKyO3HC0JDm33uhpOF19rC7GRxg/xjF14bN7x7pjgJ5xpl7g4BwgMWKSAljwzCKn9QoEYtuGnxT4Bng+WDuZ4k7PAAAAAElFTkSuQmCC";function he({item:e,canPlaceItem:x,placeItem:D,deleteItem:R,deleteItemRotate:I,isSelected:g,onSelect:d,onDeselect:h,isUnselecting:C,highlightCells:O,unHighlightCells:k,visible:G,removeItem:B,isViewingDesign:v,cellSize:r}){const[f,c]=a.useState(0),[w,L]=a.useState(0),M=a.useRef(null),[X,j]=a.useState(0),[V,W]=a.useState(0),[b,N]=a.useState(!1),[p,U]=a.useState(0),[u,Z]=a.useState(null),[q,J]=a.useState(!0),[H,ae]=a.useState(12),ce=a.useRef(null),[re,Ae]=a.useState(!0),S=t=>{const l=t%2===1;return{width:l?e.cellsTall*r:e.cellsLong*r,height:l?e.cellsLong*r:e.cellsTall*r,cellsWide:l?e.cellsTall:e.cellsLong,cellsTall:l?e.cellsLong:e.cellsTall}},K=t=>{const l=e.cellsLong*r,o=e.cellsTall*r;switch(t%4){case 0:return{x:0,y:0};case 1:return{x:(o-l)/2,y:(l-o)/2};case 2:return{x:0,y:0};case 3:return{x:(o-l)/2,y:(l-o)/2};default:return{x:0,y:0}}},z=()=>{if(!e.hasMoved)return;const t=p+1,l=S(t),o=le.fromDoc(e.toDoc());o.cellsLong=l.cellsWide,o.cellsTall=l.cellsTall,o.initialElement=e.initialElement,o.rotation=t,o.hasMoved=e.hasMoved;let n=u;if(!e.hasMoved&&e.rotation!=0||n&&x(y.fromString(n.id),o)){n==null&&(n=e.initialElement),console.log("ROTATE ITEM",e.id,"to rotation:",t,"at cell:",n?.id),U(t),I(e,y.fromString(n.id)),e.rotation=t;const m=K(t),s=n.offsetLeft,A=n.offsetTop;c(s+m.x),L(A+m.y),j(s+m.x),W(A+m.y)}};function de(t){const l=M.current,o=window.getComputedStyle(l),n=document.createElement("span");n.style.font=o.font,n.style.fontSize=t+"px",n.style.fontFamily=o.fontFamily,n.style.fontWeight=o.fontWeight,n.style.position="absolute",n.style.visibility="hidden",n.style.whiteSpace="nowrap",n.textContent=l.textContent,document.body.appendChild(n);const m=n.offsetWidth;return document.body.removeChild(n),m}function _(t){if(M.current){const l=M.current;return de(t-1)>l.offsetWidth&&t-1>8?_(t-1):t-1}return t}a.useEffect(()=>{setTimeout(()=>{M.current&&ae(_(H)),e.isDisplayItem&&!e.hasMoved&&(console.log("Starting item as dragging item"),N(!0))},100)},[]),a.useEffect(()=>{e.initialElement!=null&&!e.hasMoved&&(console.log("Item initial element:",e.rotation),e.rotation&&setTimeout(()=>{console.log("Rotating item to initial rotation:",e.rotation);for(let t=0;t<e.rotation;t++)console.log("Rotating item",t+1,"times"),U(l=>{const o=(l+1)%4,n=K(o),m=e.initialElement.offsetLeft,s=e.initialElement.offsetTop;return c(m+n.x),L(s+n.y),j(m+n.x),W(s+n.y),o})},100),e.initialElement&&!e.hasMoved&&(e.initialElement.classList.contains("cell")&&(console.log("Setting cell to initial element:",e.initialElement.children[0]),Z(e.initialElement.children[0])),c(e.initialElement.offsetLeft),L(e.initialElement.offsetTop),j(e.initialElement.offsetLeft),W(e.initialElement.offsetTop)))},[e]);const ee=()=>{if(b)return;if(u==null){c(e.initialElement.offsetLeft),j(e.initialElement.offsetLeft),L(e.initialElement.offsetTop),W(e.initialElement.offsetTop);return}const t=u.offsetTop,l=u.offsetLeft,o=K(p);c(l+o.x),L(t+o.y),j(l+o.x),W(t+o.y)};a.useEffect(()=>(window.addEventListener("resize",ee),()=>{window.removeEventListener("resize",ee)}),[u,p,b]);const P=t=>{t.preventDefault()};a.useEffect(()=>{if(console.log("IS Dragging: ",b),b){j(f),W(w),document.body.addEventListener("touchmove",P,{passive:!1});const t=document.getElementById(e.id)?.getBoundingClientRect(),l=t?t.left-f:0,o=t?t.top-w:0;g&&h();const n=(s,A,T)=>{const F=S(p),E=le.fromDoc(e.toDoc());E.cellsLong=F.cellsWide,E.cellsTall=F.cellsTall,E.initialElement=e.initialElement,E.rotation=p,E.hasMoved=e.hasMoved,E.id=e.id;let $=T;if(!$||!$.classList?.contains("cell")){const Y=document.elementFromPoint(s,A);Y?.classList?.contains("cell")&&($=Y)}$?.classList?.contains("cell")?O(y.fromString($.id),E):k(),c(s-l),L(A-o+5)},m=(s,A)=>{console.log("Drag ended"),k(),document.body.removeEventListener("touchmove",P);const T=document.elementFromPoint(s,A);if(T?.classList?.contains("cell")){const F=S(p),E={...e,cellsLong:F.cellsWide,cellsTall:F.cellsTall};if(!x(y.fromString(T.id),E)){if(e.isDisplayItem&&!e.hasMoved){console.log("Removing item from toolbox"),B(e);return}c(X),L(V),N(!1);return}const $=T.offsetTop,Y=T.offsetLeft,te=K(p),oe=Y+te.x,ne=$+te.y;c(oe),L(ne),j(oe),W(ne),D(y.fromString(T.id),E,u!=null?y.fromString(u.id):null),console.log("Placed item at cell:",T),Z(T)}else{if(e.isDisplayItem&&!e.hasMoved){console.log("Removing item from toolbox"),B(e);return}c(X),L(V)}N(!1)};return document.onmousemove=s=>{s.preventDefault(),n(s.clientX,s.clientY,s.target)},document.onmouseup=s=>{m(s.clientX,s.clientY),document.onmousemove=null,document.onmouseup=null,document.ontouchmove=null,document.ontouchend=null},document.ontouchmove=s=>{s.preventDefault();const A=s.touches[0];n(A.clientX,A.clientY,s.target)},document.ontouchend=s=>{const A=s.changedTouches[0];m(A.clientX,A.clientY),document.removeEventListener("touchmove",P),document.onmousemove=null,document.onmouseup=null,document.ontouchmove=null,document.ontouchend=null},()=>{document.removeEventListener("touchmove",P)}}else document.onmousemove=null,document.onmouseup=null,document.ontouchmove=null,document.ontouchend=null,document.body.removeEventListener("touchmove",P)},[b,u,p]);const Q=S(p);function fe(){if(u){const t=p+1,l=S(t),o={...e,cellsLong:l.cellsWide,cellsTall:l.cellsTall};console.log("Can place item at cell:",x(y.fromString(u?.id||""),o)),J(x(y.fromString(u.id),o))}else J(!1)}return f==0||w==0||!re?null:i.jsxs(i.Fragment,{children:[i.jsx("div",{id:e.id,ref:ce,className:`draggable-item ${b?"dragging":g?"selected":""} ${e.moveable?"":"not-moveable"} ${G?"":"invisible"}`,style:{top:`${w}px`,left:`${f}px`,width:`${e.cellsLong*(e.isDisplayItem&&!b&&!e.hasMoved?10:r)-(g?4:0)}px`,height:`${e.cellsTall*(e.isDisplayItem&&!b&&!e.hasMoved?10:r)-(g?4:0)}px`,rotate:`${p*90}deg`,transformOrigin:"center center",fontSize:`${H}px`},onMouseDown:e.moveable&&!v?()=>N(!0):void 0,onTouchStart:e.moveable&&!v?t=>{t.preventDefault(),N(!0)}:void 0,onClick:t=>{t.stopPropagation(),e.hasMoved&&(g?h():(fe(),d(e.id)))},children:e.icon.includes("custom-")?i.jsx("div",{className:"custom-icon",children:i.jsx("div",{children:i.jsx("p",{ref:M,children:e.icon.split("custom-")[1]})})}):i.jsx("img",{src:e.icon,alt:"icon"})}),(g||C)&&i.jsx(i.Fragment,{children:/Mobi|Android/i.test(navigator.userAgent)?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:`draggable-item-options mobile-left ${C?"exiting":""}`,style:{top:`${w+e.cellsTall*r/2-10}px`,left:`${f+e.cellsLong*r/2-Q.width/2-20}px`,width:"10px"},children:i.jsx("img",{src:ie,alt:"rotate",className:"rotate-icon"+(q?" can-rotate":" cannot-rotate"),onClick:t=>{t.stopPropagation(),z()}})}),i.jsx("div",{className:`draggable-item-options mobile-right ${C?"exiting":""}`,style:{top:`${w+e.cellsTall*r/2-10}px`,left:`${f+e.cellsLong*r/2+Q.width/2+10}px`,width:"10px"},children:i.jsx("img",{src:se,alt:"delete",className:"delete-icon",onClick:t=>{t.stopPropagation(),R(e,y.fromString(u?.id||""))}})})]}):i.jsxs("div",{className:`draggable-item-options ${C?"exiting":""}`,style:{top:`${w+e.cellsTall*r/2-Q.height/2-20}px`,left:`${f+e.cellsLong*r/2-Q.width/2}px`,width:`${Q.width}px`},children:[i.jsx("img",{src:ie,alt:"rotate",className:"rotate-icon"+(q?" can-rotate":" cannot-rotate"),onClick:t=>{t.stopPropagation(),z()}}),i.jsx("img",{src:se,alt:"delete",className:"delete-icon",onClick:t=>{t.stopPropagation(),R(e,y.fromString(u?.id||""))}})]})})]})}function pe({section:e,visible:x,cellSize:D}){const[R,I]=a.useState(e.cellElement?.offsetLeft??0),[g,d]=a.useState(e.cellElement?.offsetTop??0),h=a.useRef(null),[C,O]=a.useState(16);function k(v){const r=h.current,f=window.getComputedStyle(r),c=document.createElement("span");c.style.font=f.font,c.style.fontSize=v+"px",c.style.fontFamily=f.fontFamily,c.style.fontWeight=f.fontWeight,c.style.position="absolute",c.style.visibility="hidden",c.style.whiteSpace="no-wrap",c.textContent=r.textContent,document.body.appendChild(c);const w=c.offsetWidth;return document.body.removeChild(c),w}function G(v){if(h.current){const r=h.current,f=k(v-1);return console.log("Current text width:",f),console.log("Paragraph width:",r.offsetWidth),f>r.offsetWidth&&C>6?(console.log("Decreasing font size to:",v-1),G(v-1)):v-1}return v}a.useEffect(()=>{setTimeout(()=>{h.current&&O(G(C))},100)},[]);const B=()=>{e.cellElement!=null&&(I(e.cellElement.offsetLeft),d(e.cellElement.offsetTop))};return a.useEffect(()=>(window.addEventListener("resize",B),()=>{window.removeEventListener("resize",B)}),[e.cellElement]),e.cellElement&&i.jsx("div",{className:`section ${x??!0?"":"invisible"}`,style:{top:`${e.cellElement.offsetTop}px`,left:`${e.cellElement.offsetLeft}px`,width:`${e.cellsLong*D-2}px`,height:`${e.cellsTall*D-2}px`},children:i.jsx("h2",{className:"section-title",style:{fontSize:`${C}px`},ref:h,children:e.name})})}export{ge as A,he as D,pe as S};
