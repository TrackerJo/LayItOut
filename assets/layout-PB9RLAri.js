import{r as I,j as a,c as It}from"./index-QIV6qY6h.js";import{A as ve,S as He,D as ht}from"./section-CHPOvXdQ.js";import{I as C,C as w,T as te,S as U,b as V,s as Se,e as ue,_ as ft,f as pt,r as Fe,h as yt,i as xt,j as wt,k as Ze,l as Tt,m as Lt,p as vt,u as St,n as bt,D as At,o as Nt,q as jt,t as kt}from"./firestore-eMuYHorM.js";import{F as Ie}from"./add_custom_item_dialog-DnliRUT_.js";function Ct({inventoryItem:o,addDraggingItem:y,removeItem:d}){const L=I.useRef(null),S=I.useRef(null),[R,J]=I.useState(12),[P,B]=I.useState(o.item);function X(f){const G=S.current,E=window.getComputedStyle(G),N=document.createElement("span");N.style.font=E.font,N.style.fontSize=f+"px",N.style.fontFamily=E.fontFamily,N.style.fontWeight=E.fontWeight,N.style.position="absolute",N.style.visibility="hidden",N.style.whiteSpace="nowrap",N.textContent=G.textContent,document.body.appendChild(N);const M=N.offsetWidth;return document.body.removeChild(N),M}function H(f){if(S.current){const G=S.current;return X(f-1)>G.offsetWidth&&f-1>8?H(f-1):f-1}return f}return I.useEffect(()=>{setTimeout(()=>{S.current&&J(H(R))},100)},[]),a.jsxs("div",{className:"display",children:[a.jsx("div",{ref:L,id:o.item.id,className:"display-item",style:{width:`${o.item.cellsLong*10}px`,height:`${o.item.cellsTall*10}px`},onMouseDown:f=>{f.preventDefault(),f.stopPropagation(),o.item.initialElement=L.current,o.item.id=o.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",o.item.id,"to initialElement",o.item.initialElement),B(new C({id:o.item.id,cellsLong:o.item.cellsLong,cellsTall:o.item.cellsTall,name:o.item.name,icon:o.item.icon,moveable:o.item.moveable,starterItem:o.item.starterItem,displayItem:o.item.isDisplayItem})),y(o.item)},onTouchStart:f=>{f.preventDefault(),f.stopPropagation(),o.item.initialElement=L.current,o.item.id=o.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",o.item.id,"to initialElement",o.item.initialElement),B(new C({id:o.item.id,cellsLong:o.item.cellsLong,cellsTall:o.item.cellsTall,name:o.item.name,icon:o.item.icon,moveable:o.item.moveable,starterItem:o.item.starterItem,displayItem:o.item.isDisplayItem})),y(o.item)},children:o.item.icon.includes("custom-")?a.jsx("div",{className:"custom-icon",children:a.jsx("div",{children:a.jsx("p",{ref:S,style:{fontSize:`${R}px`},children:o.item.icon.split("custom-")[1]})})}):a.jsx("img",{src:o.item.icon,alt:"icon"})}),a.jsx("p",{children:o.item.name}),a.jsxs("p",{className:"quantity",children:["x",o.quantity]})]})}const Et="/LayItOut/assets/plus.circle-Ce3xm00a.png";function Rt({inventoryItems:o,addDraggingItem:y,maxHeight:d,removeItem:L,showAddCustomItem:S,isCreatingTemplate:R,isEditingTemplate:J,isViewingDesign:P}){return a.jsxs("div",{className:"toolbox",style:{maxHeight:d?`${d}px`:"200px"},children:[o.map(B=>a.jsx(Ct,{inventoryItem:B,addDraggingItem:y,removeItem:L})),!(R||J||P)&&a.jsx("div",{className:"add-item",onClick:()=>{S()},children:a.jsx("img",{src:Et,alt:"Add Item"})})]})}function Ot({dialogRef:o,closeDialog:y,layoutSections:d,isOpen:L}){const[S,R]=I.useState(0),[J,P]=I.useState(0),[B,X]=I.useState([]),[H,f]=I.useState([...d]),G=/Mobi|Android/i.test(navigator.userAgent)?5:10;function E(M){for(const j of H)if(M.x>=j.cellId.x&&M.x<j.cellId.x+j.cellsLong&&M.y>=j.cellId.y&&M.y<j.cellId.y+j.cellsTall)return j;return null}I.useEffect(()=>{if(!L)return;console.log("Layout dialog opened, generating cells and sections",d);const M=[];let j=0,T=0;for(const h of d)console.log("Generating cells for section",h.name,"at",h.cellId,"with size",h.cellsLong,"x",h.cellsTall),console.log("Added section Length:",h.cellsLong*G+h.cellId.x),(h.cellsLong+h.cellId.x)*G>j&&(j+=h.cellsLong*G),(h.cellsTall+h.cellId.y)*G>T&&(T+=h.cellsTall*G);console.log("Current width:",j,"Current height:",T),R(j),P(T),[...Array(T/G).keys()].map(h=>{const v=[];[...Array(j/G).keys()].map(x=>{console.log(E(new w({x,y:h}))!=null?"In section":"Outside section"),v.push({id:new w({x,y:h}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!1,size:G})}),M.push(v)}),X([...M]),setTimeout(()=>{const h=[...d];for(const v of h)console.log("Adding section",v.name,v.cellId),v.cellElement=document.querySelector(`.layout-dialog #${v.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",v.cellElement);console.log("Setting sections",h),f([...h]),X([...M])},100)},[L,d]);function N(M){let j=[];return M.map(T=>j=[...j,...T]),j}return a.jsxs("dialog",{ref:o,className:"layout-dialog",children:[a.jsxs("div",{className:"layout-dialog-div",children:[a.jsx("h2",{children:"Layout"}),a.jsx(ve,{width:S,height:J,cells:N(B)}),a.jsx("br",{}),a.jsx("button",{className:"layout-dialog-close",onClick:y,children:"Close"})]}),H.map(M=>a.jsx(He,{takingPhoto:!1,section:M,visible:!0,cellSize:G},M.cellId.toId()))]})}const Pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",Dt="/LayItOut/assets/template-Cjj8EPhc.png";function Gt({dialogRef:o,closeDialog:y,templates:d,isOpen:L,isViewingArea:S}){const[R,J]=I.useState([]),[P,B]=I.useState([]),[X,H]=I.useState([]),[f,G]=I.useState(/Mobi|Android/i.test(navigator.userAgent)),[E,N]=I.useState([]),[M,j]=I.useState(!1);return I.useEffect(()=>{if(L&&(console.log("Layout dialog opened, generating cells and sections",d),d.length!==0)){if(d.length==1){N([d[0].name]);return}N(f?[d[0].name]:[d[0].name,d[1].name])}},[L,d]),I.useEffect(()=>{const T=d.filter(h=>E.includes(h.name));console.log("Viewing templates:",E),T.sort((h,v)=>E.indexOf(h.name)-E.indexOf(v.name)),console.log("Generating templates for",T.map(h=>h.name))},[E]),a.jsx(a.Fragment,{children:a.jsx("dialog",{ref:o,className:"template-dialog",children:a.jsxs("div",{className:"template-dialog-div",children:[a.jsx("h2",{children:"Templates"}),a.jsxs("div",{className:"templates",children:[d.length>1&&d.filter(T=>!E.includes(T.name)).length>0&&a.jsx("img",{src:Ie,onClick:()=>{if(f){const h=(d.findIndex(v=>v.name===E[0])-1+d.length)%d.length;N([d[h].name])}else N(T=>{const v=(d.findIndex(x=>x.name===T[0])-1+d.length)%d.length;return[d[v].name,T[0]]})},className:"back-mobile-areas"}),E.length===0&&a.jsx("div",{className:"no-templates",children:"No templates available"}),E.map(T=>a.jsxs("div",{className:"template",children:[a.jsx("img",{src:d.find(h=>h.name===T).previewImage,alt:T,className:"template-preview"}),a.jsx("h3",{children:T}),a.jsxs("div",{className:"template-actions",children:[a.jsx("button",{className:"template-select-btn",onClick:()=>{if(S){const h=new URLSearchParams(window.location.search),v=h.get("companyId"),x=h.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${v}&areaId=${x}&type=edit-template&templateId=${d.find(Z=>Z.name==T).id}`}else{const h=d.find(Z=>Z.name===T),v=new te({name:h.name,id:h.id,previewImage:h.previewImage,sections:h.sections.map(Z=>new U({name:Z.name,cellId:new w({x:Z.cellId.x*(f?20:10),y:Z.cellId.y*(f?20:10)}),cellsLong:Z.cellsLong*(f?20:10),cellsTall:Z.cellsTall*(f?20:10),startingItems:Z.startingItems.map(Y=>new V({cell:new w({x:Y.cell.x*(f?2:1),y:Y.cell.y*(f?2:1)}),item:new C({id:Y.item.id,name:Y.item.name,icon:Y.item.icon,cellsLong:Y.item.cellsLong*2,cellsTall:Y.item.cellsTall*2,starterItem:Y.item.starterItem,moveable:Y.item.moveable})}))}))}),x=new URLSearchParams(window.location.search);x.set("templateName",v.name),window.location.search=x.toString()}},children:S?"Edit":"Select"}),S&&a.jsx("button",{className:"action-btn",onClick:()=>{if(M)return;j(!0);const h=d.filter(Y=>Y.name!==T);h.length==1?N([h[0].name]):h.length==0?N([]):h.length==2&&N(f?[h[0].name]:[h[0].name,h[1].name]);const v=new URLSearchParams(window.location.search),x=v.get("companyId"),Z=v.get("areaId");Se(x,Z,h).then(()=>{j(!1)})},children:"Delete"})]})]})),d.length>1&&d.filter(T=>!E.includes(T.name)).length>0&&a.jsx("img",{src:Ie,onClick:()=>{if(f){const h=(d.findIndex(v=>v.name===E[0])+1)%d.length;N([d[h].name])}else N(T=>{const v=(d.findIndex(x=>x.name===T[T.length-1])+1)%d.length;return[T[1],d[v].name]})},className:"forward-mobile-areas"})]}),S&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"action-btn",onClick:()=>{const T=new URLSearchParams(window.location.search),h=T.get("companyId"),v=T.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${h}&areaId=${v}&type=create-template`},children:"Create new Template"})," ",a.jsx("br",{})]}),a.jsx("br",{}),a.jsx("button",{className:"action-btn",onClick:y,children:"Close"}),M&&L&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"loader"})})]})})})}function Mt({dialogRef:o,closeDialog:y,addInventoryItem:d}){const[L,S]=I.useState(""),[R,J]=I.useState(1),[P,B]=I.useState(1),[X,H]=I.useState(1);return a.jsx("dialog",{ref:o,className:"custom-item-dialog",children:a.jsxs("div",{className:"custom-item-dialog-div",children:[a.jsx("h2",{children:"Add Custom Item"}),a.jsxs("div",{className:"custom-item-row",children:[a.jsx("label",{htmlFor:"item-name",children:"Name:"}),a.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:f=>S(f.target.value??""),value:L})]}),a.jsxs("div",{className:"custom-item-row",children:[a.jsx("label",{htmlFor:"item-icon",children:"Count:"}),a.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:R,onChange:f=>J(parseInt(f.target.value)??1)})]}),a.jsxs("div",{className:"custom-item-row custom-item-size",children:[a.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),a.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:P,onChange:f=>B(parseFloat(f.target.value)??1)}),a.jsx("span",{children:" x "}),a.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:X,onChange:f=>H(parseFloat(f.target.value)??1)})]}),a.jsx("br",{}),a.jsx("button",{className:"custom-item-dialog-add",onClick:()=>{if(L.trim()===""){alert("Item name cannot be empty");return}const f=new ue({quantity:R,item:new C({id:L+(Math.random()*1e4).toString(),name:L,icon:`custom-${L}`,cellsLong:Math.ceil(P),cellsTall:Math.ceil(X),moveable:!0,starterItem:!1,displayItem:!0})});d(f),S(""),J(1),B(1),H(1),y()},children:"Add Item"}),a.jsx("br",{}),a.jsx("br",{}),a.jsx("button",{className:"custom-item-dialog-close",onClick:y,children:"Close"})]})})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ye="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(y,d,L,S){this.app=y,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,yt(y)&&y.settings.appCheckToken&&(this.serverAppAppCheckToken=y.settings.appCheckToken),this.auth=d.getImmediate({optional:!0}),this.messaging=L.getImmediate({optional:!0}),this.auth||d.get().then(R=>this.auth=R,()=>{}),this.messaging||L.get().then(R=>this.messaging=R,()=>{}),this.appCheck||S?.get().then(R=>this.appCheck=R,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(y){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const d=y?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return d.error?null:d.token}return null}async getContext(y){const d=await this.getAuthToken(),L=await this.getMessagingToken(),S=await this.getAppCheckToken(y);return{authToken:d,messagingToken:L,appCheckToken:S}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const be="us-central1";class Wt{constructor(y,d,L,S,R=be,J=(...P)=>fetch(...P)){this.app=y,this.fetchImpl=J,this.emulatorOrigin=null,this.contextProvider=new Ft(y,d,L,S),this.cancelAllRequests=new Promise(P=>{this.deleteService=()=>Promise.resolve(P())});try{const P=new URL(R);this.customDomain=P.origin+(P.pathname==="/"?"":P.pathname),this.region=be}catch{this.customDomain=null,this.region=R}}_delete(){return this.deleteService()}_url(y){const d=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${d}/${this.region}/${y}`:this.customDomain!==null?`${this.customDomain}/${y}`:`https://${this.region}-${d}.cloudfunctions.net/${y}`}}function Ut(o,y,d){const L=Lt(y);o.emulatorOrigin=`http${L?"s":""}://${y}:${d}`,L&&(vt(o.emulatorOrigin),St("Functions",!0))}const We="@firebase/functions",Ue="0.13.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ht="auth-internal",Zt="app-check-internal",Yt="messaging-internal";function Jt(o){const y=(d,{instanceIdentifier:L})=>{const S=d.getProvider("app").getImmediate(),R=d.getProvider(Ht),J=d.getProvider(Yt),P=d.getProvider(Zt);return new Wt(S,R,J,P,L)};ft(new pt(Ye,y,"PUBLIC").setMultipleInstances(!0)),Fe(We,Ue,o),Fe(We,Ue,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bt(o=xt(),y=be){const L=wt(Ze(o),Ye).getImmediate({identifier:y}),S=Tt("functions");return S&&zt(L,...S),L}function zt(o,y,d){Ut(Ze(o),y,d)}Jt();Bt(bt);It.createRoot(document.getElementById("root")).render(a.jsx(Vt,{}));function Vt(){const[o,y]=I.useState(/Mobi|Android/i.test(navigator.userAgent)),[d,L]=I.useState(0),[S,R]=I.useState(0),[J,P]=I.useState(0),[B,X]=I.useState(0),[H,f]=I.useState([]),[G,E]=I.useState([]),[N,M]=I.useState(0),[j,T]=I.useState(null),[h,v]=I.useState([]),x=/Mobi|Android/i.test(navigator.userAgent)?5:10,[Z,Y]=I.useState([]),he=I.useRef(null),[Je,Ae]=I.useState(!1),[Q,ie]=I.useState([]),[b,_]=I.useState([]),[re,Ne]=I.useState([]),[Be,je]=I.useState(!1),fe=I.useRef(null),[ze,ke]=I.useState([]),[W,K]=I.useState([]),[A,de]=I.useState(null),[ce,Ce]=I.useState(!1),[le,Ve]=I.useState(!1),[ne,Xe]=I.useState(!1),[Qe,Ke]=I.useState(!1),[Xt,$e]=I.useState(!1),[qe,_e]=I.useState(!1),[pe,ye]=I.useState(""),[se,Ee]=I.useState(""),[ge,et]=I.useState(""),[me,tt]=I.useState(""),[Re,xe]=I.useState(""),[we,$]=I.useState(!0),[Oe,lt]=I.useState(null),[Te,oe]=I.useState(!1),Le=I.useRef(null);function ee(e,l){for(const n of l)if(e.x>=n.cellId.x&&e.x<n.cellId.x+n.cellsLong&&e.y>=n.cellId.y&&e.y<n.cellId.y+n.cellsTall)return n;return null}function nt(e){ie([...e.map(c=>new U({name:c.name,cellId:new w({x:c.cellId.x/2,y:c.cellId.y/2}),cellsLong:c.cellsLong/2,cellsTall:c.cellsTall/2,startingItems:[]}))]);let l=d,n=S;if(o){for(const t of e)console.log("Generating cells for section",t.name,"at",t.cellId,"with size",t.cellsLong,"x",t.cellsTall),console.log("Needed section Width:",(t.cellsLong+t.cellId.x)*x,"Current width:",l),(t.cellsLong+t.cellId.x)*x>l&&(console.log("Added section Width:",t.cellsLong*x+t.cellId.x),l+=(t.cellsLong+t.cellId.x)*x-l),console.log("Needed section Height:",(t.cellsTall+t.cellId.y)*x,"Current height:",n),(t.cellsTall+t.cellId.y)*x>n&&(console.log("Added section Height:",t.cellsTall*x+t.cellId.y),n+=(t.cellsTall+t.cellId.y)*x-n);X(n*2),P(l*2);let c=0;const i=[],s=[];for(const t of e){const m=[],r={width:t.cellsLong*x,height:t.cellsTall*x,sectionName:t.name};r.height>c&&(c=r.height),ke(p=>[...p,r]),t.cellId.x=0,t.cellId.y=0,[...Array(r.height/x).keys()].map(p=>{const k=[];[...Array(r.width/x).keys()].map(O=>{k.push({id:new w({x:O,y:p}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:x})}),m.push(k)}),i.push({sectionName:t.name,cells:[...m]}),s.push(t)}K(i),_(s),M(c),de(e[0]?e[0].name:null),setTimeout(()=>{$(!1)},500)}else{const c=[];for(const i of e)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",(i.cellsLong+i.cellId.x)*x,"Current width:",l),(i.cellsLong+i.cellId.x)*x>l&&(console.log("Added section Width:",i.cellsLong*x+i.cellId.x),l+=(i.cellsLong+i.cellId.x)*x-l),console.log("Needed section Height:",(i.cellsTall+i.cellId.y)*x,"Current height:",n),(i.cellsTall+i.cellId.y)*x>n&&(console.log("Added section Height:",i.cellsTall*x+i.cellId.y),n+=(i.cellsTall+i.cellId.y)*x-n);L(l),R(n),P(l),X(n),[...Array(n/x).keys()].map(i=>{const s=[];[...Array(l/x).keys()].map(t=>{s.push({id:new w({x:t,y:i}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:ee(new w({x:t,y:i}),e)!=null,size:x})}),c.push(s)}),f([...c]),setTimeout(()=>{const i=[],s=[...e];for(const t of s)t.cellElement=document.querySelector(`.App #${t.cellId.toId()}.cell:not(.cell-border)`),i.push(...t.startingItems.map(m=>new V({cell:new w({x:t.cellId.x+m.cell.x,y:t.cellId.y+m.cell.y}),item:new C({id:m.item.id,name:m.item.name,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,initialElement:document.querySelector(`.App #${m.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:m.item.moveable,rotation:m.item.rotation||0})})));_([...s]);for(const t of i){const m=k=>{const O=k%2===1;return{cellsLong:O?t.item.cellsTall:t.item.cellsLong,cellsTall:O?t.item.cellsLong:t.item.cellsTall}},r=t.item.rotation||0,p=m(r);for(let k=0;k<p.cellsTall;k++)for(let O=0;O<p.cellsLong;O++)c[t.cell.y+k][t.cell.x+O].hasItem=!0,c[t.cell.y+k][t.cell.x+O].itemId=t.item.id;t.item.initialElement=document.querySelector(`.App #${t.cell.toId()}.cell:not(.cell-border)`),E(k=>[...k,t.item])}f([...c]),setTimeout(()=>{$(!1)},500)},100)}}async function st(){const e=new URLSearchParams(window.location.search),l=e.get("companyId"),n=e.get("areaId"),c=e.get("areaId")||"",i=e.get("companyId")||"",s=e.get("templateId")||"",t=await jt(i,c),m=e.get("type")||"";let r=!1;if(m==="create-template")Ce(!0);else if(m==="edit-template"){Ve(!0);const g=t.templates.find(u=>u.id===s);g&&(lt(g),Ee(g.name))}else if(m==="view-design"){r=!0,Xe(!0);const g=e.get("designName")||"";ye(g);const u=e.get("designId")||"";xe(u)}else if(m==="view-area")Ke(!0);else if(m==="edit-design"){r=!0,$e(!0);const g=e.get("designName")||"";ye(g);const u=e.get("designId")||"";xe(u)}else if(m==="client-edit-design"){r=!0,_e(!0);const g=e.get("designName")||"";ye(g);const u=e.get("designId")||"";xe(u)}l&&et(l),n&&tt(n),Y(t.inventoryItems.map(g=>new ue({item:new C({id:g.item.id,name:g.item.name,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,initialElement:g.item.initialElement,moveable:g.item.moveable,starterItem:g.item.starterItem,displayItem:!0}),quantity:g.quantity})));const p=[],k=[];for(const g of t.templates){const u=[],D=[];for(const z of g.sections)u.push(new U({name:z.name,cellId:new w({x:z.cellId.x/(o?20:10),y:z.cellId.y/(o?20:10)}),cellsLong:z.cellsLong/(o?20:10),cellsTall:z.cellsTall/(o?20:10),startingItems:z.startingItems.map(F=>new V({cell:new w({x:F.cell.x/(o?2:1),y:F.cell.y/(o?2:1)}),item:new C({id:F.item.id,name:F.item.name,cellsLong:F.item.cellsLong/2,cellsTall:F.item.cellsTall/2,icon:F.item.icon,starterItem:!0,moveable:F.item.moveable,rotation:F.item.rotation||0})}))})),D.push(new U({name:z.name,cellId:new w({x:z.cellId.x,y:z.cellId.y}),cellsLong:z.cellsLong,cellsTall:z.cellsTall,startingItems:z.startingItems.map(F=>new V({cell:new w({x:F.cell.x,y:F.cell.y}),item:new C({id:F.item.id,name:F.item.name,cellsLong:F.item.cellsLong,cellsTall:F.item.cellsTall,icon:F.item.icon,starterItem:!0,moveable:F.item.moveable,rotation:F.item.rotation||0})}))}));p.push(new te({name:g.name,sections:u,id:g.id,previewImage:g.previewImage})),k.push(new te({name:g.name,sections:D,id:g.id,previewImage:g.previewImage}))}Ne([...p]);const O=[],q=s===""?void 0:k.find(g=>g.id===s);if(console.log("TEMPLATE",q,"AREA",t),r){const g=await kt(i,c,e.get("designId")||"");if(g===null){window.location.href="/LayItOut/DNF/";return}ie([...g.sections]),_([...g.sections.map(u=>new U({name:u.name,cellId:new w({x:u.cellId.x/10,y:u.cellId.y/10}),cellsLong:u.cellsLong/10,cellsTall:u.cellsTall/10,startingItems:u.startingItems,items:u.startingItems.map(D=>new C({id:D.item.id,name:D.item.name,sectionCell:D.cell,cellsLong:D.item.cellsLong,cellsTall:D.item.cellsTall,icon:D.item.icon,moveable:D.item.moveable,starterItem:D.item.starterItem,rotation:D.item.rotation}))}))]),O.push(...g.sections.map(u=>new U({name:u.name,cellId:new w({x:u.cellId.x/10,y:u.cellId.y/10}),cellsLong:u.cellsLong/10,cellsTall:u.cellsTall/10,startingItems:u.startingItems,items:u.startingItems.map(D=>new C({id:D.item.id,name:D.item.name,sectionCell:D.cell,cellsLong:D.item.cellsLong,cellsTall:D.item.cellsTall,icon:D.item.icon,moveable:D.item.moveable,starterItem:D.item.starterItem,rotation:D.item.rotation}))})))}else q!==void 0?(ie([...q.sections]),_([...q.sections.map(g=>new U({name:g.name,cellId:new w({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(u=>new C({id:u.item.id,name:u.item.name,sectionCell:u.cell,cellsLong:u.item.cellsLong,cellsTall:u.item.cellsTall,icon:u.item.icon,moveable:u.item.moveable,starterItem:u.item.starterItem,rotation:u.item.rotation}))}))]),O.push(...q.sections.map(g=>new U({name:g.name,cellId:new w({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(u=>new C({id:u.item.id,name:u.item.name,cellsLong:u.item.cellsLong,cellsTall:u.item.cellsTall,icon:u.item.icon,moveable:u.item.moveable,starterItem:u.item.starterItem,rotation:u.item.rotation,sectionCell:u.cell}))})))):(ie([...t.sections]),_([...t.sections.map(g=>new U({name:g.name,cellId:new w({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(u=>new C({id:u.item.id,name:u.item.name,sectionCell:u.cell,cellsLong:u.item.cellsLong,cellsTall:u.item.cellsTall,icon:u.item.icon,moveable:u.item.moveable,starterItem:u.item.starterItem,rotation:u.item.rotation}))}))]),O.push(...t.sections.map(g=>new U({name:g.name,cellId:new w({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(u=>new C({id:u.item.id,name:u.item.name,sectionCell:u.cell,cellsLong:u.item.cellsLong,cellsTall:u.item.cellsTall,icon:u.item.icon,moveable:u.item.moveable,starterItem:u.item.starterItem,rotation:u.item.rotation}))}))));console.log("SECTIONS TO GENERATE",O),nt(O)}I.useEffect(()=>{st()},[]);function ot(e,l,n){if(!o||e==null)return;const c=[...n],i=[],s=n.find(t=>t.name==e);console.log("NEW SECTION",s),console.log("Adding section",s.name,s.cellId),console.log("MOBILE CELLS",l),s.cellElement=document.querySelector(`.App #${s.name.split(" ").join("-")} #${s.name.split(" ").join("")}${s.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",s.cellElement);for(const t of s.startingItems){console.log("Placing starting item",t.item.name,t.cell);const m=k=>{const O=k%2===1;return{cellsLong:O?t.item.cellsTall:t.item.cellsLong,cellsTall:O?t.item.cellsLong:t.item.cellsTall}},r=t.item.rotation||0,p=m(r);for(let k=0;k<p.cellsTall;k++)for(let O=0;O<p.cellsLong;O++){const q=l.find(g=>g.sectionName===s.name);q.cells[t.cell.y+k][t.cell.x+O].hasItem=!0,q.cells[t.cell.y+k][t.cell.x+O].itemId=t.item.id}t.item.initialElement=document.querySelector(`.App #${s.name.split(" ").join("-")} #${s.name.split(" ").join("")}${t.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",t.item.initialElement),i.push(new C({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,initialElement:t.item.initialElement,starterItem:!0,moveable:t.item.moveable,rotation:t.item.rotation}))}console.log("Setting sections",c),_([...c]),console.log("ITEMS",i),E(t=>[...t.filter(r=>!i.some(p=>p.id===r.id)),...i.map(r=>new C({id:r.id,name:r.name,cellsLong:r.cellsLong,cellsTall:r.cellsTall,icon:r.icon,initialElement:r.initialElement,starterItem:!0,moveable:r.moveable,rotation:r.rotation}))])}function Pe(e){let l=[];return e.map(n=>l=[...l,...n]),l}function De(e,l){console.log(e);const n=o?W.find(t=>t.sectionName===A).cells:H,c=n[e.y].length,i=n.length;if(console.log(c,i),e.x+l.cellsLong>c||e.y+l.cellsTall>i)return!1;const s=ee(e,b);if(!s&&!o)return console.log("Item is out of bounds of any section"),!1;for(let t=0;t<l.cellsTall;t++)for(let m=0;m<l.cellsLong;m++){if(!o){const r=ee(new w({x:e.x+m,y:e.y+t}),b);if(!r)return console.log("Item is out of bounds of any section"),!1;if(r.name!=s.name)return console.log("Item is crossing section boundaries"),!1}if(n[e.y+t][e.x+m].hasItem&&n[e.y+t][e.x+m].itemId!=l.id)return console.log("Something is already here"),!1}return!0}function at(e,l,n){const c=Array.from(o?W.find(t=>t.sectionName===A).cells:H);if(n!=null){console.log("Removing item");const t=o?b.find(m=>m.name===A):ee(n,b);t.items=t.items.filter(m=>m.id!=l.id);for(let m=0;m<l.cellsTall;m++)for(let r=0;r<l.cellsLong;r++)c[n.y+m][n.x+r].hasItem=!1,c[n.y+m][n.x+r].itemId=""}const i=o?b.find(t=>t.name===A):ee(e,b),s=new w({x:e.x-i.cellId.x,y:e.y-i.cellId.y});l.sectionCell=s,console.log("Adding item to section",i.name,"at",s,l),i.items.push(l);for(let t=0;t<l.cellsTall;t++)for(let m=0;m<l.cellsLong;m++)c[e.y+t][e.x+m].hasItem=!0,c[e.y+t][e.x+m].itemId=l.id;if(console.log(c),o){const t=W.find(m=>m.sectionName===A);t&&(t.cells=c.map(m=>m.map(r=>({...r}))),K([...W]))}else f(c);if(console.log("Removing item from inventory",l.name),!l.hasMoved){const t=Z.findIndex(m=>m.item.name==l.name&&!m.item.hasMoved);if(t!==-1){const m=[...Z];m[t].quantity-=1,m[t].quantity<=0&&m.splice(t,1),Y(m)}else Y(Z)}E(t=>(console.log("Placing item",l.id),console.log("Updating item",l.id),t.find(m=>m.id==l.id).hasMoved||(t.find(m=>m.id==l.id).hasMoved=!0),t))}function it(e){G.find(l=>l.name==e.name&&!l.hasMoved&&!l.starterItem)||E(l=>[...l,e])}function Ge(e){console.log("Removing item",e.id),E(l=>l.filter(n=>n.id!=e.id))}function ct(e,l){const n=Array.from(o?W.find(m=>m.sectionName===A).cells:H),c=m=>{const r=m%2===1;return{cellsWide:r?e.cellsTall:e.cellsLong,cellsTall:r?e.cellsLong:e.cellsTall}},i=e.rotation||0,s=c(i);for(let m=0;m<s.cellsTall;m++)for(let r=0;r<s.cellsWide;r++)n[l.y+m][l.x+r].hasItem=!1,n[l.y+m][l.x+r].itemId="";if(o){const m=W.find(r=>r.sectionName===A);m&&(m.cells=n.map(r=>r.map(p=>({...p}))),K([...W])),K(r=>r.map(p=>p.sectionName===A?{...p,cells:n}:p))}else f(n);const t=o?b.find(m=>m.name===A):ee(l,b);t.items=t.items.filter(m=>m.id!=e.id),console.log("DELETING ITEM",e.id),E(m=>(console.log(),m.filter(r=>r.id!=e.id))),Y(m=>{const r=m.findIndex(p=>p.item.name==e.name&&!p.item.hasMoved);if(r!==-1){const p=[...m];return p[r].quantity+=1,p}else return[...m,new ue({item:new C({id:e.id,name:e.name,cellsLong:s.cellsWide,cellsTall:s.cellsTall,icon:e.icon}),quantity:1})]})}function mt(e,l){const n=Array.from(o?W.find(r=>r.sectionName===A).cells:H);console.log("DELETING ITEM ROTATE",e.id,e.rotation);const c=r=>{const p=r%2===1;return{cellsWide:p?e.cellsTall:e.cellsLong,cellsTall:p?e.cellsLong:e.cellsTall}},i=e.rotation||0,s=c(i);for(let r=0;r<s.cellsTall;r++)for(let p=0;p<s.cellsWide;p++)console.log("Deleting cell",l.y+r,l.x+p),n[l.y+r][l.x+p].hasItem=!1,n[l.y+r][l.x+p].itemId="";if(o){const r=W.find(p=>p.sectionName===A);r&&(r.cells=n.map(p=>p.map(k=>({...k}))),K([...W])),K(p=>p.map(k=>k.sectionName===A?{...k,cells:n}:k))}else f(n);console.log("DELETING ITEM",e.id);const t=o?b.find(r=>r.name===A):ee(l,b);t.items=t.items.filter(r=>r.id!=e.id);const m=new w({x:l.x-t.cellId.x,y:l.y-t.cellId.y});e.sectionCell=m,t.items.push(e)}function rt(e,l){const n=o?W.find(s=>s.sectionName===A).cells:H,c=Array.from(n);if(n[e.y]==null){Me();return}const i=De(e,l);c.forEach(s=>s.forEach(t=>{t.mouseOver=!1,t.canPlaceItem=!1,t.mouseOverLocation=""}));for(let s=0;s<l.cellsTall;s++)for(let t=0;t<l.cellsLong;t++)e.y+s<c.length&&e.x+t<c[e.y+s].length&&(l.cellsLong===1&&l.cellsTall===1?c[e.y+s][e.x+t].mouseOverLocation="single":l.cellsTall===1?t===0?c[e.y+s][e.x+t].mouseOverLocation="leftFull":t===l.cellsLong-1?c[e.y+s][e.x+t].mouseOverLocation="rightFull":c[e.y+s][e.x+t].mouseOverLocation="middleFull":l.cellsLong===1?s===0?c[e.y+s][e.x+t].mouseOverLocation="topFull":s===l.cellsTall-1?c[e.y+s][e.x+t].mouseOverLocation="bottomFull":c[e.y+s][e.x+t].mouseOverLocation="middleVFull":s===0&&t===0?c[e.y+s][e.x+t].mouseOverLocation="topLeftCorner":s===0&&t===l.cellsLong-1?c[e.y+s][e.x+t].mouseOverLocation="topRightCorner":s===l.cellsTall-1&&t===0?c[e.y+s][e.x+t].mouseOverLocation="bottomLeftCorner":s===l.cellsTall-1&&t===l.cellsLong-1?c[e.y+s][e.x+t].mouseOverLocation="bottomRightCorner":s===0?c[e.y+s][e.x+t].mouseOverLocation="top":s===l.cellsTall-1?c[e.y+s][e.x+t].mouseOverLocation="bottom":t===0?c[e.y+s][e.x+t].mouseOverLocation="left":t===l.cellsLong-1?c[e.y+s][e.x+t].mouseOverLocation="right":c[e.y+s][e.x+t].mouseOverLocation="middle",c[e.y+s][e.x+t].mouseOver=!0,c[e.y+s][e.x+t].canPlaceItem=i);if(o){const s=W.find(t=>t.sectionName===A);s&&(s.cells=c.map(t=>t.map(m=>({...m}))),K([...W])),K(t=>t.map(m=>m.sectionName===A?{...m,cells:c}:m))}else f(c)}function Me(){console.log("Unhighlighting cells");const e=Array.from(o?W.find(l=>l.sectionName===A).cells:H);if(e.forEach(l=>l.forEach(n=>{n.mouseOver=!1,n.canPlaceItem=!1,n.mouseOverLocation=""})),o){const l=W.find(n=>n.sectionName===A);l&&(l.cells=e.map(n=>n.map(c=>({...c}))),K([...W])),K(n=>n.map(c=>c.sectionName===A?{...c,cells:e}:c))}else f(e)}I.useEffect(()=>{ot(A,W,b)},[A]),I.useEffect(()=>{const e=()=>{const l=G.find(n=>n.id===j);console.log("Unselecting item",j),T(null),l&&(v(n=>[...n,l.id]),console.log("Unselecting item",l.id),setTimeout(()=>{v(n=>n.filter(c=>c!==l.id))},300))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[j,G]);function dt(e){T(null),v(l=>[...l,e]),console.log("Unselecting item",e),setTimeout(()=>{v(l=>l.filter(n=>n!==e))},300)}function gt(e){const l=G.find(n=>n.id===j);console.log("Unselecting item",j),T(e),l&&(v(n=>[...n,l.id]),console.log("Unselecting item",l.id),setTimeout(()=>{v(n=>n.filter(c=>c!==l.id))},300))}function ut(e){Y(l=>[...l,e])}const ae=e=>{console.log("Preventing scroll"),e.preventDefault(),e.stopPropagation(),window.scrollTo(0,0)};return I.useEffect(()=>(Te?(window.addEventListener("scroll",ae),window.addEventListener("touchmove",ae,{passive:!1})):(window.removeEventListener("scroll",ae),window.removeEventListener("touchmove",ae)),()=>{window.removeEventListener("scroll",ae),window.removeEventListener("touchmove",ae)}),[Te]),a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"App",children:[a.jsx("h1",{className:"title",children:"LayItOut"}),a.jsx("br",{}),(ce||le)&&a.jsxs("div",{className:"template-name-row",children:[a.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),a.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:e=>Ee(e.target.value),value:se})]}),ne&&a.jsx("div",{className:"design-name-row",children:a.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",pe]})}),(ce||le)&&a.jsxs("div",{className:"template-creation",children:[a.jsxs("button",{className:"action-btn",onClick:()=>{if(se.trim()==""){alert("Please enter a template name");return}if(re.some(e=>e.name===se&&(le?e.id!==Oe.id:!0))){alert("Template with this name already exists");return}le?($(!0),setTimeout(async()=>{const e=b.map(l=>new U({name:l.name,cellId:new w({x:Q.find(n=>n.name==l.name).cellId.x*20,y:Q.find(n=>n.name==l.name).cellId.y*20}),cellsLong:l.cellsLong*10,cellsTall:l.cellsTall*10,startingItems:l.items.map(n=>new V({cell:new w({x:n.sectionCell.x,y:n.sectionCell.y}),item:new C({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),oe(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){oe(!1);const n=re.map(c=>c.id===Oe.id?(console.log("SECTION",b),new te({name:se,previewImage:l.newValue,sections:b.map(i=>new U({name:i.name,cellId:new w({x:c.sections.find(s=>s.name==i.name).cellId.x*(o?20:10),y:c.sections.find(s=>s.name==i.name).cellId.y*(o?20:10)}),cellsLong:i.cellsLong*10,cellsTall:i.cellsTall*10,startingItems:i.items.map(s=>new V({cell:new w({x:s.sectionCell.x,y:s.sectionCell.y}),item:new C({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:c.id})):new te({name:c.name,previewImage:c.previewImage,sections:c.sections.map(i=>new U({name:i.name,cellId:new w({x:i.cellId.x*(o?20:10),y:i.cellId.y*(o?20:10)}),cellsLong:i.cellsLong*(o?20:10),cellsTall:i.cellsTall*(o?20:10),startingItems:i.startingItems.map(s=>new V({cell:new w({x:s.cell.x*(o?2:1),y:s.cell.y*(o?2:1)}),item:new C({id:s.item.id,name:s.item.name,cellsLong:s.item.cellsLong*2,cellsTall:s.item.cellsTall*2,icon:s.item.icon,starterItem:s.item.starterItem,moveable:s.item.moveable,rotation:s.item.rotation})}))})),id:c.id}));Se(ge,me,n).then(()=>{console.log("Template updated successfully"),$(!1);const c=new URLSearchParams(window.location.search),i=c.get("companyId"),s=c.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${i}&areaId=${s}&type=view-area`})}})},500)):($(!0),setTimeout(async()=>{const e=b.map(l=>new U({name:l.name,cellId:new w({x:Q.find(n=>n.name==l.name).cellId.x*20,y:Q.find(n=>n.name==l.name).cellId.y*20}),cellsLong:l.cellsLong*10,cellsTall:l.cellsTall*10,startingItems:l.items.map(n=>new V({cell:new w({x:n.sectionCell.x,y:n.sectionCell.y}),item:new C({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),oe(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){oe(!1);const n=new te({name:se,previewImage:l.newValue,sections:b.map(i=>new U({name:i.name,cellId:new w({x:Q.find(s=>s.name==i.name).cellId.x*20,y:Q.find(s=>s.name==i.name).cellId.y*20}),cellsLong:i.cellsLong*10,cellsTall:i.cellsTall*10,startingItems:i.items.map(s=>new V({cell:new w({x:s.sectionCell.x,y:s.sectionCell.y}),item:new C({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:se+(Math.random()*1e4).toString()}),c=[...re.map(i=>new te({name:i.name,previewImage:i.previewImage,sections:i.sections.map(s=>new U({name:s.name,cellId:new w({x:s.cellId.x*(o?20:10),y:s.cellId.y*(o?20:10)}),cellsLong:s.cellsLong*(o?20:10),cellsTall:s.cellsTall*(o?20:10),startingItems:s.startingItems.map(t=>new V({cell:new w({x:t.cell.x*(o?2:1),y:t.cell.y*(o?2:1)}),item:new C({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong*2,cellsTall:t.item.cellsTall*2,icon:t.item.icon,starterItem:t.item.starterItem,moveable:t.item.moveable,rotation:t.item.rotation})}))})),id:i.id})),n];Se(ge,me,c).then(()=>{console.log("Template updated successfully"),$(!1);const i=new URLSearchParams(window.location.search),s=i.get("companyId"),t=i.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${s}&areaId=${t}&type=view-area`})}})},500))},children:[ce?"Create":"Save"," Template"]}),a.jsx("button",{className:"action-btn",onClick:()=>{Ce(!1),Ne([]),ie([]),_([]),K([]),ke([]),de(null)},children:"Cancel"})]}),qe&&a.jsxs("div",{className:"template-creation",children:[a.jsx("button",{className:"action-btn",onClick:()=>{$(!0),setTimeout(async()=>{const e=b.map(l=>new U({name:l.name,cellId:new w({x:Q.find(n=>n.name==l.name).cellId.x*20,y:Q.find(n=>n.name==l.name).cellId.y*20}),cellsLong:l.cellsLong*10,cellsTall:l.cellsTall*10,startingItems:l.items.map(n=>new V({cell:new w({x:n.sectionCell.x,y:n.sectionCell.y}),item:new C({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),oe(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){oe(!1);const n=new At({name:pe,previewImage:l.newValue,areaId:me,sections:b.map(c=>new U({name:c.name,cellId:new w({x:Q.find(i=>i.name==c.name).cellId.x*20,y:Q.find(i=>i.name==c.name).cellId.y*20}),cellsLong:c.cellsLong*10,cellsTall:c.cellsTall*10,startingItems:c.items.map(i=>new V({cell:new w({x:i.sectionCell.x,y:i.sectionCell.y}),item:new C({id:i.id,name:i.name,cellsLong:i.cellsLong,cellsTall:i.cellsTall,icon:i.icon,starterItem:!0,moveable:i.moveable,rotation:i.rotation})}))})),id:Re});Nt(ge,me,n).then(()=>{console.log("Design updated successfully"),$(!1)})}})},500)},children:"Save"}),a.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),we&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"loader-backdrop",children:a.jsx("div",{className:"loader"})})})," ",a.jsxs("div",{className:"layout",children:[!ne&&a.jsx(Rt,{isViewingDesign:ne,isEditingTemplate:le,isCreatingTemplate:ce,maxHeight:o?200:S,showAddCustomItem:()=>{Le.current?.showModal()},addDraggingItem:it,removeItem:Ge,inventoryItems:Z.map(e=>new ue({item:new C({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,displayItem:!0}),quantity:e.quantity}))}),o?a.jsxs("div",{className:"mobile-areas",style:{height:N+"px"},children:[a.jsx("img",{src:Ie,onClick:()=>{const e=b.findIndex(n=>n.name==A);if(e===-1)return;const l=(e-1+b.length)%b.length;de(b[l].name),console.log("Changing viewing section to",b[l].name)},className:"back-mobile-areas"}),ze.map((e,l)=>a.jsx(ve,{width:e.width,height:e.height,cells:Pe(W.find(n=>n.sectionName==e.sectionName).cells),id:e.sectionName,visibile:A==null?!0:e.sectionName==A,section:e.sectionName},l)),a.jsx("img",{src:Ie,onClick:()=>{const e=b.findIndex(n=>n.name==A);if(e===-1)return;const l=(e+1)%b.length;de(b[l].name),console.log("Changing viewing section to",b[l].name)},className:"forward-mobile-areas"})]}):a.jsx(ve,{width:d,height:S,cells:Pe(H)})]}),ne&&a.jsx("div",{className:"design-view",children:a.jsx("button",{className:"action-btn",onClick:()=>{window.location.href=`/LayItOut/Print/?companyId=${ge}&areaId=${me}&designName=${pe}&designId=${Re}`},children:"Print"})})]}),a.jsxs("div",{children:[b.map(e=>a.jsx(He,{takingPhoto:!1,section:e,visible:A==null?!0:e.name==A,cellSize:x},e.cellId.toId())),G.map(e=>a.jsx(ht,{cellSize:x,isViewingDesign:ne,removeItem:Ge,visible:o?!e.hasMoved&&!e.starterItem?!0:A==null?!1:e.starterItem?b.find(l=>l.name==A)?.startingItems.some(l=>l.item.id===e.id):b.find(l=>l.name==A)?.items.some(l=>l.id===e.id):!0,item:e,canPlaceItem:De,placeItem:at,deleteItemRotate:mt,highlightCells:rt,unHighlightCells:Me,deleteItem:ct,isSelected:j===e.id,onSelect:gt,isUnselecting:h.includes(e.id),onDeselect:()=>dt(e.id)},e.id))]}),o&&!we&&a.jsx("div",{className:"layout-icon",onClick:()=>{he.current?.showModal(),Ae(!0),console.log("Showing layout dialog")},children:a.jsx("img",{src:Pt,alt:""})}),!we&&!(ce||le||ne)&&a.jsx("div",{className:"template-icon",onClick:()=>{fe.current?.showModal(),je(!0),console.log("Showing template dialog")},children:a.jsx("img",{src:Dt,alt:""})}),a.jsx(Gt,{isViewingArea:Qe,dialogRef:fe,isOpen:Be,closeDialog:()=>{fe.current?.close(),je(!1)},templates:re}),a.jsx(Ot,{dialogRef:he,isOpen:Je,closeDialog:()=>{he.current?.close(),Ae(!1)},layoutSections:Q}),a.jsx(Mt,{dialogRef:Le,addInventoryItem:ut,closeDialog:()=>{Le.current?.close()}}),Te&&a.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:"http://localhost:5173/LayItOut/Preview/",width:J+20,height:B+20})]})}
