import{j as i,r as a}from"./index-QIV6qY6h.js";import{C as L,I as le}from"./firestore-eMuYHorM.js";function ue({id:e,mouseOver:E,canPlaceItem:D,hasItem:y,mouseOverLocation:$,inSection:g,section:d,size:C}){return i.jsx("div",{className:`cell ${E?"hovered":""} ${D?"legal":"illegal"} ${y?"hasItem":""} ${$} ${g?"":"outside"}`,id:`${d==null?"":d.split(" ").join("")}${e.toId()}`,style:{width:`${C}px`,height:`${C}px`},children:i.jsx("div",{className:"cell cell-border",id:`${d==null?"":d.split(" ").join("")}${e.toId()}`})})}function pe({width:e,height:E,cells:D,id:y,visibile:$,section:g}){return i.jsx("div",{className:`area ${$??!0?"":"invisible"}`,style:{width:`${e}px`,height:`${E}px`},id:y!=null?y.split(" ").join("-"):"",children:D.map(d=>i.jsx(ue,{size:d.size,id:d.id,canPlaceItem:d.canPlaceItem,mouseOver:d.mouseOver,hasItem:d.hasItem,itemId:d.itemId,mouseOverLocation:d.mouseOverLocation,inSection:d.inSection,section:g}))})}const se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAPCAYAAADtc08vAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAEKADAAQAAAABAAAADwAAAADW5XGhAAABRUlEQVQoFY2Tz0oDMRDGv4lgPXkUPAiCvfUBbD3VLoJoBUuPPoI+jlffQIqiUC9tb/45+QIF7bXFB9jDZjrZNptN090a2M0km++XyZdZ4rPGH4AdaN2mwddI4tLGtdo29nd7ILqExq2S1w1AW1DqlaPj0zK1Jwb3MZk+kBFw1DiHoieJkqJMAvHPrEPjcZwCNkGKxEaXAYogZeIAEELQlS3uUsPMmZdpm3W2eRnYSecJKou59WLzTVmR109mIzC+3Zy+N4a5sYsCAFerFRzuyT2jLpBPWRqD1aPUS+RkLvIAOfGFXGkfv9MmNF+LB0pgL9w6aTnpIso8CMQ5wzJPmDU0tWn4PrSgFLDpqsziDGKKLaErC6H/iO1uHmT575CY05N66qRnzqVtRau9D6GmMedInud1RbIqNmMafLwh0bIhxSB9MAfmu9CGVRsdYgAAAABJRU5ErkJggg==",ie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAGaADAAQAAAABAAAAGQAAAABY85deAAABrUlEQVRIDe1VPUsDQRB9ezk0GO0FwVhFBQtDWot09oqFCGopgp1ILoWNEEHRRmy0EmwEK7XxB1gIfjQWdmlFLEQRDcaM7y4f3O4lmJw2QhYuu29m3szeu2ECmGtZYsjKAVZk0HSFxVaAqNBL2ywiuIYjcwF/CIMqc0QhgwkoTBEnuCd9udaQU6s+3PKRbyIWsjhi4n2y83wOfVnyKOLEh0MdLb7BIgRpfCKFdeWghGMvk7DwK0axoa5CZdZIWbml9hnDNqLhXwKb/CFKdanlyak7D89LFB0INocWTLCHD0CVTHMVu0Wi1P29avD2jEyz8DYft9N+Xg4KUHJGeWewowomweb3uOddn2qOtNheEyg80rZJ/1fN1/iQoGsS3Tjn7jaQtmx+7GHNkkIfi8Ro22Xrbmm+RmBJOtHjSsb2r7OCeltwJXRXsbw18ftQi61yNVKwiOb+G9Au0pKObbn+g1w2XrxrlhBv+rpx9Fdiy1yDWPlnNKyO3HC0JDm33uhpOF19rC7GRxg/xjF14bN7x7pjgJ5xpl7g4BwgMWKSAljwzCKn9QoEYtuGnxT4Bng+WDuZ4k7PAAAAAElFTkSuQmCC";function he({item:e,canPlaceItem:E,placeItem:D,deleteItem:y,deleteItemRotate:$,isSelected:g,onSelect:d,onDeselect:C,isUnselecting:p,highlightCells:N,unHighlightCells:B,visible:O,removeItem:b,isViewingDesign:M,cellSize:c}){const[u,f]=a.useState(0),[r,x]=a.useState(0),S=a.useRef(null),[X,I]=a.useState(0),[V,j]=a.useState(0),[R,P]=a.useState(!1),[v,U]=a.useState(0),[A,Z]=a.useState(null),[q,J]=a.useState(!0),[H,ae]=a.useState(12),ce=a.useRef(null),[re,Ae]=a.useState(!0),Q=t=>{const l=t%2===1;return{width:l?e.cellsTall*c:e.cellsLong*c,height:l?e.cellsLong*c:e.cellsTall*c,cellsWide:l?e.cellsTall:e.cellsLong,cellsTall:l?e.cellsLong:e.cellsTall}},Y=t=>{const l=e.cellsLong*c,o=e.cellsTall*c;switch(t%4){case 0:return{x:0,y:0};case 1:return{x:(o-l)/2,y:(l-o)/2};case 2:return{x:0,y:0};case 3:return{x:(o-l)/2,y:(l-o)/2};default:return{x:0,y:0}}},z=()=>{const t=v+1,l=Q(t),o=le.fromDoc(e.toDoc());o.cellsLong=l.cellsWide,o.cellsTall=l.cellsTall,o.initialElement=e.initialElement,o.rotation=t,o.hasMoved=e.hasMoved;let n=A;if(!e.hasMoved&&e.rotation!=0||n&&E(L.fromString(n.id),o)){n==null&&(n=e.initialElement),console.log("ROTATE ITEM",e.id,"to rotation:",t,"at cell:",n?.id),U(t),$(e,L.fromString(n.id)),e.rotation=t;const h=Y(t),s=n.offsetLeft,m=n.offsetTop;f(s+h.x),x(m+h.y),I(s+h.x),j(m+h.y)}};function de(t){const l=S.current,o=window.getComputedStyle(l),n=document.createElement("span");n.style.font=o.font,n.style.fontSize=t+"px",n.style.fontFamily=o.fontFamily,n.style.fontWeight=o.fontWeight,n.style.position="absolute",n.style.visibility="hidden",n.style.whiteSpace="nowrap",n.textContent=l.textContent,document.body.appendChild(n);const h=n.offsetWidth;return document.body.removeChild(n),h}function _(t){if(S.current){const l=S.current;return de(t-1)>l.offsetWidth&&t-1>8?_(t-1):t-1}return t}a.useEffect(()=>{setTimeout(()=>{S.current&&ae(_(H)),e.isDisplayItem&&!e.hasMoved&&(console.log("Starting item as dragging item"),P(!0))},100)},[]),a.useEffect(()=>{e.initialElement!=null&&!e.hasMoved&&(console.log("Item initial element:",e.rotation),e.rotation&&setTimeout(()=>{console.log("Rotating item to initial rotation:",e.rotation);for(let t=0;t<e.rotation;t++)console.log("Rotating item",t+1,"times"),U(l=>{const o=(l+1)%4,n=Y(o),h=e.initialElement.offsetLeft,s=e.initialElement.offsetTop;return f(h+n.x),x(s+n.y),I(h+n.x),j(s+n.y),o})},100),e.initialElement&&!e.hasMoved&&(e.initialElement.classList.contains("cell")&&(console.log("Setting cell to initial element:",e.initialElement.children[0]),Z(e.initialElement.children[0])),f(e.initialElement.offsetLeft),x(e.initialElement.offsetTop),I(e.initialElement.offsetLeft),j(e.initialElement.offsetTop)))},[e]);const ee=()=>{if(R)return;if(A==null){f(e.initialElement.offsetLeft),I(e.initialElement.offsetLeft),x(e.initialElement.offsetTop),j(e.initialElement.offsetTop);return}const t=A.offsetTop,l=A.offsetLeft,o=Y(v);f(l+o.x),x(t+o.y),I(l+o.x),j(t+o.y)};a.useEffect(()=>(window.addEventListener("resize",ee),()=>{window.removeEventListener("resize",ee)}),[A,v,R]);const F=t=>{t.preventDefault()};a.useEffect(()=>{if(console.log("IS Dragging: ",R),R){I(u),j(r),document.body.addEventListener("touchmove",F,{passive:!1});const t=document.getElementById(e.id)?.getBoundingClientRect(),l=t?t.left-u:0,o=t?t.top-r:0;g&&C();const n=(s,m,T)=>{const K=Q(v),w=le.fromDoc(e.toDoc());w.cellsLong=K.cellsWide,w.cellsTall=K.cellsTall,w.initialElement=e.initialElement,w.rotation=v,w.hasMoved=e.hasMoved,w.id=e.id;let W=T;if(!W||!W.classList?.contains("cell")){const k=document.elementFromPoint(s,m);k?.classList?.contains("cell")&&(W=k)}W?.classList?.contains("cell")?N(L.fromString(W.id),w):B(),f(s-l),x(m-o+5)},h=(s,m)=>{console.log("Drag ended"),B(),document.body.removeEventListener("touchmove",F);const T=document.elementFromPoint(s,m);if(T?.classList?.contains("cell")){const K=Q(v),w={...e,cellsLong:K.cellsWide,cellsTall:K.cellsTall};if(!E(L.fromString(T.id),w)){if(e.isDisplayItem&&!e.hasMoved){console.log("Removing item from toolbox"),b(e);return}f(X),x(V),P(!1);return}const W=T.offsetTop,k=T.offsetLeft,te=Y(v),oe=k+te.x,ne=W+te.y;f(oe),x(ne),I(oe),j(ne),D(L.fromString(T.id),w,A!=null?L.fromString(A.id):null),console.log("Placed item at cell:",T),Z(T)}else{if(e.isDisplayItem&&!e.hasMoved){console.log("Removing item from toolbox"),b(e);return}f(X),x(V)}P(!1)};return document.onmousemove=s=>{s.preventDefault(),n(s.clientX,s.clientY,s.target)},document.onmouseup=s=>{h(s.clientX,s.clientY),document.onmousemove=null,document.onmouseup=null,document.ontouchmove=null,document.ontouchend=null},document.ontouchmove=s=>{s.preventDefault();const m=s.touches[0];n(m.clientX,m.clientY,s.target)},document.ontouchend=s=>{const m=s.changedTouches[0];h(m.clientX,m.clientY),document.removeEventListener("touchmove",F),document.onmousemove=null,document.onmouseup=null,document.ontouchmove=null,document.ontouchend=null},()=>{document.removeEventListener("touchmove",F)}}else document.onmousemove=null,document.onmouseup=null,document.ontouchmove=null,document.ontouchend=null,document.body.removeEventListener("touchmove",F)},[R,A,v]);const G=Q(v);function fe(){if(A){const t=v+1,l=Q(t),o={...e,cellsLong:l.cellsWide,cellsTall:l.cellsTall};console.log("Can place item at cell:",E(L.fromString(A?.id||""),o)),J(E(L.fromString(A.id),o))}else J(!1)}return u==0||r==0||!re?null:i.jsxs(i.Fragment,{children:[i.jsx("div",{id:e.id,ref:ce,className:`draggable-item ${R?"dragging":g?"selected":""} ${e.moveable?"":"not-moveable"} ${O?"":"invisible"}`,style:{top:`${r}px`,left:`${u}px`,width:`${e.cellsLong*(e.isDisplayItem&&!R&&!e.hasMoved?10:c)-(g?4:0)}px`,height:`${e.cellsTall*(e.isDisplayItem&&!R&&!e.hasMoved?10:c)-(g?4:0)}px`,rotate:`${v*90}deg`,transformOrigin:"center center",fontSize:`${H}px`},onMouseDown:e.moveable&&!M?()=>P(!0):void 0,onTouchStart:e.moveable&&!M?t=>{t.preventDefault(),P(!0)}:void 0,onClick:t=>{t.stopPropagation(),g?C():(fe(),d(e.id))},children:e.icon.includes("custom-")?i.jsx("div",{className:"custom-icon",children:i.jsx("div",{children:i.jsx("p",{ref:S,children:e.icon.split("custom-")[1]})})}):i.jsx("img",{src:e.icon,alt:"icon"})}),(g||p)&&i.jsx(i.Fragment,{children:/Mobi|Android/i.test(navigator.userAgent)?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:`draggable-item-options mobile-left ${p?"exiting":""}`,style:{top:`${r+e.cellsTall*c/2-10}px`,left:`${u+e.cellsLong*c/2-G.width/2-20}px`,width:"10px"},children:i.jsx("img",{src:ie,alt:"rotate",className:"rotate-icon"+(q?" can-rotate":" cannot-rotate"),onClick:t=>{t.stopPropagation(),z()}})}),i.jsx("div",{className:`draggable-item-options mobile-right ${p?"exiting":""}`,style:{top:`${r+e.cellsTall*c/2-10}px`,left:`${u+e.cellsLong*c/2+G.width/2+10}px`,width:"10px"},children:i.jsx("img",{src:se,alt:"delete",className:"delete-icon",onClick:t=>{t.stopPropagation(),y(e,L.fromString(A?.id||""))}})})]}):i.jsxs("div",{className:`draggable-item-options ${p?"exiting":""}`,style:{top:`${r+e.cellsTall*c/2-G.height/2-20}px`,left:`${u+e.cellsLong*c/2-G.width/2}px`,width:`${G.width}px`},children:[i.jsx("img",{src:ie,alt:"rotate",className:"rotate-icon"+(q?" can-rotate":" cannot-rotate"),onClick:t=>{t.stopPropagation(),z()}}),i.jsx("img",{src:se,alt:"delete",className:"delete-icon",onClick:t=>{t.stopPropagation(),y(e,L.fromString(A?.id||""))}})]})})]})}function xe({section:e,visible:E,cellSize:D,takingPhoto:y}){const[$,g]=a.useState(e.cellElement?.offsetLeft??0),[d,C]=a.useState(e.cellElement?.offsetTop??0),p=a.useRef(null),[N,B]=a.useState(16);function O(c){const u=p.current,f=window.getComputedStyle(u),r=document.createElement("span");r.style.font=f.font,r.style.fontSize=c+"px",r.style.fontFamily=f.fontFamily,r.style.fontWeight=f.fontWeight,r.style.position="absolute",r.style.visibility="hidden",r.style.whiteSpace="no-wrap",r.textContent=u.textContent,document.body.appendChild(r);const x=r.offsetWidth;return document.body.removeChild(r),x}function b(c){if(p.current){const u=p.current,f=O(c-1);return console.log("Current text width:",f),console.log("Paragraph width:",u.offsetWidth),f>u.offsetWidth&&N>6?(console.log("Decreasing font size to:",c-1),b(c-1)):c-1}return c}a.useEffect(()=>{setTimeout(()=>{p.current&&B(b(N))},100)},[]),a.useEffect(()=>{y?p.current&&B(b(48)):p.current&&B(b(16))},[y]);const M=()=>{e.cellElement!=null&&(g(e.cellElement.offsetLeft),C(e.cellElement.offsetTop))};return a.useEffect(()=>(window.addEventListener("resize",M),()=>{window.removeEventListener("resize",M)}),[e.cellElement]),e.cellElement&&i.jsx("div",{className:`section ${E??!0?"":"invisible"}`,style:{top:`${e.cellElement.offsetTop}px`,left:`${e.cellElement.offsetLeft}px`,width:`${e.cellsLong*D-2}px`,height:`${e.cellsTall*D-2}px`},children:i.jsx("h2",{className:"section-title",style:{fontSize:`${N}px`},ref:p,children:e.name})})}export{pe as A,he as D,xe as S};
