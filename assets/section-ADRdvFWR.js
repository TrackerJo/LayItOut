import{j as c,r as s}from"./index-QIV6qY6h.js";import{C as w,I as ce}from"./firestore-BzzbFXtm.js";function pe({id:a,mouseOver:L,canPlaceItem:e,hasItem:m,mouseOverLocation:B,inSection:b,section:f,size:p}){return c.jsx("div",{className:`cell ${L?"hovered":""} ${e?"legal":"illegal"} ${m?"hasItem":""} ${B} ${b?"":"outside"}`,id:`${f==null?"":f.split(" ").join("")}${a.toId()}`,style:{width:`${p}px`,height:`${p}px`},children:c.jsx("div",{className:"cell cell-border",id:`${f==null?"":f.split(" ").join("")}${a.toId()}`})})}function Ee({width:a,height:L,cells:e,id:m,visibile:B,section:b}){return c.jsx("div",{className:`area ${B??!0?"":"invisible"}`,style:{width:`${a}px`,height:`${L}px`},id:m!=null?m.split(" ").join("-"):"",children:e.map(f=>c.jsx(pe,{size:f.size,id:f.id,canPlaceItem:f.canPlaceItem,mouseOver:f.mouseOver,hasItem:f.hasItem,itemId:f.itemId,mouseOverLocation:f.mouseOverLocation,inSection:f.inSection,section:b}))})}const ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAPCAYAAADtc08vAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAEKADAAQAAAABAAAADwAAAADW5XGhAAABRUlEQVQoFY2Tz0oDMRDGv4lgPXkUPAiCvfUBbD3VLoJoBUuPPoI+jlffQIqiUC9tb/45+QIF7bXFB9jDZjrZNptN090a2M0km++XyZdZ4rPGH4AdaN2mwddI4tLGtdo29nd7ILqExq2S1w1AW1DqlaPj0zK1Jwb3MZk+kBFw1DiHoieJkqJMAvHPrEPjcZwCNkGKxEaXAYogZeIAEELQlS3uUsPMmZdpm3W2eRnYSecJKou59WLzTVmR109mIzC+3Zy+N4a5sYsCAFerFRzuyT2jLpBPWRqD1aPUS+RkLvIAOfGFXGkfv9MmNF+LB0pgL9w6aTnpIso8CMQ5wzJPmDU0tWn4PrSgFLDpqsziDGKKLaErC6H/iO1uHmT575CY05N66qRnzqVtRau9D6GmMedInud1RbIqNmMafLwh0bIhxSB9MAfmu9CGVRsdYgAAAABJRU5ErkJggg==",re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAGaADAAQAAAABAAAAGQAAAABY85deAAABrUlEQVRIDe1VPUsDQRB9ezk0GO0FwVhFBQtDWot09oqFCGopgp1ILoWNEEHRRmy0EmwEK7XxB1gIfjQWdmlFLEQRDcaM7y4f3O4lmJw2QhYuu29m3szeu2ECmGtZYsjKAVZk0HSFxVaAqNBL2ywiuIYjcwF/CIMqc0QhgwkoTBEnuCd9udaQU6s+3PKRbyIWsjhi4n2y83wOfVnyKOLEh0MdLb7BIgRpfCKFdeWghGMvk7DwK0axoa5CZdZIWbml9hnDNqLhXwKb/CFKdanlyak7D89LFB0INocWTLCHD0CVTHMVu0Wi1P29avD2jEyz8DYft9N+Xg4KUHJGeWewowomweb3uOddn2qOtNheEyg80rZJ/1fN1/iQoGsS3Tjn7jaQtmx+7GHNkkIfi8Ro22Xrbmm+RmBJOtHjSsb2r7OCeltwJXRXsbw18ftQi61yNVKwiOb+G9Au0pKObbn+g1w2XrxrlhBv+rpx9Fdiy1yDWPlnNKyO3HC0JDm33uhpOF19rC7GRxg/xjF14bN7x7pjgJ5xpl7g4BwgMWKSAljwzCKn9QoEYtuGnxT4Bng+WDuZ4k7PAAAAAElFTkSuQmCC";function ye({isCreatingArea:a,isCreatingTemplate:L,item:e,canPlaceItem:m,placeItem:B,deleteItem:b,deleteItemRotate:f,isSelected:p,onSelect:T,onDeselect:N,isUnselecting:I,highlightCells:V,unHighlightCells:M,visible:Y,removeItem:x,isViewingDesign:E,cellSize:r}){const[d,h]=s.useState(0),[W,R]=s.useState(0),P=s.useRef(null),[Z,j]=s.useState(0),[q,$]=s.useState(0),[C,Q]=s.useState(!1),[v,J]=s.useState(0),[u,H]=s.useState(null),[z,_]=s.useState(!0),[ee,de]=s.useState(12),fe=s.useRef(null),[ue,he]=s.useState(!0),[Ae,k]=s.useState(!1);s.useEffect(()=>(window.addEventListener("mousedown",()=>k(!0)),window.addEventListener("mouseup",()=>k(!1)),()=>{window.removeEventListener("mousedown",()=>k(!0)),window.removeEventListener("mouseup",()=>k(!1))}),[]);const F=t=>{const l=t%2===1;return{width:l?e.cellsTall*r:e.cellsLong*r,height:l?e.cellsLong*r:e.cellsTall*r,cellsWide:l?e.cellsTall:e.cellsLong,cellsTall:l?e.cellsLong:e.cellsTall}},O=t=>{const l=e.cellsLong*r,o=e.cellsTall*r;switch(t%4){case 0:return{x:0,y:0};case 1:return{x:(o-l)/2,y:(l-o)/2};case 2:return{x:0,y:0};case 3:return{x:(o-l)/2,y:(l-o)/2};default:return{x:0,y:0}}},te=()=>{const t=v+1,l=F(t),o=ce.fromDoc(e.toDoc());o.cellsLong=l.cellsWide,o.cellsTall=l.cellsTall,o.initialElement=e.initialElement,o.rotation=t,o.hasMoved=e.hasMoved;let n=u;if(!e.hasMoved&&e.rotation!=0||n&&m(w.fromString(n.id),o)){n==null&&(n=e.initialElement),console.log("ROTATE ITEM",e.id,"to rotation:",t,"at cell:",n?.id),J(t),f(e,w.fromString(n.id)),e.rotation=t;const g=O(t),i=n.offsetLeft,A=n.offsetTop;h(i+g.x),R(A+g.y),j(i+g.x),$(A+g.y)}};function me(t){const l=P.current,o=window.getComputedStyle(l),n=document.createElement("span");n.style.font=o.font,n.style.fontSize=t+"px",n.style.fontFamily=o.fontFamily,n.style.fontWeight=o.fontWeight,n.style.position="absolute",n.style.visibility="hidden",n.style.whiteSpace="nowrap",n.textContent=l.textContent,document.body.appendChild(n);const g=n.offsetWidth;return document.body.removeChild(n),g}function oe(t){if(P.current){const l=P.current;return me(t-1)>l.offsetWidth&&t-1>8?oe(t-1):t-1}return t}s.useEffect(()=>{setTimeout(()=>{P.current&&de(oe(ee)),e.isDisplayItem&&!e.hasMoved&&(console.log("Starting item as dragging item"),Q(!0))},100)},[]),s.useEffect(()=>{e.initialElement!=null&&(console.log("Item initial element:",e.rotation),e.rotation&&setTimeout(()=>{console.log("Rotating item to initial rotation:",e.rotation);for(let t=0;t<e.rotation;t++)console.log("Rotating item",t+1,"times"),J(l=>{const o=(l+1)%4,n=O(o),g=e.initialElement.offsetLeft,i=e.initialElement.offsetTop;return h(g+n.x),R(i+n.y),j(g+n.x),$(i+n.y),o})},100),e.initialElement&&(e.initialElement.classList.contains("cell")&&(console.log("Setting cell to initial element:",e.initialElement.children[0]),H(e.initialElement.children[0])),h(e.initialElement.offsetLeft),R(e.initialElement.offsetTop),j(e.initialElement.offsetLeft),$(e.initialElement.offsetTop)))},[e]);const ne=()=>{if(C)return;if(u==null){h(e.initialElement.offsetLeft),j(e.initialElement.offsetLeft),R(e.initialElement.offsetTop),$(e.initialElement.offsetTop);return}const t=u.offsetTop,l=u.offsetLeft,o=O(v);h(l+o.x),R(t+o.y),j(l+o.x),$(t+o.y)};s.useEffect(()=>(window.addEventListener("resize",ne),()=>{window.removeEventListener("resize",ne)}),[u,v,C]);const G=t=>{t.preventDefault()};s.useEffect(()=>{if(console.log("IS Dragging: ",C),C){j(d),$(W),document.body.addEventListener("touchmove",G,{passive:!1});const t=document.getElementById(e.id)?.getBoundingClientRect(),l=t?t.left-d:0,o=t?t.top-W:0;p&&N();const n=(i,A,D)=>{const X=F(v),y=ce.fromDoc(e.toDoc());y.cellsLong=X.cellsWide,y.cellsTall=X.cellsTall,y.initialElement=e.initialElement,y.rotation=v,y.hasMoved=e.hasMoved,y.id=e.id;let S=D;if(!S||!S.classList?.contains("cell")){const U=document.elementFromPoint(i,A);U?.classList?.contains("cell")&&(S=U)}S?.classList?.contains("cell")?V(w.fromString(S.id),y):M(),h(i-l),R(A-o+5),console.log("Is mouse down:",Ae)},g=(i,A)=>{console.log("Drag ended"),M(),document.body.removeEventListener("touchmove",G);const D=document.elementFromPoint(i,A);if(D?.classList?.contains("cell")){const X=F(v),y={...e,cellsLong:X.cellsWide,cellsTall:X.cellsTall};if(!m(w.fromString(D.id),y)){if(e.isDisplayItem&&!e.hasMoved){console.log("Removing item from toolbox"),x(e);return}h(Z),R(q),Q(!1);return}const S=D.offsetTop,U=D.offsetLeft,le=O(v),se=U+le.x,ie=S+le.y;h(se),R(ie),j(se),$(ie),B(w.fromString(D.id),y,u!=null?w.fromString(u.id):null),console.log("Placed item at cell:",D),H(D)}else{if(e.isDisplayItem&&!e.hasMoved){console.log("Removing item from toolbox"),x(e);return}h(Z),R(q)}Q(!1)};return document.onmousemove=i=>{i.preventDefault(),n(i.clientX,i.clientY,i.target)},document.onmouseup=i=>{g(i.clientX,i.clientY),document.onmousemove=null,document.onmouseup=null,document.ontouchmove=null,document.ontouchend=null},document.ontouchmove=i=>{i.preventDefault();const A=i.touches[0];n(A.clientX,A.clientY,i.target)},document.ontouchend=i=>{const A=i.changedTouches[0];g(A.clientX,A.clientY),document.removeEventListener("touchmove",G),document.onmousemove=null,document.onmouseup=null,document.ontouchmove=null,document.ontouchend=null},()=>{document.removeEventListener("touchmove",G)}}else document.onmousemove=null,document.onmouseup=null,document.ontouchmove=null,document.ontouchend=null,document.body.removeEventListener("touchmove",G)},[C,u,v]);const K=F(v);function ge(){if(u){const t=v+1,l=F(t),o={...e,cellsLong:l.cellsWide,cellsTall:l.cellsTall};console.log("Can place item at cell:",m(w.fromString(u?.id||""),o)),_(m(w.fromString(u.id),o))}else _(!1)}return d==0||W==0||!ue?null:c.jsxs(c.Fragment,{children:[c.jsx("div",{id:e.id,ref:fe,className:`draggable-item ${E?"viewing":""} ${e.isSectionModifier&&!e.moveable?"placed-modifier":""} ${e.isSectionModifier?e.sectionModifierType?.toString():""} ${C?"dragging":p?"selected":""} ${e.moveable?"":"not-moveable"} ${Y?"":"invisible"}`,style:{top:`${W}px`,left:`${d}px`,width:`${e.cellsLong*(e.isDisplayItem&&!C&&!e.hasMoved?10:r)-(p?4:0)-(e.sectionModifierType=="LeftWall"||e.sectionModifierType=="RightWall"||e.sectionModifierType?.includes("Corner")?1:0)}px`,height:`${e.cellsTall*(e.isDisplayItem&&!C&&!e.hasMoved?10:r)-(p?4:0)-(e.sectionModifierType=="TopWall"||e.sectionModifierType=="BottomWall"||e.sectionModifierType?.includes("Corner")?1:0)}px`,rotate:`${v*90}deg`,transformOrigin:"center center",fontSize:`${ee}px`},onMouseDown:(e.moveable||a||L)&&!E?()=>Q(!0):void 0,onTouchStart:(e.moveable||a||L)&&!E?t=>{t.preventDefault(),Q(!0)}:void 0,onClick:t=>{t.stopPropagation(),!(!e.moveable&&!a&&!L||E)&&(p?N():(ge(),T(e.id)))},children:e.isSectionModifier?null:e.icon.includes("custom-")?c.jsx("div",{className:e.isSectionItem?"custom-section":"custom-icon",children:c.jsx("div",{children:c.jsx("p",{ref:P,children:e.icon.split("custom-")[1]})})}):c.jsx("img",{src:e.icon,alt:"icon"})}),(p||I)&&c.jsx(c.Fragment,{children:/Mobi|Android/i.test(navigator.userAgent)?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:`draggable-item-options mobile-left ${I?"exiting":""}`,style:{top:`${W+e.cellsTall*r/2-10}px`,left:`${d+e.cellsLong*r/2-K.width/2-20}px`,width:"10px"},children:c.jsx("img",{src:re,alt:"rotate",className:"rotate-icon"+(z?" can-rotate":" cannot-rotate"),onClick:t=>{t.stopPropagation(),te()}})}),c.jsx("div",{className:`draggable-item-options mobile-right ${I?"exiting":""}`,style:{top:`${W+e.cellsTall*r/2-10}px`,left:`${d+e.cellsLong*r/2+K.width/2+10}px`,width:"10px"},children:c.jsx("img",{src:ae,alt:"delete",className:"delete-icon",onClick:t=>{t.stopPropagation(),b(e,w.fromString(u?.id||""))}})})]}):c.jsxs("div",{className:`draggable-item-options ${I?"exiting":""}`,style:{top:`${W+e.cellsTall*r/2-K.height/2-20}px`,left:`${d+e.cellsLong*r/2-K.width/2}px`,width:`${K.width}px`},children:[!e.isSectionModifier&&c.jsx("img",{src:re,alt:"rotate",className:"rotate-icon"+(z?" can-rotate":" cannot-rotate"),onClick:t=>{t.stopPropagation(),te()}}),c.jsx("img",{src:ae,alt:"delete",className:"delete-icon",onClick:t=>{t.stopPropagation(),b(e,w.fromString(u?.id||""))}})]})})]})}function we({section:a,visible:L,cellSize:e,takingPhoto:m}){const[B,b]=s.useState(a.cellElement?.offsetLeft??0),[f,p]=s.useState(a.cellElement?.offsetTop??0),T=s.useRef(null),[N,I]=s.useState(16);function V(x){const E=T.current,r=window.getComputedStyle(E),d=document.createElement("span");d.style.font=r.font,d.style.fontSize=x+"px",d.style.fontFamily=r.fontFamily,d.style.fontWeight=r.fontWeight,d.style.position="absolute",d.style.visibility="hidden",d.style.whiteSpace="no-wrap",d.textContent=E.textContent,document.body.appendChild(d);const h=d.offsetWidth;return document.body.removeChild(d),h}function M(x){if(T.current){const E=T.current,r=V(x-1);return console.log("Current text width:",r),console.log("Paragraph width:",E.offsetWidth),r>E.offsetWidth&&N>6?(console.log("Decreasing font size to:",x-1),M(x-1)):x-1}return x}s.useEffect(()=>{setTimeout(()=>{T.current&&I(M(N))},100)},[]),s.useEffect(()=>{m?T.current&&I(M(48)):T.current&&I(M(16))},[m]);const Y=()=>{a.cellElement!=null&&(b(a.cellElement.offsetLeft),p(a.cellElement.offsetTop))};return s.useEffect(()=>(window.addEventListener("resize",Y),()=>{window.removeEventListener("resize",Y)}),[a.cellElement]),a.cellElement&&c.jsx("div",{className:`section ${L??!0?"":"invisible"}`,style:{top:`${a.cellElement.offsetTop}px`,left:`${a.cellElement.offsetLeft}px`,width:`${a.cellsLong*e-2}px`,height:`${a.cellsTall*e-2}px`},children:c.jsx("h2",{className:"section-title",style:{fontSize:`${N}px`},ref:T,children:a.name})})}export{Ee as A,ye as D,we as S,ae as X};
