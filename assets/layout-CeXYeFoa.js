import{r as d,j as o,c as Pt}from"./index-QIV6qY6h.js";import{A as it,S as Wt,D as Ft}from"./section-Bl4_lSg3.js";import{I as w,s as Ee,e as ae,p as Gt,C as y,S as W,f as U,T as ue,D as at,u as ct,h as Yt,i as Ut,j as Ht,k as Jt,l as Bt,A as Zt,m as Xt}from"./firestore-Bko8voo4.js";import{F as ke}from"./add_custom_item_dialog-DQtvLDx8.js";function $t({inventoryItem:c,addDraggingItem:G,removeItem:H,setSelectedItem:C,tapAndPlaceMode:D}){const O=d.useRef(null),M=d.useRef(null),[E,B]=d.useState(12),[L,b]=d.useState(c.item);function S(p){const ee=M.current,I=window.getComputedStyle(ee),h=document.createElement("span");h.style.font=I.font,h.style.fontSize=p+"px",h.style.fontFamily=I.fontFamily,h.style.fontWeight=I.fontWeight,h.style.position="absolute",h.style.visibility="hidden",h.style.whiteSpace="nowrap",h.textContent=ee.textContent,document.body.appendChild(h);const P=h.offsetWidth;return document.body.removeChild(h),P}function J(p){if(M.current){const ee=M.current;return S(p-1)>ee.offsetWidth&&p-1>8?J(p-1):p-1}return p}return d.useEffect(()=>{setTimeout(()=>{M.current&&B(J(E))},100)},[]),o.jsxs("div",{className:"display",children:[o.jsx("div",{ref:O,id:c.item.id,className:c.item.isSectionItem?"display-section":`display-item ${c.item.isSectionModifier?c.item.sectionModifierType.toString():""}`,style:{width:`${c.item.cellsLong*10}px`,height:`${c.item.cellsTall*10}px`},onMouseDown:p=>{D||(p.preventDefault(),p.stopPropagation(),c.item.initialElement=O.current,c.item.id=c.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",c.item.id,"to initialElement",c.item.initialElement),b(new w({id:c.item.id,cellsLong:c.item.cellsLong,cellsTall:c.item.cellsTall,name:c.item.name,icon:c.item.icon,moveable:c.item.moveable,starterItem:c.item.starterItem,displayItem:c.item.isDisplayItem,isSectionItem:c.item.isSectionItem})),G(c.item))},onClick:p=>{D&&(p.preventDefault(),p.stopPropagation(),c.item.initialElement=O.current,c.item.id=c.item.name+(Math.random()*1e4).toString(),C(c.item))},onTouchStart:p=>{D||(p.preventDefault(),p.stopPropagation(),c.item.initialElement=O.current,c.item.id=c.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",c.item.id,"to initialElement",c.item.initialElement),b(new w({id:c.item.id,cellsLong:c.item.cellsLong,cellsTall:c.item.cellsTall,name:c.item.name,icon:c.item.icon,moveable:c.item.moveable,starterItem:c.item.starterItem,displayItem:c.item.isDisplayItem})),G(c.item))},children:c.item.isSectionModifier?null:c.item.icon.includes("custom-")?o.jsx("div",{className:c.item.isSectionItem?"custom-section":"custom-icon",children:o.jsx("div",{children:o.jsx("p",{ref:M,style:{fontSize:`${E}px`},children:c.item.icon.split("custom-")[1]})})}):o.jsx("img",{src:c.item.icon,alt:"icon"})}),o.jsx("p",{children:c.item.name}),c.quantity>0&&o.jsxs("p",{className:"quantity",children:["x",c.quantity]})]})}const zt="/LayItOut/assets/plus.circle-Ce3xm00a.png";function qt({inventoryItems:c,addDraggingItem:G,maxHeight:H,removeItem:C,showAddCustomItem:D,isCreatingTemplate:O,isEditingTemplate:M,isViewingDesign:E,tapAndPlaceMode:B,setSelectedItem:L,isModifyingSections:b}){return o.jsxs("div",{className:"toolbox",style:{maxHeight:H?`${H}px`:"200px"},children:[c.map(S=>o.jsx($t,{setSelectedItem:L,tapAndPlaceMode:B,inventoryItem:S,addDraggingItem:G,removeItem:C})),!(O||M||E||b)&&o.jsx("div",{className:"add-item",onClick:()=>{D()},children:o.jsx("img",{src:zt,alt:"Add Item"})})]})}function Vt({dialogRef:c,closeDialog:G,areaPreview:H}){return o.jsx("dialog",{ref:c,className:"layout-dialog",children:o.jsxs("div",{className:"layout-dialog-div",children:[o.jsx("h2",{children:"Layout"}),o.jsx("img",{src:H,alt:"Layout preview",className:"layout-dialog-preview"}),o.jsx("br",{}),o.jsx("button",{className:"layout-dialog-close",onClick:G,children:"Close"})]})})}const Qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",Kt="/LayItOut/assets/template-Cjj8EPhc.png";function _t({dialogRef:c,closeDialog:G,templates:H,isOpen:C,isViewingArea:D,selectTemplate:O,duplicateTemplate:M}){const[E,B]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[L,b]=d.useState([]),[S,J]=d.useState(!1),[p,ee]=d.useState([]);return d.useEffect(()=>{ee(H)},[H]),d.useEffect(()=>{if(C&&(console.log("Layout dialog opened, generating cells and sections",p),p.length!==0)){if(p.length==1){b([p[0].name]);return}b(E?[p[0].name]:[p[0].name,p[1].name])}},[C,p]),d.useEffect(()=>{const I=p.filter(h=>L.includes(h.name));console.log("Viewing templates:",L),I.sort((h,P)=>L.indexOf(h.name)-L.indexOf(P.name)),console.log("Generating templates for",I.map(h=>h.name))},[L,p]),o.jsx(o.Fragment,{children:o.jsx("dialog",{ref:c,className:"template-dialog",children:o.jsxs("div",{className:"template-dialog-div",children:[o.jsx("h2",{children:"Templates"}),o.jsxs("div",{className:"templates",children:[p.length>1&&p.filter(I=>!L.includes(I.name)).length>0&&o.jsx("img",{src:ke,onClick:()=>{if(E){const h=(p.findIndex(P=>P.name===L[0])-1+p.length)%p.length;b([p[h].name])}else b(I=>{const P=(p.findIndex(V=>V.name===I[0])-1+p.length)%p.length;return[p[P].name,I[0]]})},className:"back-mobile-areas"}),L.length===0&&o.jsx("div",{className:"no-templates",children:"No templates available"}),L.map(I=>o.jsxs("div",{className:"template",children:[o.jsx("img",{src:p.find(h=>h.name===I).previewImage,alt:I,className:"template-preview"}),o.jsx("h3",{children:I}),o.jsxs("div",{className:"template-actions",children:[o.jsx("button",{className:"template-select-btn",onClick:()=>{if(D){const h=new URLSearchParams(window.location.search),P=h.get("companyId"),V=h.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${P}&areaId=${V}&type=edit-template&templateId=${p.find(oe=>oe.name==I).id}`}else G(),O&&O(p.find(h=>h.name===I))},children:D?"Edit":"Select"}),D&&o.jsx("button",{className:"action-btn",onClick:()=>{S||(J(!0),M&&M(p.find(h=>h.name===I)))},children:"Duplicate"}),D&&o.jsx("button",{className:"action-btn",onClick:()=>{if(S)return;J(!0);const h=p.filter(A=>A.name!==I);ee(h),h.length==1?b([h[0].name]):h.length==0?b([]):b(E?[h[0].name]:[h[0].name,h[1].name]);const P=new URLSearchParams(window.location.search),V=P.get("companyId"),oe=P.get("areaId");Ee(V,oe,h).then(()=>{J(!1)})},children:"Delete"})]})]})),p.length>1&&p.filter(I=>!L.includes(I.name)).length>0&&o.jsx("img",{src:ke,onClick:()=>{if(E){const h=(p.findIndex(P=>P.name===L[0])+1)%p.length;b([p[h].name])}else b(I=>{const P=(p.findIndex(V=>V.name===I[I.length-1])+1)%p.length;return[I[1],p[P].name]})},className:"forward-mobile-areas"})]}),D&&o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"action-btn",onClick:()=>{const I=new URLSearchParams(window.location.search),h=I.get("companyId"),P=I.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${h}&areaId=${P}&type=create-template`},children:"Create new Template"})," ",o.jsx("br",{})]}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:G,children:"Close"}),S&&C&&o.jsx(o.Fragment,{children:o.jsx("div",{className:"loader"})})]})})})}function el({dialogRef:c,closeDialog:G,addInventoryItem:H}){const[C,D]=d.useState(""),[O,M]=d.useState(1),[E,B]=d.useState(1),[L,b]=d.useState(1);return o.jsx("dialog",{ref:c,className:"custom-item-dialog",children:o.jsxs("div",{className:"custom-item-dialog-div",children:[o.jsx("h2",{children:"Add Custom Item"}),o.jsxs("div",{className:"custom-item-row",children:[o.jsx("label",{htmlFor:"item-name",children:"Name:"}),o.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:S=>D(S.target.value??""),value:C})]}),o.jsxs("div",{className:"custom-item-row",children:[o.jsx("label",{htmlFor:"item-icon",children:"Count:"}),o.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:O,onChange:S=>M(parseInt(S.target.value)??1)})]}),o.jsxs("div",{className:"custom-item-row custom-item-size",children:[o.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),o.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:E,onChange:S=>B(parseFloat(S.target.value)??1)}),o.jsx("span",{children:" x "}),o.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:L,onChange:S=>b(parseFloat(S.target.value)??1)})]}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:()=>{if(C.trim()===""){alert("Item name cannot be empty");return}const S=new ae({quantity:O,item:new w({id:C+(Math.random()*1e4).toString(),name:C,icon:`custom-${C}`,cellsLong:Math.ceil(E),cellsTall:Math.ceil(L),moveable:!0,starterItem:!1,displayItem:!0})});H(S),D(""),M(1),B(1),b(1),G()},children:"Add Item"}),o.jsx("br",{}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:G,children:"Close"})]})})}function tl({dialogRef:c,closeDialog:G,addSection:H}){const[C,D]=d.useState(""),[O,M]=d.useState(1),[E,B]=d.useState(1);return o.jsx("dialog",{ref:c,className:"section-dialog",children:o.jsxs("div",{className:"section-dialog-div",children:[o.jsx("h2",{children:"Add Section"}),o.jsxs("div",{className:"section-row",children:[o.jsx("label",{htmlFor:"section-name",children:"Name:"}),o.jsx("input",{type:"text",id:"section-name",name:"section-name",onChange:L=>D(L.target.value??""),value:C})]}),o.jsxs("div",{className:"section-row section-size",children:[o.jsx("label",{htmlFor:"section-width",children:"Size (in feet):"}),o.jsx("input",{type:"number",id:"section-width",name:"section-width",min:"1",value:O,onChange:L=>M(parseFloat(L.target.value)??1)}),o.jsx("span",{children:" x "}),o.jsx("input",{type:"number",id:"section-height",name:"section-height",min:"1",value:E,onChange:L=>B(parseFloat(L.target.value)??1)})]}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:()=>{if(C.trim()===""){alert("Section name cannot be empty");return}const L=new ae({quantity:1,item:new w({id:C+(Math.random()*1e4).toString(),name:C,icon:`custom-${C}`,cellsLong:Math.ceil(O),cellsTall:Math.ceil(E),moveable:!0,starterItem:!1,displayItem:!0,isSectionItem:!0})});H(L),D(""),M(1),B(1),G()},children:"Add Section"}),o.jsx("br",{}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:G,children:"Close"})]})})}function ll({dialogRef:c,closeDialog:G,addInventoryItem:H}){const[C,D]=d.useState(null),[O,M]=d.useState(""),[E,B]=d.useState(1),[L,b]=d.useState(1),[S,J]=d.useState(1),[p,ee]=d.useState(!0);return o.jsx("dialog",{ref:c,className:"inventory-item-dialog",children:o.jsxs("div",{className:"inventory-item-dialog-div",children:[o.jsx("h2",{children:"Add Inventory Item"}),C==null?o.jsxs(o.Fragment,{children:["  ",o.jsx("label",{htmlFor:"",children:"Premade Items:"}),o.jsx("div",{className:"inventory-item-list",children:Gt.map(I=>o.jsx("div",{className:"inventory-item",onClick:()=>{const h=new ae({quantity:1,item:new w({id:I.name+(Math.random()*1e4).toString(),name:I.name,icon:I.icon,cellsLong:I.cellsLong,cellsTall:I.cellsTall,moveable:!0,starterItem:!1,displayItem:!0})});D(h)},children:o.jsxs("div",{className:"inventory-item-display",children:[o.jsx("img",{src:I.icon,alt:"icon"}),o.jsx("p",{children:I.name}),o.jsxs("p",{className:"quantity",children:[I.cellsLong,"ft x ",I.cellsTall,"ft"]})]})},I.name))}),o.jsx("label",{htmlFor:"",children:"Or:"}),o.jsx("label",{htmlFor:"",children:"Custom Item:"}),o.jsxs("div",{className:"inventory-item-row",children:[o.jsx("label",{htmlFor:"item-name",children:"Name:"}),o.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:I=>M(I.target.value??""),value:O})]}),o.jsxs("div",{className:"inventory-item-row",children:[o.jsx("label",{htmlFor:"item-icon",children:"Count:"}),o.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:E,onChange:I=>B(parseInt(I.target.value)??1)})]}),o.jsxs("div",{className:"inventory-item-row inventory-item-size",children:[o.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),o.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:L,onChange:I=>b(parseFloat(I.target.value)??1)}),o.jsx("span",{children:" x "}),o.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:S,onChange:I=>J(parseFloat(I.target.value)??1)})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),o.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:p,onChange:I=>ee(I.target.checked)})]}),o.jsx("br",{})]}):o.jsxs(o.Fragment,{children:[o.jsxs("label",{htmlFor:"",children:["Item: ",C.item.name]}),o.jsxs("div",{className:"inventory-item-row",children:[o.jsx("label",{htmlFor:"item-icon",children:"Count:"}),o.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:E,onChange:I=>B(parseInt(I.target.value)??1)})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),o.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:p,onChange:I=>ee(I.target.checked)})]})]}),o.jsx("br",{}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:()=>{if(O.trim()===""&&C==null){alert("Item name cannot be empty");return}if(E<=0){alert("Item count must be greater than zero");return}let I=C;I==null?I=new ae({quantity:E,item:new w({id:O+(Math.random()*1e4).toString(),name:O,icon:`inventory-${O}`,cellsLong:Math.ceil(L),cellsTall:Math.ceil(S),moveable:p,starterItem:!1,displayItem:!0})}):(I.quantity=E,I.item.moveable=p),H(I),ee(!0),D(null),M(""),B(1),b(1),J(1),G()},children:"Add Item"}),o.jsx("button",{className:"action-btn",onClick:G,children:"Close"})]})})}function nl({item:c,setSelectingItem:G,canPlaceItem:H,placeItem:C,highlightCells:D,unHighlightCells:O,cellSize:M}){const[E,B]=d.useState(0),[L,b]=d.useState(0),S=d.useRef(null),[J,p]=d.useState(0),[ee,I]=d.useState(0),[h,P]=d.useState(!1),[V,oe]=d.useState(0),[A,me]=d.useState(null),[re,ve]=d.useState(!0),[Re,ce]=d.useState(12),[pe,Oe]=d.useState(null),Le=d.useRef(null),[Pe,Qe]=d.useState(!0),ye=d.useCallback(j=>{const k=j%2===1;return{width:k?c.cellsTall*M:c.cellsLong*M,height:k?c.cellsLong*M:c.cellsTall*M,cellsWide:k?c.cellsTall:c.cellsLong,cellsTall:k?c.cellsLong:c.cellsTall}},[c,M]);function Ke(j){const k=S.current,X=window.getComputedStyle(k),F=document.createElement("span");F.style.font=X.font,F.style.fontSize=j+"px",F.style.fontFamily=X.fontFamily,F.style.fontWeight=X.fontWeight,F.style.position="absolute",F.style.visibility="hidden",F.style.whiteSpace="nowrap",F.textContent=k.textContent,document.body.appendChild(F);const Ie=F.offsetWidth;return document.body.removeChild(F),Ie}function Ae(j){if(S.current){const k=S.current;return Ke(j-1)>k.offsetWidth&&j-1>8?Ae(j-1):j-1}return j}d.useEffect(()=>{setTimeout(()=>{S.current&&ce(Ae(Re))},100)},[]),d.useEffect(()=>{if(c){P(!0);const j=Le.current?.getBoundingClientRect();Oe({x:j?j.left-E:0,y:j?j.top-L:0})}else console.log("No item to place, stopping dragging"),P(!1),Oe(null),B(0),b(0),p(0),I(0),oe(0),me(null),ve(!0),ce(12),Qe(!0)},[c]);const Z=j=>{j.preventDefault()},fe=d.useCallback((j,k,X)=>{if(c==null||!h||!pe)return;console.log("PLACING MOVE",c);const F=X.target,Ie=ye(V),R=w.fromDoc(c.toDoc());R.cellsLong=Ie.cellsWide,R.cellsTall=Ie.cellsTall,R.initialElement=c.initialElement,R.rotation=V,R.hasMoved=c.hasMoved,R.id=c.id;let Q=F;if(!Q||!Q.classList?.contains("cell")){const N=document.elementFromPoint(j,k);N?.classList?.contains("cell")&&(Q=N)}Q?.classList?.contains("cell")?D(y.fromString(Q.id),R):O(),B(j-pe.x),b(k-pe.y+5)},[c,h,E,L,pe,ye,V,D,O,Le]),v=d.useCallback(j=>{if(c==null)return;const k=j.clientX,X=j.clientY;console.log("Drag ended"),O(),document.body.removeEventListener("touchmove",Z);const F=document.elementFromPoint(k,X);if(!F?.classList?.contains("cell"))G();else{const Ie=ye(V),R={...c,cellsLong:Ie.cellsWide,cellsTall:Ie.cellsTall};if(!H(y.fromString(F.id),R))return;C(y.fromString(F.id),R,A!=null?y.fromString(A.id):null),console.log("Placed item at cell:",F)}},[c,V,G,H,C,A,O,J,ee]),de=d.useCallback(j=>{const k=j.clientX,X=j.clientY;fe(k,X,j)},[fe]),ge=d.useCallback(j=>{const k=j.touches[0],X=k.clientX,F=k.clientY;fe(X,F,j)},[fe]),we=d.useCallback(j=>{const k=j.changedTouches[0],X=k.clientX,F=k.clientY;v({clientX:X,clientY:F}),document.body.removeEventListener("touchmove",Z)},[v,Z]);return d.useEffect(()=>{if(h)return document.body.addEventListener("touchmove",Z,{passive:!1}),document.addEventListener("mousemove",de),document.addEventListener("mouseup",v),document.addEventListener("touchmove",ge),document.addEventListener("touchend",we),()=>{document.body.removeEventListener("touchmove",Z),document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",v),document.removeEventListener("touchmove",ge),document.removeEventListener("touchend",we)}},[h,de,v,ge,we,Z]),E==0||L==0||!Pe||c==null?o.jsx(o.Fragment,{}):o.jsx(o.Fragment,{children:o.jsx("div",{id:c.id,ref:Le,className:`draggable-item ${c.isSectionModifier&&!c.moveable?"placed-modifier":""} ${c.isSectionModifier?c.sectionModifierType?.toString():""} ${h?"dragging":""} ${c.moveable?"":"not-moveable"}`,style:{top:`${L}px`,left:`${E}px`,width:`${c.cellsLong*(c.isDisplayItem&&!h&&!c.hasMoved?10:M)-(c.sectionModifierType=="LeftWall"||c.sectionModifierType=="RightWall"||c.sectionModifierType?.includes("Corner")?1:0)}px`,height:`${c.cellsTall*(c.isDisplayItem&&!h&&!c.hasMoved?10:M)-(c.sectionModifierType=="TopWall"||c.sectionModifierType=="BottomWall"||c.sectionModifierType?.includes("Corner")?1:0)}px`,rotate:`${V*90}deg`,transformOrigin:"center center",fontSize:`${Re}px`,zIndex:h?1e3:1},children:c.isSectionModifier?null:c.icon.includes("custom-")?o.jsx("div",{className:c.isSectionItem?"custom-section":"custom-icon",children:o.jsx("div",{children:o.jsx("p",{ref:S,children:c.icon.split("custom-")[1]})})}):o.jsx("img",{src:c.icon,alt:"icon"})})})}Pt.createRoot(document.getElementById("root")).render(o.jsx(ol,{}));function ol(){const[c,G]=d.useState(/Mobi|Android/i.test(navigator.userAgent)),[H,C]=d.useState(0),[D,O]=d.useState(0),[M,E]=d.useState(0),[B,L]=d.useState(0),[b,S]=d.useState([]),[J,p]=d.useState([]),[ee,I]=d.useState(0),[h,P]=d.useState(null),[V,oe]=d.useState([]),A=/Mobi|Android/i.test(navigator.userAgent)?5:10,[me,re]=d.useState([]),[ve,Re]=d.useState(!0),[ce,pe]=d.useState(null),[Oe,Le]=d.useState(null),[Pe,Qe]=d.useState([new w({id:"left-wall",name:"Left Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWall"}),new w({id:"right-wall",name:"Right Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWall"}),new w({id:"top-wall",name:"Top Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWall"}),new w({id:"bottom-wall",name:"Bottom Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWall"}),new w({id:"top-left-corner-wall",name:"Top Left Corner Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopLeftCornerWall"}),new w({id:"top-right-corner-wall",name:"Top Right Corner Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopRightCornerWall"}),new w({id:"bottom-left-corner-wall",name:"Bottom Left Corner Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomLeftCornerWall"}),new w({id:"bottom-right-corner-wall",name:"Bottom Right Corner Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomRightCornerWall"})]),ye=d.useRef(null),[Ke,Ae]=d.useState(!1),[Z,fe]=d.useState([]),[v,de]=d.useState([]),[ge,we]=d.useState([]),[j,k]=d.useState(!1),X=d.useRef(null),[F,Ie]=d.useState([]),[R,Q]=d.useState([]),[N,We]=d.useState(null),[Se,mt]=d.useState(!1),[xe,rt]=d.useState(!1),[be,dt]=d.useState(!1),[_e,gt]=d.useState(!1),[se,ut]=d.useState(!1),[le,Fe]=d.useState("placing-sections"),[sl,ft]=d.useState(!1),[It,pt]=d.useState(!1),[Ce,Ge]=d.useState(""),[De,ht]=d.useState(null),[je,et]=d.useState(""),[K,yt]=d.useState(""),[z,wt]=d.useState(""),[Ye,xt]=d.useState(null),[Ue,He]=d.useState(""),[Je,te]=d.useState(!0),[tt,Tt]=d.useState(null),[Be,he]=d.useState(!1),[vt,Lt]=d.useState(null),[St,Me]=d.useState(!1),Ze=d.useRef(null),Xe=d.useRef(null),$e=d.useRef(null);function Te(t,e){for(const s of e)if(t.x>=s.cellId.x&&t.x<s.cellId.x+s.cellsLong&&t.y>=s.cellId.y&&t.y<s.cellId.y+s.cellsTall)return s;return null}function bt(t,e,s,m){fe([...t.map(l=>new W({name:l.name,cellId:new y({x:l.cellId.x,y:l.cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,modifierItems:l.modifierItems.map(a=>new U({cell:new y({x:a.cell.x,y:a.cell.y}),item:new w({id:a.item.id,name:a.item.name,cellsLong:a.item.cellsLong,cellsTall:a.item.cellsTall,icon:a.item.icon,starterItem:!0,moveable:a.item.moveable,rotation:a.item.rotation||0,isSectionItem:a.item.isSectionItem,isSectionModifier:a.item.isSectionModifier,sectionModifierType:a.item.sectionModifierType,displayItem:a.item.isDisplayItem})})),startingItems:[]}))]);let i=H,n=D;if(c){for(const f of t)console.log("Generating cells for section",f.name,"at",f.cellId,"with size",f.cellsLong,"x",f.cellsTall),console.log("Needed section Width:",(f.cellsLong+f.cellId.x)*A,"Current width:",i),(f.cellsLong+f.cellId.x)*A>i&&(console.log("Added section Width:",f.cellsLong*A+f.cellId.x),i+=(f.cellsLong+f.cellId.x)*A-i),console.log("Needed section Height:",(f.cellsTall+f.cellId.y)*A,"Current height:",n),(f.cellsTall+f.cellId.y)*A>n&&(console.log("Added section Height:",f.cellsTall*A+f.cellId.y),n+=(f.cellsTall+f.cellId.y)*A-n);L(n/A*2),E(i/A*2);let l=0;const a=[],u=[];for(const f of t){const T=[],q={width:f.cellsLong*A,height:f.cellsTall*A,sectionName:f.name};q.height>l&&(l=q.height),Ie(ie=>[...ie,q]),f.cellId.x=0,f.cellId.y=0,[...Array(q.height/A).keys()].map(ie=>{const $=[];[...Array(q.width/A).keys()].map(_=>{$.push({id:new y({x:_,y:ie}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:A})}),T.push($)}),a.push({sectionName:f.name,cells:[...T]}),u.push(f)}Q(a),de(u),I(l),We(t[0]?t[0].name:null),setTimeout(()=>{te(!1)},500)}else{const l=[];for(const a of t)console.log("Generating cells for section",a.name,"at",a.cellId,"with size",a.cellsLong,"x",a.cellsTall),console.log("Needed section Width:",a.cellsLong+a.cellId.x,"Current width:",i),a.cellsLong+a.cellId.x>i&&(console.log("Added section Width:",a.cellsLong+a.cellId.x),i+=a.cellsLong+a.cellId.x-i),console.log("Needed section Height:",a.cellsTall+a.cellId.y,"Current height:",n),a.cellsTall+a.cellId.y>n&&(console.log("Added section Height:",a.cellsTall+a.cellId.y),n+=a.cellsTall+a.cellId.y-n);C(e.width),O(e.height),E(e.width),L(e.height),console.log("Final width:",i,"Final height:",n),[...Array(e.height).keys()].map(a=>{const u=[];[...Array(e.width).keys()].map(f=>{console.log("Creating cell at",f,a,"with size",A,s),u.push({id:new y({x:f,y:a}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:s&&m=="placing-sections"?!0:Te(new y({x:f,y:a}),t)!=null,size:A})}),l.push(u)}),S([...l]),setTimeout(()=>{const a=[],u=[...t];for(const f of u)f.cellElement=document.querySelector(`.App #${f.cellId.toId()}.cell:not(.cell-border)`),a.push(...f.startingItems.map(T=>new U({cell:new y({x:f.cellId.x+T.cell.x,y:f.cellId.y+T.cell.y}),item:new w({id:T.item.id,name:T.item.name,cellsLong:T.item.cellsLong,cellsTall:T.item.cellsTall,icon:T.item.icon,initialElement:document.querySelector(`.App #${T.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:T.item.moveable,rotation:T.item.rotation||0})}))),a.push(...f.modifierItems.map(T=>new U({cell:new y({x:f.cellId.x+T.cell.x,y:f.cellId.y+T.cell.y}),item:new w({id:T.item.id,name:T.item.name,cellsLong:T.item.cellsLong,cellsTall:T.item.cellsTall,icon:T.item.icon,initialElement:document.querySelector(`.App #${T.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1,isSectionItem:T.item.isSectionItem,isSectionModifier:T.item.isSectionModifier,sectionModifierType:T.item.sectionModifierType,rotation:T.item.rotation||0})})));de([...u]);for(const f of a){const T=$=>{const _=$%2===1;return{cellsLong:_?f.item.cellsTall:f.item.cellsLong,cellsTall:_?f.item.cellsLong:f.item.cellsTall}},q=f.item.rotation||0,ie=T(q);for(let $=0;$<ie.cellsTall;$++)for(let _=0;_<ie.cellsLong;_++)l[f.cell.y+$][f.cell.x+_].hasItem=!0,l[f.cell.y+$][f.cell.x+_].itemId=f.item.id;f.item.initialElement=document.querySelector(`.App #${f.cell.toId()}.cell:not(.cell-border)`),p($=>[...$,f.item])}S([...l]),setTimeout(()=>{te(!1)},500)},100)}}async function jt(){const t=new URLSearchParams(window.location.search),e=t.get("companyId"),s=t.get("areaId"),m=t.get("areaId")||"",i=t.get("companyId")||"",n=t.get("templateId")||"",l=await Ut(i,m);if(l===null){window.location.href="/LayItOut/DNF/";return}xt(l),Lt(l.previewImage||null);const a=t.get("type")||"";let u=!1,f=!1,T="modify-sections";if(a==="create-template")mt(!0);else if(a==="edit-template"){rt(!0);const g=l.templates.find(r=>r.id===n);g&&(Tt(g),et(g.name))}else if(a==="view-design"){u=!0,dt(!0);const g=t.get("designName")||"";Ge(g);const r=t.get("designId")||"";He(r)}else if(a==="view-area")gt(!0);else if(a==="edit-design"){u=!0,ft(!0);const g=t.get("designName")||"";Ge(g);const r=t.get("designId")||"";He(r)}else if(a==="client-edit-design"){u=!0,pt(!0);const g=t.get("designName")||"";Ge(g);const r=t.get("designId")||"";He(r)}else if(a==="create-area"){f=!0,ut(!0);const g=t.get("stage");g==="placing-sections"?(T="placing-sections",Fe("placing-sections")):g==="modify-sections"?(Fe("modify-sections"),T="modify-sections",re(Pe.map(r=>new ae({item:new w({id:r.id,name:r.name,cellsLong:r.cellsLong,cellsTall:r.cellsTall,icon:r.icon,initialElement:r.initialElement,moveable:r.moveable,starterItem:r.starterItem,displayItem:!0,isSectionItem:r.isSectionItem,isSectionModifier:r.isSectionModifier,sectionModifierType:r.sectionModifierType}),quantity:-1})))):g==="placing-items"&&(Fe("placing-items"),T="placing-items",re(l.inventoryItems.map(r=>new ae({item:new w({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,initialElement:r.item.initialElement,moveable:r.item.moveable,starterItem:r.item.starterItem,displayItem:!0}),quantity:r.quantity}))))}e&&yt(e),s&&wt(s),f||re(l.inventoryItems.map(g=>new ae({item:new w({id:g.item.id,name:g.item.name,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,initialElement:g.item.initialElement,moveable:g.item.moveable,starterItem:g.item.starterItem,displayItem:!0}),quantity:g.quantity})));const q=[],ie=[];for(const g of l.templates){const r=[],Y=[];for(const ne of g.sections)r.push(new W({name:ne.name,cellId:new y({x:ne.cellId.x,y:ne.cellId.y}),cellsLong:ne.cellsLong,cellsTall:ne.cellsTall,modifierItems:ne.modifierItems.map(x=>new U({cell:new y({x:x.cell.x,y:x.cell.y}),item:new w({id:x.item.id,name:x.item.name,cellsLong:x.item.cellsLong,cellsTall:x.item.cellsTall,icon:x.item.icon,starterItem:!0,moveable:x.item.moveable,rotation:x.item.rotation||0,isSectionItem:x.item.isSectionItem,isSectionModifier:x.item.isSectionModifier,sectionModifierType:x.item.sectionModifierType,displayItem:x.item.isDisplayItem})})),startingItems:ne.startingItems.map(x=>new U({cell:new y({x:x.cell.x,y:x.cell.y}),item:new w({id:x.item.id,name:x.item.name,cellsLong:x.item.cellsLong,cellsTall:x.item.cellsTall,icon:x.item.icon,starterItem:!0,moveable:x.item.moveable,rotation:x.item.rotation||0})}))})),Y.push(new W({name:ne.name,cellId:new y({x:ne.cellId.x,y:ne.cellId.y}),cellsLong:ne.cellsLong,cellsTall:ne.cellsTall,modifierItems:ne.modifierItems.map(x=>new U({cell:new y({x:x.cell.x,y:x.cell.y}),item:new w({id:x.item.id,name:x.item.name,cellsLong:x.item.cellsLong,cellsTall:x.item.cellsTall,icon:x.item.icon,starterItem:!0,moveable:x.item.moveable,rotation:x.item.rotation||0,isSectionItem:x.item.isSectionItem,isSectionModifier:x.item.isSectionModifier,sectionModifierType:x.item.sectionModifierType,displayItem:x.item.isDisplayItem})})),startingItems:ne.startingItems.map(x=>new U({cell:new y({x:x.cell.x,y:x.cell.y}),item:new w({id:x.item.id,name:x.item.name,cellsLong:x.item.cellsLong,cellsTall:x.item.cellsTall,icon:x.item.icon,starterItem:!0,moveable:x.item.moveable,rotation:x.item.rotation||0})}))}));q.push(new ue({name:g.name,sections:r,inventoryItems:g.inventoryItems,id:g.id,previewImage:g.previewImage})),ie.push(new ue({name:g.name,sections:Y,id:g.id,previewImage:g.previewImage,inventoryItems:g.inventoryItems}))}we([...q]);const $=[],_=n===""?void 0:ie.find(g=>g.id===n);if(console.log("TEMPLATE",_,"AREA",l),u){const g=await Ht(i,m,t.get("designId")||"");if(g===null){window.location.href="/LayItOut/DNF/";return}ht(g),re(g.inventoryItems.map(r=>new ae({item:new w({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,initialElement:r.item.initialElement,moveable:r.item.moveable,starterItem:r.item.starterItem,displayItem:!0}),quantity:r.quantity}))),fe([...g.sections]),de([...g.sections.map(r=>new W({name:r.name,cellId:new y({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,startingItems:r.startingItems,modifierItems:r.modifierItems,items:r.startingItems.map(Y=>new w({id:Y.item.id,name:Y.item.name,sectionCell:Y.cell,cellsLong:Y.item.cellsLong,cellsTall:Y.item.cellsTall,icon:Y.item.icon,moveable:Y.item.moveable,starterItem:Y.item.starterItem,rotation:Y.item.rotation}))}))]),$.push(...g.sections.map(r=>new W({name:r.name,cellId:new y({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,startingItems:r.startingItems,modifierItems:r.modifierItems,items:r.startingItems.map(Y=>new w({id:Y.item.id,name:Y.item.name,sectionCell:Y.cell,cellsLong:Y.item.cellsLong,cellsTall:Y.item.cellsTall,icon:Y.item.icon,moveable:Y.item.moveable,starterItem:Y.item.starterItem,rotation:Y.item.rotation}))})))}else _!==void 0?(re(_.inventoryItems.map(g=>new ae({item:new w({id:g.item.id,name:g.item.name,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,initialElement:g.item.initialElement,moveable:g.item.moveable,starterItem:g.item.starterItem,displayItem:!0}),quantity:g.quantity}))),fe([..._.sections]),de([..._.sections.map(g=>new W({name:g.name,cellId:new y({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,modifierItems:g.modifierItems,items:g.startingItems.map(r=>new w({id:r.item.id,name:r.item.name,sectionCell:r.cell,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,rotation:r.item.rotation}))}))]),$.push(..._.sections.map(g=>new W({name:g.name,cellId:new y({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,modifierItems:g.modifierItems,startingItems:g.startingItems,items:g.startingItems.map(r=>new w({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,rotation:r.item.rotation,sectionCell:r.cell}))})))):(fe([...l.sections]),de([...l.sections.map(g=>new W({name:g.name,cellId:new y({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,modifierItems:g.modifierItems,startingItems:g.startingItems,items:g.startingItems.map(r=>new w({id:r.item.id,name:r.item.name,sectionCell:r.cell,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,rotation:r.item.rotation}))}))]),$.push(...l.sections.map(g=>new W({name:g.name,cellId:new y({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,modifierItems:g.modifierItems,items:g.startingItems.map(r=>new w({id:r.item.id,name:r.item.name,sectionCell:r.cell,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,rotation:r.item.rotation}))}))));console.log("SECTIONS TO GENERATE",$),bt($,l,a==="create-area",T)}d.useEffect(()=>{jt()},[]);function Nt(t,e,s){if(!c||t==null)return;const m=[...s],i=[],n=s.find(l=>l.name==t);console.log("NEW SECTION",n),console.log("Adding section",n.name,n.cellId),console.log("MOBILE CELLS",e),n.cellElement=document.querySelector(`.App #${n.name.split(" ").join("-")} #${n.name.split(" ").join("")}${n.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",n.cellElement);for(const l of n.startingItems){console.log("Placing starting item",l.item.name,l.cell);const a=T=>{const q=T%2===1;return{cellsLong:q?l.item.cellsTall:l.item.cellsLong,cellsTall:q?l.item.cellsLong:l.item.cellsTall}},u=l.item.rotation||0,f=a(u);for(let T=0;T<f.cellsTall;T++)for(let q=0;q<f.cellsLong;q++){const ie=e.find($=>$.sectionName===n.name);ie.cells[l.cell.y+T][l.cell.x+q].hasItem=!0,ie.cells[l.cell.y+T][l.cell.x+q].itemId=l.item.id}l.item.initialElement=document.querySelector(`.App #${n.name.split(" ").join("-")} #${n.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",l.item.initialElement),i.push(new w({id:l.item.id,name:l.item.name,cellsLong:l.item.cellsLong,cellsTall:l.item.cellsTall,icon:l.item.icon,initialElement:l.item.initialElement,starterItem:!0,moveable:l.item.moveable,rotation:l.item.rotation}))}console.log("Setting sections",m),de([...m]),console.log("ITEMS",i),p(l=>[...l.filter(u=>!i.some(f=>f.id===u.id)),...i.map(u=>new w({id:u.id,name:u.name,cellsLong:u.cellsLong,cellsTall:u.cellsTall,icon:u.icon,initialElement:u.initialElement,starterItem:!0,moveable:u.moveable,rotation:u.rotation}))])}function lt(t){let e=[];return t.map(s=>e=[...e,...s]),e}function ze(t,e){console.log(t);const s=c?R.find(l=>l.sectionName===N).cells:b,m=s[t.y].length,i=s.length;if(console.log(m,i),t.x+e.cellsLong>m||t.y+e.cellsTall>i)return!1;const n=Te(t,v);if(!n&&!c&&(le!=="placing-sections"||!se))return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<e.cellsTall;l++)for(let a=0;a<e.cellsLong;a++){if(!c){const u=Te(new y({x:t.x+a,y:t.y+l}),v);if(!u&&(le!=="placing-sections"||!se))return console.log("Item is out of bounds of any section"),!1;if(u?.name!=n?.name&&(le!=="placing-sections"||!se))return console.log("Item is crossing section boundaries"),!1}if(s[t.y+l][t.x+a].hasItem&&s[t.y+l][t.x+a].itemId!=e.id){console.log("Something is already here");const u=J.find(f=>f.id==s[t.y+l][t.x+a].itemId);if(u&&u.isSectionModifier){if(u.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",l,a,e.cellsTall,e.cellsLong),a==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(u.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",l,a,e.cellsTall,e.cellsLong),a==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(u.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",l,a,e.cellsTall,e.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(u.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",l,a,e.cellsTall,e.cellsLong),l==e.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(u.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",l,a,e.cellsTall,e.cellsLong),l==0&&a==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(u.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",l,a,e.cellsTall,e.cellsLong),l==0&&a==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(u.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",l,a,e.cellsTall,e.cellsLong),l==e.cellsTall-1&&a==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(u.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",l,a,e.cellsTall,e.cellsLong),l==e.cellsTall-1&&a==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function nt(t,e,s){const m=Array.from(c?R.find(n=>n.sectionName===N).cells:b);if(Me(!0),s!=null){console.log("Removing item");const n=c?v.find(l=>l.name===N):Te(s,v);n.items=n.items.filter(l=>l.id!=e.id);for(let l=0;l<e.cellsTall;l++)for(let a=0;a<e.cellsLong;a++)m[s.y+l][s.x+a].hasItem=!1,m[s.y+l][s.x+a].itemId=""}if(le!=="placing-sections"||!se){const n=c?v.find(a=>a.name===N):Te(t,v),l=new y({x:t.x-n.cellId.x,y:t.y-n.cellId.y});e.sectionCell=l,console.log("Adding item to section",n.name,"at",l,e),n.items.push(e)}else e.sectionCell=new y({x:t.x,y:t.y});for(let n=0;n<e.cellsTall;n++)for(let l=0;l<e.cellsLong;l++)m[t.y+n][t.x+l].hasItem=!0,m[t.y+n][t.x+l].itemId=e.id;if(console.log(m),c){const n=R.find(l=>l.sectionName===N);n&&(n.cells=m.map(l=>l.map(a=>({...a}))),Q([...R]))}else S(m);console.log("Removing item from inventory",e.name);let i=!1;if(!e.hasMoved){const n=me.findIndex(l=>l.item.name==e.name&&!l.item.hasMoved);if(n!==-1){const l=[...me];l[n].quantity>0&&(l[n].quantity-=1,l[n].quantity<=0&&(i=!0,l.splice(n,1)),re(l))}else re(me)}if(p(n=>(console.log("Placing item",e),console.log("Updating item",e.id),ve&&ce&&e.id==ce.id?(console.log("Updating placing item",e.id),e.hasMoved=!0,e.starterItem=!0,e.isDisplayItem=!1,e.initialElement=document.querySelector(`.App #${t.toId()}.cell:not(.cell-border)`),[...n,new w({id:e.name+Math.floor(Math.random()*1e5).toString(),name:e.name,cellsLong:e.cellsLong,cellsTall:e.cellsTall,icon:e.icon,initialElement:e.initialElement,moveable:e.moveable,starterItem:e.starterItem,displayItem:e.isDisplayItem,isSectionItem:e.isSectionItem,isSectionModifier:e.isSectionModifier,sectionModifierType:e.sectionModifierType,sectionCell:e.sectionCell,rotation:e.rotation})]):(n.find(l=>l.id==e.id).hasMoved||(n.find(l=>l.id==e.id).hasMoved=!0,n.find(l=>l.id==e.id).sectionCell=e.sectionCell),n))),ve&&ce&&i){pe(null);return}}function At(t){J.find(e=>e.name==t.name&&!e.hasMoved&&!e.starterItem)||p(e=>[...e,t])}d.useEffect(()=>{ce?(console.log("Adding placing item",ce.id),Le(ce.id)):(console.log("Removing placing item",Oe),Le(""))},[ce]);function ot(t){console.log("Removing item",t.id),p(e=>e.filter(s=>s.id!=t.id))}function Ct(t,e){const s=Array.from(c?R.find(l=>l.sectionName===N).cells:b);Me(!0);const m=l=>{const a=l%2===1;return{cellsWide:a?t.cellsTall:t.cellsLong,cellsTall:a?t.cellsLong:t.cellsTall}},i=t.rotation||0,n=m(i);for(let l=0;l<n.cellsTall;l++)for(let a=0;a<n.cellsWide;a++)s[e.y+l][e.x+a].hasItem=!1,s[e.y+l][e.x+a].itemId="";if(c){const l=R.find(a=>a.sectionName===N);l&&(l.cells=s.map(a=>a.map(u=>({...u}))),Q([...R])),Q(a=>a.map(u=>u.sectionName===N?{...u,cells:s}:u))}else S(s);if(le!=="placing-sections"||!se){const l=c?v.find(a=>a.name===N):Te(e,v);l.items=l.items.filter(a=>a.id!=t.id),console.log("DELETING ITEM",t.id)}p(l=>(console.log(),l.filter(a=>a.id!=t.id))),re(l=>{const a=l.findIndex(u=>u.item.name==t.name&&!u.item.hasMoved);if(a!==-1){const u=[...l];return u[a].quantity>0&&(u[a].quantity+=1),u}else return[...l,new ae({item:new w({id:t.id,name:t.name,cellsLong:n.cellsWide,cellsTall:n.cellsTall,icon:t.icon,isSectionItem:t.isSectionItem}),quantity:1})]})}function Mt(t,e){const s=Array.from(c?R.find(u=>u.sectionName===N).cells:b);console.log("DELETING ITEM ROTATE",t.id,t.rotation),Me(!0);const m=u=>{const f=u%2===1;return{cellsWide:f?t.cellsTall:t.cellsLong,cellsTall:f?t.cellsLong:t.cellsTall}},i=t.rotation||0,n=m(i);for(let u=0;u<n.cellsTall;u++)for(let f=0;f<n.cellsWide;f++)console.log("Deleting cell",e.y+u,e.x+f),s[e.y+u][e.x+f].hasItem=!1,s[e.y+u][e.x+f].itemId="";if(c){const u=R.find(f=>f.sectionName===N);u&&(u.cells=s.map(f=>f.map(T=>({...T}))),Q([...R])),Q(f=>f.map(T=>T.sectionName===N?{...T,cells:s}:T))}else S(s);console.log("DELETING ITEM",t.id);const l=c?v.find(u=>u.name===N):Te(e,v);l.items=l.items.filter(u=>u.id!=t.id);const a=new y({x:e.x-l.cellId.x,y:e.y-l.cellId.y});t.sectionCell=a,l.items.push(t)}function st(t,e){const s=c?R.find(n=>n.sectionName===N).cells:b,m=Array.from(s);if(s[t.y]==null){qe();return}const i=ze(t,e);m.forEach(n=>n.forEach(l=>{l.mouseOver=!1,l.canPlaceItem=!1,l.mouseOverLocation=""}));for(let n=0;n<e.cellsTall;n++)for(let l=0;l<e.cellsLong;l++)t.y+n<m.length&&t.x+l<m[t.y+n].length&&(e.cellsLong===1&&e.cellsTall===1?m[t.y+n][t.x+l].mouseOverLocation="single":e.cellsTall===1?l===0?m[t.y+n][t.x+l].mouseOverLocation="leftFull":l===e.cellsLong-1?m[t.y+n][t.x+l].mouseOverLocation="rightFull":m[t.y+n][t.x+l].mouseOverLocation="middleFull":e.cellsLong===1?n===0?m[t.y+n][t.x+l].mouseOverLocation="topFull":n===e.cellsTall-1?m[t.y+n][t.x+l].mouseOverLocation="bottomFull":m[t.y+n][t.x+l].mouseOverLocation="middleVFull":n===0&&l===0?m[t.y+n][t.x+l].mouseOverLocation="topLeftCorner":n===0&&l===e.cellsLong-1?m[t.y+n][t.x+l].mouseOverLocation="topRightCorner":n===e.cellsTall-1&&l===0?m[t.y+n][t.x+l].mouseOverLocation="bottomLeftCorner":n===e.cellsTall-1&&l===e.cellsLong-1?m[t.y+n][t.x+l].mouseOverLocation="bottomRightCorner":n===0?m[t.y+n][t.x+l].mouseOverLocation="top":n===e.cellsTall-1?m[t.y+n][t.x+l].mouseOverLocation="bottom":l===0?m[t.y+n][t.x+l].mouseOverLocation="left":l===e.cellsLong-1?m[t.y+n][t.x+l].mouseOverLocation="right":m[t.y+n][t.x+l].mouseOverLocation="middle",m[t.y+n][t.x+l].mouseOver=!0,m[t.y+n][t.x+l].canPlaceItem=i);if(c){const n=R.find(l=>l.sectionName===N);n&&(n.cells=m.map(l=>l.map(a=>({...a}))),Q([...R])),Q(l=>l.map(a=>a.sectionName===N?{...a,cells:m}:a))}else S(m)}function qe(){console.log("Unhighlighting cells");const t=Array.from(c?R.find(e=>e.sectionName===N).cells:b);if(t.forEach(e=>e.forEach(s=>{s.mouseOver=!1,s.canPlaceItem=!1,s.mouseOverLocation=""})),c){const e=R.find(s=>s.sectionName===N);e&&(e.cells=t.map(s=>s.map(m=>({...m}))),Q([...R])),Q(s=>s.map(m=>m.sectionName===N?{...m,cells:t}:m))}else S(t)}d.useEffect(()=>{Nt(N,R,v)},[N]),d.useEffect(()=>{const t=()=>{const e=J.find(s=>s.id===h);console.log("Unselecting item",h),P(null),e&&(oe(s=>[...s,e.id]),console.log("Unselecting item",e.id),setTimeout(()=>{oe(s=>s.filter(m=>m!==e.id))},300))};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[h,J]);function Et(t){P(null),oe(e=>[...e,t]),console.log("Unselecting item",t),setTimeout(()=>{oe(e=>e.filter(s=>s!==t))},300)}function Rt(t){const e=J.find(s=>s.id===h);console.log("Unselecting item",h),P(t),e&&(oe(s=>[...s,e.id]),console.log("Unselecting item",e.id),setTimeout(()=>{oe(s=>s.filter(m=>m!==e.id))},300))}function Ve(t){re(e=>[...e,t])}const Ne=t=>{console.log("Preventing scroll"),t.preventDefault(),t.stopPropagation(),window.scrollTo(0,0)};d.useEffect(()=>(Be?(window.addEventListener("scroll",Ne),window.addEventListener("touchmove",Ne,{passive:!1})):(window.removeEventListener("scroll",Ne),window.removeEventListener("touchmove",Ne)),()=>{window.removeEventListener("scroll",Ne),window.removeEventListener("touchmove",Ne)}),[Be]);async function Ot(t){const e=[];te(!0);for(const i of t){const n=i.name,l=new y({x:i.sectionCell.x,y:i.sectionCell.y}),a=new W({name:n,cellId:l,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:[],startingItems:[],items:[]});e.push(a)}let s=0,m=0;for(const i of e)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",i.cellsLong+i.cellId.x,"Current width:",s),i.cellsLong+i.cellId.x>s&&(console.log("Added section Width:",i.cellsLong+i.cellId.x),s+=i.cellsLong+i.cellId.x-s),console.log("Needed section Height:",i.cellsTall+i.cellId.y,"Current height:",m),i.cellsTall+i.cellId.y>m&&(console.log("Added section Height:",i.cellsTall+i.cellId.y),m+=i.cellsTall+i.cellId.y-m);await Jt(K,z,e,s,m),window.location.href=`/LayItOut/Layout/?companyId=${K}&areaId=${z}&type=create-area&stage=modify-sections`}async function Dt(t,e){const s=[];te(!0);for(const m of e){const i=m.name,n=new y({x:m.cellId.x,y:m.cellId.y}),l=new W({name:i,cellId:n,cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:[],items:[],modifierItems:m.items.map(a=>new U({cell:new y({x:a.sectionCell.x,y:a.sectionCell.y}),item:new w({id:a.id,name:a.name,cellsLong:a.cellsLong,cellsTall:a.cellsTall,icon:a.icon,rotation:a.rotation,moveable:a.moveable,starterItem:a.starterItem,isSectionItem:a.isSectionItem,isSectionModifier:!0,sectionModifierType:a.sectionModifierType})}))});s.push(l)}console.log("Saving section modifier items",s),await Bt(K,z,s),console.log("Section modifier items saved successfully"),window.location.href=`/LayItOut/Layout/?companyId=${K}&areaId=${z}&type=create-area&stage=placing-items`}async function kt(t,e){te(!0);const s=[];for(const i of t){const n=i.name,l=new y({x:i.cellId.x,y:i.cellId.y}),a=new W({name:n,cellId:l,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.items.map(u=>new U({cell:new y({x:u.sectionCell.x,y:u.sectionCell.y}),item:new w({id:u.id,name:u.name,cellsLong:u.cellsLong,cellsTall:u.cellsTall,icon:u.icon,starterItem:!0,moveable:u.moveable,rotation:u.rotation})})),items:[]});s.push(a)}console.log("Saving area sections",s);const m=new Zt({id:z,name:Ye.name,sections:s,templates:[],previewImage:"",width:Ye.width,height:Ye.height,inventoryItems:e.map(i=>new ae({item:new w({id:i.item.id,name:i.item.name,cellsLong:i.item.cellsLong,cellsTall:i.item.cellsTall,icon:i.item.icon,starterItem:!0,moveable:i.item.moveable,rotation:i.item.rotation}),quantity:i.quantity}))});await Xt(K,m),console.log("Area saved successfully"),te(!1),window.location.href=`/LayItOut/Layout/?companyId=${K}&areaId=${z}&type=view-area`}return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"App",children:[o.jsx("h1",{className:"title",children:"LayItOut"}),o.jsx("br",{}),se&&o.jsxs("div",{className:"area-creation",children:[o.jsx("h2",{className:"area-creation-title",children:"Create Area"}),o.jsx("label",{htmlFor:"",children:le=="placing-sections"?"Create new sections and place them":le=="modify-sections"?"Add walls and doors to sections":"Add items to the inventory and place items"})]}),(Se||xe)&&o.jsxs("div",{className:"template-name-row",children:[o.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),o.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:t=>et(t.target.value),value:je})]}),be&&o.jsx("div",{className:"design-name-row",children:o.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",Ce]})}),(Se||xe)&&o.jsxs("div",{className:"template-creation",children:[o.jsxs("button",{className:"action-btn",onClick:()=>{if(je.trim()==""){alert("Please enter a template name");return}if(ge.some(t=>t.name===je&&(xe?t.id!==tt.id:!0))){alert("Template with this name already exists");return}xe?(te(!0),setTimeout(async()=>{const t=v.map(e=>new W({name:e.name,cellId:new y({x:Z.find(s=>s.name==e.name).cellId.x,y:Z.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new U({cell:new y({x:s.sectionCell.x,y:s.sectionCell.y}),item:new w({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))}));localStorage.setItem("screenshotSections",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),he(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){he(!1);const s=ge.map(m=>m.id===tt.id?(console.log("SECTION",v),new ue({name:je,inventoryItems:me,previewImage:e.newValue,sections:v.map(i=>new W({name:i.name,cellId:new y({x:m.sections.find(n=>n.name==i.name).cellId.x,y:m.sections.find(n=>n.name==i.name).cellId.y}),cellsLong:i.cellsLong,modifierItems:i.modifierItems,cellsTall:i.cellsTall,startingItems:i.items.map(n=>new U({cell:new y({x:n.sectionCell.x,y:n.sectionCell.y}),item:new w({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))})),id:m.id})):new ue({name:m.name,previewImage:m.previewImage,inventoryItems:m.inventoryItems,sections:m.sections.map(i=>new W({name:i.name,cellId:new y({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(n=>new U({cell:new y({x:n.cell.x,y:n.cell.y}),item:new w({id:n.item.id,name:n.item.name,cellsLong:n.item.cellsLong,cellsTall:n.item.cellsTall,icon:n.item.icon,starterItem:n.item.starterItem,moveable:n.item.moveable,rotation:n.item.rotation})}))})),id:m.id}));Ee(K,z,s).then(()=>{console.log("Template updated successfully"),te(!1);const m=new URLSearchParams(window.location.search),i=m.get("companyId"),n=m.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${i}&areaId=${n}&type=view-area`})}})},500)):(te(!0),setTimeout(async()=>{const t=v.map(e=>new W({name:e.name,cellId:new y({x:Z.find(s=>s.name==e.name).cellId.x,y:Z.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new U({cell:new y({x:s.sectionCell.x,y:s.sectionCell.y}),item:new w({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))}));localStorage.setItem("screenshotSections",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),he(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){he(!1);const s=new ue({name:je,previewImage:e.newValue,inventoryItems:me,sections:v.map(i=>new W({name:i.name,cellId:new y({x:Z.find(n=>n.name==i.name).cellId.x,y:Z.find(n=>n.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.items.map(n=>new U({cell:new y({x:n.sectionCell.x,y:n.sectionCell.y}),item:new w({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))})),id:je+(Math.random()*1e4).toString()}),m=[...ge.map(i=>new ue({name:i.name,previewImage:i.previewImage,inventoryItems:i.inventoryItems,sections:i.sections.map(n=>new W({name:n.name,cellId:new y({x:n.cellId.x,y:n.cellId.y}),cellsLong:n.cellsLong,cellsTall:n.cellsTall,modifierItems:n.modifierItems,startingItems:n.startingItems.map(l=>new U({cell:new y({x:l.cell.x,y:l.cell.y}),item:new w({id:l.item.id,name:l.item.name,cellsLong:l.item.cellsLong,cellsTall:l.item.cellsTall,icon:l.item.icon,starterItem:l.item.starterItem,moveable:l.item.moveable,rotation:l.item.rotation})}))})),id:i.id})),s];Ee(K,z,m).then(()=>{console.log("Template updated successfully"),te(!1);const i=new URLSearchParams(window.location.search),n=i.get("companyId"),l=i.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${n}&areaId=${l}&type=view-area`})}})},500))},children:[Se?"Create":"Save"," Template"]}),o.jsx("button",{className:"action-btn",onClick:()=>{const t=new URLSearchParams(window.location.search),e=t.get("companyId"),s=t.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${e}&areaId=${s}&type=view-area`},children:"Cancel"})]}),It&&o.jsxs("div",{className:"template-creation",children:[St&&o.jsx("button",{className:"action-btn",onClick:()=>{te(!0),setTimeout(async()=>{const t=v.map(e=>new W({name:e.name,cellId:new y({x:Z.find(s=>s.name==e.name).cellId.x,y:Z.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new U({cell:new y({x:s.sectionCell.x,y:s.sectionCell.y}),item:new w({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))}));localStorage.setItem("screenshotSections",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),he(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){he(!1);const s=new at({name:Ce,previewImage:e.newValue,areaId:z,inventoryItems:me,sections:v.map(m=>new W({name:m.name,cellId:new y({x:Z.find(i=>i.name==m.name).cellId.x,y:Z.find(i=>i.name==m.name).cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,modifierItems:m.modifierItems,startingItems:m.items.map(i=>new U({cell:new y({x:i.sectionCell.x,y:i.sectionCell.y}),item:new w({id:i.id,name:i.name,cellsLong:i.cellsLong,cellsTall:i.cellsTall,icon:i.icon,starterItem:!0,moveable:i.moveable,rotation:i.rotation})}))})),id:Ue});ct(K,z,s).then(()=>{console.log("Design updated successfully"),Me(!1),te(!1)})}})},500)},children:"Save"}),o.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),o.jsxs("div",{className:"place-mode-row",children:[o.jsx("label",{htmlFor:"tap-and-place-mode",children:"Place Mode: "}),o.jsxs("select",{id:"tap-and-place-mode",name:"tap-and-place-mode",value:ve?"tap":"drag",onChange:t=>Re(t.target.value==="tap"),className:"place-mode-select",children:[o.jsx("option",{value:"drag",children:"Drag and Drop"}),o.jsx("option",{value:"tap",children:"Tap and Place"})]})]}),Je&&o.jsx(o.Fragment,{children:o.jsx("div",{className:"loader-backdrop",children:o.jsx("div",{className:"loader"})})})," ",o.jsxs("div",{className:"layout",children:[!be&&o.jsx(qt,{setSelectedItem:pe,tapAndPlaceMode:ve,isModifyingSections:se&&le=="modify-sections",isViewingDesign:be,isEditingTemplate:xe,isCreatingTemplate:Se,maxHeight:c?200:D*A,showAddCustomItem:()=>{le=="placing-sections"&&se?Xe.current?.showModal():le=="placing-items"&&se?$e.current?.showModal():Ze.current?.showModal()},addDraggingItem:At,removeItem:ot,inventoryItems:me.map(t=>new ae({item:new w({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,displayItem:!0,isSectionItem:t.item.isSectionItem,isSectionModifier:t.item.isSectionModifier,moveable:t.item.moveable,rotation:t.item.rotation,sectionModifierType:t.item.sectionModifierType}),quantity:t.quantity}))}),c?o.jsxs("div",{className:"mobile-areas",style:{height:ee+"px"},children:[o.jsx("img",{src:ke,onClick:()=>{const t=v.findIndex(s=>s.name==N);if(t===-1)return;const e=(t-1+v.length)%v.length;We(v[e].name),console.log("Changing viewing section to",v[e].name)},className:"back-mobile-areas"}),F.map((t,e)=>o.jsx(it,{width:t.width,height:t.height,cells:lt(R.find(s=>s.sectionName==t.sectionName).cells),id:t.sectionName,visibile:N==null?!0:t.sectionName==N,section:t.sectionName},e)),o.jsx("img",{src:ke,onClick:()=>{const t=v.findIndex(s=>s.name==N);if(t===-1)return;const e=(t+1)%v.length;We(v[e].name),console.log("Changing viewing section to",v[e].name)},className:"forward-mobile-areas"})]}):o.jsx(it,{width:H*A,height:D*A,cells:lt(b)})]}),be&&o.jsxs("div",{className:"design-view",children:[o.jsx("button",{className:"action-btn",onClick:()=>{const t=v.map(e=>new W({name:e.name,cellId:new y({x:Z.find(s=>s.name==e.name).cellId.x,y:Z.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new U({cell:new y({x:s.sectionCell.x,y:s.sectionCell.y}),item:new w({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))}));localStorage.setItem("printSections",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/LayItOut/Print/?companyId=${K}&areaId=${z}&designName=${Ce}&designId=${Ue}`,"_blank")},children:"Print"}),o.jsx("button",{className:"action-btn",onClick:()=>{const t=new ue({name:Ce,previewImage:De.previewImage,inventoryItems:De.inventoryItems,sections:De.sections,id:De.name+(Math.random()*1e4).toString()}),e=[...ge.map(s=>new ue({name:s.name,previewImage:s.previewImage,inventoryItems:s.inventoryItems,sections:s.sections.map(m=>new W({name:m.name,cellId:new y({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,modifierItems:m.modifierItems,startingItems:m.startingItems.map(i=>new U({cell:new y({x:i.cell.x,y:i.cell.y}),item:new w({id:i.item.id,name:i.item.name,cellsLong:i.item.cellsLong,cellsTall:i.item.cellsTall,icon:i.item.icon,starterItem:i.item.starterItem,moveable:i.item.moveable,rotation:i.item.rotation})}))})),id:s.id})),t];Ee(K,z,e).then(()=>{console.log("Template updated successfully"),we(e),window.location.href=`/LayItOut/Layout/?companyId=${K}&areaId=${z}&type=edit-template&templateId=${t.id}`})},children:"Turn into a Template"}),o.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/"},children:"Back"})]}),_e&&o.jsx("div",{className:"design-view",children:o.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/"},children:"Back"})}),se&&o.jsxs("div",{className:"design-view",children:[o.jsx("button",{className:"action-btn",onClick:()=>{le=="placing-sections"?Ot(J.filter(t=>t.isSectionItem)):le=="modify-sections"?Dt(J.filter(t=>t.isSectionModifier),v):le=="placing-items"&&kt(v,me)},children:le=="placing-items"?"Create Area":"Next"}),o.jsx("button",{className:"action-btn",onClick:async()=>{te(!0),await Yt(K,z),window.location.href="/LayItOut/"},children:"Cancel"})]})]}),o.jsxs("div",{children:[v.map(t=>o.jsx(Wt,{takingPhoto:!1,section:t,visible:N==null?!0:t.name==N,cellSize:A},t.cellId.toId())),J.map(t=>o.jsx(Ft,{isCreatingArea:se,isCreatingTemplate:Se||xe,cellSize:A,isViewingDesign:be,removeItem:ot,visible:c?!t.hasMoved&&!t.starterItem?!0:N==null?!1:t.starterItem?v.find(e=>e.name==N)?.startingItems.some(e=>e.item.id===t.id):v.find(e=>e.name==N)?.items.some(e=>e.id===t.id):!0,item:t,canPlaceItem:ze,placeItem:nt,deleteItemRotate:Mt,highlightCells:st,unHighlightCells:qe,deleteItem:Ct,isSelected:h===t.id,onSelect:Rt,isUnselecting:V.includes(t.id),onDeselect:()=>Et(t.id)},t.id))]}),c&&!Je&&o.jsx("div",{className:"layout-icon",onClick:()=>{ye.current?.showModal(),Ae(!0),console.log("Showing layout dialog")},children:o.jsx("img",{src:Qt,alt:""})}),!Je&&!(Se||xe||be||se)&&o.jsx("div",{className:"template-icon",onClick:()=>{X.current?.showModal(),k(!0),console.log("Showing template dialog")},children:o.jsx("img",{src:Kt,alt:""})}),o.jsx(_t,{isViewingArea:_e,dialogRef:X,isOpen:j,closeDialog:()=>{X.current?.close(),k(!1)},duplicateTemplate:t=>{const e=new ue({name:t.name+" Copy",previewImage:t.previewImage,inventoryItems:t.inventoryItems,sections:t.sections,id:t.name+"Copy"+(Math.random()*1e4).toString()}),s=[...ge.map(m=>new ue({name:m.name,previewImage:m.previewImage,inventoryItems:m.inventoryItems,sections:m.sections.map(i=>new W({name:i.name,cellId:new y({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(n=>new U({cell:new y({x:n.cell.x,y:n.cell.y}),item:new w({id:n.item.id,name:n.item.name,cellsLong:n.item.cellsLong,cellsTall:n.item.cellsTall,icon:n.item.icon,starterItem:n.item.starterItem,moveable:n.item.moveable,rotation:n.item.rotation})}))})),id:m.id})),e];Ee(K,z,s).then(()=>{X.current?.close(),console.log("Template updated successfully"),we(s),k(!1),window.location.href=`/LayItOut/Layout/?companyId=${K}&areaId=${z}&type=edit-template&templateId=${e.id}`})},templates:ge,selectTemplate:t=>{te(!0),setTimeout(async()=>{const e=t.sections.map(s=>new W({name:s.name,cellId:new y({x:t.sections.find(m=>m.name==s.name).cellId.x,y:t.sections.find(m=>m.name==s.name).cellId.y}),cellsLong:s.cellsLong,cellsTall:s.cellsTall,modifierItems:s.modifierItems,startingItems:s.startingItems.map(m=>new U({cell:new y({x:m.cell.x,y:m.cell.y}),item:new w({id:m.item.id,name:m.item.name,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,starterItem:!0,moveable:m.item.moveable,rotation:m.item.rotation})}))}));localStorage.setItem("screenshotSections",e.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),he(!0),window.addEventListener("storage",async s=>{if(console.log("Storage event",s),s.key==="screenshot"){he(!1);const m=new at({name:Ce,previewImage:s.newValue,areaId:z,inventoryItems:t.inventoryItems,sections:t.sections.map(i=>new W({name:i.name,cellId:new y({x:t.sections.find(n=>n.name==i.name).cellId.x,y:t.sections.find(n=>n.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(n=>new U({cell:new y({x:n.cell.x,y:n.cell.y}),item:new w({id:n.item.id,name:n.item.name,cellsLong:n.item.cellsLong,cellsTall:n.item.cellsTall,icon:n.item.icon,starterItem:!0,moveable:n.item.moveable,rotation:n.item.rotation})}))})),id:Ue});console.log("UPDATED DESIGN",m),ct(K,z,m).then(()=>{console.log("Design updated successfully"),Me(!1),te(!1),window.location.reload()})}})},500)}}),o.jsx(Vt,{dialogRef:ye,closeDialog:()=>{ye.current?.close(),Ae(!1)},areaPreview:vt||""}),o.jsx(el,{dialogRef:Ze,addInventoryItem:Ve,closeDialog:()=>{Ze.current?.close()}}),o.jsx(tl,{dialogRef:Xe,closeDialog:()=>{Xe.current?.close()},addSection:Ve}),o.jsx(ll,{dialogRef:$e,closeDialog:()=>{$e.current?.close()},addInventoryItem:Ve}),o.jsx(nl,{item:ce,setSelectingItem:()=>{pe(null)},canPlaceItem:ze,placeItem:nt,highlightCells:st,unHighlightCells:qe,cellSize:A}),Be&&o.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:window.location.origin+"/LayItOut/Preview/",width:M*A+20,height:B*A+20})]})}
