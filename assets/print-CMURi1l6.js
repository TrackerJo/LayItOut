import{c as U,j as c,r as i}from"./index-QIV6qY6h.js";import{A as k,S as M,D as q}from"./section-q8AgVIhV.js";import{S as p,C as h,I as f,V as z,W as F,e as $}from"./firestore-CNKM-Wvp.js";U.createRoot(document.getElementById("root")).render(c.jsx(B,{}));function B(){const[G,V]=i.useState(/Mobi|Android/i.test(navigator.userAgent)),[x,w]=i.useState(0),[S,T]=i.useState(0),[A,y]=i.useState([]),[j,v]=i.useState([]),u=10,[b,L]=i.useState([]),[J,C]=i.useState(""),[X,N]=i.useState(""),[E,O]=i.useState(""),[R,Y]=i.useState(!0);function D(t,a){for(const o of a)if(t.x>=o.cellId.x&&t.x<o.cellId.x+o.cellsLong&&t.y>=o.cellId.y&&t.y<o.cellId.y+o.cellsTall)return o;return null}function P(t){let a=x,o=S;const d=[];for(const e of t)console.log("Generating cells for section",e.name,"at",e.cellId,"with size",e.cellsLong,"x",e.cellsTall),console.log("Needed section Width:",e.cellsLong+e.cellId.x,"Current width:",a),e.cellsLong+e.cellId.x>a&&(console.log("Added section Width:",e.cellsLong+e.cellId.x),a+=e.cellsLong+e.cellId.x-a),console.log("Needed section Height:",e.cellsTall+e.cellId.y,"Current height:",o),e.cellsTall+e.cellId.y>o&&(console.log("Added section Height:",e.cellsTall+e.cellId.y),o+=e.cellsTall+e.cellId.y-o);w(a),T(o),[...Array(o).keys()].map(e=>{const m=[];[...Array(a).keys()].map(l=>{m.push({id:new h({x:l,y:e}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:D(new h({x:l,y:e}),t)!=null,size:u})}),d.push(m)}),y([...d]),setTimeout(()=>{const e=[],m=[...t];for(const l of m)l.cellElement=document.querySelector(`.App #${l.cellId.toId()}.cell:not(.cell-border)`),e.push(...l.startingItems.map(r=>new $({cell:new h({x:l.cellId.x+r.cell.x,y:l.cellId.y+r.cell.y}),item:new f({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,initialElement:document.querySelector(`.App #${r.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:r.item.moveable,rotation:r.item.rotation||0})})));L([...m]);for(const l of e){const r=g=>{const I=g%2===1;return{cellsLong:I?l.item.cellsTall:l.item.cellsLong,cellsTall:I?l.item.cellsLong:l.item.cellsTall}},n=l.item.rotation||0,s=r(n);for(let g=0;g<s.cellsTall;g++)for(let I=0;I<s.cellsLong;I++)d[l.cell.y+g][l.cell.x+I].hasItem=!0,d[l.cell.y+g][l.cell.x+I].itemId=l.item.id;l.item.initialElement=document.querySelector(`.App #${l.cell.toId()}.cell:not(.cell-border)`),v(g=>[...g,l.item])}y([...d]),setTimeout(()=>{window.print()},500)},100)}async function H(){const t=new URLSearchParams(window.location.search),a=t.get("companyId"),o=t.get("areaId"),d=t.get("designName"),e=t.get("designId");if(!a||!o||!d||!e){alert("Invalid URL parameters");return}C(a),N(o),O(d);const m=[];let l=localStorage.getItem("printSections");console.log("Screenshot sections from localStorage",l),l=l?.split("LAYOUTSEPARATOR")||"";const r=[];for(const n of l)console.log("Section string",n),r.push(p.fromJSON(n));L([...r.map(n=>new p({name:n.name,cellId:new h({x:n.cellId.x,y:n.cellId.y}),cellsLong:n.cellsLong,cellsTall:n.cellsTall,startingItems:n.startingItems,items:n.startingItems.map(s=>new f({id:s.item.id,name:s.item.name,sectionCell:s.cell,cellsLong:s.item.cellsLong,cellsTall:s.item.cellsTall,icon:s.item.icon,moveable:s.item.moveable,starterItem:s.item.starterItem,rotation:s.item.rotation}))}))]),m.push(...r.map(n=>new p({name:n.name,cellId:new h({x:n.cellId.x,y:n.cellId.y}),cellsLong:n.cellsLong,cellsTall:n.cellsTall,startingItems:n.startingItems,items:n.startingItems.map(s=>new f({id:s.item.id,name:s.item.name,sectionCell:s.cell,cellsLong:s.item.cellsLong,cellsTall:s.item.cellsTall,icon:s.item.icon,moveable:s.item.moveable,starterItem:s.item.starterItem,rotation:s.item.rotation}))}))),console.log("SECTIONS TO GENERATE",m),P(m)}i.useEffect(()=>{H();async function t(){const a=z();F("dMjfwNN0XFes0WxUH8h1",a)}t()},[]);function W(t){let a=[];return t.map(o=>a=[...a,...o]),a}return c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"App",children:[c.jsx("h1",{className:"title",children:"LayItOut"}),c.jsx("br",{}),R&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"loader-backdrop"}),c.jsx("div",{className:"loader"})]})," ",c.jsx("div",{className:"layout",children:c.jsx(k,{width:x*u,height:S*u,cells:W(A)})})]}),b.map(t=>c.jsx(M,{takingPhoto:!1,section:t,visible:!0,cellSize:u},t.cellId.toId())),j.map(t=>c.jsx(q,{cellSize:u,isViewingDesign:!0,removeItem:()=>{},visible:!0,item:t,canPlaceItem:()=>!1,placeItem:()=>{},deleteItemRotate:()=>{},highlightCells:()=>{},unHighlightCells:()=>{},deleteItem:()=>{},isSelected:!1,onSelect:()=>{},isUnselecting:!1,onDeselect:()=>{}},t.id)),c.jsxs("div",{className:"print-footer",children:[c.jsx("p",{children:"Printed Layout from LayItOut.com"}),c.jsxs("p",{children:["Design Name: ",E]}),c.jsxs("p",{children:["Generated on: ",new Date().toLocaleString()]})]})]})}
