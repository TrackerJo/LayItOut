import{c as Ie,j as I,r as a}from"./index-QIV6qY6h.js";import{A as J,S as ye,D as he}from"./section-CHPOvXdQ.js";import{S as D,C as S,I as w,e as xe,b as Se}from"./firestore-eMuYHorM.js";import{F as Y}from"./add_custom_item_dialog-DnliRUT_.js";Ie.createRoot(document.getElementById("root")).render(I.jsx(Le,{}));function Le(){const[y,pe]=a.useState(!1),[U,G]=a.useState(0),[F,K]=a.useState(0),[L,p]=a.useState([]),[O,E]=a.useState([]),[Q,X]=a.useState(0),[T,R]=a.useState(null),[Z,v]=a.useState([]),g=10,[M,k]=a.useState([]);a.useRef(null);const[Te,ve]=a.useState(!1),[we,W]=a.useState([]),[d,N]=a.useState([]),[Ee,be]=a.useState([]),[Oe,Ne]=a.useState(!1);a.useRef(null);const[_,C]=a.useState([]),[h,A]=a.useState([]),[r,P]=a.useState(null),[Ae,je]=a.useState(!1),[De,Re]=a.useState(!1),[ee,Me]=a.useState(!1),[ke,Pe]=a.useState(!1),[Ue,Fe]=a.useState(!1),[We,qe]=a.useState(!1),[$e,He]=a.useState(""),[Ve,ze]=a.useState(""),[Be,Je]=a.useState(""),[Ye,Ge]=a.useState(""),[Ke,Qe]=a.useState(""),[le,j]=a.useState(!0),[Xe,Ze]=a.useState(null),[q,$]=a.useState(!1),[_e,ne]=a.useState(!1);a.useRef(null);function b(l,n){for(const s of n)if(l.x>=s.cellId.x&&l.x<s.cellId.x+s.cellsLong&&l.y>=s.cellId.y&&l.y<s.cellId.y+s.cellsTall)return s;return null}function te(l){W([...l.map(t=>new D({name:t.name,cellId:new S({x:t.cellId.x/2,y:t.cellId.y/2}),cellsLong:t.cellsLong/2,cellsTall:t.cellsTall/2,startingItems:[]}))]);let n=U,s=F;if(y){let t=0;const c=[],i=[];for(const e of l){const o=[],m={width:e.cellsLong*g,height:e.cellsTall*g,sectionName:e.name};m.height>t&&(t=m.height),C(x=>[...x,m]),e.cellId.x=0,e.cellId.y=0,[...Array(m.height/g).keys()].map(x=>{const u=[];[...Array(m.width/g).keys()].map(f=>{u.push({id:new S({x:f,y:x}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:g})}),o.push(u)}),c.push({sectionName:e.name,cells:[...o]}),i.push(e)}A(c),N(i),X(t),P(l[0]?l[0].name:null),setTimeout(()=>{j(!1)},500)}else{const t=[];for(const c of l)console.log("Generating cells for section",c.name,"at",c.cellId,"with size",c.cellsLong,"x",c.cellsTall),console.log("Needed section Width:",(c.cellsLong+c.cellId.x)*g,"Current width:",n),(c.cellsLong+c.cellId.x)*g>n&&(console.log("Added section Width:",c.cellsLong*g+c.cellId.x),n+=(c.cellsLong+c.cellId.x)*g-n),console.log("Needed section Height:",(c.cellsTall+c.cellId.y)*g,"Current height:",s),(c.cellsTall+c.cellId.y)*g>s&&(console.log("Added section Height:",c.cellsTall*g+c.cellId.y),s+=(c.cellsTall+c.cellId.y)*g-s);G(n),K(s),[...Array(s/g).keys()].map(c=>{const i=[];[...Array(n/g).keys()].map(e=>{i.push({id:new S({x:e,y:c}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:b(new S({x:e,y:c}),l)!=null,size:g})}),t.push(i)}),p([...t]),setTimeout(()=>{const c=[],i=[...l];for(const e of i)e.cellElement=document.querySelector(`.App #${e.cellId.toId()}.cell:not(.cell-border)`),c.push(...e.startingItems.map(o=>new Se({cell:new S({x:e.cellId.x+o.cell.x,y:e.cellId.y+o.cell.y}),item:new w({id:o.item.id,name:o.item.name,cellsLong:o.item.cellsLong,cellsTall:o.item.cellsTall,icon:o.item.icon,initialElement:document.querySelector(`.App #${o.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:o.item.moveable,rotation:o.item.rotation||0})})));N([...i]);for(const e of c){const o=u=>{const f=u%2===1;return{cellsLong:f?e.item.cellsTall:e.item.cellsLong,cellsTall:f?e.item.cellsLong:e.item.cellsTall}},m=e.item.rotation||0,x=o(m);for(let u=0;u<x.cellsTall;u++)for(let f=0;f<x.cellsLong;f++)t[e.cell.y+u][e.cell.x+f].hasItem=!0,t[e.cell.y+u][e.cell.x+f].itemId=e.item.id;e.item.initialElement=document.querySelector(`.App #${e.cell.toId()}.cell:not(.cell-border)`),E(u=>[...u,e.item])}p([...t]),setTimeout(()=>{j(!1),oe()},500)},100)}}async function oe(l,n){j(!0),$(!0),setTimeout(async()=>{const s=document.getElementById("capture"),t=await domtoimage.toPng(s);$(!1),localStorage.setItem("screenshot",t),ne(!0),j(!1)},500)}async function se(){new URLSearchParams(window.location.search);const l=[];let n=localStorage.getItem("screenshotSections");console.log("Screenshot sections from localStorage",n),n=n?.split("LAYOUTSEPARATOR")||"";const s=[];for(const t of n)console.log("Section string",t),s.push(D.fromJSON(t));W([...s]),N([...s.map(t=>new D({name:t.name,cellId:new S({x:t.cellId.x/10,y:t.cellId.y/10}),cellsLong:t.cellsLong/10,cellsTall:t.cellsTall/10,startingItems:t.startingItems,items:t.startingItems.map(c=>new w({id:c.item.id,name:c.item.name,sectionCell:c.cell,cellsLong:c.item.cellsLong,cellsTall:c.item.cellsTall,icon:c.item.icon,moveable:c.item.moveable,starterItem:c.item.starterItem,rotation:c.item.rotation}))}))]),l.push(...s.map(t=>new D({name:t.name,cellId:new S({x:t.cellId.x/10,y:t.cellId.y/10}),cellsLong:t.cellsLong/10,cellsTall:t.cellsTall/10,startingItems:t.startingItems,items:t.startingItems.map(c=>new w({id:c.item.id,name:c.item.name,sectionCell:c.cell,cellsLong:c.item.cellsLong,cellsTall:c.item.cellsTall,icon:c.item.icon,moveable:c.item.moveable,starterItem:c.item.starterItem,rotation:c.item.rotation}))}))),console.log("SECTIONS TO GENERATE",l),te(l)}a.useEffect(()=>{se()},[]);function ie(l,n,s){if(!y||l==null)return;const t=[...s],c=[],i=s.find(e=>e.name==l);console.log("NEW SECTION",i),console.log("Adding section",i.name,i.cellId),console.log("MOBILE CELLS",n),i.cellElement=document.querySelector(`.App #${i.name.split(" ").join("-")} #${i.name.split(" ").join("")}${i.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",i.cellElement);for(const e of i.startingItems){console.log("Placing starting item",e.item.name,e.cell);const o=u=>{const f=u%2===1;return{cellsLong:f?e.item.cellsTall:e.item.cellsLong,cellsTall:f?e.item.cellsLong:e.item.cellsTall}},m=e.item.rotation||0,x=o(m);for(let u=0;u<x.cellsTall;u++)for(let f=0;f<x.cellsLong;f++){const B=n.find(fe=>fe.sectionName===i.name);B.cells[e.cell.y+u][e.cell.x+f].hasItem=!0,B.cells[e.cell.y+u][e.cell.x+f].itemId=e.item.id}e.item.initialElement=document.querySelector(`.App #${i.name.split(" ").join("-")} #${i.name.split(" ").join("")}${e.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",e.item.initialElement),c.push(new w({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,initialElement:e.item.initialElement,starterItem:!0,moveable:e.item.moveable,rotation:e.item.rotation}))}console.log("Setting sections",t),N([...t]),console.log("ITEMS",c),E(e=>[...e.filter(m=>!c.some(x=>x.id===m.id)),...c.map(m=>new w({id:m.id,name:m.name,cellsLong:m.cellsLong,cellsTall:m.cellsTall,icon:m.icon,initialElement:m.initialElement,starterItem:!0,moveable:m.moveable,rotation:m.rotation}))])}function H(l){let n=[];return l.map(s=>n=[...n,...s]),n}function V(l,n){console.log(l);const s=y?h.find(e=>e.sectionName===r).cells:L,t=s[l.y].length,c=s.length;if(console.log(t,c),l.x+n.cellsLong>t||l.y+n.cellsTall>c)return!1;const i=b(l,d);if(!i&&!y)return console.log("Item is out of bounds of any section"),!1;for(let e=0;e<n.cellsTall;e++)for(let o=0;o<n.cellsLong;o++){if(!y){const m=b(new S({x:l.x+o,y:l.y+e}),d);if(!m)return console.log("Item is out of bounds of any section"),!1;if(m.name!=i.name)return console.log("Item is crossing section boundaries"),!1}if(s[l.y+e][l.x+o].hasItem&&s[l.y+e][l.x+o].itemId!=n.id)return console.log("Something is already here"),!1}return!0}function ce(l,n,s){const t=Array.from(y?h.find(e=>e.sectionName===r).cells:L);if(s!=null){console.log("Removing item");const e=y?d.find(o=>o.name===r):b(s,d);e.items=e.items.filter(o=>o.id!=n.id);for(let o=0;o<n.cellsTall;o++)for(let m=0;m<n.cellsLong;m++)t[s.y+o][s.x+m].hasItem=!1,t[s.y+o][s.x+m].itemId=""}const c=y?d.find(e=>e.name===r):b(l,d),i=new S({x:l.x-c.cellId.x,y:l.y-c.cellId.y});n.sectionCell=i,c.items.push(n);for(let e=0;e<n.cellsTall;e++)for(let o=0;o<n.cellsLong;o++)t[l.y+e][l.x+o].hasItem=!0,t[l.y+e][l.x+o].itemId=n.id;if(console.log(t),y){const e=h.find(o=>o.sectionName===r);e&&(e.cells=t.map(o=>o.map(m=>({...m}))),A([...h]))}else p(t);if(console.log("Removing item from inventory",n.name),!n.hasMoved){const e=M.findIndex(o=>o.item.name==n.name&&!o.item.hasMoved);if(e!==-1){const o=[...M];o[e].quantity-=1,o[e].quantity<=0&&o.splice(e,1),k(o)}else k(M)}E(e=>(console.log("Placing item",n.id),console.log("Updating item",n.id),e.find(o=>o.id==n.id).hasMoved||(e.find(o=>o.id==n.id).hasMoved=!0),e))}function ae(l){console.log("Removing item",l.id),E(n=>n.filter(s=>s.id!=l.id))}function me(l,n){const s=Array.from(L),t=e=>{const o=e%2===1;return{cellsWide:o?l.cellsTall:l.cellsLong,cellsTall:o?l.cellsLong:l.cellsTall}},c=l.rotation||0,i=t(c);for(let e=0;e<i.cellsTall;e++)for(let o=0;o<i.cellsWide;o++)s[n.y+e][n.x+o].hasItem=!1,s[n.y+e][n.x+o].itemId="";p(s),console.log("DELETING ITEM",l.id),E(e=>(console.log(),e.filter(o=>o.id!=l.id))),k(e=>{const o=e.findIndex(m=>m.item.name==l.name&&!m.item.hasMoved);if(o!==-1){const m=[...e];return m[o].quantity+=1,m}else return[...e,new xe({item:new w({id:l.id,name:l.name,cellsLong:i.cellsWide,cellsTall:i.cellsTall,icon:l.icon}),quantity:1})]})}function re(l,n){const s=Array.from(y?h.find(e=>e.sectionName===r).cells:L);console.log("DELETING ITEM ROTATE",l.id,l.rotation);const t=e=>{const o=e%2===1;return{cellsWide:o?l.cellsTall:l.cellsLong,cellsTall:o?l.cellsLong:l.cellsTall}},c=l.rotation||0,i=t(c);for(let e=0;e<i.cellsTall;e++)for(let o=0;o<i.cellsWide;o++)console.log("Deleting cell",n.y+e,n.x+o),s[n.y+e][n.x+o].hasItem=!1,s[n.y+e][n.x+o].itemId="";p([...s]),console.log("DELETING ITEM",l.id)}function de(l,n){const s=y?h.find(i=>i.sectionName===r).cells:L,t=Array.from(s);if(s[l.y]==null){z();return}const c=V(l,n);t.forEach(i=>i.forEach(e=>{e.mouseOver=!1,e.canPlaceItem=!1,e.mouseOverLocation=""}));for(let i=0;i<n.cellsTall;i++)for(let e=0;e<n.cellsLong;e++)l.y+i<t.length&&l.x+e<t[l.y+i].length&&(n.cellsLong===1&&n.cellsTall===1?t[l.y+i][l.x+e].mouseOverLocation="single":n.cellsTall===1?e===0?t[l.y+i][l.x+e].mouseOverLocation="leftFull":e===n.cellsLong-1?t[l.y+i][l.x+e].mouseOverLocation="rightFull":t[l.y+i][l.x+e].mouseOverLocation="middleFull":n.cellsLong===1?i===0?t[l.y+i][l.x+e].mouseOverLocation="topFull":i===n.cellsTall-1?t[l.y+i][l.x+e].mouseOverLocation="bottomFull":t[l.y+i][l.x+e].mouseOverLocation="middleVFull":i===0&&e===0?t[l.y+i][l.x+e].mouseOverLocation="topLeftCorner":i===0&&e===n.cellsLong-1?t[l.y+i][l.x+e].mouseOverLocation="topRightCorner":i===n.cellsTall-1&&e===0?t[l.y+i][l.x+e].mouseOverLocation="bottomLeftCorner":i===n.cellsTall-1&&e===n.cellsLong-1?t[l.y+i][l.x+e].mouseOverLocation="bottomRightCorner":i===0?t[l.y+i][l.x+e].mouseOverLocation="top":i===n.cellsTall-1?t[l.y+i][l.x+e].mouseOverLocation="bottom":e===0?t[l.y+i][l.x+e].mouseOverLocation="left":e===n.cellsLong-1?t[l.y+i][l.x+e].mouseOverLocation="right":t[l.y+i][l.x+e].mouseOverLocation="middle",t[l.y+i][l.x+e].mouseOver=!0,t[l.y+i][l.x+e].canPlaceItem=c);if(y){const i=h.find(e=>e.sectionName===r);i&&(i.cells=t.map(e=>e.map(o=>({...o}))),A([...h])),A(e=>e.map(o=>o.sectionName===r?{...o,cells:t}:o))}else p(t)}function z(){const l=Array.from(y?h.find(n=>n.sectionName===r).cells:L);l.forEach(n=>n.forEach(s=>{s.mouseOver=!1,s.canPlaceItem=!1,s.mouseOverLocation=""})),p(l)}a.useEffect(()=>{ie(r,h,d)},[r]),a.useEffect(()=>{const l=()=>{const n=O.find(s=>s.id===T);console.log("Unselecting item",T),R(null),n&&(v(s=>[...s,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{v(s=>s.filter(t=>t!==n.id))},300))};return document.addEventListener("click",l),()=>document.removeEventListener("click",l)},[T,O]);function ge(l){R(null),v(n=>[...n,l]),console.log("Unselecting item",l),setTimeout(()=>{v(n=>n.filter(s=>s!==l))},300)}function ue(l){const n=O.find(s=>s.id===T);console.log("Unselecting item",T),R(l),n&&(v(s=>[...s,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{v(s=>s.filter(t=>t!==n.id))},300))}return I.jsxs(I.Fragment,{children:[I.jsxs("div",{className:"App",children:[le&&I.jsxs(I.Fragment,{children:[I.jsx("div",{className:"loader-backdrop"}),I.jsx("div",{className:"loader"})]})," ",I.jsx("div",{className:"layout",children:y?I.jsxs("div",{className:"mobile-areas",style:{height:Q+"px"},children:[I.jsx("img",{src:Y,onClick:()=>{const l=d.findIndex(s=>s.name==r);if(l===-1)return;const n=(l-1+d.length)%d.length;P(d[n].name),console.log("Changing viewing section to",d[n].name)},className:"back-mobile-areas"}),_.map((l,n)=>I.jsx(J,{width:l.width,height:l.height,cells:H(h.find(s=>s.sectionName==l.sectionName).cells),id:l.sectionName,visibile:r==null?!0:l.sectionName==r,section:l.sectionName},n)),I.jsx("img",{src:Y,onClick:()=>{const l=d.findIndex(s=>s.name==r);if(l===-1)return;const n=(l+1)%d.length;P(d[n].name),console.log("Changing viewing section to",d[n].name)},className:"forward-mobile-areas"})]}):I.jsx(J,{width:U,height:F,cells:H(L)})})]}),I.jsxs("div",{id:q?"capture":"",children:[d.map(l=>I.jsx(ye,{takingPhoto:q,section:l,visible:r==null?!0:l.name==r,cellSize:g},l.cellId.toId())),O.map(l=>I.jsx(he,{cellSize:g,isViewingDesign:ee,removeItem:ae,visible:y?!l.hasMoved&&!l.starterItem?!0:r==null?!1:l.starterItem?d.find(n=>n.name==r)?.startingItems.some(n=>n.item.id===l.id):d.find(n=>n.name==r)?.items.some(n=>n.id===l.id):!0,item:l,canPlaceItem:V,placeItem:ce,deleteItemRotate:re,highlightCells:de,unHighlightCells:z,deleteItem:me,isSelected:T===l.id,onSelect:ue,isUnselecting:Z.includes(l.id),onDeselect:()=>ge(l.id)},l.id))]})]})}
