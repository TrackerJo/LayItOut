import{r as u,j as o,c as gl}from"./index-QIV6qY6h.js";import{A as Pe,S as ul,D as Il}from"./section-q8AgVIhV.js";import{I as T,s as be,b as de,S as E,C as h,e as M,T as oe,D as Ge,u as Me,f as fl,h as hl}from"./firestore-CNKM-Wvp.js";import{F as fe}from"./add_custom_item_dialog-CkfgPpdu.js";function pl({inventoryItem:d,addDraggingItem:W,removeItem:F}){const D=u.useRef(null),R=u.useRef(null),[J,U]=u.useState(12),[V,A]=u.useState(d.item);function O(y){const I=R.current,G=window.getComputedStyle(I),p=document.createElement("span");p.style.font=G.font,p.style.fontSize=y+"px",p.style.fontFamily=G.fontFamily,p.style.fontWeight=G.fontWeight,p.style.position="absolute",p.style.visibility="hidden",p.style.whiteSpace="nowrap",p.textContent=I.textContent,document.body.appendChild(p);const x=p.offsetWidth;return document.body.removeChild(p),x}function P(y){if(R.current){const I=R.current;return O(y-1)>I.offsetWidth&&y-1>8?P(y-1):y-1}return y}return u.useEffect(()=>{setTimeout(()=>{R.current&&U(P(J))},100)},[]),o.jsxs("div",{className:"display",children:[o.jsx("div",{ref:D,id:d.item.id,className:"display-item",style:{width:`${d.item.cellsLong*10}px`,height:`${d.item.cellsTall*10}px`},onMouseDown:y=>{y.preventDefault(),y.stopPropagation(),d.item.initialElement=D.current,d.item.id=d.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",d.item.id,"to initialElement",d.item.initialElement),A(new T({id:d.item.id,cellsLong:d.item.cellsLong,cellsTall:d.item.cellsTall,name:d.item.name,icon:d.item.icon,moveable:d.item.moveable,starterItem:d.item.starterItem,displayItem:d.item.isDisplayItem})),W(d.item)},onTouchStart:y=>{y.preventDefault(),y.stopPropagation(),d.item.initialElement=D.current,d.item.id=d.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",d.item.id,"to initialElement",d.item.initialElement),A(new T({id:d.item.id,cellsLong:d.item.cellsLong,cellsTall:d.item.cellsTall,name:d.item.name,icon:d.item.icon,moveable:d.item.moveable,starterItem:d.item.starterItem,displayItem:d.item.isDisplayItem})),W(d.item)},children:d.item.icon.includes("custom-")?o.jsx("div",{className:"custom-icon",children:o.jsx("div",{children:o.jsx("p",{ref:R,style:{fontSize:`${J}px`},children:d.item.icon.split("custom-")[1]})})}):o.jsx("img",{src:d.item.icon,alt:"icon"})}),o.jsx("p",{children:d.item.name}),o.jsxs("p",{className:"quantity",children:["x",d.quantity]})]})}const yl="/LayItOut/assets/plus.circle-Ce3xm00a.png";function xl({inventoryItems:d,addDraggingItem:W,maxHeight:F,removeItem:D,showAddCustomItem:R,isCreatingTemplate:J,isEditingTemplate:U,isViewingDesign:V}){return o.jsxs("div",{className:"toolbox",style:{maxHeight:F?`${F}px`:"200px"},children:[d.map(A=>o.jsx(pl,{inventoryItem:A,addDraggingItem:W,removeItem:D})),!(J||U||V)&&o.jsx("div",{className:"add-item",onClick:()=>{R()},children:o.jsx("img",{src:yl,alt:"Add Item"})})]})}function wl({dialogRef:d,closeDialog:W,areaPreview:F}){return o.jsx("dialog",{ref:d,className:"layout-dialog",children:o.jsxs("div",{className:"layout-dialog-div",children:[o.jsx("h2",{children:"Layout"}),o.jsx("img",{src:F,alt:"Layout preview",className:"layout-dialog-preview"}),o.jsx("br",{}),o.jsx("button",{className:"layout-dialog-close",onClick:W,children:"Close"})]})})}const Ll="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",Tl="/LayItOut/assets/template-Cjj8EPhc.png";function vl({dialogRef:d,closeDialog:W,templates:F,isOpen:D,isViewingArea:R,selectTemplate:J}){const[U,V]=u.useState(/Mobi|Android/i.test(navigator.userAgent)),[A,O]=u.useState([]),[P,y]=u.useState(!1),[I,G]=u.useState([]);return u.useEffect(()=>{G(F)},[F]),u.useEffect(()=>{if(D&&(console.log("Layout dialog opened, generating cells and sections",I),I.length!==0)){if(I.length==1){O([I[0].name]);return}O(U?[I[0].name]:[I[0].name,I[1].name])}},[D,I]),u.useEffect(()=>{const p=I.filter(x=>A.includes(x.name));console.log("Viewing templates:",A),p.sort((x,S)=>A.indexOf(x.name)-A.indexOf(S.name)),console.log("Generating templates for",p.map(x=>x.name))},[A,I]),o.jsx(o.Fragment,{children:o.jsx("dialog",{ref:d,className:"template-dialog",children:o.jsxs("div",{className:"template-dialog-div",children:[o.jsx("h2",{children:"Templates"}),o.jsxs("div",{className:"templates",children:[I.length>1&&I.filter(p=>!A.includes(p.name)).length>0&&o.jsx("img",{src:fe,onClick:()=>{if(U){const x=(I.findIndex(S=>S.name===A[0])-1+I.length)%I.length;O([I[x].name])}else O(p=>{const S=(I.findIndex(H=>H.name===p[0])-1+I.length)%I.length;return[I[S].name,p[0]]})},className:"back-mobile-areas"}),A.length===0&&o.jsx("div",{className:"no-templates",children:"No templates available"}),A.map(p=>o.jsxs("div",{className:"template",children:[o.jsx("img",{src:I.find(x=>x.name===p).previewImage,alt:p,className:"template-preview"}),o.jsx("h3",{children:p}),o.jsxs("div",{className:"template-actions",children:[o.jsx("button",{className:"template-select-btn",onClick:()=>{if(R){const x=new URLSearchParams(window.location.search),S=x.get("companyId"),H=x.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${S}&areaId=${H}&type=edit-template&templateId=${I.find(ce=>ce.name==p).id}`}else W(),J&&J(I.find(x=>x.name===p))},children:R?"Edit":"Select"}),R&&o.jsx("button",{className:"action-btn",onClick:()=>{if(P)return;y(!0);const x=I.filter(X=>X.name!==p);G(x),x.length==1?O([x[0].name]):x.length==0?O([]):O(U?[x[0].name]:[x[0].name,x[1].name]);const S=new URLSearchParams(window.location.search),H=S.get("companyId"),ce=S.get("areaId");be(H,ce,x).then(()=>{y(!1)})},children:"Delete"})]})]})),I.length>1&&I.filter(p=>!A.includes(p.name)).length>0&&o.jsx("img",{src:fe,onClick:()=>{if(U){const x=(I.findIndex(S=>S.name===A[0])+1)%I.length;O([I[x].name])}else O(p=>{const S=(I.findIndex(H=>H.name===p[p.length-1])+1)%I.length;return[p[1],I[S].name]})},className:"forward-mobile-areas"})]}),R&&o.jsxs(o.Fragment,{children:[o.jsx("button",{className:"action-btn",onClick:()=>{const p=new URLSearchParams(window.location.search),x=p.get("companyId"),S=p.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${x}&areaId=${S}&type=create-template`},children:"Create new Template"})," ",o.jsx("br",{})]}),o.jsx("br",{}),o.jsx("button",{className:"action-btn",onClick:W,children:"Close"}),P&&D&&o.jsx(o.Fragment,{children:o.jsx("div",{className:"loader"})})]})})})}function Sl({dialogRef:d,closeDialog:W,addInventoryItem:F}){const[D,R]=u.useState(""),[J,U]=u.useState(1),[V,A]=u.useState(1),[O,P]=u.useState(1);return o.jsx("dialog",{ref:d,className:"custom-item-dialog",children:o.jsxs("div",{className:"custom-item-dialog-div",children:[o.jsx("h2",{children:"Add Custom Item"}),o.jsxs("div",{className:"custom-item-row",children:[o.jsx("label",{htmlFor:"item-name",children:"Name:"}),o.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:y=>R(y.target.value??""),value:D})]}),o.jsxs("div",{className:"custom-item-row",children:[o.jsx("label",{htmlFor:"item-icon",children:"Count:"}),o.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:J,onChange:y=>U(parseInt(y.target.value)??1)})]}),o.jsxs("div",{className:"custom-item-row custom-item-size",children:[o.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),o.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:V,onChange:y=>A(parseFloat(y.target.value)??1)}),o.jsx("span",{children:" x "}),o.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:O,onChange:y=>P(parseFloat(y.target.value)??1)})]}),o.jsx("br",{}),o.jsx("button",{className:"custom-item-dialog-add",onClick:()=>{if(D.trim()===""){alert("Item name cannot be empty");return}const y=new de({quantity:J,item:new T({id:D+(Math.random()*1e4).toString(),name:D,icon:`custom-${D}`,cellsLong:Math.ceil(V),cellsTall:Math.ceil(O),moveable:!0,starterItem:!1,displayItem:!0})});F(y),R(""),U(1),A(1),P(1),W()},children:"Add Item"}),o.jsx("br",{}),o.jsx("br",{}),o.jsx("button",{className:"custom-item-dialog-close",onClick:W,children:"Close"})]})})}gl.createRoot(document.getElementById("root")).render(o.jsx(bl,{}));function bl(){const[d,W]=u.useState(/Mobi|Android/i.test(navigator.userAgent)),[F,D]=u.useState(0),[R,J]=u.useState(0),[U,V]=u.useState(0),[A,O]=u.useState(0),[P,y]=u.useState([]),[I,G]=u.useState([]),[p,x]=u.useState(0),[S,H]=u.useState(null),[ce,X]=u.useState([]),b=/Mobi|Android/i.test(navigator.userAgent)?5:10,[_,ee]=u.useState([]),he=u.useRef(null),[jl,je]=u.useState(!1),[Y,ge]=u.useState([]),[w,le]=u.useState([]),[ue,We]=u.useState([]),[Fe,Ne]=u.useState(!1),pe=u.useRef(null),[Ue,Je]=u.useState([]),[k,B]=u.useState([]),[L,ye]=u.useState(null),[ie,Ye]=u.useState(!1),[te,Ze]=u.useState(!1),[ne,He]=u.useState(!1),[Ae,Be]=u.useState(!1),[Nl,ze]=u.useState(!1),[Ve,Xe]=u.useState(!1),[Ie,xe]=u.useState(""),[se,Ee]=u.useState(""),[me,Qe]=u.useState(""),[q,Ke]=u.useState(""),[we,Le]=u.useState(""),[Te,z]=u.useState(!0),[Re,qe]=u.useState(null),[ve,Q]=u.useState(!1),[$e,_e]=u.useState(null),[el,re]=u.useState(!1),Se=u.useRef(null);function $(e,l){for(const n of l)if(e.x>=n.cellId.x&&e.x<n.cellId.x+n.cellsLong&&e.y>=n.cellId.y&&e.y<n.cellId.y+n.cellsTall)return n;return null}function ll(e){ge([...e.map(a=>new E({name:a.name,cellId:new h({x:a.cellId.x,y:a.cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,startingItems:[]}))]);let l=F,n=R;if(d){for(const t of e)console.log("Generating cells for section",t.name,"at",t.cellId,"with size",t.cellsLong,"x",t.cellsTall),console.log("Needed section Width:",(t.cellsLong+t.cellId.x)*b,"Current width:",l),(t.cellsLong+t.cellId.x)*b>l&&(console.log("Added section Width:",t.cellsLong*b+t.cellId.x),l+=(t.cellsLong+t.cellId.x)*b-l),console.log("Needed section Height:",(t.cellsTall+t.cellId.y)*b,"Current height:",n),(t.cellsTall+t.cellId.y)*b>n&&(console.log("Added section Height:",t.cellsTall*b+t.cellId.y),n+=(t.cellsTall+t.cellId.y)*b-n);O(n/b),V(l/b);let a=0;const c=[],s=[];for(const t of e){const i=[],r={width:t.cellsLong*b,height:t.cellsTall*b,sectionName:t.name};r.height>a&&(a=r.height),Je(f=>[...f,r]),t.cellId.x=0,t.cellId.y=0,[...Array(r.height/b).keys()].map(f=>{const v=[];[...Array(r.width/b).keys()].map(j=>{v.push({id:new h({x:j,y:f}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:b})}),i.push(v)}),c.push({sectionName:t.name,cells:[...i]}),s.push(t)}B(c),le(s),x(a),ye(e[0]?e[0].name:null),setTimeout(()=>{z(!1)},500)}else{const a=[];for(const c of e)console.log("Generating cells for section",c.name,"at",c.cellId,"with size",c.cellsLong,"x",c.cellsTall),console.log("Needed section Width:",c.cellsLong+c.cellId.x,"Current width:",l),c.cellsLong+c.cellId.x>l&&(console.log("Added section Width:",c.cellsLong+c.cellId.x),l+=c.cellsLong+c.cellId.x-l),console.log("Needed section Height:",c.cellsTall+c.cellId.y,"Current height:",n),c.cellsTall+c.cellId.y>n&&(console.log("Added section Height:",c.cellsTall+c.cellId.y),n+=c.cellsTall+c.cellId.y-n);D(l),J(n),V(l),O(n),console.log("Final width:",l,"Final height:",n),[...Array(n).keys()].map(c=>{const s=[];[...Array(l).keys()].map(t=>{s.push({id:new h({x:t,y:c}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:$(new h({x:t,y:c}),e)!=null,size:b})}),a.push(s)}),y([...a]),setTimeout(()=>{const c=[],s=[...e];for(const t of s)t.cellElement=document.querySelector(`.App #${t.cellId.toId()}.cell:not(.cell-border)`),c.push(...t.startingItems.map(i=>new M({cell:new h({x:t.cellId.x+i.cell.x,y:t.cellId.y+i.cell.y}),item:new T({id:i.item.id,name:i.item.name,cellsLong:i.item.cellsLong,cellsTall:i.item.cellsTall,icon:i.item.icon,initialElement:document.querySelector(`.App #${i.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:i.item.moveable,rotation:i.item.rotation||0})})));le([...s]);for(const t of c){const i=v=>{const j=v%2===1;return{cellsLong:j?t.item.cellsTall:t.item.cellsLong,cellsTall:j?t.item.cellsLong:t.item.cellsTall}},r=t.item.rotation||0,f=i(r);for(let v=0;v<f.cellsTall;v++)for(let j=0;j<f.cellsLong;j++)a[t.cell.y+v][t.cell.x+j].hasItem=!0,a[t.cell.y+v][t.cell.x+j].itemId=t.item.id;t.item.initialElement=document.querySelector(`.App #${t.cell.toId()}.cell:not(.cell-border)`),G(v=>[...v,t.item])}y([...a]),setTimeout(()=>{z(!1)},500)},100)}}async function tl(){const e=new URLSearchParams(window.location.search),l=e.get("companyId"),n=e.get("areaId"),a=e.get("areaId")||"",c=e.get("companyId")||"",s=e.get("templateId")||"",t=await fl(c,a);_e(t.previewImage||null);const i=e.get("type")||"";let r=!1;if(i==="create-template")Ye(!0);else if(i==="edit-template"){Ze(!0);const g=t.templates.find(m=>m.id===s);g&&(qe(g),Ee(g.name))}else if(i==="view-design"){r=!0,He(!0);const g=e.get("designName")||"";xe(g);const m=e.get("designId")||"";Le(m)}else if(i==="view-area")Be(!0);else if(i==="edit-design"){r=!0,ze(!0);const g=e.get("designName")||"";xe(g);const m=e.get("designId")||"";Le(m)}else if(i==="client-edit-design"){r=!0,Xe(!0);const g=e.get("designName")||"";xe(g);const m=e.get("designId")||"";Le(m)}l&&Qe(l),n&&Ke(n),ee(t.inventoryItems.map(g=>new de({item:new T({id:g.item.id,name:g.item.name,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,initialElement:g.item.initialElement,moveable:g.item.moveable,starterItem:g.item.starterItem,displayItem:!0}),quantity:g.quantity})));const f=[],v=[];for(const g of t.templates){const m=[],N=[];for(const Z of g.sections)m.push(new E({name:Z.name,cellId:new h({x:Z.cellId.x,y:Z.cellId.y}),cellsLong:Z.cellsLong,cellsTall:Z.cellsTall,startingItems:Z.startingItems.map(C=>new M({cell:new h({x:C.cell.x,y:C.cell.y}),item:new T({id:C.item.id,name:C.item.name,cellsLong:C.item.cellsLong,cellsTall:C.item.cellsTall,icon:C.item.icon,starterItem:!0,moveable:C.item.moveable,rotation:C.item.rotation||0})}))})),N.push(new E({name:Z.name,cellId:new h({x:Z.cellId.x,y:Z.cellId.y}),cellsLong:Z.cellsLong,cellsTall:Z.cellsTall,startingItems:Z.startingItems.map(C=>new M({cell:new h({x:C.cell.x,y:C.cell.y}),item:new T({id:C.item.id,name:C.item.name,cellsLong:C.item.cellsLong,cellsTall:C.item.cellsTall,icon:C.item.icon,starterItem:!0,moveable:C.item.moveable,rotation:C.item.rotation||0})}))}));f.push(new oe({name:g.name,sections:m,id:g.id,previewImage:g.previewImage})),v.push(new oe({name:g.name,sections:N,id:g.id,previewImage:g.previewImage}))}We([...f]);const j=[],K=s===""?void 0:v.find(g=>g.id===s);if(console.log("TEMPLATE",K,"AREA",t),r){const g=await hl(c,a,e.get("designId")||"");if(g===null){window.location.href="/LayItOut/DNF/";return}ee(g.inventoryItems.map(m=>new de({item:new T({id:m.item.id,name:m.item.name,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,initialElement:m.item.initialElement,moveable:m.item.moveable,starterItem:m.item.starterItem,displayItem:!0}),quantity:m.quantity}))),ge([...g.sections]),le([...g.sections.map(m=>new E({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,items:m.startingItems.map(N=>new T({id:N.item.id,name:N.item.name,sectionCell:N.cell,cellsLong:N.item.cellsLong,cellsTall:N.item.cellsTall,icon:N.item.icon,moveable:N.item.moveable,starterItem:N.item.starterItem,rotation:N.item.rotation}))}))]),j.push(...g.sections.map(m=>new E({name:m.name,cellId:new h({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,items:m.startingItems.map(N=>new T({id:N.item.id,name:N.item.name,sectionCell:N.cell,cellsLong:N.item.cellsLong,cellsTall:N.item.cellsTall,icon:N.item.icon,moveable:N.item.moveable,starterItem:N.item.starterItem,rotation:N.item.rotation}))})))}else K!==void 0?(ge([...K.sections]),le([...K.sections.map(g=>new E({name:g.name,cellId:new h({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,items:g.startingItems.map(m=>new T({id:m.item.id,name:m.item.name,sectionCell:m.cell,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,rotation:m.item.rotation}))}))]),j.push(...K.sections.map(g=>new E({name:g.name,cellId:new h({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,items:g.startingItems.map(m=>new T({id:m.item.id,name:m.item.name,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,rotation:m.item.rotation,sectionCell:m.cell}))})))):(ge([...t.sections]),le([...t.sections.map(g=>new E({name:g.name,cellId:new h({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,items:g.startingItems.map(m=>new T({id:m.item.id,name:m.item.name,sectionCell:m.cell,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,rotation:m.item.rotation}))}))]),j.push(...t.sections.map(g=>new E({name:g.name,cellId:new h({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,items:g.startingItems.map(m=>new T({id:m.item.id,name:m.item.name,sectionCell:m.cell,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,rotation:m.item.rotation}))}))));console.log("SECTIONS TO GENERATE",j),ll(j)}u.useEffect(()=>{tl()},[]);function nl(e,l,n){if(!d||e==null)return;const a=[...n],c=[],s=n.find(t=>t.name==e);console.log("NEW SECTION",s),console.log("Adding section",s.name,s.cellId),console.log("MOBILE CELLS",l),s.cellElement=document.querySelector(`.App #${s.name.split(" ").join("-")} #${s.name.split(" ").join("")}${s.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",s.cellElement);for(const t of s.startingItems){console.log("Placing starting item",t.item.name,t.cell);const i=v=>{const j=v%2===1;return{cellsLong:j?t.item.cellsTall:t.item.cellsLong,cellsTall:j?t.item.cellsLong:t.item.cellsTall}},r=t.item.rotation||0,f=i(r);for(let v=0;v<f.cellsTall;v++)for(let j=0;j<f.cellsLong;j++){const K=l.find(g=>g.sectionName===s.name);K.cells[t.cell.y+v][t.cell.x+j].hasItem=!0,K.cells[t.cell.y+v][t.cell.x+j].itemId=t.item.id}t.item.initialElement=document.querySelector(`.App #${s.name.split(" ").join("-")} #${s.name.split(" ").join("")}${t.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",t.item.initialElement),c.push(new T({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,initialElement:t.item.initialElement,starterItem:!0,moveable:t.item.moveable,rotation:t.item.rotation}))}console.log("Setting sections",a),le([...a]),console.log("ITEMS",c),G(t=>[...t.filter(r=>!c.some(f=>f.id===r.id)),...c.map(r=>new T({id:r.id,name:r.name,cellsLong:r.cellsLong,cellsTall:r.cellsTall,icon:r.icon,initialElement:r.initialElement,starterItem:!0,moveable:r.moveable,rotation:r.rotation}))])}function Oe(e){let l=[];return e.map(n=>l=[...l,...n]),l}function Ce(e,l){console.log(e);const n=d?k.find(t=>t.sectionName===L).cells:P,a=n[e.y].length,c=n.length;if(console.log(a,c),e.x+l.cellsLong>a||e.y+l.cellsTall>c)return!1;const s=$(e,w);if(!s&&!d)return console.log("Item is out of bounds of any section"),!1;for(let t=0;t<l.cellsTall;t++)for(let i=0;i<l.cellsLong;i++){if(!d){const r=$(new h({x:e.x+i,y:e.y+t}),w);if(!r)return console.log("Item is out of bounds of any section"),!1;if(r.name!=s.name)return console.log("Item is crossing section boundaries"),!1}if(n[e.y+t][e.x+i].hasItem&&n[e.y+t][e.x+i].itemId!=l.id)return console.log("Something is already here"),!1}return!0}function sl(e,l,n){const a=Array.from(d?k.find(t=>t.sectionName===L).cells:P);if(re(!0),n!=null){console.log("Removing item");const t=d?w.find(i=>i.name===L):$(n,w);t.items=t.items.filter(i=>i.id!=l.id);for(let i=0;i<l.cellsTall;i++)for(let r=0;r<l.cellsLong;r++)a[n.y+i][n.x+r].hasItem=!1,a[n.y+i][n.x+r].itemId=""}const c=d?w.find(t=>t.name===L):$(e,w),s=new h({x:e.x-c.cellId.x,y:e.y-c.cellId.y});l.sectionCell=s,console.log("Adding item to section",c.name,"at",s,l),c.items.push(l);for(let t=0;t<l.cellsTall;t++)for(let i=0;i<l.cellsLong;i++)a[e.y+t][e.x+i].hasItem=!0,a[e.y+t][e.x+i].itemId=l.id;if(console.log(a),d){const t=k.find(i=>i.sectionName===L);t&&(t.cells=a.map(i=>i.map(r=>({...r}))),B([...k]))}else y(a);if(console.log("Removing item from inventory",l.name),!l.hasMoved){const t=_.findIndex(i=>i.item.name==l.name&&!i.item.hasMoved);if(t!==-1){const i=[..._];i[t].quantity-=1,i[t].quantity<=0&&i.splice(t,1),ee(i)}else ee(_)}G(t=>(console.log("Placing item",l.id),console.log("Updating item",l.id),t.find(i=>i.id==l.id).hasMoved||(t.find(i=>i.id==l.id).hasMoved=!0),t))}function al(e){I.find(l=>l.name==e.name&&!l.hasMoved&&!l.starterItem)||G(l=>[...l,e])}function ke(e){console.log("Removing item",e.id),G(l=>l.filter(n=>n.id!=e.id))}function ol(e,l){const n=Array.from(d?k.find(i=>i.sectionName===L).cells:P);re(!0);const a=i=>{const r=i%2===1;return{cellsWide:r?e.cellsTall:e.cellsLong,cellsTall:r?e.cellsLong:e.cellsTall}},c=e.rotation||0,s=a(c);for(let i=0;i<s.cellsTall;i++)for(let r=0;r<s.cellsWide;r++)n[l.y+i][l.x+r].hasItem=!1,n[l.y+i][l.x+r].itemId="";if(d){const i=k.find(r=>r.sectionName===L);i&&(i.cells=n.map(r=>r.map(f=>({...f}))),B([...k])),B(r=>r.map(f=>f.sectionName===L?{...f,cells:n}:f))}else y(n);const t=d?w.find(i=>i.name===L):$(l,w);t.items=t.items.filter(i=>i.id!=e.id),console.log("DELETING ITEM",e.id),G(i=>(console.log(),i.filter(r=>r.id!=e.id))),ee(i=>{const r=i.findIndex(f=>f.item.name==e.name&&!f.item.hasMoved);if(r!==-1){const f=[...i];return f[r].quantity+=1,f}else return[...i,new de({item:new T({id:e.id,name:e.name,cellsLong:s.cellsWide,cellsTall:s.cellsTall,icon:e.icon}),quantity:1})]})}function cl(e,l){const n=Array.from(d?k.find(r=>r.sectionName===L).cells:P);console.log("DELETING ITEM ROTATE",e.id,e.rotation),re(!0);const a=r=>{const f=r%2===1;return{cellsWide:f?e.cellsTall:e.cellsLong,cellsTall:f?e.cellsLong:e.cellsTall}},c=e.rotation||0,s=a(c);for(let r=0;r<s.cellsTall;r++)for(let f=0;f<s.cellsWide;f++)console.log("Deleting cell",l.y+r,l.x+f),n[l.y+r][l.x+f].hasItem=!1,n[l.y+r][l.x+f].itemId="";if(d){const r=k.find(f=>f.sectionName===L);r&&(r.cells=n.map(f=>f.map(v=>({...v}))),B([...k])),B(f=>f.map(v=>v.sectionName===L?{...v,cells:n}:v))}else y(n);console.log("DELETING ITEM",e.id);const t=d?w.find(r=>r.name===L):$(l,w);t.items=t.items.filter(r=>r.id!=e.id);const i=new h({x:l.x-t.cellId.x,y:l.y-t.cellId.y});e.sectionCell=i,t.items.push(e)}function il(e,l){const n=d?k.find(s=>s.sectionName===L).cells:P,a=Array.from(n);if(n[e.y]==null){De();return}const c=Ce(e,l);a.forEach(s=>s.forEach(t=>{t.mouseOver=!1,t.canPlaceItem=!1,t.mouseOverLocation=""}));for(let s=0;s<l.cellsTall;s++)for(let t=0;t<l.cellsLong;t++)e.y+s<a.length&&e.x+t<a[e.y+s].length&&(l.cellsLong===1&&l.cellsTall===1?a[e.y+s][e.x+t].mouseOverLocation="single":l.cellsTall===1?t===0?a[e.y+s][e.x+t].mouseOverLocation="leftFull":t===l.cellsLong-1?a[e.y+s][e.x+t].mouseOverLocation="rightFull":a[e.y+s][e.x+t].mouseOverLocation="middleFull":l.cellsLong===1?s===0?a[e.y+s][e.x+t].mouseOverLocation="topFull":s===l.cellsTall-1?a[e.y+s][e.x+t].mouseOverLocation="bottomFull":a[e.y+s][e.x+t].mouseOverLocation="middleVFull":s===0&&t===0?a[e.y+s][e.x+t].mouseOverLocation="topLeftCorner":s===0&&t===l.cellsLong-1?a[e.y+s][e.x+t].mouseOverLocation="topRightCorner":s===l.cellsTall-1&&t===0?a[e.y+s][e.x+t].mouseOverLocation="bottomLeftCorner":s===l.cellsTall-1&&t===l.cellsLong-1?a[e.y+s][e.x+t].mouseOverLocation="bottomRightCorner":s===0?a[e.y+s][e.x+t].mouseOverLocation="top":s===l.cellsTall-1?a[e.y+s][e.x+t].mouseOverLocation="bottom":t===0?a[e.y+s][e.x+t].mouseOverLocation="left":t===l.cellsLong-1?a[e.y+s][e.x+t].mouseOverLocation="right":a[e.y+s][e.x+t].mouseOverLocation="middle",a[e.y+s][e.x+t].mouseOver=!0,a[e.y+s][e.x+t].canPlaceItem=c);if(d){const s=k.find(t=>t.sectionName===L);s&&(s.cells=a.map(t=>t.map(i=>({...i}))),B([...k])),B(t=>t.map(i=>i.sectionName===L?{...i,cells:a}:i))}else y(a)}function De(){console.log("Unhighlighting cells");const e=Array.from(d?k.find(l=>l.sectionName===L).cells:P);if(e.forEach(l=>l.forEach(n=>{n.mouseOver=!1,n.canPlaceItem=!1,n.mouseOverLocation=""})),d){const l=k.find(n=>n.sectionName===L);l&&(l.cells=e.map(n=>n.map(a=>({...a}))),B([...k])),B(n=>n.map(a=>a.sectionName===L?{...a,cells:e}:a))}else y(e)}u.useEffect(()=>{nl(L,k,w)},[L]),u.useEffect(()=>{const e=()=>{const l=I.find(n=>n.id===S);console.log("Unselecting item",S),H(null),l&&(X(n=>[...n,l.id]),console.log("Unselecting item",l.id),setTimeout(()=>{X(n=>n.filter(a=>a!==l.id))},300))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[S,I]);function ml(e){H(null),X(l=>[...l,e]),console.log("Unselecting item",e),setTimeout(()=>{X(l=>l.filter(n=>n!==e))},300)}function rl(e){const l=I.find(n=>n.id===S);console.log("Unselecting item",S),H(e),l&&(X(n=>[...n,l.id]),console.log("Unselecting item",l.id),setTimeout(()=>{X(n=>n.filter(a=>a!==l.id))},300))}function dl(e){ee(l=>[...l,e])}const ae=e=>{console.log("Preventing scroll"),e.preventDefault(),e.stopPropagation(),window.scrollTo(0,0)};return u.useEffect(()=>(ve?(window.addEventListener("scroll",ae),window.addEventListener("touchmove",ae,{passive:!1})):(window.removeEventListener("scroll",ae),window.removeEventListener("touchmove",ae)),()=>{window.removeEventListener("scroll",ae),window.removeEventListener("touchmove",ae)}),[ve]),o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"App",children:[o.jsx("h1",{className:"title",children:"LayItOut"}),o.jsx("br",{}),(ie||te)&&o.jsxs("div",{className:"template-name-row",children:[o.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),o.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:e=>Ee(e.target.value),value:se})]}),ne&&o.jsx("div",{className:"design-name-row",children:o.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",Ie]})}),(ie||te)&&o.jsxs("div",{className:"template-creation",children:[o.jsxs("button",{className:"action-btn",onClick:()=>{if(se.trim()==""){alert("Please enter a template name");return}if(ue.some(e=>e.name===se&&(te?e.id!==Re.id:!0))){alert("Template with this name already exists");return}te?(z(!0),setTimeout(async()=>{const e=w.map(l=>new E({name:l.name,cellId:new h({x:Y.find(n=>n.name==l.name).cellId.x,y:Y.find(n=>n.name==l.name).cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,startingItems:l.items.map(n=>new M({cell:new h({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),Q(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){Q(!1);const n=ue.map(a=>a.id===Re.id?(console.log("SECTION",w),new oe({name:se,previewImage:l.newValue,sections:w.map(c=>new E({name:c.name,cellId:new h({x:a.sections.find(s=>s.name==c.name).cellId.x,y:a.sections.find(s=>s.name==c.name).cellId.y}),cellsLong:c.cellsLong,cellsTall:c.cellsTall,startingItems:c.items.map(s=>new M({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new T({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:a.id})):new oe({name:a.name,previewImage:a.previewImage,sections:a.sections.map(c=>new E({name:c.name,cellId:new h({x:c.cellId.x,y:c.cellId.y}),cellsLong:c.cellsLong,cellsTall:c.cellsTall,startingItems:c.startingItems.map(s=>new M({cell:new h({x:s.cell.x,y:s.cell.y}),item:new T({id:s.item.id,name:s.item.name,cellsLong:s.item.cellsLong,cellsTall:s.item.cellsTall,icon:s.item.icon,starterItem:s.item.starterItem,moveable:s.item.moveable,rotation:s.item.rotation})}))})),id:a.id}));be(me,q,n).then(()=>{console.log("Template updated successfully"),z(!1);const a=new URLSearchParams(window.location.search),c=a.get("companyId"),s=a.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${c}&areaId=${s}&type=view-area`})}})},500)):(z(!0),setTimeout(async()=>{const e=w.map(l=>new E({name:l.name,cellId:new h({x:Y.find(n=>n.name==l.name).cellId.x,y:Y.find(n=>n.name==l.name).cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,startingItems:l.items.map(n=>new M({cell:new h({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),Q(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){Q(!1);const n=new oe({name:se,previewImage:l.newValue,sections:w.map(c=>new E({name:c.name,cellId:new h({x:Y.find(s=>s.name==c.name).cellId.x,y:Y.find(s=>s.name==c.name).cellId.y}),cellsLong:c.cellsLong,cellsTall:c.cellsTall,startingItems:c.items.map(s=>new M({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new T({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:se+(Math.random()*1e4).toString()}),a=[...ue.map(c=>new oe({name:c.name,previewImage:c.previewImage,sections:c.sections.map(s=>new E({name:s.name,cellId:new h({x:s.cellId.x,y:s.cellId.y}),cellsLong:s.cellsLong,cellsTall:s.cellsTall,startingItems:s.startingItems.map(t=>new M({cell:new h({x:t.cell.x,y:t.cell.y}),item:new T({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,starterItem:t.item.starterItem,moveable:t.item.moveable,rotation:t.item.rotation})}))})),id:c.id})),n];be(me,q,a).then(()=>{console.log("Template updated successfully"),z(!1);const c=new URLSearchParams(window.location.search),s=c.get("companyId"),t=c.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${s}&areaId=${t}&type=view-area`})}})},500))},children:[ie?"Create":"Save"," Template"]}),o.jsx("button",{className:"action-btn",onClick:()=>{const e=new URLSearchParams(window.location.search),l=e.get("companyId"),n=e.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${l}&areaId=${n}&type=view-area`},children:"Cancel"})]}),Ve&&o.jsxs("div",{className:"template-creation",children:[el&&o.jsx("button",{className:"action-btn",onClick:()=>{z(!0),setTimeout(async()=>{const e=w.map(l=>new E({name:l.name,cellId:new h({x:Y.find(n=>n.name==l.name).cellId.x,y:Y.find(n=>n.name==l.name).cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,startingItems:l.items.map(n=>new M({cell:new h({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),Q(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){Q(!1);const n=new Ge({name:Ie,previewImage:l.newValue,areaId:q,inventoryItems:_,sections:w.map(a=>new E({name:a.name,cellId:new h({x:Y.find(c=>c.name==a.name).cellId.x,y:Y.find(c=>c.name==a.name).cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,startingItems:a.items.map(c=>new M({cell:new h({x:c.sectionCell.x,y:c.sectionCell.y}),item:new T({id:c.id,name:c.name,cellsLong:c.cellsLong,cellsTall:c.cellsTall,icon:c.icon,starterItem:!0,moveable:c.moveable,rotation:c.rotation})}))})),id:we});Me(me,q,n).then(()=>{console.log("Design updated successfully"),re(!1),z(!1)})}})},500)},children:"Save"}),o.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),Te&&o.jsx(o.Fragment,{children:o.jsx("div",{className:"loader-backdrop",children:o.jsx("div",{className:"loader"})})})," ",o.jsxs("div",{className:"layout",children:[!ne&&o.jsx(xl,{isViewingDesign:ne,isEditingTemplate:te,isCreatingTemplate:ie,maxHeight:d?200:R*b,showAddCustomItem:()=>{Se.current?.showModal()},addDraggingItem:al,removeItem:ke,inventoryItems:_.map(e=>new de({item:new T({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,displayItem:!0}),quantity:e.quantity}))}),d?o.jsxs("div",{className:"mobile-areas",style:{height:p+"px"},children:[o.jsx("img",{src:fe,onClick:()=>{const e=w.findIndex(n=>n.name==L);if(e===-1)return;const l=(e-1+w.length)%w.length;ye(w[l].name),console.log("Changing viewing section to",w[l].name)},className:"back-mobile-areas"}),Ue.map((e,l)=>o.jsx(Pe,{width:e.width,height:e.height,cells:Oe(k.find(n=>n.sectionName==e.sectionName).cells),id:e.sectionName,visibile:L==null?!0:e.sectionName==L,section:e.sectionName},l)),o.jsx("img",{src:fe,onClick:()=>{const e=w.findIndex(n=>n.name==L);if(e===-1)return;const l=(e+1)%w.length;ye(w[l].name),console.log("Changing viewing section to",w[l].name)},className:"forward-mobile-areas"})]}):o.jsx(Pe,{width:F*b,height:R*b,cells:Oe(P)})]}),ne&&o.jsxs("div",{className:"design-view",children:[o.jsx("button",{className:"action-btn",onClick:()=>{const e=w.map(l=>new E({name:l.name,cellId:new h({x:Y.find(n=>n.name==l.name).cellId.x,y:Y.find(n=>n.name==l.name).cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,startingItems:l.items.map(n=>new M({cell:new h({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("printSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),window.location.href=`/LayItOut/Print/?companyId=${me}&areaId=${q}&designName=${Ie}&designId=${we}`},children:"Print"}),o.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/"},children:"Back"})]}),Ae&&o.jsx("div",{className:"design-view",children:o.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/"},children:"Back"})})]}),o.jsxs("div",{children:[w.map(e=>o.jsx(ul,{takingPhoto:!1,section:e,visible:L==null?!0:e.name==L,cellSize:b},e.cellId.toId())),I.map(e=>o.jsx(Il,{cellSize:b,isViewingDesign:ne,removeItem:ke,visible:d?!e.hasMoved&&!e.starterItem?!0:L==null?!1:e.starterItem?w.find(l=>l.name==L)?.startingItems.some(l=>l.item.id===e.id):w.find(l=>l.name==L)?.items.some(l=>l.id===e.id):!0,item:e,canPlaceItem:Ce,placeItem:sl,deleteItemRotate:cl,highlightCells:il,unHighlightCells:De,deleteItem:ol,isSelected:S===e.id,onSelect:rl,isUnselecting:ce.includes(e.id),onDeselect:()=>ml(e.id)},e.id))]}),d&&!Te&&o.jsx("div",{className:"layout-icon",onClick:()=>{he.current?.showModal(),je(!0),console.log("Showing layout dialog")},children:o.jsx("img",{src:Ll,alt:""})}),!Te&&!(ie||te||ne)&&o.jsx("div",{className:"template-icon",onClick:()=>{pe.current?.showModal(),Ne(!0),console.log("Showing template dialog")},children:o.jsx("img",{src:Tl,alt:""})}),o.jsx(vl,{isViewingArea:Ae,dialogRef:pe,isOpen:Fe,closeDialog:()=>{pe.current?.close(),Ne(!1)},templates:ue,selectTemplate:e=>{z(!0),setTimeout(async()=>{const l=e.sections.map(n=>new E({name:n.name,cellId:new h({x:e.sections.find(a=>a.name==n.name).cellId.x,y:e.sections.find(a=>a.name==n.name).cellId.y}),cellsLong:n.cellsLong,cellsTall:n.cellsTall,startingItems:n.items.map(a=>new M({cell:new h({x:a.sectionCell.x,y:a.sectionCell.y}),item:new T({id:a.id,name:a.name,cellsLong:a.cellsLong,cellsTall:a.cellsTall,icon:a.icon,starterItem:!0,moveable:a.moveable,rotation:a.rotation})}))}));localStorage.setItem("screenshotSections",l.map(n=>JSON.stringify(n.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",l.map(n=>JSON.stringify(n.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),Q(!0),window.addEventListener("storage",async n=>{if(console.log("Storage event",n),n.key==="screenshot"){Q(!1);const a=new Ge({name:Ie,previewImage:n.newValue,areaId:q,inventoryItems:_,sections:e.sections.map(c=>new E({name:c.name,cellId:new h({x:e.sections.find(s=>s.name==c.name).cellId.x,y:e.sections.find(s=>s.name==c.name).cellId.y}),cellsLong:c.cellsLong,cellsTall:c.cellsTall,startingItems:c.items.map(s=>new M({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new T({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:we});console.log("UPDATED DESIGN",a),Me(me,q,a).then(()=>{console.log("Design updated successfully"),re(!1),z(!1)})}})},500)}}),o.jsx(wl,{dialogRef:he,closeDialog:()=>{he.current?.close(),je(!1)},areaPreview:$e||""}),o.jsx(Sl,{dialogRef:Se,addInventoryItem:dl,closeDialog:()=>{Se.current?.close()}}),ve&&o.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:"https://trackerjo.github.io/LayItOut/Preview/",width:U*b+20,height:A*b+20})]})}
