import{r as I,j as a,c as cl}from"./index-QIV6qY6h.js";import{A as ke,S as ml,D as dl}from"./section-DZA6YsYH.js";import{I as T,T as q,S as O,C as y,b as Y,s as ve,e as ge,D as rl,u as gl,f as ul,h as Il}from"./firestore-FyM7zbDZ.js";import{F as ue}from"./add_custom_item_dialog-CkfgPpdu.js";function fl({inventoryItem:m,addDraggingItem:Z,removeItem:W}){const k=I.useRef(null),E=I.useRef(null),[M,V]=I.useState(12),[A,j]=I.useState(m.item);function J(u){const F=E.current,p=window.getComputedStyle(F),f=document.createElement("span");f.style.font=p.font,f.style.fontSize=u+"px",f.style.fontFamily=p.fontFamily,f.style.fontWeight=p.fontWeight,f.style.position="absolute",f.style.visibility="hidden",f.style.whiteSpace="nowrap",f.textContent=F.textContent,document.body.appendChild(f);const b=f.offsetWidth;return document.body.removeChild(f),b}function P(u){if(E.current){const F=E.current;return J(u-1)>F.offsetWidth&&u-1>8?P(u-1):u-1}return u}return I.useEffect(()=>{setTimeout(()=>{E.current&&V(P(M))},100)},[]),a.jsxs("div",{className:"display",children:[a.jsx("div",{ref:k,id:m.item.id,className:"display-item",style:{width:`${m.item.cellsLong*10}px`,height:`${m.item.cellsTall*10}px`},onMouseDown:u=>{u.preventDefault(),u.stopPropagation(),m.item.initialElement=k.current,m.item.id=m.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",m.item.id,"to initialElement",m.item.initialElement),j(new T({id:m.item.id,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,name:m.item.name,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,displayItem:m.item.isDisplayItem})),Z(m.item)},onTouchStart:u=>{u.preventDefault(),u.stopPropagation(),m.item.initialElement=k.current,m.item.id=m.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",m.item.id,"to initialElement",m.item.initialElement),j(new T({id:m.item.id,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,name:m.item.name,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,displayItem:m.item.isDisplayItem})),Z(m.item)},children:m.item.icon.includes("custom-")?a.jsx("div",{className:"custom-icon",children:a.jsx("div",{children:a.jsx("p",{ref:E,style:{fontSize:`${M}px`},children:m.item.icon.split("custom-")[1]})})}):a.jsx("img",{src:m.item.icon,alt:"icon"})}),a.jsx("p",{children:m.item.name}),a.jsxs("p",{className:"quantity",children:["x",m.quantity]})]})}const hl="/LayItOut/assets/plus.circle-Ce3xm00a.png";function pl({inventoryItems:m,addDraggingItem:Z,maxHeight:W,removeItem:k,showAddCustomItem:E,isCreatingTemplate:M,isEditingTemplate:V,isViewingDesign:A}){return a.jsxs("div",{className:"toolbox",style:{maxHeight:W?`${W}px`:"200px"},children:[m.map(j=>a.jsx(fl,{inventoryItem:j,addDraggingItem:Z,removeItem:k})),!(M||V||A)&&a.jsx("div",{className:"add-item",onClick:()=>{E()},children:a.jsx("img",{src:hl,alt:"Add Item"})})]})}function yl({dialogRef:m,closeDialog:Z,areaPreview:W}){return a.jsx("dialog",{ref:m,className:"layout-dialog",children:a.jsxs("div",{className:"layout-dialog-div",children:[a.jsx("h2",{children:"Layout"}),a.jsx("img",{src:W,alt:"Layout preview",className:"layout-dialog-preview"}),a.jsx("br",{}),a.jsx("button",{className:"layout-dialog-close",onClick:Z,children:"Close"})]})})}const xl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",wl="/LayItOut/assets/template-Cjj8EPhc.png";function Ll({dialogRef:m,closeDialog:Z,templates:W,isOpen:k,isViewingArea:E}){const[M,V]=I.useState(/Mobi|Android/i.test(navigator.userAgent)),[A,j]=I.useState([]),[J,P]=I.useState(!1),[u,F]=I.useState([]);return I.useEffect(()=>{F(W)},[W]),I.useEffect(()=>{if(k&&(console.log("Layout dialog opened, generating cells and sections",u),u.length!==0)){if(u.length==1){j([u[0].name]);return}j(M?[u[0].name]:[u[0].name,u[1].name])}},[k,u]),I.useEffect(()=>{const p=u.filter(f=>A.includes(f.name));console.log("Viewing templates:",A),p.sort((f,b)=>A.indexOf(f.name)-A.indexOf(b.name)),console.log("Generating templates for",p.map(f=>f.name))},[A,u]),a.jsx(a.Fragment,{children:a.jsx("dialog",{ref:m,className:"template-dialog",children:a.jsxs("div",{className:"template-dialog-div",children:[a.jsx("h2",{children:"Templates"}),a.jsxs("div",{className:"templates",children:[u.length>1&&u.filter(p=>!A.includes(p.name)).length>0&&a.jsx("img",{src:ue,onClick:()=>{if(M){const f=(u.findIndex(b=>b.name===A[0])-1+u.length)%u.length;j([u[f].name])}else j(p=>{const b=(u.findIndex(D=>D.name===p[0])-1+u.length)%u.length;return[u[b].name,p[0]]})},className:"back-mobile-areas"}),A.length===0&&a.jsx("div",{className:"no-templates",children:"No templates available"}),A.map(p=>a.jsxs("div",{className:"template",children:[a.jsx("img",{src:u.find(f=>f.name===p).previewImage,alt:p,className:"template-preview"}),a.jsx("h3",{children:p}),a.jsxs("div",{className:"template-actions",children:[a.jsx("button",{className:"template-select-btn",onClick:()=>{if(E){const f=new URLSearchParams(window.location.search),b=f.get("companyId"),D=f.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${b}&areaId=${D}&type=edit-template&templateId=${u.find(G=>G.name==p).id}`}else{const f=u.find(G=>G.name===p),b=new q({name:f.name,id:f.id,previewImage:f.previewImage,sections:f.sections.map(G=>new O({name:G.name,cellId:new y({x:G.cellId.x,y:G.cellId.y}),cellsLong:G.cellsLong,cellsTall:G.cellsTall,startingItems:G.startingItems.map(U=>new Y({cell:new y({x:U.cell.x,y:U.cell.y}),item:new T({id:U.item.id,name:U.item.name,icon:U.item.icon,cellsLong:U.item.cellsLong,cellsTall:U.item.cellsTall,starterItem:U.item.starterItem,moveable:U.item.moveable})}))}))}),D=new URLSearchParams(window.location.search);D.set("templateName",b.name),window.location.search=D.toString()}},children:E?"Edit":"Select"}),E&&a.jsx("button",{className:"action-btn",onClick:()=>{if(J)return;P(!0);const f=u.filter(U=>U.name!==p);F(f),f.length==1?j([f[0].name]):f.length==0?j([]):j(M?[f[0].name]:[f[0].name,f[1].name]);const b=new URLSearchParams(window.location.search),D=b.get("companyId"),G=b.get("areaId");ve(D,G,f).then(()=>{P(!1)})},children:"Delete"})]})]})),u.length>1&&u.filter(p=>!A.includes(p.name)).length>0&&a.jsx("img",{src:ue,onClick:()=>{if(M){const f=(u.findIndex(b=>b.name===A[0])+1)%u.length;j([u[f].name])}else j(p=>{const b=(u.findIndex(D=>D.name===p[p.length-1])+1)%u.length;return[p[1],u[b].name]})},className:"forward-mobile-areas"})]}),E&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"action-btn",onClick:()=>{const p=new URLSearchParams(window.location.search),f=p.get("companyId"),b=p.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${f}&areaId=${b}&type=create-template`},children:"Create new Template"})," ",a.jsx("br",{})]}),a.jsx("br",{}),a.jsx("button",{className:"action-btn",onClick:Z,children:"Close"}),J&&k&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"loader"})})]})})})}function Tl({dialogRef:m,closeDialog:Z,addInventoryItem:W}){const[k,E]=I.useState(""),[M,V]=I.useState(1),[A,j]=I.useState(1),[J,P]=I.useState(1);return a.jsx("dialog",{ref:m,className:"custom-item-dialog",children:a.jsxs("div",{className:"custom-item-dialog-div",children:[a.jsx("h2",{children:"Add Custom Item"}),a.jsxs("div",{className:"custom-item-row",children:[a.jsx("label",{htmlFor:"item-name",children:"Name:"}),a.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:u=>E(u.target.value??""),value:k})]}),a.jsxs("div",{className:"custom-item-row",children:[a.jsx("label",{htmlFor:"item-icon",children:"Count:"}),a.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:M,onChange:u=>V(parseInt(u.target.value)??1)})]}),a.jsxs("div",{className:"custom-item-row custom-item-size",children:[a.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),a.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:A,onChange:u=>j(parseFloat(u.target.value)??1)}),a.jsx("span",{children:" x "}),a.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:J,onChange:u=>P(parseFloat(u.target.value)??1)})]}),a.jsx("br",{}),a.jsx("button",{className:"custom-item-dialog-add",onClick:()=>{if(k.trim()===""){alert("Item name cannot be empty");return}const u=new ge({quantity:M,item:new T({id:k+(Math.random()*1e4).toString(),name:k,icon:`custom-${k}`,cellsLong:Math.ceil(A),cellsTall:Math.ceil(J),moveable:!0,starterItem:!1,displayItem:!0})});W(u),E(""),V(1),j(1),P(1),Z()},children:"Add Item"}),a.jsx("br",{}),a.jsx("br",{}),a.jsx("button",{className:"custom-item-dialog-close",onClick:Z,children:"Close"})]})})}cl.createRoot(document.getElementById("root")).render(a.jsx(vl,{}));function vl(){const[m,Z]=I.useState(/Mobi|Android/i.test(navigator.userAgent)),[W,k]=I.useState(0),[E,M]=I.useState(0),[V,A]=I.useState(0),[j,J]=I.useState(0),[P,u]=I.useState([]),[F,p]=I.useState([]),[f,b]=I.useState(0),[D,G]=I.useState(null),[U,$]=I.useState([]),N=/Mobi|Android/i.test(navigator.userAgent)?5:10,[ce,ae]=I.useState([]),Ie=I.useRef(null),[bl,be]=I.useState(!1),[B,me]=I.useState([]),[x,_]=I.useState([]),[de,De]=I.useState([]),[Pe,Se]=I.useState(!1),fe=I.useRef(null),[Ge,Me]=I.useState([]),[C,z]=I.useState([]),[w,he]=I.useState(null),[oe,We]=I.useState(!1),[ee,Fe]=I.useState(!1),[le,Ue]=I.useState(!1),[Ze,He]=I.useState(!1),[Sl,Ye]=I.useState(!1),[Je,Be]=I.useState(!1),[pe,ye]=I.useState(""),[te,je]=I.useState(""),[re,ze]=I.useState(""),[ie,Ve]=I.useState(""),[Ne,xe]=I.useState(""),[we,X]=I.useState(!0),[Ae,Xe]=I.useState(null),[Le,ne]=I.useState(!1),[Qe,Ke]=I.useState(null),Te=I.useRef(null);function K(e,t){for(const n of t)if(e.x>=n.cellId.x&&e.x<n.cellId.x+n.cellsLong&&e.y>=n.cellId.y&&e.y<n.cellId.y+n.cellsTall)return n;return null}function qe(e){me([...e.map(i=>new O({name:i.name,cellId:new y({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,startingItems:[]}))]);let t=W,n=E;if(m){for(const l of e)console.log("Generating cells for section",l.name,"at",l.cellId,"with size",l.cellsLong,"x",l.cellsTall),console.log("Needed section Width:",(l.cellsLong+l.cellId.x)*N,"Current width:",t),(l.cellsLong+l.cellId.x)*N>t&&(console.log("Added section Width:",l.cellsLong*N+l.cellId.x),t+=(l.cellsLong+l.cellId.x)*N-t),console.log("Needed section Height:",(l.cellsTall+l.cellId.y)*N,"Current height:",n),(l.cellsTall+l.cellId.y)*N>n&&(console.log("Added section Height:",l.cellsTall*N+l.cellId.y),n+=(l.cellsTall+l.cellId.y)*N-n);J(n*2),A(t*2);let i=0;const o=[],s=[];for(const l of e){const c=[],d={width:l.cellsLong*N,height:l.cellsTall*N,sectionName:l.name};d.height>i&&(i=d.height),Me(h=>[...h,d]),l.cellId.x=0,l.cellId.y=0,[...Array(d.height/N).keys()].map(h=>{const L=[];[...Array(d.width/N).keys()].map(v=>{L.push({id:new y({x:v,y:h}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:N})}),c.push(L)}),o.push({sectionName:l.name,cells:[...c]}),s.push(l)}z(o),_(s),b(i),he(e[0]?e[0].name:null),setTimeout(()=>{X(!1)},500)}else{const i=[];for(const o of e)console.log("Generating cells for section",o.name,"at",o.cellId,"with size",o.cellsLong,"x",o.cellsTall),console.log("Needed section Width:",o.cellsLong+o.cellId.x,"Current width:",t),o.cellsLong+o.cellId.x>t&&(console.log("Added section Width:",o.cellsLong+o.cellId.x),t+=o.cellsLong+o.cellId.x-t),console.log("Needed section Height:",o.cellsTall+o.cellId.y,"Current height:",n),o.cellsTall+o.cellId.y>n&&(console.log("Added section Height:",o.cellsTall+o.cellId.y),n+=o.cellsTall+o.cellId.y-n);k(t),M(n),A(t),J(n),console.log("Final width:",t,"Final height:",n),[...Array(n).keys()].map(o=>{const s=[];[...Array(t).keys()].map(l=>{s.push({id:new y({x:l,y:o}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:K(new y({x:l,y:o}),e)!=null,size:N})}),i.push(s)}),u([...i]),setTimeout(()=>{const o=[],s=[...e];for(const l of s)l.cellElement=document.querySelector(`.App #${l.cellId.toId()}.cell:not(.cell-border)`),o.push(...l.startingItems.map(c=>new Y({cell:new y({x:l.cellId.x+c.cell.x,y:l.cellId.y+c.cell.y}),item:new T({id:c.item.id,name:c.item.name,cellsLong:c.item.cellsLong,cellsTall:c.item.cellsTall,icon:c.item.icon,initialElement:document.querySelector(`.App #${c.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:c.item.moveable,rotation:c.item.rotation||0})})));_([...s]);for(const l of o){const c=L=>{const v=L%2===1;return{cellsLong:v?l.item.cellsTall:l.item.cellsLong,cellsTall:v?l.item.cellsLong:l.item.cellsTall}},d=l.item.rotation||0,h=c(d);for(let L=0;L<h.cellsTall;L++)for(let v=0;v<h.cellsLong;v++)i[l.cell.y+L][l.cell.x+v].hasItem=!0,i[l.cell.y+L][l.cell.x+v].itemId=l.item.id;l.item.initialElement=document.querySelector(`.App #${l.cell.toId()}.cell:not(.cell-border)`),p(L=>[...L,l.item])}u([...i]),setTimeout(()=>{X(!1)},500)},100)}}async function $e(){const e=new URLSearchParams(window.location.search),t=e.get("companyId"),n=e.get("areaId"),i=e.get("areaId")||"",o=e.get("companyId")||"",s=e.get("templateId")||"",l=await ul(o,i);Ke(l.previewImage||null);const c=e.get("type")||"";let d=!1;if(c==="create-template")We(!0);else if(c==="edit-template"){Fe(!0);const r=l.templates.find(g=>g.id===s);r&&(Xe(r),je(r.name))}else if(c==="view-design"){d=!0,Ue(!0);const r=e.get("designName")||"";ye(r);const g=e.get("designId")||"";xe(g)}else if(c==="view-area")He(!0);else if(c==="edit-design"){d=!0,Ye(!0);const r=e.get("designName")||"";ye(r);const g=e.get("designId")||"";xe(g)}else if(c==="client-edit-design"){d=!0,Be(!0);const r=e.get("designName")||"";ye(r);const g=e.get("designId")||"";xe(g)}t&&ze(t),n&&Ve(n),ae(l.inventoryItems.map(r=>new ge({item:new T({id:r.item.id,name:r.item.name,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,icon:r.item.icon,initialElement:r.item.initialElement,moveable:r.item.moveable,starterItem:r.item.starterItem,displayItem:!0}),quantity:r.quantity})));const h=[],L=[];for(const r of l.templates){const g=[],S=[];for(const H of r.sections)g.push(new O({name:H.name,cellId:new y({x:H.cellId.x,y:H.cellId.y}),cellsLong:H.cellsLong,cellsTall:H.cellsTall,startingItems:H.startingItems.map(R=>new Y({cell:new y({x:R.cell.x,y:R.cell.y}),item:new T({id:R.item.id,name:R.item.name,cellsLong:R.item.cellsLong,cellsTall:R.item.cellsTall,icon:R.item.icon,starterItem:!0,moveable:R.item.moveable,rotation:R.item.rotation||0})}))})),S.push(new O({name:H.name,cellId:new y({x:H.cellId.x,y:H.cellId.y}),cellsLong:H.cellsLong,cellsTall:H.cellsTall,startingItems:H.startingItems.map(R=>new Y({cell:new y({x:R.cell.x,y:R.cell.y}),item:new T({id:R.item.id,name:R.item.name,cellsLong:R.item.cellsLong,cellsTall:R.item.cellsTall,icon:R.item.icon,starterItem:!0,moveable:R.item.moveable,rotation:R.item.rotation||0})}))}));h.push(new q({name:r.name,sections:g,id:r.id,previewImage:r.previewImage})),L.push(new q({name:r.name,sections:S,id:r.id,previewImage:r.previewImage}))}De([...h]);const v=[],Q=s===""?void 0:L.find(r=>r.id===s);if(console.log("TEMPLATE",Q,"AREA",l),d){const r=await Il(o,i,e.get("designId")||"");if(r===null){window.location.href="/LayItOut/DNF/";return}me([...r.sections]),_([...r.sections.map(g=>new O({name:g.name,cellId:new y({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,items:g.startingItems.map(S=>new T({id:S.item.id,name:S.item.name,sectionCell:S.cell,cellsLong:S.item.cellsLong,cellsTall:S.item.cellsTall,icon:S.item.icon,moveable:S.item.moveable,starterItem:S.item.starterItem,rotation:S.item.rotation}))}))]),v.push(...r.sections.map(g=>new O({name:g.name,cellId:new y({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,items:g.startingItems.map(S=>new T({id:S.item.id,name:S.item.name,sectionCell:S.cell,cellsLong:S.item.cellsLong,cellsTall:S.item.cellsTall,icon:S.item.icon,moveable:S.item.moveable,starterItem:S.item.starterItem,rotation:S.item.rotation}))})))}else Q!==void 0?(me([...Q.sections]),_([...Q.sections.map(r=>new O({name:r.name,cellId:new y({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,startingItems:r.startingItems,items:r.startingItems.map(g=>new T({id:g.item.id,name:g.item.name,sectionCell:g.cell,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,moveable:g.item.moveable,starterItem:g.item.starterItem,rotation:g.item.rotation}))}))]),v.push(...Q.sections.map(r=>new O({name:r.name,cellId:new y({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,startingItems:r.startingItems,items:r.startingItems.map(g=>new T({id:g.item.id,name:g.item.name,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,moveable:g.item.moveable,starterItem:g.item.starterItem,rotation:g.item.rotation,sectionCell:g.cell}))})))):(me([...l.sections]),_([...l.sections.map(r=>new O({name:r.name,cellId:new y({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,startingItems:r.startingItems,items:r.startingItems.map(g=>new T({id:g.item.id,name:g.item.name,sectionCell:g.cell,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,moveable:g.item.moveable,starterItem:g.item.starterItem,rotation:g.item.rotation}))}))]),v.push(...l.sections.map(r=>new O({name:r.name,cellId:new y({x:r.cellId.x,y:r.cellId.y}),cellsLong:r.cellsLong,cellsTall:r.cellsTall,startingItems:r.startingItems,items:r.startingItems.map(g=>new T({id:g.item.id,name:g.item.name,sectionCell:g.cell,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,moveable:g.item.moveable,starterItem:g.item.starterItem,rotation:g.item.rotation}))}))));console.log("SECTIONS TO GENERATE",v),qe(v)}I.useEffect(()=>{$e()},[]);function _e(e,t,n){if(!m||e==null)return;const i=[...n],o=[],s=n.find(l=>l.name==e);console.log("NEW SECTION",s),console.log("Adding section",s.name,s.cellId),console.log("MOBILE CELLS",t),s.cellElement=document.querySelector(`.App #${s.name.split(" ").join("-")} #${s.name.split(" ").join("")}${s.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",s.cellElement);for(const l of s.startingItems){console.log("Placing starting item",l.item.name,l.cell);const c=L=>{const v=L%2===1;return{cellsLong:v?l.item.cellsTall:l.item.cellsLong,cellsTall:v?l.item.cellsLong:l.item.cellsTall}},d=l.item.rotation||0,h=c(d);for(let L=0;L<h.cellsTall;L++)for(let v=0;v<h.cellsLong;v++){const Q=t.find(r=>r.sectionName===s.name);Q.cells[l.cell.y+L][l.cell.x+v].hasItem=!0,Q.cells[l.cell.y+L][l.cell.x+v].itemId=l.item.id}l.item.initialElement=document.querySelector(`.App #${s.name.split(" ").join("-")} #${s.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",l.item.initialElement),o.push(new T({id:l.item.id,name:l.item.name,cellsLong:l.item.cellsLong,cellsTall:l.item.cellsTall,icon:l.item.icon,initialElement:l.item.initialElement,starterItem:!0,moveable:l.item.moveable,rotation:l.item.rotation}))}console.log("Setting sections",i),_([...i]),console.log("ITEMS",o),p(l=>[...l.filter(d=>!o.some(h=>h.id===d.id)),...o.map(d=>new T({id:d.id,name:d.name,cellsLong:d.cellsLong,cellsTall:d.cellsTall,icon:d.icon,initialElement:d.initialElement,starterItem:!0,moveable:d.moveable,rotation:d.rotation}))])}function Ee(e){let t=[];return e.map(n=>t=[...t,...n]),t}function Re(e,t){console.log(e);const n=m?C.find(l=>l.sectionName===w).cells:P,i=n[e.y].length,o=n.length;if(console.log(i,o),e.x+t.cellsLong>i||e.y+t.cellsTall>o)return!1;const s=K(e,x);if(!s&&!m)return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<t.cellsTall;l++)for(let c=0;c<t.cellsLong;c++){if(!m){const d=K(new y({x:e.x+c,y:e.y+l}),x);if(!d)return console.log("Item is out of bounds of any section"),!1;if(d.name!=s.name)return console.log("Item is crossing section boundaries"),!1}if(n[e.y+l][e.x+c].hasItem&&n[e.y+l][e.x+c].itemId!=t.id)return console.log("Something is already here"),!1}return!0}function el(e,t,n){const i=Array.from(m?C.find(l=>l.sectionName===w).cells:P);if(n!=null){console.log("Removing item");const l=m?x.find(c=>c.name===w):K(n,x);l.items=l.items.filter(c=>c.id!=t.id);for(let c=0;c<t.cellsTall;c++)for(let d=0;d<t.cellsLong;d++)i[n.y+c][n.x+d].hasItem=!1,i[n.y+c][n.x+d].itemId=""}const o=m?x.find(l=>l.name===w):K(e,x),s=new y({x:e.x-o.cellId.x,y:e.y-o.cellId.y});t.sectionCell=s,console.log("Adding item to section",o.name,"at",s,t),o.items.push(t);for(let l=0;l<t.cellsTall;l++)for(let c=0;c<t.cellsLong;c++)i[e.y+l][e.x+c].hasItem=!0,i[e.y+l][e.x+c].itemId=t.id;if(console.log(i),m){const l=C.find(c=>c.sectionName===w);l&&(l.cells=i.map(c=>c.map(d=>({...d}))),z([...C]))}else u(i);if(console.log("Removing item from inventory",t.name),!t.hasMoved){const l=ce.findIndex(c=>c.item.name==t.name&&!c.item.hasMoved);if(l!==-1){const c=[...ce];c[l].quantity-=1,c[l].quantity<=0&&c.splice(l,1),ae(c)}else ae(ce)}p(l=>(console.log("Placing item",t.id),console.log("Updating item",t.id),l.find(c=>c.id==t.id).hasMoved||(l.find(c=>c.id==t.id).hasMoved=!0),l))}function ll(e){F.find(t=>t.name==e.name&&!t.hasMoved&&!t.starterItem)||p(t=>[...t,e])}function Ce(e){console.log("Removing item",e.id),p(t=>t.filter(n=>n.id!=e.id))}function tl(e,t){const n=Array.from(m?C.find(c=>c.sectionName===w).cells:P),i=c=>{const d=c%2===1;return{cellsWide:d?e.cellsTall:e.cellsLong,cellsTall:d?e.cellsLong:e.cellsTall}},o=e.rotation||0,s=i(o);for(let c=0;c<s.cellsTall;c++)for(let d=0;d<s.cellsWide;d++)n[t.y+c][t.x+d].hasItem=!1,n[t.y+c][t.x+d].itemId="";if(m){const c=C.find(d=>d.sectionName===w);c&&(c.cells=n.map(d=>d.map(h=>({...h}))),z([...C])),z(d=>d.map(h=>h.sectionName===w?{...h,cells:n}:h))}else u(n);const l=m?x.find(c=>c.name===w):K(t,x);l.items=l.items.filter(c=>c.id!=e.id),console.log("DELETING ITEM",e.id),p(c=>(console.log(),c.filter(d=>d.id!=e.id))),ae(c=>{const d=c.findIndex(h=>h.item.name==e.name&&!h.item.hasMoved);if(d!==-1){const h=[...c];return h[d].quantity+=1,h}else return[...c,new ge({item:new T({id:e.id,name:e.name,cellsLong:s.cellsWide,cellsTall:s.cellsTall,icon:e.icon}),quantity:1})]})}function nl(e,t){const n=Array.from(m?C.find(d=>d.sectionName===w).cells:P);console.log("DELETING ITEM ROTATE",e.id,e.rotation);const i=d=>{const h=d%2===1;return{cellsWide:h?e.cellsTall:e.cellsLong,cellsTall:h?e.cellsLong:e.cellsTall}},o=e.rotation||0,s=i(o);for(let d=0;d<s.cellsTall;d++)for(let h=0;h<s.cellsWide;h++)console.log("Deleting cell",t.y+d,t.x+h),n[t.y+d][t.x+h].hasItem=!1,n[t.y+d][t.x+h].itemId="";if(m){const d=C.find(h=>h.sectionName===w);d&&(d.cells=n.map(h=>h.map(L=>({...L}))),z([...C])),z(h=>h.map(L=>L.sectionName===w?{...L,cells:n}:L))}else u(n);console.log("DELETING ITEM",e.id);const l=m?x.find(d=>d.name===w):K(t,x);l.items=l.items.filter(d=>d.id!=e.id);const c=new y({x:t.x-l.cellId.x,y:t.y-l.cellId.y});e.sectionCell=c,l.items.push(e)}function sl(e,t){const n=m?C.find(s=>s.sectionName===w).cells:P,i=Array.from(n);if(n[e.y]==null){Oe();return}const o=Re(e,t);i.forEach(s=>s.forEach(l=>{l.mouseOver=!1,l.canPlaceItem=!1,l.mouseOverLocation=""}));for(let s=0;s<t.cellsTall;s++)for(let l=0;l<t.cellsLong;l++)e.y+s<i.length&&e.x+l<i[e.y+s].length&&(t.cellsLong===1&&t.cellsTall===1?i[e.y+s][e.x+l].mouseOverLocation="single":t.cellsTall===1?l===0?i[e.y+s][e.x+l].mouseOverLocation="leftFull":l===t.cellsLong-1?i[e.y+s][e.x+l].mouseOverLocation="rightFull":i[e.y+s][e.x+l].mouseOverLocation="middleFull":t.cellsLong===1?s===0?i[e.y+s][e.x+l].mouseOverLocation="topFull":s===t.cellsTall-1?i[e.y+s][e.x+l].mouseOverLocation="bottomFull":i[e.y+s][e.x+l].mouseOverLocation="middleVFull":s===0&&l===0?i[e.y+s][e.x+l].mouseOverLocation="topLeftCorner":s===0&&l===t.cellsLong-1?i[e.y+s][e.x+l].mouseOverLocation="topRightCorner":s===t.cellsTall-1&&l===0?i[e.y+s][e.x+l].mouseOverLocation="bottomLeftCorner":s===t.cellsTall-1&&l===t.cellsLong-1?i[e.y+s][e.x+l].mouseOverLocation="bottomRightCorner":s===0?i[e.y+s][e.x+l].mouseOverLocation="top":s===t.cellsTall-1?i[e.y+s][e.x+l].mouseOverLocation="bottom":l===0?i[e.y+s][e.x+l].mouseOverLocation="left":l===t.cellsLong-1?i[e.y+s][e.x+l].mouseOverLocation="right":i[e.y+s][e.x+l].mouseOverLocation="middle",i[e.y+s][e.x+l].mouseOver=!0,i[e.y+s][e.x+l].canPlaceItem=o);if(m){const s=C.find(l=>l.sectionName===w);s&&(s.cells=i.map(l=>l.map(c=>({...c}))),z([...C])),z(l=>l.map(c=>c.sectionName===w?{...c,cells:i}:c))}else u(i)}function Oe(){console.log("Unhighlighting cells");const e=Array.from(m?C.find(t=>t.sectionName===w).cells:P);if(e.forEach(t=>t.forEach(n=>{n.mouseOver=!1,n.canPlaceItem=!1,n.mouseOverLocation=""})),m){const t=C.find(n=>n.sectionName===w);t&&(t.cells=e.map(n=>n.map(i=>({...i}))),z([...C])),z(n=>n.map(i=>i.sectionName===w?{...i,cells:e}:i))}else u(e)}I.useEffect(()=>{_e(w,C,x)},[w]),I.useEffect(()=>{const e=()=>{const t=F.find(n=>n.id===D);console.log("Unselecting item",D),G(null),t&&($(n=>[...n,t.id]),console.log("Unselecting item",t.id),setTimeout(()=>{$(n=>n.filter(i=>i!==t.id))},300))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[D,F]);function al(e){G(null),$(t=>[...t,e]),console.log("Unselecting item",e),setTimeout(()=>{$(t=>t.filter(n=>n!==e))},300)}function ol(e){const t=F.find(n=>n.id===D);console.log("Unselecting item",D),G(e),t&&($(n=>[...n,t.id]),console.log("Unselecting item",t.id),setTimeout(()=>{$(n=>n.filter(i=>i!==t.id))},300))}function il(e){ae(t=>[...t,e])}const se=e=>{console.log("Preventing scroll"),e.preventDefault(),e.stopPropagation(),window.scrollTo(0,0)};return I.useEffect(()=>(Le?(window.addEventListener("scroll",se),window.addEventListener("touchmove",se,{passive:!1})):(window.removeEventListener("scroll",se),window.removeEventListener("touchmove",se)),()=>{window.removeEventListener("scroll",se),window.removeEventListener("touchmove",se)}),[Le]),a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"App",children:[a.jsx("h1",{className:"title",children:"LayItOut"}),a.jsx("br",{}),(oe||ee)&&a.jsxs("div",{className:"template-name-row",children:[a.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),a.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:e=>je(e.target.value),value:te})]}),le&&a.jsx("div",{className:"design-name-row",children:a.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",pe]})}),(oe||ee)&&a.jsxs("div",{className:"template-creation",children:[a.jsxs("button",{className:"action-btn",onClick:()=>{if(te.trim()==""){alert("Please enter a template name");return}if(de.some(e=>e.name===te&&(ee?e.id!==Ae.id:!0))){alert("Template with this name already exists");return}ee?(X(!0),setTimeout(async()=>{const e=x.map(t=>new O({name:t.name,cellId:new y({x:B.find(n=>n.name==t.name).cellId.x,y:B.find(n=>n.name==t.name).cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,startingItems:t.items.map(n=>new Y({cell:new y({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ne(!0),window.addEventListener("storage",async t=>{if(console.log("Storage event",t),t.key==="screenshot"){ne(!1);const n=de.map(i=>i.id===Ae.id?(console.log("SECTION",x),new q({name:te,previewImage:t.newValue,sections:x.map(o=>new O({name:o.name,cellId:new y({x:i.sections.find(s=>s.name==o.name).cellId.x,y:i.sections.find(s=>s.name==o.name).cellId.y}),cellsLong:o.cellsLong*10,cellsTall:o.cellsTall*10,startingItems:o.items.map(s=>new Y({cell:new y({x:s.sectionCell.x,y:s.sectionCell.y}),item:new T({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:i.id})):new q({name:i.name,previewImage:i.previewImage,sections:i.sections.map(o=>new O({name:o.name,cellId:new y({x:o.cellId.x,y:o.cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,startingItems:o.startingItems.map(s=>new Y({cell:new y({x:s.cell.x,y:s.cell.y}),item:new T({id:s.item.id,name:s.item.name,cellsLong:s.item.cellsLong,cellsTall:s.item.cellsTall,icon:s.item.icon,starterItem:s.item.starterItem,moveable:s.item.moveable,rotation:s.item.rotation})}))})),id:i.id}));ve(re,ie,n).then(()=>{console.log("Template updated successfully"),X(!1);const i=new URLSearchParams(window.location.search),o=i.get("companyId"),s=i.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${o}&areaId=${s}&type=view-area`})}})},500)):(X(!0),setTimeout(async()=>{const e=x.map(t=>new O({name:t.name,cellId:new y({x:B.find(n=>n.name==t.name).cellId.x,y:B.find(n=>n.name==t.name).cellId.y}),cellsLong:t.cellsLong,cellsTall:t.cellsTall,startingItems:t.items.map(n=>new Y({cell:new y({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ne(!0),window.addEventListener("storage",async t=>{if(console.log("Storage event",t),t.key==="screenshot"){ne(!1);const n=new q({name:te,previewImage:t.newValue,sections:x.map(o=>new O({name:o.name,cellId:new y({x:B.find(s=>s.name==o.name).cellId.x,y:B.find(s=>s.name==o.name).cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,startingItems:o.items.map(s=>new Y({cell:new y({x:s.sectionCell.x,y:s.sectionCell.y}),item:new T({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:te+(Math.random()*1e4).toString()}),i=[...de.map(o=>new q({name:o.name,previewImage:o.previewImage,sections:o.sections.map(s=>new O({name:s.name,cellId:new y({x:s.cellId.x,y:s.cellId.y}),cellsLong:s.cellsLong,cellsTall:s.cellsTall,startingItems:s.startingItems.map(l=>new Y({cell:new y({x:l.cell.x,y:l.cell.y}),item:new T({id:l.item.id,name:l.item.name,cellsLong:l.item.cellsLong,cellsTall:l.item.cellsTall,icon:l.item.icon,starterItem:l.item.starterItem,moveable:l.item.moveable,rotation:l.item.rotation})}))})),id:o.id})),n];ve(re,ie,i).then(()=>{console.log("Template updated successfully"),X(!1);const o=new URLSearchParams(window.location.search),s=o.get("companyId"),l=o.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${s}&areaId=${l}&type=view-area`})}})},500))},children:[oe?"Create":"Save"," Template"]}),a.jsx("button",{className:"action-btn",onClick:()=>{const e=new URLSearchParams(window.location.search),t=e.get("companyId"),n=e.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${t}&areaId=${n}&type=view-area`},children:"Cancel"})]}),Je&&a.jsxs("div",{className:"template-creation",children:[a.jsx("button",{className:"action-btn",onClick:()=>{X(!0),setTimeout(async()=>{const e=x.map(t=>new O({name:t.name,cellId:new y({x:B.find(n=>n.name==t.name).cellId.x*20,y:B.find(n=>n.name==t.name).cellId.y*20}),cellsLong:t.cellsLong*10,cellsTall:t.cellsTall*10,startingItems:t.items.map(n=>new Y({cell:new y({x:n.sectionCell.x,y:n.sectionCell.y}),item:new T({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(t=>JSON.stringify(t.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),ne(!0),window.addEventListener("storage",async t=>{if(console.log("Storage event",t),t.key==="screenshot"){ne(!1);const n=new rl({name:pe,previewImage:t.newValue,areaId:ie,sections:x.map(i=>new O({name:i.name,cellId:new y({x:B.find(o=>o.name==i.name).cellId.x,y:B.find(o=>o.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,startingItems:i.items.map(o=>new Y({cell:new y({x:o.sectionCell.x,y:o.sectionCell.y}),item:new T({id:o.id,name:o.name,cellsLong:o.cellsLong,cellsTall:o.cellsTall,icon:o.icon,starterItem:!0,moveable:o.moveable,rotation:o.rotation})}))})),id:Ne});gl(re,ie,n).then(()=>{console.log("Design updated successfully"),X(!1)})}})},500)},children:"Save"}),a.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),we&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"loader-backdrop",children:a.jsx("div",{className:"loader"})})})," ",a.jsxs("div",{className:"layout",children:[!le&&a.jsx(pl,{isViewingDesign:le,isEditingTemplate:ee,isCreatingTemplate:oe,maxHeight:m?200:E*N,showAddCustomItem:()=>{Te.current?.showModal()},addDraggingItem:ll,removeItem:Ce,inventoryItems:ce.map(e=>new ge({item:new T({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,displayItem:!0}),quantity:e.quantity}))}),m?a.jsxs("div",{className:"mobile-areas",style:{height:f+"px"},children:[a.jsx("img",{src:ue,onClick:()=>{const e=x.findIndex(n=>n.name==w);if(e===-1)return;const t=(e-1+x.length)%x.length;he(x[t].name),console.log("Changing viewing section to",x[t].name)},className:"back-mobile-areas"}),Ge.map((e,t)=>a.jsx(ke,{width:e.width,height:e.height,cells:Ee(C.find(n=>n.sectionName==e.sectionName).cells),id:e.sectionName,visibile:w==null?!0:e.sectionName==w,section:e.sectionName},t)),a.jsx("img",{src:ue,onClick:()=>{const e=x.findIndex(n=>n.name==w);if(e===-1)return;const t=(e+1)%x.length;he(x[t].name),console.log("Changing viewing section to",x[t].name)},className:"forward-mobile-areas"})]}):a.jsx(ke,{width:W*N,height:E*N,cells:Ee(P)})]}),le&&a.jsx("div",{className:"design-view",children:a.jsx("button",{className:"action-btn",onClick:()=>{window.location.href=`/LayItOut/Print/?companyId=${re}&areaId=${ie}&designName=${pe}&designId=${Ne}`},children:"Print"})})]}),a.jsxs("div",{children:[x.map(e=>a.jsx(ml,{takingPhoto:!1,section:e,visible:w==null?!0:e.name==w,cellSize:N},e.cellId.toId())),F.map(e=>a.jsx(dl,{cellSize:N,isViewingDesign:le,removeItem:Ce,visible:m?!e.hasMoved&&!e.starterItem?!0:w==null?!1:e.starterItem?x.find(t=>t.name==w)?.startingItems.some(t=>t.item.id===e.id):x.find(t=>t.name==w)?.items.some(t=>t.id===e.id):!0,item:e,canPlaceItem:Re,placeItem:el,deleteItemRotate:nl,highlightCells:sl,unHighlightCells:Oe,deleteItem:tl,isSelected:D===e.id,onSelect:ol,isUnselecting:U.includes(e.id),onDeselect:()=>al(e.id)},e.id))]}),m&&!we&&a.jsx("div",{className:"layout-icon",onClick:()=>{Ie.current?.showModal(),be(!0),console.log("Showing layout dialog")},children:a.jsx("img",{src:xl,alt:""})}),!we&&!(oe||ee||le)&&a.jsx("div",{className:"template-icon",onClick:()=>{fe.current?.showModal(),Se(!0),console.log("Showing template dialog")},children:a.jsx("img",{src:wl,alt:""})}),a.jsx(Ll,{isViewingArea:Ze,dialogRef:fe,isOpen:Pe,closeDialog:()=>{fe.current?.close(),Se(!1)},templates:de}),a.jsx(yl,{dialogRef:Ie,closeDialog:()=>{Ie.current?.close(),be(!1)},areaPreview:Qe||""}),a.jsx(Tl,{dialogRef:Te,addInventoryItem:il,closeDialog:()=>{Te.current?.close()}}),Le&&a.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:"https://trackerjo.github.io/LayItOut/Preview/",width:V*N+20,height:j*N+20})]})}
