import{r as I,j as a,c as rl}from"./index-QIV6qY6h.js";import{A as De,S as dl,D as gl}from"./section-D1VfoUIK.js";import{I as L,T as q,S as C,C as p,b as Z,s as be,e as me,D as ul,u as Il,f as fl,h as hl}from"./firestore-B020sBkw.js";import{F as ue}from"./add_custom_item_dialog-CkfgPpdu.js";function pl({inventoryItem:r,addDraggingItem:H,removeItem:W}){const k=I.useRef(null),E=I.useRef(null),[M,V]=I.useState(12),[A,j]=I.useState(r.item);function B(u){const F=E.current,y=window.getComputedStyle(F),f=document.createElement("span");f.style.font=y.font,f.style.fontSize=u+"px",f.style.fontFamily=y.fontFamily,f.style.fontWeight=y.fontWeight,f.style.position="absolute",f.style.visibility="hidden",f.style.whiteSpace="nowrap",f.textContent=F.textContent,document.body.appendChild(f);const b=f.offsetWidth;return document.body.removeChild(f),b}function D(u){if(E.current){const F=E.current;return B(u-1)>F.offsetWidth&&u-1>8?D(u-1):u-1}return u}return I.useEffect(()=>{setTimeout(()=>{E.current&&V(D(M))},100)},[]),a.jsxs("div",{className:"display",children:[a.jsx("div",{ref:k,id:r.item.id,className:"display-item",style:{width:`${r.item.cellsLong*10}px`,height:`${r.item.cellsTall*10}px`},onMouseDown:u=>{u.preventDefault(),u.stopPropagation(),r.item.initialElement=k.current,r.item.id=r.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",r.item.id,"to initialElement",r.item.initialElement),j(new L({id:r.item.id,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,name:r.item.name,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,displayItem:r.item.isDisplayItem})),H(r.item)},onTouchStart:u=>{u.preventDefault(),u.stopPropagation(),r.item.initialElement=k.current,r.item.id=r.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",r.item.id,"to initialElement",r.item.initialElement),j(new L({id:r.item.id,cellsLong:r.item.cellsLong,cellsTall:r.item.cellsTall,name:r.item.name,icon:r.item.icon,moveable:r.item.moveable,starterItem:r.item.starterItem,displayItem:r.item.isDisplayItem})),H(r.item)},children:r.item.icon.includes("custom-")?a.jsx("div",{className:"custom-icon",children:a.jsx("div",{children:a.jsx("p",{ref:E,style:{fontSize:`${M}px`},children:r.item.icon.split("custom-")[1]})})}):a.jsx("img",{src:r.item.icon,alt:"icon"})}),a.jsx("p",{children:r.item.name}),a.jsxs("p",{className:"quantity",children:["x",r.quantity]})]})}const yl="/LayItOut/assets/plus.circle-Ce3xm00a.png";function xl({inventoryItems:r,addDraggingItem:H,maxHeight:W,removeItem:k,showAddCustomItem:E,isCreatingTemplate:M,isEditingTemplate:V,isViewingDesign:A}){return a.jsxs("div",{className:"toolbox",style:{maxHeight:W?`${W}px`:"200px"},children:[r.map(j=>a.jsx(pl,{inventoryItem:j,addDraggingItem:H,removeItem:k})),!(M||V||A)&&a.jsx("div",{className:"add-item",onClick:()=>{E()},children:a.jsx("img",{src:yl,alt:"Add Item"})})]})}function wl({dialogRef:r,closeDialog:H,areaPreview:W}){return a.jsx("dialog",{ref:r,className:"layout-dialog",children:a.jsxs("div",{className:"layout-dialog-div",children:[a.jsx("h2",{children:"Layout"}),a.jsx("img",{src:W,alt:"Layout preview",className:"layout-dialog-preview"}),a.jsx("br",{}),a.jsx("button",{className:"layout-dialog-close",onClick:H,children:"Close"})]})})}const Ll="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",Tl="/LayItOut/assets/template-Cjj8EPhc.png";function vl({dialogRef:r,closeDialog:H,templates:W,isOpen:k,isViewingArea:E}){const[M,V]=I.useState(/Mobi|Android/i.test(navigator.userAgent)),[A,j]=I.useState([]),[B,D]=I.useState(!1),[u,F]=I.useState([]);return I.useEffect(()=>{F(W)},[W]),I.useEffect(()=>{if(k&&(console.log("Layout dialog opened, generating cells and sections",u),u.length!==0)){if(u.length==1){j([u[0].name]);return}j(M?[u[0].name]:[u[0].name,u[1].name])}},[k,u]),I.useEffect(()=>{const y=u.filter(f=>A.includes(f.name));console.log("Viewing templates:",A),y.sort((f,b)=>A.indexOf(f.name)-A.indexOf(b.name)),console.log("Generating templates for",y.map(f=>f.name))},[A,u]),a.jsx(a.Fragment,{children:a.jsx("dialog",{ref:r,className:"template-dialog",children:a.jsxs("div",{className:"template-dialog-div",children:[a.jsx("h2",{children:"Templates"}),a.jsxs("div",{className:"templates",children:[u.length>1&&u.filter(y=>!A.includes(y.name)).length>0&&a.jsx("img",{src:ue,onClick:()=>{if(M){const f=(u.findIndex(b=>b.name===A[0])-1+u.length)%u.length;j([u[f].name])}else j(y=>{const b=(u.findIndex(P=>P.name===y[0])-1+u.length)%u.length;return[u[b].name,y[0]]})},className:"back-mobile-areas"}),A.length===0&&a.jsx("div",{className:"no-templates",children:"No templates available"}),A.map(y=>a.jsxs("div",{className:"template",children:[a.jsx("img",{src:u.find(f=>f.name===y).previewImage,alt:y,className:"template-preview"}),a.jsx("h3",{children:y}),a.jsxs("div",{className:"template-actions",children:[a.jsx("button",{className:"template-select-btn",onClick:()=>{if(E){const f=new URLSearchParams(window.location.search),b=f.get("companyId"),P=f.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${b}&areaId=${P}&type=edit-template&templateId=${u.find(G=>G.name==y).id}`}else{const f=u.find(G=>G.name===y),b=new q({name:f.name,id:f.id,previewImage:f.previewImage,sections:f.sections.map(G=>new C({name:G.name,cellId:new p({x:G.cellId.x,y:G.cellId.y}),cellsLong:G.cellsLong,cellsTall:G.cellsTall,startingItems:G.startingItems.map(U=>new Z({cell:new p({x:U.cell.x,y:U.cell.y}),item:new L({id:U.item.id,name:U.item.name,icon:U.item.icon,cellsLong:U.item.cellsLong,cellsTall:U.item.cellsTall,starterItem:U.item.starterItem,moveable:U.item.moveable})}))}))}),P=new URLSearchParams(window.location.search);P.set("templateName",b.name),window.location.search=P.toString()}},children:E?"Edit":"Select"}),E&&a.jsx("button",{className:"action-btn",onClick:()=>{if(B)return;D(!0);const f=u.filter(U=>U.name!==y);F(f),f.length==1?j([f[0].name]):f.length==0?j([]):j(M?[f[0].name]:[f[0].name,f[1].name]);const b=new URLSearchParams(window.location.search),P=b.get("companyId"),G=b.get("areaId");be(P,G,f).then(()=>{D(!1)})},children:"Delete"})]})]})),u.length>1&&u.filter(y=>!A.includes(y.name)).length>0&&a.jsx("img",{src:ue,onClick:()=>{if(M){const f=(u.findIndex(b=>b.name===A[0])+1)%u.length;j([u[f].name])}else j(y=>{const b=(u.findIndex(P=>P.name===y[y.length-1])+1)%u.length;return[y[1],u[b].name]})},className:"forward-mobile-areas"})]}),E&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"action-btn",onClick:()=>{const y=new URLSearchParams(window.location.search),f=y.get("companyId"),b=y.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${f}&areaId=${b}&type=create-template`},children:"Create new Template"})," ",a.jsx("br",{})]}),a.jsx("br",{}),a.jsx("button",{className:"action-btn",onClick:H,children:"Close"}),B&&k&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"loader"})})]})})})}function bl({dialogRef:r,closeDialog:H,addInventoryItem:W}){const[k,E]=I.useState(""),[M,V]=I.useState(1),[A,j]=I.useState(1),[B,D]=I.useState(1);return a.jsx("dialog",{ref:r,className:"custom-item-dialog",children:a.jsxs("div",{className:"custom-item-dialog-div",children:[a.jsx("h2",{children:"Add Custom Item"}),a.jsxs("div",{className:"custom-item-row",children:[a.jsx("label",{htmlFor:"item-name",children:"Name:"}),a.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:u=>E(u.target.value??""),value:k})]}),a.jsxs("div",{className:"custom-item-row",children:[a.jsx("label",{htmlFor:"item-icon",children:"Count:"}),a.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:M,onChange:u=>V(parseInt(u.target.value)??1)})]}),a.jsxs("div",{className:"custom-item-row custom-item-size",children:[a.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),a.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:A,onChange:u=>j(parseFloat(u.target.value)??1)}),a.jsx("span",{children:" x "}),a.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:B,onChange:u=>D(parseFloat(u.target.value)??1)})]}),a.jsx("br",{}),a.jsx("button",{className:"custom-item-dialog-add",onClick:()=>{if(k.trim()===""){alert("Item name cannot be empty");return}const u=new me({quantity:M,item:new L({id:k+(Math.random()*1e4).toString(),name:k,icon:`custom-${k}`,cellsLong:Math.ceil(A),cellsTall:Math.ceil(B),moveable:!0,starterItem:!1,displayItem:!0})});W(u),E(""),V(1),j(1),D(1),H()},children:"Add Item"}),a.jsx("br",{}),a.jsx("br",{}),a.jsx("button",{className:"custom-item-dialog-close",onClick:H,children:"Close"})]})})}rl.createRoot(document.getElementById("root")).render(a.jsx(Sl,{}));function Sl(){const[r,H]=I.useState(/Mobi|Android/i.test(navigator.userAgent)),[W,k]=I.useState(0),[E,M]=I.useState(0),[V,A]=I.useState(0),[j,B]=I.useState(0),[D,u]=I.useState([]),[F,y]=I.useState([]),[f,b]=I.useState(0),[P,G]=I.useState(null),[U,$]=I.useState([]),N=/Mobi|Android/i.test(navigator.userAgent)?5:10,[oe,_]=I.useState([]),Ie=I.useRef(null),[jl,Se]=I.useState(!1),[Y,re]=I.useState([]),[x,ee]=I.useState([]),[de,Ge]=I.useState([]),[Me,je]=I.useState(!1),fe=I.useRef(null),[We,Fe]=I.useState([]),[O,z]=I.useState([]),[w,he]=I.useState(null),[ie,Ue]=I.useState(!1),[le,Ze]=I.useState(!1),[te,He]=I.useState(!1),[Ne,Ye]=I.useState(!1),[Nl,Je]=I.useState(!1),[Be,ze]=I.useState(!1),[pe,ye]=I.useState(""),[ne,Ae]=I.useState(""),[ge,Ve]=I.useState(""),[ce,Xe]=I.useState(""),[Ee,xe]=I.useState(""),[we,X]=I.useState(!0),[Re,Qe]=I.useState(null),[Le,se]=I.useState(!1),[Ke,qe]=I.useState(null),[$e,Te]=I.useState(!1),ve=I.useRef(null);function K(e,l){for(const n of l)if(e.x>=n.cellId.x&&e.x<n.cellId.x+n.cellsLong&&e.y>=n.cellId.y&&e.y<n.cellId.y+n.cellsTall)return n;return null}function _e(e){re([...e.map(i=>new C({name:i.name,cellId:new p({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,startingItems:[]}))]);let l=W,n=E;if(r){for(const t of e)console.log("Generating cells for section",t.name,"at",t.cellId,"with size",t.cellsLong,"x",t.cellsTall),console.log("Needed section Width:",(t.cellsLong+t.cellId.x)*N,"Current width:",l),(t.cellsLong+t.cellId.x)*N>l&&(console.log("Added section Width:",t.cellsLong*N+t.cellId.x),l+=(t.cellsLong+t.cellId.x)*N-l),console.log("Needed section Height:",(t.cellsTall+t.cellId.y)*N,"Current height:",n),(t.cellsTall+t.cellId.y)*N>n&&(console.log("Added section Height:",t.cellsTall*N+t.cellId.y),n+=(t.cellsTall+t.cellId.y)*N-n);B(n*2),A(l*2);let i=0;const o=[],s=[];for(const t of e){const c=[],d={width:t.cellsLong*N,height:t.cellsTall*N,sectionName:t.name};d.height>i&&(i=d.height),Fe(h=>[...h,d]),t.cellId.x=0,t.cellId.y=0,[...Array(d.height/N).keys()].map(h=>{const T=[];[...Array(d.width/N).keys()].map(v=>{T.push({id:new p({x:v,y:h}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:N})}),c.push(T)}),o.push({sectionName:t.name,cells:[...c]}),s.push(t)}z(o),ee(s),b(i),he(e[0]?e[0].name:null),setTimeout(()=>{X(!1)},500)}else{const i=[];for(const o of e)console.log("Generating cells for section",o.name,"at",o.cellId,"with size",o.cellsLong,"x",o.cellsTall),console.log("Needed section Width:",o.cellsLong+o.cellId.x,"Current width:",l),o.cellsLong+o.cellId.x>l&&(console.log("Added section Width:",o.cellsLong+o.cellId.x),l+=o.cellsLong+o.cellId.x-l),console.log("Needed section Height:",o.cellsTall+o.cellId.y,"Current height:",n),o.cellsTall+o.cellId.y>n&&(console.log("Added section Height:",o.cellsTall+o.cellId.y),n+=o.cellsTall+o.cellId.y-n);k(l),M(n),A(l),B(n),console.log("Final width:",l,"Final height:",n),[...Array(n).keys()].map(o=>{const s=[];[...Array(l).keys()].map(t=>{s.push({id:new p({x:t,y:o}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:K(new p({x:t,y:o}),e)!=null,size:N})}),i.push(s)}),u([...i]),setTimeout(()=>{const o=[],s=[...e];for(const t of s)t.cellElement=document.querySelector(`.App #${t.cellId.toId()}.cell:not(.cell-border)`),o.push(...t.startingItems.map(c=>new Z({cell:new p({x:t.cellId.x+c.cell.x,y:t.cellId.y+c.cell.y}),item:new L({id:c.item.id,name:c.item.name,cellsLong:c.item.cellsLong,cellsTall:c.item.cellsTall,icon:c.item.icon,initialElement:document.querySelector(`.App #${c.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:c.item.moveable,rotation:c.item.rotation||0})})));ee([...s]);for(const t of o){const c=T=>{const v=T%2===1;return{cellsLong:v?t.item.cellsTall:t.item.cellsLong,cellsTall:v?t.item.cellsLong:t.item.cellsTall}},d=t.item.rotation||0,h=c(d);for(let T=0;T<h.cellsTall;T++)for(let v=0;v<h.cellsLong;v++)i[t.cell.y+T][t.cell.x+v].hasItem=!0,i[t.cell.y+T][t.cell.x+v].itemId=t.item.id;t.item.initialElement=document.querySelector(`.App #${t.cell.toId()}.cell:not(.cell-border)`),y(T=>[...T,t.item])}u([...i]),setTimeout(()=>{X(!1)},500)},100)}}async function el(){const e=new URLSearchParams(window.location.search),l=e.get("companyId"),n=e.get("areaId"),i=e.get("areaId")||"",o=e.get("companyId")||"",s=e.get("templateId")||"",t=await fl(o,i);qe(t.previewImage||null);const c=e.get("type")||"";let d=!1;if(c==="create-template")Ue(!0);else if(c==="edit-template"){Ze(!0);const g=t.templates.find(m=>m.id===s);g&&(Qe(g),Ae(g.name))}else if(c==="view-design"){d=!0,He(!0);const g=e.get("designName")||"";ye(g);const m=e.get("designId")||"";xe(m)}else if(c==="view-area")Ye(!0);else if(c==="edit-design"){d=!0,Je(!0);const g=e.get("designName")||"";ye(g);const m=e.get("designId")||"";xe(m)}else if(c==="client-edit-design"){d=!0,ze(!0);const g=e.get("designName")||"";ye(g);const m=e.get("designId")||"";xe(m)}l&&Ve(l),n&&Xe(n),_(t.inventoryItems.map(g=>new me({item:new L({id:g.item.id,name:g.item.name,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,initialElement:g.item.initialElement,moveable:g.item.moveable,starterItem:g.item.starterItem,displayItem:!0}),quantity:g.quantity})));const h=[],T=[];for(const g of t.templates){const m=[],S=[];for(const J of g.sections)m.push(new C({name:J.name,cellId:new p({x:J.cellId.x,y:J.cellId.y}),cellsLong:J.cellsLong,cellsTall:J.cellsTall,startingItems:J.startingItems.map(R=>new Z({cell:new p({x:R.cell.x,y:R.cell.y}),item:new L({id:R.item.id,name:R.item.name,cellsLong:R.item.cellsLong,cellsTall:R.item.cellsTall,icon:R.item.icon,starterItem:!0,moveable:R.item.moveable,rotation:R.item.rotation||0})}))})),S.push(new C({name:J.name,cellId:new p({x:J.cellId.x,y:J.cellId.y}),cellsLong:J.cellsLong,cellsTall:J.cellsTall,startingItems:J.startingItems.map(R=>new Z({cell:new p({x:R.cell.x,y:R.cell.y}),item:new L({id:R.item.id,name:R.item.name,cellsLong:R.item.cellsLong,cellsTall:R.item.cellsTall,icon:R.item.icon,starterItem:!0,moveable:R.item.moveable,rotation:R.item.rotation||0})}))}));h.push(new q({name:g.name,sections:m,id:g.id,previewImage:g.previewImage})),T.push(new q({name:g.name,sections:S,id:g.id,previewImage:g.previewImage}))}Ge([...h]);const v=[],Q=s===""?void 0:T.find(g=>g.id===s);if(console.log("TEMPLATE",Q,"AREA",t),d){const g=await hl(o,i,e.get("designId")||"");if(g===null){window.location.href="/LayItOut/DNF/";return}_(g.inventoryItems.map(m=>new me({item:new L({id:m.item.id,name:m.item.name,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,initialElement:m.item.initialElement,moveable:m.item.moveable,starterItem:m.item.starterItem,displayItem:!0}),quantity:m.quantity}))),re([...g.sections]),ee([...g.sections.map(m=>new C({name:m.name,cellId:new p({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,items:m.startingItems.map(S=>new L({id:S.item.id,name:S.item.name,sectionCell:S.cell,cellsLong:S.item.cellsLong,cellsTall:S.item.cellsTall,icon:S.item.icon,moveable:S.item.moveable,starterItem:S.item.starterItem,rotation:S.item.rotation}))}))]),v.push(...g.sections.map(m=>new C({name:m.name,cellId:new p({x:m.cellId.x,y:m.cellId.y}),cellsLong:m.cellsLong,cellsTall:m.cellsTall,startingItems:m.startingItems,items:m.startingItems.map(S=>new L({id:S.item.id,name:S.item.name,sectionCell:S.cell,cellsLong:S.item.cellsLong,cellsTall:S.item.cellsTall,icon:S.item.icon,moveable:S.item.moveable,starterItem:S.item.starterItem,rotation:S.item.rotation}))})))}else Q!==void 0?(re([...Q.sections]),ee([...Q.sections.map(g=>new C({name:g.name,cellId:new p({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,items:g.startingItems.map(m=>new L({id:m.item.id,name:m.item.name,sectionCell:m.cell,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,rotation:m.item.rotation}))}))]),v.push(...Q.sections.map(g=>new C({name:g.name,cellId:new p({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,items:g.startingItems.map(m=>new L({id:m.item.id,name:m.item.name,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,rotation:m.item.rotation,sectionCell:m.cell}))})))):(re([...t.sections]),ee([...t.sections.map(g=>new C({name:g.name,cellId:new p({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,items:g.startingItems.map(m=>new L({id:m.item.id,name:m.item.name,sectionCell:m.cell,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,rotation:m.item.rotation}))}))]),v.push(...t.sections.map(g=>new C({name:g.name,cellId:new p({x:g.cellId.x,y:g.cellId.y}),cellsLong:g.cellsLong,cellsTall:g.cellsTall,startingItems:g.startingItems,items:g.startingItems.map(m=>new L({id:m.item.id,name:m.item.name,sectionCell:m.cell,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,rotation:m.item.rotation}))}))));console.log("SECTIONS TO GENERATE",v),_e(v)}I.useEffect(()=>{el()},[]);function ll(e,l,n){if(!r||e==null)return;const i=[...n],o=[],s=n.find(t=>t.name==e);console.log("NEW SECTION",s),console.log("Adding section",s.name,s.cellId),console.log("MOBILE CELLS",l),s.cellElement=document.querySelector(`.App #${s.name.split(" ").join("-")} #${s.name.split(" ").join("")}${s.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",s.cellElement);for(const t of s.startingItems){console.log("Placing starting item",t.item.name,t.cell);const c=T=>{const v=T%2===1;return{cellsLong:v?t.item.cellsTall:t.item.cellsLong,cellsTall:v?t.item.cellsLong:t.item.cellsTall}},d=t.item.rotation||0,h=c(d);for(let T=0;T<h.cellsTall;T++)for(let v=0;v<h.cellsLong;v++){const Q=l.find(g=>g.sectionName===s.name);Q.cells[t.cell.y+T][t.cell.x+v].hasItem=!0,Q.cells[t.cell.y+T][t.cell.x+v].itemId=t.item.id}t.item.initialElement=document.querySelector(`.App #${s.name.split(" ").join("-")} #${s.name.split(" ").join("")}${t.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",t.item.initialElement),o.push(new L({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,initialElement:t.item.initialElement,starterItem:!0,moveable:t.item.moveable,rotation:t.item.rotation}))}console.log("Setting sections",i),ee([...i]),console.log("ITEMS",o),y(t=>[...t.filter(d=>!o.some(h=>h.id===d.id)),...o.map(d=>new L({id:d.id,name:d.name,cellsLong:d.cellsLong,cellsTall:d.cellsTall,icon:d.icon,initialElement:d.initialElement,starterItem:!0,moveable:d.moveable,rotation:d.rotation}))])}function Ce(e){let l=[];return e.map(n=>l=[...l,...n]),l}function Oe(e,l){console.log(e);const n=r?O.find(t=>t.sectionName===w).cells:D,i=n[e.y].length,o=n.length;if(console.log(i,o),e.x+l.cellsLong>i||e.y+l.cellsTall>o)return!1;const s=K(e,x);if(!s&&!r)return console.log("Item is out of bounds of any section"),!1;for(let t=0;t<l.cellsTall;t++)for(let c=0;c<l.cellsLong;c++){if(!r){const d=K(new p({x:e.x+c,y:e.y+t}),x);if(!d)return console.log("Item is out of bounds of any section"),!1;if(d.name!=s.name)return console.log("Item is crossing section boundaries"),!1}if(n[e.y+t][e.x+c].hasItem&&n[e.y+t][e.x+c].itemId!=l.id)return console.log("Something is already here"),!1}return!0}function tl(e,l,n){const i=Array.from(r?O.find(t=>t.sectionName===w).cells:D);if(Te(!0),n!=null){console.log("Removing item");const t=r?x.find(c=>c.name===w):K(n,x);t.items=t.items.filter(c=>c.id!=l.id);for(let c=0;c<l.cellsTall;c++)for(let d=0;d<l.cellsLong;d++)i[n.y+c][n.x+d].hasItem=!1,i[n.y+c][n.x+d].itemId=""}const o=r?x.find(t=>t.name===w):K(e,x),s=new p({x:e.x-o.cellId.x,y:e.y-o.cellId.y});l.sectionCell=s,console.log("Adding item to section",o.name,"at",s,l),o.items.push(l);for(let t=0;t<l.cellsTall;t++)for(let c=0;c<l.cellsLong;c++)i[e.y+t][e.x+c].hasItem=!0,i[e.y+t][e.x+c].itemId=l.id;if(console.log(i),r){const t=O.find(c=>c.sectionName===w);t&&(t.cells=i.map(c=>c.map(d=>({...d}))),z([...O]))}else u(i);if(console.log("Removing item from inventory",l.name),!l.hasMoved){const t=oe.findIndex(c=>c.item.name==l.name&&!c.item.hasMoved);if(t!==-1){const c=[...oe];c[t].quantity-=1,c[t].quantity<=0&&c.splice(t,1),_(c)}else _(oe)}y(t=>(console.log("Placing item",l.id),console.log("Updating item",l.id),t.find(c=>c.id==l.id).hasMoved||(t.find(c=>c.id==l.id).hasMoved=!0),t))}function nl(e){F.find(l=>l.name==e.name&&!l.hasMoved&&!l.starterItem)||y(l=>[...l,e])}function ke(e){console.log("Removing item",e.id),y(l=>l.filter(n=>n.id!=e.id))}function sl(e,l){const n=Array.from(r?O.find(c=>c.sectionName===w).cells:D);Te(!0);const i=c=>{const d=c%2===1;return{cellsWide:d?e.cellsTall:e.cellsLong,cellsTall:d?e.cellsLong:e.cellsTall}},o=e.rotation||0,s=i(o);for(let c=0;c<s.cellsTall;c++)for(let d=0;d<s.cellsWide;d++)n[l.y+c][l.x+d].hasItem=!1,n[l.y+c][l.x+d].itemId="";if(r){const c=O.find(d=>d.sectionName===w);c&&(c.cells=n.map(d=>d.map(h=>({...h}))),z([...O])),z(d=>d.map(h=>h.sectionName===w?{...h,cells:n}:h))}else u(n);const t=r?x.find(c=>c.name===w):K(l,x);t.items=t.items.filter(c=>c.id!=e.id),console.log("DELETING ITEM",e.id),y(c=>(console.log(),c.filter(d=>d.id!=e.id))),_(c=>{const d=c.findIndex(h=>h.item.name==e.name&&!h.item.hasMoved);if(d!==-1){const h=[...c];return h[d].quantity+=1,h}else return[...c,new me({item:new L({id:e.id,name:e.name,cellsLong:s.cellsWide,cellsTall:s.cellsTall,icon:e.icon}),quantity:1})]})}function al(e,l){const n=Array.from(r?O.find(d=>d.sectionName===w).cells:D);console.log("DELETING ITEM ROTATE",e.id,e.rotation),Te(!0);const i=d=>{const h=d%2===1;return{cellsWide:h?e.cellsTall:e.cellsLong,cellsTall:h?e.cellsLong:e.cellsTall}},o=e.rotation||0,s=i(o);for(let d=0;d<s.cellsTall;d++)for(let h=0;h<s.cellsWide;h++)console.log("Deleting cell",l.y+d,l.x+h),n[l.y+d][l.x+h].hasItem=!1,n[l.y+d][l.x+h].itemId="";if(r){const d=O.find(h=>h.sectionName===w);d&&(d.cells=n.map(h=>h.map(T=>({...T}))),z([...O])),z(h=>h.map(T=>T.sectionName===w?{...T,cells:n}:T))}else u(n);console.log("DELETING ITEM",e.id);const t=r?x.find(d=>d.name===w):K(l,x);t.items=t.items.filter(d=>d.id!=e.id);const c=new p({x:l.x-t.cellId.x,y:l.y-t.cellId.y});e.sectionCell=c,t.items.push(e)}function ol(e,l){const n=r?O.find(s=>s.sectionName===w).cells:D,i=Array.from(n);if(n[e.y]==null){Pe();return}const o=Oe(e,l);i.forEach(s=>s.forEach(t=>{t.mouseOver=!1,t.canPlaceItem=!1,t.mouseOverLocation=""}));for(let s=0;s<l.cellsTall;s++)for(let t=0;t<l.cellsLong;t++)e.y+s<i.length&&e.x+t<i[e.y+s].length&&(l.cellsLong===1&&l.cellsTall===1?i[e.y+s][e.x+t].mouseOverLocation="single":l.cellsTall===1?t===0?i[e.y+s][e.x+t].mouseOverLocation="leftFull":t===l.cellsLong-1?i[e.y+s][e.x+t].mouseOverLocation="rightFull":i[e.y+s][e.x+t].mouseOverLocation="middleFull":l.cellsLong===1?s===0?i[e.y+s][e.x+t].mouseOverLocation="topFull":s===l.cellsTall-1?i[e.y+s][e.x+t].mouseOverLocation="bottomFull":i[e.y+s][e.x+t].mouseOverLocation="middleVFull":s===0&&t===0?i[e.y+s][e.x+t].mouseOverLocation="topLeftCorner":s===0&&t===l.cellsLong-1?i[e.y+s][e.x+t].mouseOverLocation="topRightCorner":s===l.cellsTall-1&&t===0?i[e.y+s][e.x+t].mouseOverLocation="bottomLeftCorner":s===l.cellsTall-1&&t===l.cellsLong-1?i[e.y+s][e.x+t].mouseOverLocation="bottomRightCorner":s===0?i[e.y+s][e.x+t].mouseOverLocation="top":s===l.cellsTall-1?i[e.y+s][e.x+t].mouseOverLocation="bottom":t===0?i[e.y+s][e.x+t].mouseOverLocation="left":t===l.cellsLong-1?i[e.y+s][e.x+t].mouseOverLocation="right":i[e.y+s][e.x+t].mouseOverLocation="middle",i[e.y+s][e.x+t].mouseOver=!0,i[e.y+s][e.x+t].canPlaceItem=o);if(r){const s=O.find(t=>t.sectionName===w);s&&(s.cells=i.map(t=>t.map(c=>({...c}))),z([...O])),z(t=>t.map(c=>c.sectionName===w?{...c,cells:i}:c))}else u(i)}function Pe(){console.log("Unhighlighting cells");const e=Array.from(r?O.find(l=>l.sectionName===w).cells:D);if(e.forEach(l=>l.forEach(n=>{n.mouseOver=!1,n.canPlaceItem=!1,n.mouseOverLocation=""})),r){const l=O.find(n=>n.sectionName===w);l&&(l.cells=e.map(n=>n.map(i=>({...i}))),z([...O])),z(n=>n.map(i=>i.sectionName===w?{...i,cells:e}:i))}else u(e)}I.useEffect(()=>{ll(w,O,x)},[w]),I.useEffect(()=>{const e=()=>{const l=F.find(n=>n.id===P);console.log("Unselecting item",P),G(null),l&&($(n=>[...n,l.id]),console.log("Unselecting item",l.id),setTimeout(()=>{$(n=>n.filter(i=>i!==l.id))},300))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[P,F]);function il(e){G(null),$(l=>[...l,e]),console.log("Unselecting item",e),setTimeout(()=>{$(l=>l.filter(n=>n!==e))},300)}function cl(e){const l=F.find(n=>n.id===P);console.log("Unselecting item",P),G(e),l&&($(n=>[...n,l.id]),console.log("Unselecting item",l.id),setTimeout(()=>{$(n=>n.filter(i=>i!==l.id))},300))}function ml(e){_(l=>[...l,e])}const ae=e=>{console.log("Preventing scroll"),e.preventDefault(),e.stopPropagation(),window.scrollTo(0,0)};return I.useEffect(()=>(Le?(window.addEventListener("scroll",ae),window.addEventListener("touchmove",ae,{passive:!1})):(window.removeEventListener("scroll",ae),window.removeEventListener("touchmove",ae)),()=>{window.removeEventListener("scroll",ae),window.removeEventListener("touchmove",ae)}),[Le]),a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"App",children:[a.jsx("h1",{className:"title",children:"LayItOut"}),a.jsx("br",{}),(ie||le)&&a.jsxs("div",{className:"template-name-row",children:[a.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),a.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:e=>Ae(e.target.value),value:ne})]}),te&&a.jsx("div",{className:"design-name-row",children:a.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",pe]})}),(ie||le)&&a.jsxs("div",{className:"template-creation",children:[a.jsxs("button",{className:"action-btn",onClick:()=>{if(ne.trim()==""){alert("Please enter a template name");return}if(de.some(e=>e.name===ne&&(le?e.id!==Re.id:!0))){alert("Template with this name already exists");return}le?(X(!0),setTimeout(async()=>{const e=x.map(l=>new C({name:l.name,cellId:new p({x:Y.find(n=>n.name==l.name).cellId.x,y:Y.find(n=>n.name==l.name).cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,startingItems:l.items.map(n=>new Z({cell:new p({x:n.sectionCell.x,y:n.sectionCell.y}),item:new L({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),se(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){se(!1);const n=de.map(i=>i.id===Re.id?(console.log("SECTION",x),new q({name:ne,previewImage:l.newValue,sections:x.map(o=>new C({name:o.name,cellId:new p({x:i.sections.find(s=>s.name==o.name).cellId.x,y:i.sections.find(s=>s.name==o.name).cellId.y}),cellsLong:o.cellsLong*10,cellsTall:o.cellsTall*10,startingItems:o.items.map(s=>new Z({cell:new p({x:s.sectionCell.x,y:s.sectionCell.y}),item:new L({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:i.id})):new q({name:i.name,previewImage:i.previewImage,sections:i.sections.map(o=>new C({name:o.name,cellId:new p({x:o.cellId.x,y:o.cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,startingItems:o.startingItems.map(s=>new Z({cell:new p({x:s.cell.x,y:s.cell.y}),item:new L({id:s.item.id,name:s.item.name,cellsLong:s.item.cellsLong,cellsTall:s.item.cellsTall,icon:s.item.icon,starterItem:s.item.starterItem,moveable:s.item.moveable,rotation:s.item.rotation})}))})),id:i.id}));be(ge,ce,n).then(()=>{console.log("Template updated successfully"),X(!1);const i=new URLSearchParams(window.location.search),o=i.get("companyId"),s=i.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${o}&areaId=${s}&type=view-area`})}})},500)):(X(!0),setTimeout(async()=>{const e=x.map(l=>new C({name:l.name,cellId:new p({x:Y.find(n=>n.name==l.name).cellId.x,y:Y.find(n=>n.name==l.name).cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,startingItems:l.items.map(n=>new Z({cell:new p({x:n.sectionCell.x,y:n.sectionCell.y}),item:new L({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),se(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){se(!1);const n=new q({name:ne,previewImage:l.newValue,sections:x.map(o=>new C({name:o.name,cellId:new p({x:Y.find(s=>s.name==o.name).cellId.x,y:Y.find(s=>s.name==o.name).cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,startingItems:o.items.map(s=>new Z({cell:new p({x:s.sectionCell.x,y:s.sectionCell.y}),item:new L({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:ne+(Math.random()*1e4).toString()}),i=[...de.map(o=>new q({name:o.name,previewImage:o.previewImage,sections:o.sections.map(s=>new C({name:s.name,cellId:new p({x:s.cellId.x,y:s.cellId.y}),cellsLong:s.cellsLong,cellsTall:s.cellsTall,startingItems:s.startingItems.map(t=>new Z({cell:new p({x:t.cell.x,y:t.cell.y}),item:new L({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,starterItem:t.item.starterItem,moveable:t.item.moveable,rotation:t.item.rotation})}))})),id:o.id})),n];be(ge,ce,i).then(()=>{console.log("Template updated successfully"),X(!1);const o=new URLSearchParams(window.location.search),s=o.get("companyId"),t=o.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${s}&areaId=${t}&type=view-area`})}})},500))},children:[ie?"Create":"Save"," Template"]}),a.jsx("button",{className:"action-btn",onClick:()=>{const e=new URLSearchParams(window.location.search),l=e.get("companyId"),n=e.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${l}&areaId=${n}&type=view-area`},children:"Cancel"})]}),Be&&a.jsxs("div",{className:"template-creation",children:[$e&&a.jsx("button",{className:"action-btn",onClick:()=>{X(!0),setTimeout(async()=>{const e=x.map(l=>new C({name:l.name,cellId:new p({x:Y.find(n=>n.name==l.name).cellId.x,y:Y.find(n=>n.name==l.name).cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,startingItems:l.items.map(n=>new Z({cell:new p({x:n.sectionCell.x,y:n.sectionCell.y}),item:new L({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),se(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){se(!1);const n=new ul({name:pe,previewImage:l.newValue,areaId:ce,inventoryItems:oe,sections:x.map(i=>new C({name:i.name,cellId:new p({x:Y.find(o=>o.name==i.name).cellId.x,y:Y.find(o=>o.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,startingItems:i.items.map(o=>new Z({cell:new p({x:o.sectionCell.x,y:o.sectionCell.y}),item:new L({id:o.id,name:o.name,cellsLong:o.cellsLong,cellsTall:o.cellsTall,icon:o.icon,starterItem:!0,moveable:o.moveable,rotation:o.rotation})}))})),id:Ee});Il(ge,ce,n).then(()=>{console.log("Design updated successfully"),X(!1)})}})},500)},children:"Save"}),a.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),we&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"loader-backdrop",children:a.jsx("div",{className:"loader"})})})," ",a.jsxs("div",{className:"layout",children:[!te&&a.jsx(xl,{isViewingDesign:te,isEditingTemplate:le,isCreatingTemplate:ie,maxHeight:r?200:E*N,showAddCustomItem:()=>{ve.current?.showModal()},addDraggingItem:nl,removeItem:ke,inventoryItems:oe.map(e=>new me({item:new L({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,displayItem:!0}),quantity:e.quantity}))}),r?a.jsxs("div",{className:"mobile-areas",style:{height:f+"px"},children:[a.jsx("img",{src:ue,onClick:()=>{const e=x.findIndex(n=>n.name==w);if(e===-1)return;const l=(e-1+x.length)%x.length;he(x[l].name),console.log("Changing viewing section to",x[l].name)},className:"back-mobile-areas"}),We.map((e,l)=>a.jsx(De,{width:e.width,height:e.height,cells:Ce(O.find(n=>n.sectionName==e.sectionName).cells),id:e.sectionName,visibile:w==null?!0:e.sectionName==w,section:e.sectionName},l)),a.jsx("img",{src:ue,onClick:()=>{const e=x.findIndex(n=>n.name==w);if(e===-1)return;const l=(e+1)%x.length;he(x[l].name),console.log("Changing viewing section to",x[l].name)},className:"forward-mobile-areas"})]}):a.jsx(De,{width:W*N,height:E*N,cells:Ce(D)})]}),te&&a.jsxs("div",{className:"design-view",children:[a.jsx("button",{className:"action-btn",onClick:()=>{const e=x.map(l=>new C({name:l.name,cellId:new p({x:Y.find(n=>n.name==l.name).cellId.x,y:Y.find(n=>n.name==l.name).cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,startingItems:l.items.map(n=>new Z({cell:new p({x:n.sectionCell.x,y:n.sectionCell.y}),item:new L({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("printSections",e.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),window.location.href=`/LayItOut/Print/?companyId=${ge}&areaId=${ce}&designName=${pe}&designId=${Ee}`},children:"Print"}),a.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/"},children:"Back"})]}),Ne&&a.jsx("div",{className:"design-view",children:a.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/"},children:"Back"})})]}),a.jsxs("div",{children:[x.map(e=>a.jsx(dl,{takingPhoto:!1,section:e,visible:w==null?!0:e.name==w,cellSize:N},e.cellId.toId())),F.map(e=>a.jsx(gl,{cellSize:N,isViewingDesign:te,removeItem:ke,visible:r?!e.hasMoved&&!e.starterItem?!0:w==null?!1:e.starterItem?x.find(l=>l.name==w)?.startingItems.some(l=>l.item.id===e.id):x.find(l=>l.name==w)?.items.some(l=>l.id===e.id):!0,item:e,canPlaceItem:Oe,placeItem:tl,deleteItemRotate:al,highlightCells:ol,unHighlightCells:Pe,deleteItem:sl,isSelected:P===e.id,onSelect:cl,isUnselecting:U.includes(e.id),onDeselect:()=>il(e.id)},e.id))]}),r&&!we&&a.jsx("div",{className:"layout-icon",onClick:()=>{Ie.current?.showModal(),Se(!0),console.log("Showing layout dialog")},children:a.jsx("img",{src:Ll,alt:""})}),!we&&!(ie||le||te)&&a.jsx("div",{className:"template-icon",onClick:()=>{fe.current?.showModal(),je(!0),console.log("Showing template dialog")},children:a.jsx("img",{src:Tl,alt:""})}),a.jsx(vl,{isViewingArea:Ne,dialogRef:fe,isOpen:Me,closeDialog:()=>{fe.current?.close(),je(!1)},templates:de}),a.jsx(wl,{dialogRef:Ie,closeDialog:()=>{Ie.current?.close(),Se(!1)},areaPreview:Ke||""}),a.jsx(bl,{dialogRef:ve,addInventoryItem:ml,closeDialog:()=>{ve.current?.close()}}),Le&&a.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:"https://trackerjo.github.io/LayItOut/Preview/",width:V*N+20,height:j*N+20})]})}
