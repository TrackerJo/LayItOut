import{c as Ie,j as f,r as a}from"./index-QIV6qY6h.js";import{A as B,S as ye,D as he}from"./section-Bl4_lSg3.js";import{S as P,C as S,I as T,e as xe,f as G}from"./firestore-Bko8voo4.js";import{F as J}from"./add_custom_item_dialog-DQtvLDx8.js";Ie.createRoot(document.getElementById("root")).render(f.jsx(Se,{}));function Se(){const[I,pe]=a.useState(!1),[U,Y]=a.useState(0),[q,K]=a.useState(0),[p,L]=a.useState([]),[O,E]=a.useState([]),[Q,X]=a.useState(0),[v,D]=a.useState(null),[Z,w]=a.useState([]),x=10,[R,M]=a.useState([]);a.useRef(null);const[Le,Te]=a.useState(!1),[ve,we]=a.useState([]),[d,N]=a.useState([]),[Ee,be]=a.useState([]),[Oe,Ne]=a.useState(!1);a.useRef(null);const[_,C]=a.useState([]),[y,A]=a.useState([]),[r,k]=a.useState(null),[Ae,je]=a.useState(!1),[De,Re]=a.useState(!1),[ee,Me]=a.useState(!1),[ke,Pe]=a.useState(!1),[Ue,qe]=a.useState(!1),[Fe,We]=a.useState(!1),[$e,He]=a.useState(""),[Ve,ze]=a.useState(""),[Be,Ge]=a.useState(""),[Je,Ye]=a.useState(""),[Ke,Qe]=a.useState(""),[le,j]=a.useState(!0),[Xe,Ze]=a.useState(null),[F,W]=a.useState(!1),[_e,ne]=a.useState(!1);a.useRef(null);function b(l,n){for(const s of n)if(l.x>=s.cellId.x&&l.x<s.cellId.x+s.cellsLong&&l.y>=s.cellId.y&&l.y<s.cellId.y+s.cellsTall)return s;return null}function te(l){let n=U,s=q;if(I){let o=0;const c=[],i=[];for(const e of l){const t=[],m={width:e.cellsLong*x,height:e.cellsTall*x,sectionName:e.name};m.height>o&&(o=m.height),C(h=>[...h,m]),e.cellId.x=0,e.cellId.y=0,[...Array(m.height/x).keys()].map(h=>{const g=[];[...Array(m.width/x).keys()].map(u=>{g.push({id:new S({x:u,y:h}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:x})}),t.push(g)}),c.push({sectionName:e.name,cells:[...t]}),i.push(e)}A(c),N(i),X(o),k(l[0]?l[0].name:null),setTimeout(()=>{j(!1)},500)}else{const o=[];for(const c of l)console.log("Generating cells for section",c.name,"at",c.cellId,"with size",c.cellsLong,"x",c.cellsTall),console.log("Needed section Width:",c.cellsLong+c.cellId.x,"Current width:",n),c.cellsLong+c.cellId.x>n&&(console.log("Added section Width:",c.cellsLong+c.cellId.x),n+=c.cellsLong+c.cellId.x-n),console.log("Needed section Height:",c.cellsTall+c.cellId.y,"Current height:",s),c.cellsTall+c.cellId.y>s&&(console.log("Added section Height:",c.cellsTall+c.cellId.y),s+=c.cellsTall+c.cellId.y-s);Y(n),K(s),[...Array(s).keys()].map(c=>{const i=[];[...Array(n).keys()].map(e=>{i.push({id:new S({x:e,y:c}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:b(new S({x:e,y:c}),l)!=null,size:x})}),o.push(i)}),L([...o]),setTimeout(()=>{const c=[],i=[...l];for(const e of i)e.cellElement=document.querySelector(`.App #${e.cellId.toId()}.cell:not(.cell-border)`),c.push(...e.startingItems.map(t=>new G({cell:new S({x:e.cellId.x+t.cell.x,y:e.cellId.y+t.cell.y}),item:new T({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,initialElement:document.querySelector(`.App #${t.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:t.item.moveable,rotation:t.item.rotation||0})}))),c.push(...e.modifierItems.map(t=>new G({cell:new S({x:e.cellId.x+t.cell.x,y:e.cellId.y+t.cell.y}),item:new T({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,initialElement:document.querySelector(`.App #${t.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1,isSectionItem:t.item.isSectionItem,isSectionModifier:t.item.isSectionModifier,sectionModifierType:t.item.sectionModifierType,rotation:t.item.rotation||0})})));N([...i]);for(const e of c){const t=g=>{const u=g%2===1;return{cellsLong:u?e.item.cellsTall:e.item.cellsLong,cellsTall:u?e.item.cellsLong:e.item.cellsTall}},m=e.item.rotation||0,h=t(m);for(let g=0;g<h.cellsTall;g++)for(let u=0;u<h.cellsLong;u++)o[e.cell.y+g][e.cell.x+u].hasItem=!0,o[e.cell.y+g][e.cell.x+u].itemId=e.item.id;e.item.initialElement=document.querySelector(`.App #${e.cell.toId()}.cell:not(.cell-border)`),E(g=>[...g,e.item])}L([...o]),setTimeout(()=>{j(!1),oe()},500)},100)}}async function oe(l,n){j(!0),W(!0),setTimeout(async()=>{const s=document.getElementById("capture"),o=await domtoimage.toPng(s);W(!1),localStorage.setItem("screenshot",o),ne(!0),j(!1)},500)}async function se(){new URLSearchParams(window.location.search);const l=[];let n=localStorage.getItem("screenshotSections");console.log("Screenshot sections from localStorage",n),n=n?.split("LAYOUTSEPARATOR")||"";const s=[];for(const o of n)console.log("Section string",o),s.push(P.fromJSON(o));N([...s.map(o=>new P({name:o.name,cellId:new S({x:o.cellId.x,y:o.cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,startingItems:o.startingItems,modifierItems:o.modifierItems,items:o.startingItems.map(c=>new T({id:c.item.id,name:c.item.name,sectionCell:c.cell,cellsLong:c.item.cellsLong,cellsTall:c.item.cellsTall,icon:c.item.icon,moveable:c.item.moveable,starterItem:c.item.starterItem,rotation:c.item.rotation}))}))]),l.push(...s.map(o=>new P({name:o.name,cellId:new S({x:o.cellId.x,y:o.cellId.y}),cellsLong:o.cellsLong,cellsTall:o.cellsTall,startingItems:o.startingItems,modifierItems:o.modifierItems,items:o.startingItems.map(c=>new T({id:c.item.id,name:c.item.name,sectionCell:c.cell,cellsLong:c.item.cellsLong,cellsTall:c.item.cellsTall,icon:c.item.icon,moveable:c.item.moveable,starterItem:c.item.starterItem,rotation:c.item.rotation}))}))),console.log("SECTIONS TO GENERATE",l),te(l)}a.useEffect(()=>{se()},[]);function ie(l,n,s){if(!I||l==null)return;const o=[...s],c=[],i=s.find(e=>e.name==l);console.log("NEW SECTION",i),console.log("Adding section",i.name,i.cellId),console.log("MOBILE CELLS",n),i.cellElement=document.querySelector(`.App #${i.name.split(" ").join("-")} #${i.name.split(" ").join("")}${i.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",i.cellElement);for(const e of i.startingItems){console.log("Placing starting item",e.item.name,e.cell);const t=g=>{const u=g%2===1;return{cellsLong:u?e.item.cellsTall:e.item.cellsLong,cellsTall:u?e.item.cellsLong:e.item.cellsTall}},m=e.item.rotation||0,h=t(m);for(let g=0;g<h.cellsTall;g++)for(let u=0;u<h.cellsLong;u++){const z=n.find(fe=>fe.sectionName===i.name);z.cells[e.cell.y+g][e.cell.x+u].hasItem=!0,z.cells[e.cell.y+g][e.cell.x+u].itemId=e.item.id}e.item.initialElement=document.querySelector(`.App #${i.name.split(" ").join("-")} #${i.name.split(" ").join("")}${e.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",e.item.initialElement),c.push(new T({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,initialElement:e.item.initialElement,starterItem:!0,moveable:e.item.moveable,rotation:e.item.rotation}))}console.log("Setting sections",o),N([...o]),console.log("ITEMS",c),E(e=>[...e.filter(m=>!c.some(h=>h.id===m.id)),...c.map(m=>new T({id:m.id,name:m.name,cellsLong:m.cellsLong,cellsTall:m.cellsTall,icon:m.icon,initialElement:m.initialElement,starterItem:!0,moveable:m.moveable,rotation:m.rotation}))])}function $(l){let n=[];return l.map(s=>n=[...n,...s]),n}function H(l,n){console.log(l);const s=I?y.find(e=>e.sectionName===r).cells:p,o=s[l.y].length,c=s.length;if(console.log(o,c),l.x+n.cellsLong>o||l.y+n.cellsTall>c)return!1;const i=b(l,d);if(!i&&!I)return console.log("Item is out of bounds of any section"),!1;for(let e=0;e<n.cellsTall;e++)for(let t=0;t<n.cellsLong;t++){if(!I){const m=b(new S({x:l.x+t,y:l.y+e}),d);if(!m)return console.log("Item is out of bounds of any section"),!1;if(m.name!=i.name)return console.log("Item is crossing section boundaries"),!1}if(s[l.y+e][l.x+t].hasItem&&s[l.y+e][l.x+t].itemId!=n.id)return console.log("Something is already here"),!1}return!0}function ce(l,n,s){const o=Array.from(I?y.find(e=>e.sectionName===r).cells:p);if(s!=null){console.log("Removing item");const e=I?d.find(t=>t.name===r):b(s,d);e.items=e.items.filter(t=>t.id!=n.id);for(let t=0;t<n.cellsTall;t++)for(let m=0;m<n.cellsLong;m++)o[s.y+t][s.x+m].hasItem=!1,o[s.y+t][s.x+m].itemId=""}const c=I?d.find(e=>e.name===r):b(l,d),i=new S({x:l.x-c.cellId.x,y:l.y-c.cellId.y});n.sectionCell=i,c.items.push(n);for(let e=0;e<n.cellsTall;e++)for(let t=0;t<n.cellsLong;t++)o[l.y+e][l.x+t].hasItem=!0,o[l.y+e][l.x+t].itemId=n.id;if(console.log(o),I){const e=y.find(t=>t.sectionName===r);e&&(e.cells=o.map(t=>t.map(m=>({...m}))),A([...y]))}else L(o);if(console.log("Removing item from inventory",n.name),!n.hasMoved){const e=R.findIndex(t=>t.item.name==n.name&&!t.item.hasMoved);if(e!==-1){const t=[...R];t[e].quantity-=1,t[e].quantity<=0&&t.splice(e,1),M(t)}else M(R)}E(e=>(console.log("Placing item",n.id),console.log("Updating item",n.id),e.find(t=>t.id==n.id).hasMoved||(e.find(t=>t.id==n.id).hasMoved=!0),e))}function ae(l){console.log("Removing item",l.id),E(n=>n.filter(s=>s.id!=l.id))}function me(l,n){const s=Array.from(p),o=e=>{const t=e%2===1;return{cellsWide:t?l.cellsTall:l.cellsLong,cellsTall:t?l.cellsLong:l.cellsTall}},c=l.rotation||0,i=o(c);for(let e=0;e<i.cellsTall;e++)for(let t=0;t<i.cellsWide;t++)s[n.y+e][n.x+t].hasItem=!1,s[n.y+e][n.x+t].itemId="";L(s),console.log("DELETING ITEM",l.id),E(e=>(console.log(),e.filter(t=>t.id!=l.id))),M(e=>{const t=e.findIndex(m=>m.item.name==l.name&&!m.item.hasMoved);if(t!==-1){const m=[...e];return m[t].quantity+=1,m}else return[...e,new xe({item:new T({id:l.id,name:l.name,cellsLong:i.cellsWide,cellsTall:i.cellsTall,icon:l.icon}),quantity:1})]})}function re(l,n){const s=Array.from(I?y.find(e=>e.sectionName===r).cells:p);console.log("DELETING ITEM ROTATE",l.id,l.rotation);const o=e=>{const t=e%2===1;return{cellsWide:t?l.cellsTall:l.cellsLong,cellsTall:t?l.cellsLong:l.cellsTall}},c=l.rotation||0,i=o(c);for(let e=0;e<i.cellsTall;e++)for(let t=0;t<i.cellsWide;t++)console.log("Deleting cell",n.y+e,n.x+t),s[n.y+e][n.x+t].hasItem=!1,s[n.y+e][n.x+t].itemId="";L([...s]),console.log("DELETING ITEM",l.id)}function de(l,n){const s=I?y.find(i=>i.sectionName===r).cells:p,o=Array.from(s);if(s[l.y]==null){V();return}const c=H(l,n);o.forEach(i=>i.forEach(e=>{e.mouseOver=!1,e.canPlaceItem=!1,e.mouseOverLocation=""}));for(let i=0;i<n.cellsTall;i++)for(let e=0;e<n.cellsLong;e++)l.y+i<o.length&&l.x+e<o[l.y+i].length&&(n.cellsLong===1&&n.cellsTall===1?o[l.y+i][l.x+e].mouseOverLocation="single":n.cellsTall===1?e===0?o[l.y+i][l.x+e].mouseOverLocation="leftFull":e===n.cellsLong-1?o[l.y+i][l.x+e].mouseOverLocation="rightFull":o[l.y+i][l.x+e].mouseOverLocation="middleFull":n.cellsLong===1?i===0?o[l.y+i][l.x+e].mouseOverLocation="topFull":i===n.cellsTall-1?o[l.y+i][l.x+e].mouseOverLocation="bottomFull":o[l.y+i][l.x+e].mouseOverLocation="middleVFull":i===0&&e===0?o[l.y+i][l.x+e].mouseOverLocation="topLeftCorner":i===0&&e===n.cellsLong-1?o[l.y+i][l.x+e].mouseOverLocation="topRightCorner":i===n.cellsTall-1&&e===0?o[l.y+i][l.x+e].mouseOverLocation="bottomLeftCorner":i===n.cellsTall-1&&e===n.cellsLong-1?o[l.y+i][l.x+e].mouseOverLocation="bottomRightCorner":i===0?o[l.y+i][l.x+e].mouseOverLocation="top":i===n.cellsTall-1?o[l.y+i][l.x+e].mouseOverLocation="bottom":e===0?o[l.y+i][l.x+e].mouseOverLocation="left":e===n.cellsLong-1?o[l.y+i][l.x+e].mouseOverLocation="right":o[l.y+i][l.x+e].mouseOverLocation="middle",o[l.y+i][l.x+e].mouseOver=!0,o[l.y+i][l.x+e].canPlaceItem=c);if(I){const i=y.find(e=>e.sectionName===r);i&&(i.cells=o.map(e=>e.map(t=>({...t}))),A([...y])),A(e=>e.map(t=>t.sectionName===r?{...t,cells:o}:t))}else L(o)}function V(){const l=Array.from(I?y.find(n=>n.sectionName===r).cells:p);l.forEach(n=>n.forEach(s=>{s.mouseOver=!1,s.canPlaceItem=!1,s.mouseOverLocation=""})),L(l)}a.useEffect(()=>{ie(r,y,d)},[r]),a.useEffect(()=>{const l=()=>{const n=O.find(s=>s.id===v);console.log("Unselecting item",v),D(null),n&&(w(s=>[...s,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{w(s=>s.filter(o=>o!==n.id))},300))};return document.addEventListener("click",l),()=>document.removeEventListener("click",l)},[v,O]);function ge(l){D(null),w(n=>[...n,l]),console.log("Unselecting item",l),setTimeout(()=>{w(n=>n.filter(s=>s!==l))},300)}function ue(l){const n=O.find(s=>s.id===v);console.log("Unselecting item",v),D(l),n&&(w(s=>[...s,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{w(s=>s.filter(o=>o!==n.id))},300))}return f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"App",children:[le&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"loader-backdrop"}),f.jsx("div",{className:"loader"})]})," ",f.jsx("div",{className:"layout",children:I?f.jsxs("div",{className:"mobile-areas",style:{height:Q+"px"},children:[f.jsx("img",{src:J,onClick:()=>{const l=d.findIndex(s=>s.name==r);if(l===-1)return;const n=(l-1+d.length)%d.length;k(d[n].name),console.log("Changing viewing section to",d[n].name)},className:"back-mobile-areas"}),_.map((l,n)=>f.jsx(B,{width:l.width,height:l.height,cells:$(y.find(s=>s.sectionName==l.sectionName).cells),id:l.sectionName,visibile:r==null?!0:l.sectionName==r,section:l.sectionName},n)),f.jsx("img",{src:J,onClick:()=>{const l=d.findIndex(s=>s.name==r);if(l===-1)return;const n=(l+1)%d.length;k(d[n].name),console.log("Changing viewing section to",d[n].name)},className:"forward-mobile-areas"})]}):f.jsx(B,{width:U*x,height:q*x,cells:$(p)})})]}),f.jsxs("div",{id:F?"capture":"",children:[d.map(l=>f.jsx(ye,{takingPhoto:F,section:l,visible:r==null?!0:l.name==r,cellSize:x},l.cellId.toId())),O.map(l=>f.jsx(he,{isCreatingArea:!1,isCreatingTemplate:!1,cellSize:x,isViewingDesign:ee,removeItem:ae,visible:I?!l.hasMoved&&!l.starterItem?!0:r==null?!1:l.starterItem?d.find(n=>n.name==r)?.startingItems.some(n=>n.item.id===l.id):d.find(n=>n.name==r)?.items.some(n=>n.id===l.id):!0,item:l,canPlaceItem:H,placeItem:ce,deleteItemRotate:re,highlightCells:de,unHighlightCells:V,deleteItem:me,isSelected:v===l.id,onSelect:ue,isUnselecting:Z.includes(l.id),onDeselect:()=>ge(l.id)},l.id))]})]})}
