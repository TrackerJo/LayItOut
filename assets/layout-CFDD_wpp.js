import{r as u,j as a,c as It}from"./index-QIV6qY6h.js";import{A as ve,S as He,D as ht}from"./section-lPllg6X6.js";import{I as j,C as w,T as ee,S as F,b as V,s as Se,e as ue,_ as ft,f as pt,r as Fe,h as yt,i as xt,j as wt,k as Ze,l as Tt,m as Lt,p as vt,u as St,n as bt,D as At,o as jt,q as Nt,t as kt}from"./firestore-eMuYHorM.js";import{F as Ie}from"./add_custom_item_dialog-DnliRUT_.js";function Ct({inventoryItem:o,addDraggingItem:p,removeItem:r}){const T=u.useRef(null),v=u.useRef(null),[k,Z]=u.useState(12),[R,B]=u.useState(o.item);function X(h){const P=v.current,N=window.getComputedStyle(P),S=document.createElement("span");S.style.font=N.font,S.style.fontSize=h+"px",S.style.fontFamily=N.fontFamily,S.style.fontWeight=N.fontWeight,S.style.position="absolute",S.style.visibility="hidden",S.style.whiteSpace="nowrap",S.textContent=P.textContent,document.body.appendChild(S);const G=S.offsetWidth;return document.body.removeChild(S),G}function W(h){if(v.current){const P=v.current;return X(h-1)>P.offsetWidth&&h-1>8?W(h-1):h-1}return h}return u.useEffect(()=>{setTimeout(()=>{v.current&&Z(W(k))},100)},[]),a.jsxs("div",{className:"display",children:[a.jsx("div",{ref:T,id:o.item.id,className:"display-item",style:{width:`${o.item.cellsLong*10}px`,height:`${o.item.cellsTall*10}px`},onMouseDown:h=>{h.preventDefault(),h.stopPropagation(),o.item.initialElement=T.current,o.item.id=o.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",o.item.id,"to initialElement",o.item.initialElement),B(new j({id:o.item.id,cellsLong:o.item.cellsLong,cellsTall:o.item.cellsTall,name:o.item.name,icon:o.item.icon,moveable:o.item.moveable,starterItem:o.item.starterItem,displayItem:o.item.isDisplayItem})),p(o.item)},onTouchStart:h=>{h.preventDefault(),h.stopPropagation(),o.item.initialElement=T.current,o.item.id=o.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",o.item.id,"to initialElement",o.item.initialElement),B(new j({id:o.item.id,cellsLong:o.item.cellsLong,cellsTall:o.item.cellsTall,name:o.item.name,icon:o.item.icon,moveable:o.item.moveable,starterItem:o.item.starterItem,displayItem:o.item.isDisplayItem})),p(o.item)},children:o.item.icon.includes("custom-")?a.jsx("div",{className:"custom-icon",children:a.jsx("div",{children:a.jsx("p",{ref:v,style:{fontSize:`${k}px`},children:o.item.icon.split("custom-")[1]})})}):a.jsx("img",{src:o.item.icon,alt:"icon"})}),a.jsx("p",{children:o.item.name}),a.jsxs("p",{className:"quantity",children:["x",o.quantity]})]})}const Et="/LayItOut/assets/plus.circle-Ce3xm00a.png";function Rt({inventoryItems:o,addDraggingItem:p,maxHeight:r,removeItem:T,showAddCustomItem:v,isCreatingTemplate:k,isEditingTemplate:Z,isViewingDesign:R}){return a.jsxs("div",{className:"toolbox",style:{maxHeight:r?`${r}px`:"200px"},children:[o.map(B=>a.jsx(Ct,{inventoryItem:B,addDraggingItem:p,removeItem:T})),!(k||Z||R)&&a.jsx("div",{className:"add-item",onClick:()=>{v()},children:a.jsx("img",{src:Et,alt:"Add Item"})})]})}function Ot({dialogRef:o,closeDialog:p,layoutSections:r,isOpen:T}){const[v,k]=u.useState(0),[Z,R]=u.useState(0),[B,X]=u.useState([]),[W,h]=u.useState([...r]),P=/Mobi|Android/i.test(navigator.userAgent)?5:10;function N(G){for(const b of W)if(G.x>=b.cellId.x&&G.x<b.cellId.x+b.cellsLong&&G.y>=b.cellId.y&&G.y<b.cellId.y+b.cellsTall)return b;return null}u.useEffect(()=>{if(!T)return;console.log("Layout dialog opened, generating cells and sections",r);const G=[];let b=0,x=0;for(const I of r)console.log("Generating cells for section",I.name,"at",I.cellId,"with size",I.cellsLong,"x",I.cellsTall),console.log("Added section Length:",I.cellsLong*P+I.cellId.x),(I.cellsLong+I.cellId.x)*P>b&&(b+=I.cellsLong*P),(I.cellsTall+I.cellId.y)*P>x&&(x+=I.cellsTall*P);console.log("Current width:",b,"Current height:",x),k(b),R(x),[...Array(x/P).keys()].map(I=>{const L=[];[...Array(b/P).keys()].map(y=>{console.log(N(new w({x:y,y:I}))!=null?"In section":"Outside section"),L.push({id:new w({x:y,y:I}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!1,size:P})}),G.push(L)}),X([...G]),setTimeout(()=>{const I=[...r];for(const L of I)console.log("Adding section",L.name,L.cellId),L.cellElement=document.querySelector(`.layout-dialog #${L.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",L.cellElement);console.log("Setting sections",I),h([...I]),X([...G])},100)},[T,r]);function S(G){let b=[];return G.map(x=>b=[...b,...x]),b}return a.jsxs("dialog",{ref:o,className:"layout-dialog",children:[a.jsxs("div",{className:"layout-dialog-div",children:[a.jsx("h2",{children:"Layout"}),a.jsx(ve,{width:v,height:Z,cells:S(B)}),a.jsx("br",{}),a.jsx("button",{className:"layout-dialog-close",onClick:p,children:"Close"})]}),W.map(G=>a.jsx(He,{takingPhoto:!1,section:G,visible:!0,cellSize:P},G.cellId.toId()))]})}const Pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",Dt="/LayItOut/assets/template-Cjj8EPhc.png";function Gt({dialogRef:o,closeDialog:p,templates:r,isOpen:T,isViewingArea:v}){const[k,Z]=u.useState([]),[R,B]=u.useState([]),[X,W]=u.useState([]),[h,P]=u.useState(/Mobi|Android/i.test(navigator.userAgent)),[N,S]=u.useState([]),[G,b]=u.useState(!1);return u.useEffect(()=>{if(T&&(console.log("Layout dialog opened, generating cells and sections",r),r.length!==0)){if(r.length==1){S([r[0].name]);return}S(h?[r[0].name]:[r[0].name,r[1].name])}},[T,r]),u.useEffect(()=>{const x=r.filter(I=>N.includes(I.name));console.log("Viewing templates:",N),x.sort((I,L)=>N.indexOf(I.name)-N.indexOf(L.name)),console.log("Generating templates for",x.map(I=>I.name))},[N]),a.jsx(a.Fragment,{children:a.jsx("dialog",{ref:o,className:"template-dialog",children:a.jsxs("div",{className:"template-dialog-div",children:[a.jsx("h2",{children:"Templates"}),a.jsxs("div",{className:"templates",children:[r.length>1&&r.filter(x=>!N.includes(x.name)).length>0&&a.jsx("img",{src:Ie,onClick:()=>{if(h){const I=(r.findIndex(L=>L.name===N[0])-1+r.length)%r.length;S([r[I].name])}else S(x=>{const L=(r.findIndex(y=>y.name===x[0])-1+r.length)%r.length;return[r[L].name,x[0]]})},className:"back-mobile-areas"}),N.length===0&&a.jsx("div",{className:"no-templates",children:"No templates available"}),N.map(x=>a.jsxs("div",{className:"template",children:[a.jsx("img",{src:r.find(I=>I.name===x).previewImage,alt:x,className:"template-preview"}),a.jsx("h3",{children:x}),a.jsxs("div",{className:"template-actions",children:[a.jsx("button",{className:"template-select-btn",onClick:()=>{if(v){const I=new URLSearchParams(window.location.search),L=I.get("companyId"),y=I.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${L}&areaId=${y}&type=edit-template&templateId=${r.find(U=>U.name==x).id}`}else{const I=r.find(U=>U.name===x),L=new ee({name:I.name,id:I.id,previewImage:I.previewImage,sections:I.sections.map(U=>new F({name:U.name,cellId:new w({x:U.cellId.x*(h?20:10),y:U.cellId.y*(h?20:10)}),cellsLong:U.cellsLong*(h?20:10),cellsTall:U.cellsTall*(h?20:10),startingItems:U.startingItems.map(H=>new V({cell:new w({x:H.cell.x*(h?2:1),y:H.cell.y*(h?2:1)}),item:new j({id:H.item.id,name:H.item.name,icon:H.item.icon,cellsLong:H.item.cellsLong*2,cellsTall:H.item.cellsTall*2,starterItem:H.item.starterItem,moveable:H.item.moveable})}))}))}),y=new URLSearchParams(window.location.search);y.set("templateName",L.name),window.location.search=y.toString()}},children:v?"Edit":"Select"}),v&&a.jsx("button",{className:"action-btn",onClick:()=>{if(G)return;b(!0);const I=r.filter(H=>H.name!==x);I.length==1?S([I[0].name]):I.length==0?S([]):I.length==2&&S(h?[I[0].name]:[I[0].name,I[1].name]);const L=new URLSearchParams(window.location.search),y=L.get("companyId"),U=L.get("areaId");Se(y,U,I).then(()=>{b(!1)})},children:"Delete"})]})]})),r.length>1&&r.filter(x=>!N.includes(x.name)).length>0&&a.jsx("img",{src:Ie,onClick:()=>{if(h){const I=(r.findIndex(L=>L.name===N[0])+1)%r.length;S([r[I].name])}else S(x=>{const L=(r.findIndex(y=>y.name===x[x.length-1])+1)%r.length;return[x[1],r[L].name]})},className:"forward-mobile-areas"})]}),v&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"action-btn",onClick:()=>{const x=new URLSearchParams(window.location.search),I=x.get("companyId"),L=x.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${I}&areaId=${L}&type=create-template`},children:"Create new Template"})," ",a.jsx("br",{})]}),a.jsx("br",{}),a.jsx("button",{className:"action-btn",onClick:p,children:"Close"}),G&&T&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"loader"})})]})})})}function Mt({dialogRef:o,closeDialog:p,addInventoryItem:r}){const[T,v]=u.useState(""),[k,Z]=u.useState(1),[R,B]=u.useState(1),[X,W]=u.useState(1);return a.jsx("dialog",{ref:o,className:"custom-item-dialog",children:a.jsxs("div",{className:"custom-item-dialog-div",children:[a.jsx("h2",{children:"Add Custom Item"}),a.jsxs("div",{className:"custom-item-row",children:[a.jsx("label",{htmlFor:"item-name",children:"Name:"}),a.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:h=>v(h.target.value??""),value:T})]}),a.jsxs("div",{className:"custom-item-row",children:[a.jsx("label",{htmlFor:"item-icon",children:"Count:"}),a.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:k,onChange:h=>Z(parseInt(h.target.value)??1)})]}),a.jsxs("div",{className:"custom-item-row custom-item-size",children:[a.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),a.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:R,onChange:h=>B(parseFloat(h.target.value)??1)}),a.jsx("span",{children:" x "}),a.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:X,onChange:h=>W(parseFloat(h.target.value)??1)})]}),a.jsx("br",{}),a.jsx("button",{className:"custom-item-dialog-add",onClick:()=>{if(T.trim()===""){alert("Item name cannot be empty");return}const h=new ue({quantity:k,item:new j({id:T+(Math.random()*1e4).toString(),name:T,icon:`custom-${T}`,cellsLong:Math.ceil(R),cellsTall:Math.ceil(X),moveable:!0,starterItem:!1,displayItem:!0})});r(h),v(""),Z(1),B(1),W(1),p()},children:"Add Item"}),a.jsx("br",{}),a.jsx("br",{}),a.jsx("button",{className:"custom-item-dialog-close",onClick:p,children:"Close"})]})})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ye="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(p,r,T,v){this.app=p,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,yt(p)&&p.settings.appCheckToken&&(this.serverAppAppCheckToken=p.settings.appCheckToken),this.auth=r.getImmediate({optional:!0}),this.messaging=T.getImmediate({optional:!0}),this.auth||r.get().then(k=>this.auth=k,()=>{}),this.messaging||T.get().then(k=>this.messaging=k,()=>{}),this.appCheck||v?.get().then(k=>this.appCheck=k,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(p){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const r=p?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return r.error?null:r.token}return null}async getContext(p){const r=await this.getAuthToken(),T=await this.getMessagingToken(),v=await this.getAppCheckToken(p);return{authToken:r,messagingToken:T,appCheckToken:v}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const be="us-central1";class Wt{constructor(p,r,T,v,k=be,Z=(...R)=>fetch(...R)){this.app=p,this.fetchImpl=Z,this.emulatorOrigin=null,this.contextProvider=new Ft(p,r,T,v),this.cancelAllRequests=new Promise(R=>{this.deleteService=()=>Promise.resolve(R())});try{const R=new URL(k);this.customDomain=R.origin+(R.pathname==="/"?"":R.pathname),this.region=be}catch{this.customDomain=null,this.region=k}}_delete(){return this.deleteService()}_url(p){const r=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${r}/${this.region}/${p}`:this.customDomain!==null?`${this.customDomain}/${p}`:`https://${this.region}-${r}.cloudfunctions.net/${p}`}}function Ut(o,p,r){const T=Lt(p);o.emulatorOrigin=`http${T?"s":""}://${p}:${r}`,T&&(vt(o.emulatorOrigin),St("Functions",!0))}const We="@firebase/functions",Ue="0.13.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ht="auth-internal",Zt="app-check-internal",Yt="messaging-internal";function Jt(o){const p=(r,{instanceIdentifier:T})=>{const v=r.getProvider("app").getImmediate(),k=r.getProvider(Ht),Z=r.getProvider(Yt),R=r.getProvider(Zt);return new Wt(v,k,Z,R,T)};ft(new pt(Ye,p,"PUBLIC").setMultipleInstances(!0)),Fe(We,Ue,o),Fe(We,Ue,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bt(o=xt(),p=be){const T=wt(Ze(o),Ye).getImmediate({identifier:p}),v=Tt("functions");return v&&zt(T,...v),T}function zt(o,p,r){Ut(Ze(o),p,r)}Jt();Bt(bt);It.createRoot(document.getElementById("root")).render(a.jsx(Vt,{}));function Vt(){const[o,p]=u.useState(/Mobi|Android/i.test(navigator.userAgent)),[r,T]=u.useState(0),[v,k]=u.useState(0),[Z,R]=u.useState(0),[B,X]=u.useState(0),[W,h]=u.useState([]),[P,N]=u.useState([]),[S,G]=u.useState(0),[b,x]=u.useState(null),[I,L]=u.useState([]),y=/Mobi|Android/i.test(navigator.userAgent)?5:10,[U,H]=u.useState([]),he=u.useRef(null),[Je,Ae]=u.useState(!1),[Q,ae]=u.useState([]),[A,q]=u.useState([]),[re,je]=u.useState([]),[Be,Ne]=u.useState(!1),fe=u.useRef(null),[ze,ke]=u.useState([]),[J,_]=u.useState([]),[C,de]=u.useState(null),[ie,Ce]=u.useState(!1),[te,Ve]=u.useState(!1),[le,Xe]=u.useState(!1),[Qe,Ke]=u.useState(!1),[Xt,$e]=u.useState(!1),[qe,_e]=u.useState(!1),[pe,ye]=u.useState(""),[ne,Ee]=u.useState(""),[ge,et]=u.useState(""),[ce,tt]=u.useState(""),[Re,xe]=u.useState(""),[we,K]=u.useState(!0),[Oe,lt]=u.useState(null),[Te,se]=u.useState(!1),Le=u.useRef(null);function me(t,l){for(const n of l)if(t.x>=n.cellId.x&&t.x<n.cellId.x+n.cellsLong&&t.y>=n.cellId.y&&t.y<n.cellId.y+n.cellsTall)return n;return null}function nt(t){ae([...t.map(c=>new F({name:c.name,cellId:new w({x:c.cellId.x/2,y:c.cellId.y/2}),cellsLong:c.cellsLong/2,cellsTall:c.cellsTall/2,startingItems:[]}))]);let l=r,n=v;if(o){for(const e of t)console.log("Generating cells for section",e.name,"at",e.cellId,"with size",e.cellsLong,"x",e.cellsTall),console.log("Needed section Width:",(e.cellsLong+e.cellId.x)*y,"Current width:",l),(e.cellsLong+e.cellId.x)*y>l&&(console.log("Added section Width:",e.cellsLong*y+e.cellId.x),l+=(e.cellsLong+e.cellId.x)*y-l),console.log("Needed section Height:",(e.cellsTall+e.cellId.y)*y,"Current height:",n),(e.cellsTall+e.cellId.y)*y>n&&(console.log("Added section Height:",e.cellsTall*y+e.cellId.y),n+=(e.cellsTall+e.cellId.y)*y-n);X(n*2),R(l*2);let c=0;const i=[],s=[];for(const e of t){const m=[],f={width:e.cellsLong*y,height:e.cellsTall*y,sectionName:e.name};f.height>c&&(c=f.height),ke(Y=>[...Y,f]),e.cellId.x=0,e.cellId.y=0,[...Array(f.height/y).keys()].map(Y=>{const D=[];[...Array(f.width/y).keys()].map(E=>{D.push({id:new w({x:E,y:Y}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:y})}),m.push(D)}),i.push({sectionName:e.name,cells:[...m]}),s.push(e)}_(i),q(s),G(c),de(t[0]?t[0].name:null),setTimeout(()=>{K(!1)},500)}else{const c=[];for(const i of t)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",(i.cellsLong+i.cellId.x)*y,"Current width:",l),(i.cellsLong+i.cellId.x)*y>l&&(console.log("Added section Width:",i.cellsLong*y+i.cellId.x),l+=(i.cellsLong+i.cellId.x)*y-l),console.log("Needed section Height:",(i.cellsTall+i.cellId.y)*y,"Current height:",n),(i.cellsTall+i.cellId.y)*y>n&&(console.log("Added section Height:",i.cellsTall*y+i.cellId.y),n+=(i.cellsTall+i.cellId.y)*y-n);T(l),k(n),R(l),X(n),[...Array(n/y).keys()].map(i=>{const s=[];[...Array(l/y).keys()].map(e=>{s.push({id:new w({x:e,y:i}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:me(new w({x:e,y:i}),t)!=null,size:y})}),c.push(s)}),h([...c]),setTimeout(()=>{const i=[],s=[...t];for(const e of s)e.cellElement=document.querySelector(`.App #${e.cellId.toId()}.cell:not(.cell-border)`),i.push(...e.startingItems.map(m=>new V({cell:new w({x:e.cellId.x+m.cell.x,y:e.cellId.y+m.cell.y}),item:new j({id:m.item.id,name:m.item.name,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,initialElement:document.querySelector(`.App #${m.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:m.item.moveable,rotation:m.item.rotation||0})})));q([...s]);for(const e of i){const m=D=>{const E=D%2===1;return{cellsLong:E?e.item.cellsTall:e.item.cellsLong,cellsTall:E?e.item.cellsLong:e.item.cellsTall}},f=e.item.rotation||0,Y=m(f);for(let D=0;D<Y.cellsTall;D++)for(let E=0;E<Y.cellsLong;E++)c[e.cell.y+D][e.cell.x+E].hasItem=!0,c[e.cell.y+D][e.cell.x+E].itemId=e.item.id;e.item.initialElement=document.querySelector(`.App #${e.cell.toId()}.cell:not(.cell-border)`),N(D=>[...D,e.item])}h([...c]),setTimeout(()=>{K(!1)},500)},100)}}async function st(){const t=new URLSearchParams(window.location.search),l=t.get("companyId"),n=t.get("areaId"),c=t.get("areaId")||"",i=t.get("companyId")||"",s=t.get("templateId")||"",e=await Nt(i,c),m=t.get("type")||"";let f=!1;if(m==="create-template")Ce(!0);else if(m==="edit-template"){Ve(!0);const d=e.templates.find(g=>g.id===s);d&&(lt(d),Ee(d.name))}else if(m==="view-design"){f=!0,Xe(!0);const d=t.get("designName")||"";ye(d);const g=t.get("designId")||"";xe(g)}else if(m==="view-area")Ke(!0);else if(m==="edit-design"){f=!0,$e(!0);const d=t.get("designName")||"";ye(d);const g=t.get("designId")||"";xe(g)}else if(m==="client-edit-design"){f=!0,_e(!0);const d=t.get("designName")||"";ye(d);const g=t.get("designId")||"";xe(g)}l&&et(l),n&&tt(n),H(e.inventoryItems.map(d=>new ue({item:new j({id:d.item.id,name:d.item.name,cellsLong:d.item.cellsLong,cellsTall:d.item.cellsTall,icon:d.item.icon,initialElement:d.item.initialElement,moveable:d.item.moveable,starterItem:d.item.starterItem,displayItem:!0}),quantity:d.quantity})));const Y=[],D=[];for(const d of e.templates){const g=[],O=[];for(const z of d.sections)g.push(new F({name:z.name,cellId:new w({x:z.cellId.x/(o?20:10),y:z.cellId.y/(o?20:10)}),cellsLong:z.cellsLong/(o?20:10),cellsTall:z.cellsTall/(o?20:10),startingItems:z.startingItems.map(M=>new V({cell:new w({x:M.cell.x/(o?2:1),y:M.cell.y/(o?2:1)}),item:new j({id:M.item.id,name:M.item.name,cellsLong:M.item.cellsLong/2,cellsTall:M.item.cellsTall/2,icon:M.item.icon,starterItem:!0,moveable:M.item.moveable,rotation:M.item.rotation||0})}))})),O.push(new F({name:z.name,cellId:new w({x:z.cellId.x,y:z.cellId.y}),cellsLong:z.cellsLong,cellsTall:z.cellsTall,startingItems:z.startingItems.map(M=>new V({cell:new w({x:M.cell.x,y:M.cell.y}),item:new j({id:M.item.id,name:M.item.name,cellsLong:M.item.cellsLong,cellsTall:M.item.cellsTall,icon:M.item.icon,starterItem:!0,moveable:M.item.moveable,rotation:M.item.rotation||0})}))}));Y.push(new ee({name:d.name,sections:g,id:d.id,previewImage:d.previewImage})),D.push(new ee({name:d.name,sections:O,id:d.id,previewImage:d.previewImage}))}je([...Y]);const E=[],$=s===""?void 0:D.find(d=>d.id===s);if(console.log("TEMPLATE",$,"AREA",e),f){const d=await kt(i,c,t.get("designId")||"");if(d===null){window.location.href="/LayItOut/DNF/";return}ae([...d.sections]),q([...d.sections.map(g=>new F({name:g.name,cellId:new w({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(O=>new j({id:O.item.id,name:O.item.name,sectionCell:O.cell,cellsLong:O.item.cellsLong,cellsTall:O.item.cellsTall,icon:O.item.icon,moveable:O.item.moveable,starterItem:O.item.starterItem,rotation:O.item.rotation}))}))]),E.push(...d.sections.map(g=>new F({name:g.name,cellId:new w({x:g.cellId.x/10,y:g.cellId.y/10}),cellsLong:g.cellsLong/10,cellsTall:g.cellsTall/10,startingItems:g.startingItems,items:g.startingItems.map(O=>new j({id:O.item.id,name:O.item.name,sectionCell:O.cell,cellsLong:O.item.cellsLong,cellsTall:O.item.cellsTall,icon:O.item.icon,moveable:O.item.moveable,starterItem:O.item.starterItem,rotation:O.item.rotation}))})))}else $!==void 0?(ae([...$.sections]),q([...$.sections.map(d=>new F({name:d.name,cellId:new w({x:d.cellId.x/10,y:d.cellId.y/10}),cellsLong:d.cellsLong/10,cellsTall:d.cellsTall/10,startingItems:d.startingItems,items:d.startingItems.map(g=>new j({id:g.item.id,name:g.item.name,sectionCell:g.cell,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,moveable:g.item.moveable,starterItem:g.item.starterItem,rotation:g.item.rotation}))}))]),E.push(...$.sections.map(d=>new F({name:d.name,cellId:new w({x:d.cellId.x/10,y:d.cellId.y/10}),cellsLong:d.cellsLong/10,cellsTall:d.cellsTall/10,startingItems:d.startingItems,items:d.startingItems.map(g=>new j({id:g.item.id,name:g.item.name,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,moveable:g.item.moveable,starterItem:g.item.starterItem,rotation:g.item.rotation,sectionCell:g.cell}))})))):(ae([...e.sections]),q([...e.sections.map(d=>new F({name:d.name,cellId:new w({x:d.cellId.x/10,y:d.cellId.y/10}),cellsLong:d.cellsLong/10,cellsTall:d.cellsTall/10,startingItems:d.startingItems,items:d.startingItems.map(g=>new j({id:g.item.id,name:g.item.name,sectionCell:g.cell,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,moveable:g.item.moveable,starterItem:g.item.starterItem,rotation:g.item.rotation}))}))]),E.push(...e.sections.map(d=>new F({name:d.name,cellId:new w({x:d.cellId.x/10,y:d.cellId.y/10}),cellsLong:d.cellsLong/10,cellsTall:d.cellsTall/10,startingItems:d.startingItems,items:d.startingItems.map(g=>new j({id:g.item.id,name:g.item.name,sectionCell:g.cell,cellsLong:g.item.cellsLong,cellsTall:g.item.cellsTall,icon:g.item.icon,moveable:g.item.moveable,starterItem:g.item.starterItem,rotation:g.item.rotation}))}))));console.log("SECTIONS TO GENERATE",E),nt(E)}u.useEffect(()=>{st()},[]);function ot(t,l,n){if(!o||t==null)return;const c=[...n],i=[],s=n.find(e=>e.name==t);console.log("NEW SECTION",s),console.log("Adding section",s.name,s.cellId),console.log("MOBILE CELLS",l),s.cellElement=document.querySelector(`.App #${s.name.split(" ").join("-")} #${s.name.split(" ").join("")}${s.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",s.cellElement);for(const e of s.startingItems){console.log("Placing starting item",e.item.name,e.cell);const m=D=>{const E=D%2===1;return{cellsLong:E?e.item.cellsTall:e.item.cellsLong,cellsTall:E?e.item.cellsLong:e.item.cellsTall}},f=e.item.rotation||0,Y=m(f);for(let D=0;D<Y.cellsTall;D++)for(let E=0;E<Y.cellsLong;E++){const $=l.find(d=>d.sectionName===s.name);$.cells[e.cell.y+D][e.cell.x+E].hasItem=!0,$.cells[e.cell.y+D][e.cell.x+E].itemId=e.item.id}e.item.initialElement=document.querySelector(`.App #${s.name.split(" ").join("-")} #${s.name.split(" ").join("")}${e.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",e.item.initialElement),i.push(new j({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,initialElement:e.item.initialElement,starterItem:!0,moveable:e.item.moveable,rotation:e.item.rotation}))}console.log("Setting sections",c),q([...c]),console.log("ITEMS",i),N(e=>[...e.filter(f=>!i.some(Y=>Y.id===f.id)),...i.map(f=>new j({id:f.id,name:f.name,cellsLong:f.cellsLong,cellsTall:f.cellsTall,icon:f.icon,initialElement:f.initialElement,starterItem:!0,moveable:f.moveable,rotation:f.rotation}))])}function Pe(t){let l=[];return t.map(n=>l=[...l,...n]),l}function De(t,l){console.log(t);const n=o?J.find(e=>e.sectionName===C).cells:W,c=n[t.y].length,i=n.length;if(console.log(c,i),t.x+l.cellsLong>c||t.y+l.cellsTall>i)return!1;const s=me(t,A);if(!s&&!o)return console.log("Item is out of bounds of any section"),!1;for(let e=0;e<l.cellsTall;e++)for(let m=0;m<l.cellsLong;m++){if(!o){const f=me(new w({x:t.x+m,y:t.y+e}),A);if(!f)return console.log("Item is out of bounds of any section"),!1;if(f.name!=s.name)return console.log("Item is crossing section boundaries"),!1}if(n[t.y+e][t.x+m].hasItem&&n[t.y+e][t.x+m].itemId!=l.id)return console.log("Something is already here"),!1}return!0}function at(t,l,n){const c=Array.from(o?J.find(e=>e.sectionName===C).cells:W);if(n!=null){console.log("Removing item");const e=o?A.find(m=>m.name===C):me(n,A);e.items=e.items.filter(m=>m.id!=l.id);for(let m=0;m<l.cellsTall;m++)for(let f=0;f<l.cellsLong;f++)c[n.y+m][n.x+f].hasItem=!1,c[n.y+m][n.x+f].itemId=""}const i=o?A.find(e=>e.name===C):me(t,A),s=new w({x:t.x-i.cellId.x,y:t.y-i.cellId.y});l.sectionCell=s,i.items.push(l);for(let e=0;e<l.cellsTall;e++)for(let m=0;m<l.cellsLong;m++)c[t.y+e][t.x+m].hasItem=!0,c[t.y+e][t.x+m].itemId=l.id;if(console.log(c),o){const e=J.find(m=>m.sectionName===C);e&&(e.cells=c.map(m=>m.map(f=>({...f}))),_([...J]))}else h(c);if(console.log("Removing item from inventory",l.name),!l.hasMoved){const e=U.findIndex(m=>m.item.name==l.name&&!m.item.hasMoved);if(e!==-1){const m=[...U];m[e].quantity-=1,m[e].quantity<=0&&m.splice(e,1),H(m)}else H(U)}N(e=>(console.log("Placing item",l.id),console.log("Updating item",l.id),e.find(m=>m.id==l.id).hasMoved||(e.find(m=>m.id==l.id).hasMoved=!0),e))}function it(t){P.find(l=>l.name==t.name&&!l.hasMoved&&!l.starterItem)||N(l=>[...l,t])}function Ge(t){console.log("Removing item",t.id),N(l=>l.filter(n=>n.id!=t.id))}function ct(t,l){const n=Array.from(W),c=e=>{const m=e%2===1;return{cellsWide:m?t.cellsTall:t.cellsLong,cellsTall:m?t.cellsLong:t.cellsTall}},i=t.rotation||0,s=c(i);for(let e=0;e<s.cellsTall;e++)for(let m=0;m<s.cellsWide;m++)n[l.y+e][l.x+m].hasItem=!1,n[l.y+e][l.x+m].itemId="";h(n),console.log("DELETING ITEM",t.id),N(e=>(console.log(),e.filter(m=>m.id!=t.id))),H(e=>{const m=e.findIndex(f=>f.item.name==t.name&&!f.item.hasMoved);if(m!==-1){const f=[...e];return f[m].quantity+=1,f}else return[...e,new ue({item:new j({id:t.id,name:t.name,cellsLong:s.cellsWide,cellsTall:s.cellsTall,icon:t.icon}),quantity:1})]})}function mt(t,l){const n=Array.from(o?J.find(e=>e.sectionName===C).cells:W);console.log("DELETING ITEM ROTATE",t.id,t.rotation);const c=e=>{const m=e%2===1;return{cellsWide:m?t.cellsTall:t.cellsLong,cellsTall:m?t.cellsLong:t.cellsTall}},i=t.rotation||0,s=c(i);for(let e=0;e<s.cellsTall;e++)for(let m=0;m<s.cellsWide;m++)console.log("Deleting cell",l.y+e,l.x+m),n[l.y+e][l.x+m].hasItem=!1,n[l.y+e][l.x+m].itemId="";h([...n]),console.log("DELETING ITEM",t.id)}function rt(t,l){const n=o?J.find(s=>s.sectionName===C).cells:W,c=Array.from(n);if(n[t.y]==null){Me();return}const i=De(t,l);c.forEach(s=>s.forEach(e=>{e.mouseOver=!1,e.canPlaceItem=!1,e.mouseOverLocation=""}));for(let s=0;s<l.cellsTall;s++)for(let e=0;e<l.cellsLong;e++)t.y+s<c.length&&t.x+e<c[t.y+s].length&&(l.cellsLong===1&&l.cellsTall===1?c[t.y+s][t.x+e].mouseOverLocation="single":l.cellsTall===1?e===0?c[t.y+s][t.x+e].mouseOverLocation="leftFull":e===l.cellsLong-1?c[t.y+s][t.x+e].mouseOverLocation="rightFull":c[t.y+s][t.x+e].mouseOverLocation="middleFull":l.cellsLong===1?s===0?c[t.y+s][t.x+e].mouseOverLocation="topFull":s===l.cellsTall-1?c[t.y+s][t.x+e].mouseOverLocation="bottomFull":c[t.y+s][t.x+e].mouseOverLocation="middleVFull":s===0&&e===0?c[t.y+s][t.x+e].mouseOverLocation="topLeftCorner":s===0&&e===l.cellsLong-1?c[t.y+s][t.x+e].mouseOverLocation="topRightCorner":s===l.cellsTall-1&&e===0?c[t.y+s][t.x+e].mouseOverLocation="bottomLeftCorner":s===l.cellsTall-1&&e===l.cellsLong-1?c[t.y+s][t.x+e].mouseOverLocation="bottomRightCorner":s===0?c[t.y+s][t.x+e].mouseOverLocation="top":s===l.cellsTall-1?c[t.y+s][t.x+e].mouseOverLocation="bottom":e===0?c[t.y+s][t.x+e].mouseOverLocation="left":e===l.cellsLong-1?c[t.y+s][t.x+e].mouseOverLocation="right":c[t.y+s][t.x+e].mouseOverLocation="middle",c[t.y+s][t.x+e].mouseOver=!0,c[t.y+s][t.x+e].canPlaceItem=i);if(o){const s=J.find(e=>e.sectionName===C);s&&(s.cells=c.map(e=>e.map(m=>({...m}))),_([...J])),_(e=>e.map(m=>m.sectionName===C?{...m,cells:c}:m))}else h(c)}function Me(){console.log("Unhighlighting cells");const t=Array.from(o?J.find(l=>l.sectionName===C).cells:W);if(t.forEach(l=>l.forEach(n=>{n.mouseOver=!1,n.canPlaceItem=!1,n.mouseOverLocation=""})),o){const l=J.find(n=>n.sectionName===C);l&&(l.cells=t.map(n=>n.map(c=>({...c}))),_([...J])),_(n=>n.map(c=>c.sectionName===C?{...c,cells:t}:c))}else h(t)}u.useEffect(()=>{ot(C,J,A)},[C]),u.useEffect(()=>{const t=()=>{const l=P.find(n=>n.id===b);console.log("Unselecting item",b),x(null),l&&(L(n=>[...n,l.id]),console.log("Unselecting item",l.id),setTimeout(()=>{L(n=>n.filter(c=>c!==l.id))},300))};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[b,P]);function dt(t){x(null),L(l=>[...l,t]),console.log("Unselecting item",t),setTimeout(()=>{L(l=>l.filter(n=>n!==t))},300)}function gt(t){const l=P.find(n=>n.id===b);console.log("Unselecting item",b),x(t),l&&(L(n=>[...n,l.id]),console.log("Unselecting item",l.id),setTimeout(()=>{L(n=>n.filter(c=>c!==l.id))},300))}function ut(t){H(l=>[...l,t])}const oe=t=>{console.log("Preventing scroll"),t.preventDefault(),t.stopPropagation(),window.scrollTo(0,0)};return u.useEffect(()=>(Te?(window.addEventListener("scroll",oe),window.addEventListener("touchmove",oe,{passive:!1})):(window.removeEventListener("scroll",oe),window.removeEventListener("touchmove",oe)),()=>{window.removeEventListener("scroll",oe),window.removeEventListener("touchmove",oe)}),[Te]),a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"App",children:[a.jsx("h1",{className:"title",children:"LayItOut"}),a.jsx("br",{}),(ie||te)&&a.jsxs("div",{className:"template-name-row",children:[a.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),a.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:t=>Ee(t.target.value),value:ne})]}),le&&a.jsx("div",{className:"design-name-row",children:a.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",pe]})}),(ie||te)&&a.jsxs("div",{className:"template-creation",children:[a.jsxs("button",{className:"action-btn",onClick:()=>{if(ne.trim()==""){alert("Please enter a template name");return}if(re.some(t=>t.name===ne&&(te?t.id!==Oe.id:!0))){alert("Template with this name already exists");return}te?(K(!0),setTimeout(async()=>{const t=A.map(l=>new F({name:l.name,cellId:new w({x:Q.find(n=>n.name==l.name).cellId.x*20,y:Q.find(n=>n.name==l.name).cellId.y*20}),cellsLong:l.cellsLong*10,cellsTall:l.cellsTall*10,startingItems:l.items.map(n=>new V({cell:new w({x:n.sectionCell.x,y:n.sectionCell.y}),item:new j({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",t.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),se(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){se(!1);const n=re.map(c=>c.id===Oe.id?(console.log("SECTION",A),new ee({name:ne,previewImage:l.newValue,sections:A.map(i=>new F({name:i.name,cellId:new w({x:c.sections.find(s=>s.name==i.name).cellId.x*(o?20:10),y:c.sections.find(s=>s.name==i.name).cellId.y*(o?20:10)}),cellsLong:i.cellsLong*10,cellsTall:i.cellsTall*10,startingItems:i.items.map(s=>new V({cell:new w({x:s.sectionCell.x,y:s.sectionCell.y}),item:new j({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:c.id})):new ee({name:c.name,previewImage:c.previewImage,sections:c.sections.map(i=>new F({name:i.name,cellId:new w({x:i.cellId.x*(o?20:10),y:i.cellId.y*(o?20:10)}),cellsLong:i.cellsLong*(o?20:10),cellsTall:i.cellsTall*(o?20:10),startingItems:i.startingItems.map(s=>new V({cell:new w({x:s.cell.x*(o?2:1),y:s.cell.y*(o?2:1)}),item:new j({id:s.item.id,name:s.item.name,cellsLong:s.item.cellsLong*2,cellsTall:s.item.cellsTall*2,icon:s.item.icon,starterItem:s.item.starterItem,moveable:s.item.moveable,rotation:s.item.rotation})}))})),id:c.id}));Se(ge,ce,n).then(()=>{console.log("Template updated successfully"),K(!1);const c=new URLSearchParams(window.location.search),i=c.get("companyId"),s=c.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${i}&areaId=${s}&type=view-area`})}})},500)):(K(!0),setTimeout(async()=>{const t=A.map(l=>new F({name:l.name,cellId:new w({x:Q.find(n=>n.name==l.name).cellId.x*20,y:Q.find(n=>n.name==l.name).cellId.y*20}),cellsLong:l.cellsLong*10,cellsTall:l.cellsTall*10,startingItems:l.items.map(n=>new V({cell:new w({x:n.sectionCell.x,y:n.sectionCell.y}),item:new j({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",t.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),se(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){se(!1);const n=new ee({name:ne,previewImage:l.newValue,sections:A.map(i=>new F({name:i.name,cellId:new w({x:Q.find(s=>s.name==i.name).cellId.x*20,y:Q.find(s=>s.name==i.name).cellId.y*20}),cellsLong:i.cellsLong*10,cellsTall:i.cellsTall*10,startingItems:i.items.map(s=>new V({cell:new w({x:s.sectionCell.x,y:s.sectionCell.y}),item:new j({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))})),id:ne+(Math.random()*1e4).toString()}),c=[...re.map(i=>new ee({name:i.name,previewImage:i.previewImage,sections:i.sections.map(s=>new F({name:s.name,cellId:new w({x:s.cellId.x*(o?20:10),y:s.cellId.y*(o?20:10)}),cellsLong:s.cellsLong*(o?20:10),cellsTall:s.cellsTall*(o?20:10),startingItems:s.startingItems.map(e=>new V({cell:new w({x:e.cell.x*(o?2:1),y:e.cell.y*(o?2:1)}),item:new j({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong*2,cellsTall:e.item.cellsTall*2,icon:e.item.icon,starterItem:e.item.starterItem,moveable:e.item.moveable,rotation:e.item.rotation})}))})),id:i.id})),n];Se(ge,ce,c).then(()=>{console.log("Template updated successfully"),K(!1);const i=new URLSearchParams(window.location.search),s=i.get("companyId"),e=i.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${s}&areaId=${e}&type=view-area`})}})},500))},children:[ie?"Create":"Save"," Template"]}),a.jsx("button",{className:"action-btn",onClick:()=>{Ce(!1),je([]),ae([]),q([]),_([]),ke([]),de(null)},children:"Cancel"})]}),qe&&a.jsxs("div",{className:"template-creation",children:[a.jsx("button",{className:"action-btn",onClick:()=>{K(!0),setTimeout(async()=>{const t=A.map(l=>new F({name:l.name,cellId:new w({x:Q.find(n=>n.name==l.name).cellId.x*20,y:Q.find(n=>n.name==l.name).cellId.y*20}),cellsLong:l.cellsLong*10,cellsTall:l.cellsTall*10,startingItems:l.items.map(n=>new V({cell:new w({x:n.sectionCell.x,y:n.sectionCell.y}),item:new j({id:n.id,name:n.name,cellsLong:n.cellsLong,cellsTall:n.cellsTall,icon:n.icon,starterItem:!0,moveable:n.moveable,rotation:n.rotation})}))}));localStorage.setItem("screenshotSections",t.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(l=>JSON.stringify(l.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),se(!0),window.addEventListener("storage",async l=>{if(console.log("Storage event",l),l.key==="screenshot"){se(!1);const n=new At({name:pe,previewImage:l.newValue,areaId:ce,sections:A.map(c=>new F({name:c.name,cellId:new w({x:Q.find(i=>i.name==c.name).cellId.x*20,y:Q.find(i=>i.name==c.name).cellId.y*20}),cellsLong:c.cellsLong*10,cellsTall:c.cellsTall*10,startingItems:c.items.map(i=>new V({cell:new w({x:i.sectionCell.x,y:i.sectionCell.y}),item:new j({id:i.id,name:i.name,cellsLong:i.cellsLong,cellsTall:i.cellsTall,icon:i.icon,starterItem:!0,moveable:i.moveable,rotation:i.rotation})}))})),id:Re});jt(ge,ce,n).then(()=>{console.log("Design updated successfully"),K(!1)})}})},500)},children:"Save"}),a.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),we&&a.jsx(a.Fragment,{children:a.jsx("div",{className:"loader-backdrop",children:a.jsx("div",{className:"loader"})})})," ",a.jsxs("div",{className:"layout",children:[!le&&a.jsx(Rt,{isViewingDesign:le,isEditingTemplate:te,isCreatingTemplate:ie,maxHeight:o?200:v,showAddCustomItem:()=>{Le.current?.showModal()},addDraggingItem:it,removeItem:Ge,inventoryItems:U.map(t=>new ue({item:new j({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,displayItem:!0}),quantity:t.quantity}))}),o?a.jsxs("div",{className:"mobile-areas",style:{height:S+"px"},children:[a.jsx("img",{src:Ie,onClick:()=>{const t=A.findIndex(n=>n.name==C);if(t===-1)return;const l=(t-1+A.length)%A.length;de(A[l].name),console.log("Changing viewing section to",A[l].name)},className:"back-mobile-areas"}),ze.map((t,l)=>a.jsx(ve,{width:t.width,height:t.height,cells:Pe(J.find(n=>n.sectionName==t.sectionName).cells),id:t.sectionName,visibile:C==null?!0:t.sectionName==C,section:t.sectionName},l)),a.jsx("img",{src:Ie,onClick:()=>{const t=A.findIndex(n=>n.name==C);if(t===-1)return;const l=(t+1)%A.length;de(A[l].name),console.log("Changing viewing section to",A[l].name)},className:"forward-mobile-areas"})]}):a.jsx(ve,{width:r,height:v,cells:Pe(W)})]}),le&&a.jsx("div",{className:"design-view",children:a.jsx("button",{className:"action-btn",onClick:()=>{window.location.href=`/LayItOut/Print/?companyId=${ge}&areaId=${ce}&designName=${pe}&designId=${Re}`},children:"Print"})})]}),a.jsxs("div",{children:[A.map(t=>a.jsx(He,{takingPhoto:!1,section:t,visible:C==null?!0:t.name==C,cellSize:y},t.cellId.toId())),P.map(t=>a.jsx(ht,{cellSize:y,isViewingDesign:le,removeItem:Ge,visible:o?!t.hasMoved&&!t.starterItem?!0:C==null?!1:t.starterItem?A.find(l=>l.name==C)?.startingItems.some(l=>l.item.id===t.id):A.find(l=>l.name==C)?.items.some(l=>l.id===t.id):!0,item:t,canPlaceItem:De,placeItem:at,deleteItemRotate:mt,highlightCells:rt,unHighlightCells:Me,deleteItem:ct,isSelected:b===t.id,onSelect:gt,isUnselecting:I.includes(t.id),onDeselect:()=>dt(t.id)},t.id))]}),o&&!we&&a.jsx("div",{className:"layout-icon",onClick:()=>{he.current?.showModal(),Ae(!0),console.log("Showing layout dialog")},children:a.jsx("img",{src:Pt,alt:""})}),!we&&!(ie||te||le)&&a.jsx("div",{className:"template-icon",onClick:()=>{fe.current?.showModal(),Ne(!0),console.log("Showing template dialog")},children:a.jsx("img",{src:Dt,alt:""})}),a.jsx(Gt,{isViewingArea:Qe,dialogRef:fe,isOpen:Be,closeDialog:()=>{fe.current?.close(),Ne(!1)},templates:re}),a.jsx(Ot,{dialogRef:he,isOpen:Je,closeDialog:()=>{he.current?.close(),Ae(!1)},layoutSections:Q}),a.jsx(Mt,{dialogRef:Le,addInventoryItem:ut,closeDialog:()=>{Le.current?.close()}}),Te&&a.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:"https://trackerjo.github.io/LayItOut/Preview/",width:Z+20,height:B+20})]})}
