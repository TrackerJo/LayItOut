import{c as el,j as g,r as u}from"./index-QIV6qY6h.js";import{A as he,S as ll,D as nl}from"./section-Bs7d8TSU.js";import{S,C as I,b as E,I as p,T as F,s as Se,D as tl,u as ol,e as ce,f as sl,h as al}from"./firestore-FyM7zbDZ.js";import{T as cl,F as ve,L as il,a as ml,b as rl,c as dl,A as gl}from"./add_custom_item_dialog-DU3zotvu.js";el.createRoot(document.getElementById("root")).render(g.jsx(ul,{}));function ul(){const[r,Il]=u.useState(/Mobi|Android/i.test(navigator.userAgent)),[ie,be]=u.useState(0),[X,Ne]=u.useState(0),[D,R]=u.useState([]),[J,k]=u.useState([]),[Oe,Ee]=u.useState(0),[M,Z]=u.useState(null),[Ae,U]=u.useState([]),h=/Mobi|Android/i.test(navigator.userAgent)?5:10,[_,W]=u.useState([]),ee=u.useRef(null),[je,me]=u.useState(!1),[N,H]=u.useState([]),[f,P]=u.useState([]),[G,re]=u.useState([]),[De,de]=u.useState(!1),le=u.useRef(null),[Re,ge]=u.useState([]),[O,V]=u.useState([]),[x,K]=u.useState(null),[Y,ue]=u.useState(!1),[$,Pe]=u.useState(!1),[C,ke]=u.useState(!1),[Me,Ue]=u.useState(!1),[fl,$e]=u.useState(!1),[Ce,qe]=u.useState(!1),[ne,te]=u.useState(""),[q,Ie]=u.useState(""),[Q,Fe]=u.useState(""),[z,Je]=u.useState(""),[fe,oe]=u.useState(""),[se,A]=u.useState(!0),[ye,We]=u.useState(null),[we,yl]=u.useState(!1),ae=u.useRef(null);function B(l,n){for(const o of n)if(l.x>=o.cellId.x&&l.x<o.cellId.x+o.cellsLong&&l.y>=o.cellId.y&&l.y<o.cellId.y+o.cellsTall)return o;return null}function He(l){H([...l.map(s=>new S({name:s.name,cellId:new I({x:s.cellId.x/2,y:s.cellId.y/2}),cellsLong:s.cellsLong/2,cellsTall:s.cellsTall/2,startingItems:[]}))]);let n=ie,o=X;if(r){let s=0;const c=[],t=[];for(const e of l){const a=[],d={width:e.cellsLong*h,height:e.cellsTall*h,sectionName:e.name};d.height>s&&(s=d.height),ge(v=>[...v,d]),e.cellId.x=0,e.cellId.y=0,[...Array(d.height/h).keys()].map(v=>{const T=[];[...Array(d.width/h).keys()].map(y=>{T.push({id:new I({x:y,y:v}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:h})}),a.push(T)}),c.push({sectionName:e.name,cells:[...a]}),t.push(e)}V(c),P(t),Ee(s),K(l[0]?l[0].name:null),setTimeout(()=>{A(!1)},500)}else{const s=[];for(const c of l)console.log("Generating cells for section",c.name,"at",c.cellId,"with size",c.cellsLong,"x",c.cellsTall),console.log("Needed section Width:",(c.cellsLong+c.cellId.x)*h,"Current width:",n),(c.cellsLong+c.cellId.x)*h>n&&(console.log("Added section Width:",c.cellsLong*h+c.cellId.x),n+=(c.cellsLong+c.cellId.x)*h-n),console.log("Needed section Height:",(c.cellsTall+c.cellId.y)*h,"Current height:",o),(c.cellsTall+c.cellId.y)*h>o&&(console.log("Added section Height:",c.cellsTall*h+c.cellId.y),o+=(c.cellsTall+c.cellId.y)*h-o);be(n),Ne(o),[...Array(o/h).keys()].map(c=>{const t=[];[...Array(n/h).keys()].map(e=>{t.push({id:new I({x:e,y:c}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:B(new I({x:e,y:c}),l)!=null,size:h})}),s.push(t)}),R([...s]),setTimeout(()=>{const c=[],t=[...l];for(const e of t)e.cellElement=document.querySelector(`.App #${e.cellId.toId()}.cell:not(.cell-border)`),c.push(...e.startingItems.map(a=>new E({cell:new I({x:e.cellId.x+a.cell.x,y:e.cellId.y+a.cell.y}),item:new p({id:a.item.id,name:a.item.name,cellsLong:a.item.cellsLong,cellsTall:a.item.cellsTall,icon:a.item.icon,initialElement:document.querySelector(`.App #${a.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:a.item.moveable,rotation:a.item.rotation||0})})));P([...t]);for(const e of c){const a=T=>{const y=T%2===1;return{cellsLong:y?e.item.cellsTall:e.item.cellsLong,cellsTall:y?e.item.cellsLong:e.item.cellsTall}},d=e.item.rotation||0,v=a(d);for(let T=0;T<v.cellsTall;T++)for(let y=0;y<v.cellsLong;y++)s[e.cell.y+T][e.cell.x+y].hasItem=!0,s[e.cell.y+T][e.cell.x+y].itemId=e.item.id;e.item.initialElement=document.querySelector(`.App #${e.cell.toId()}.cell:not(.cell-border)`),k(T=>[...T,e.item])}R([...s]),setTimeout(()=>{A(!1)},500)},100)}}async function Ve(){const l=new URLSearchParams(window.location.search),n=l.get("companyId"),o=l.get("areaId"),s=l.get("areaId")||"",c=l.get("companyId")||"",t=l.get("templateId")||"",e=await sl(c,s),a=l.get("type")||"";let d=!1;if(a==="create-template")ue(!0);else if(a==="edit-template"){Pe(!0);const i=e.templates.find(m=>m.id===t);i&&(We(i),Ie(i.name))}else if(a==="view-design"){d=!0,ke(!0);const i=l.get("designName")||"";te(i);const m=l.get("designId")||"";oe(m)}else if(a==="view-area")Ue(!0);else if(a==="edit-design"){d=!0,$e(!0);const i=l.get("designName")||"";te(i);const m=l.get("designId")||"";oe(m)}else if(a==="client-edit-design"){d=!0,qe(!0);const i=l.get("designName")||"";te(i);const m=l.get("designId")||"";oe(m)}n&&Fe(n),o&&Je(o),W(e.inventoryItems.map(i=>new ce({item:new p({id:i.item.id,name:i.item.name,cellsLong:i.item.cellsLong,cellsTall:i.item.cellsTall,icon:i.item.icon,initialElement:i.item.initialElement,moveable:i.item.moveable,starterItem:i.item.starterItem,displayItem:!0}),quantity:i.quantity})));const v=[],T=[];for(const i of e.templates){const m=[],w=[];for(const b of i.sections)m.push(new S({name:b.name,cellId:new I({x:b.cellId.x/(r?20:10),y:b.cellId.y/(r?20:10)}),cellsLong:b.cellsLong/(r?20:10),cellsTall:b.cellsTall/(r?20:10),startingItems:b.startingItems.map(L=>new E({cell:new I({x:L.cell.x/(r?2:1),y:L.cell.y/(r?2:1)}),item:new p({id:L.item.id,name:L.item.name,cellsLong:L.item.cellsLong/2,cellsTall:L.item.cellsTall/2,icon:L.item.icon,starterItem:!0,moveable:L.item.moveable,rotation:L.item.rotation||0})}))})),w.push(new S({name:b.name,cellId:new I({x:b.cellId.x,y:b.cellId.y}),cellsLong:b.cellsLong,cellsTall:b.cellsTall,startingItems:b.startingItems.map(L=>new E({cell:new I({x:L.cell.x,y:L.cell.y}),item:new p({id:L.item.id,name:L.item.name,cellsLong:L.item.cellsLong,cellsTall:L.item.cellsTall,icon:L.item.icon,starterItem:!0,moveable:L.item.moveable,rotation:L.item.rotation||0})}))}));v.push(new F({name:i.name,sections:m,id:i.id,previewImage:i.previewImage})),T.push(new F({name:i.name,sections:w,id:i.id,previewImage:i.previewImage}))}re([...v]);const y=[],j=t===""?void 0:T.find(i=>i.id===t);if(console.log("TEMPLATE",j,"AREA",e),d){const i=await al(c,s,l.get("designId")||"");if(i===null){window.location.href="/LayItOut/DNF/";return}H([...i.sections]),P([...i.sections.map(m=>new S({name:m.name,cellId:new I({x:m.cellId.x/10,y:m.cellId.y/10}),cellsLong:m.cellsLong/10,cellsTall:m.cellsTall/10,startingItems:m.startingItems,items:m.startingItems.map(w=>new p({id:w.item.id,name:w.item.name,sectionCell:w.cell,cellsLong:w.item.cellsLong,cellsTall:w.item.cellsTall,icon:w.item.icon,moveable:w.item.moveable,starterItem:w.item.starterItem,rotation:w.item.rotation}))}))]),y.push(...i.sections.map(m=>new S({name:m.name,cellId:new I({x:m.cellId.x/10,y:m.cellId.y/10}),cellsLong:m.cellsLong/10,cellsTall:m.cellsTall/10,startingItems:m.startingItems,items:m.startingItems.map(w=>new p({id:w.item.id,name:w.item.name,sectionCell:w.cell,cellsLong:w.item.cellsLong,cellsTall:w.item.cellsTall,icon:w.item.icon,moveable:w.item.moveable,starterItem:w.item.starterItem,rotation:w.item.rotation}))})))}else j!==void 0?(H([...j.sections]),P([...j.sections.map(i=>new S({name:i.name,cellId:new I({x:i.cellId.x/10,y:i.cellId.y/10}),cellsLong:i.cellsLong/10,cellsTall:i.cellsTall/10,startingItems:i.startingItems,items:i.startingItems.map(m=>new p({id:m.item.id,name:m.item.name,sectionCell:m.cell,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,rotation:m.item.rotation}))}))]),y.push(...j.sections.map(i=>new S({name:i.name,cellId:new I({x:i.cellId.x/10,y:i.cellId.y/10}),cellsLong:i.cellsLong/10,cellsTall:i.cellsTall/10,startingItems:i.startingItems,items:i.startingItems.map(m=>new p({id:m.item.id,name:m.item.name,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,rotation:m.item.rotation,sectionCell:m.cell}))})))):(H([...e.sections]),P([...e.sections.map(i=>new S({name:i.name,cellId:new I({x:i.cellId.x/10,y:i.cellId.y/10}),cellsLong:i.cellsLong/10,cellsTall:i.cellsTall/10,startingItems:i.startingItems,items:i.startingItems.map(m=>new p({id:m.item.id,name:m.item.name,sectionCell:m.cell,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,rotation:m.item.rotation}))}))]),y.push(...e.sections.map(i=>new S({name:i.name,cellId:new I({x:i.cellId.x/10,y:i.cellId.y/10}),cellsLong:i.cellsLong/10,cellsTall:i.cellsTall/10,startingItems:i.startingItems,items:i.startingItems.map(m=>new p({id:m.item.id,name:m.item.name,sectionCell:m.cell,cellsLong:m.item.cellsLong,cellsTall:m.item.cellsTall,icon:m.item.icon,moveable:m.item.moveable,starterItem:m.item.starterItem,rotation:m.item.rotation}))}))));console.log("SECTIONS TO GENERATE",y),He(y)}u.useEffect(()=>{Ve()},[]);function Ye(l,n,o){if(!r||l==null)return;const s=[...o],c=[],t=o.find(e=>e.name==l);console.log("NEW SECTION",t),console.log("Adding section",t.name,t.cellId),console.log("MOBILE CELLS",n),t.cellElement=document.querySelector(`.App #${t.name.split(" ").join("-")} #${t.name.split(" ").join("")}${t.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",t.cellElement);for(const e of t.startingItems){console.log("Placing starting item",e.item.name,e.cell);const a=T=>{const y=T%2===1;return{cellsLong:y?e.item.cellsTall:e.item.cellsLong,cellsTall:y?e.item.cellsLong:e.item.cellsTall}},d=e.item.rotation||0,v=a(d);for(let T=0;T<v.cellsTall;T++)for(let y=0;y<v.cellsLong;y++){const j=n.find(i=>i.sectionName===t.name);j.cells[e.cell.y+T][e.cell.x+y].hasItem=!0,j.cells[e.cell.y+T][e.cell.x+y].itemId=e.item.id}e.item.initialElement=document.querySelector(`.App #${t.name.split(" ").join("-")} #${t.name.split(" ").join("")}${e.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",e.item.initialElement),c.push(new p({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong,cellsTall:e.item.cellsTall,icon:e.item.icon,initialElement:e.item.initialElement,starterItem:!0,moveable:e.item.moveable,rotation:e.item.rotation}))}console.log("Setting sections",s),P([...s]),console.log("ITEMS",c),k(e=>[...e.filter(d=>!c.some(v=>v.id===d.id)),...c.map(d=>new p({id:d.id,name:d.name,cellsLong:d.cellsLong,cellsTall:d.cellsTall,icon:d.icon,initialElement:d.initialElement,starterItem:!0,moveable:d.moveable,rotation:d.rotation}))])}function pe(l){let n=[];return l.map(o=>n=[...n,...o]),n}function xe(l,n){console.log(l);const o=r?O.find(e=>e.sectionName===x).cells:D,s=o[l.y].length,c=o.length;if(console.log(s,c),l.x+n.cellsLong>s||l.y+n.cellsTall>c)return!1;const t=B(l,f);if(!t&&!r)return console.log("Item is out of bounds of any section"),!1;for(let e=0;e<n.cellsTall;e++)for(let a=0;a<n.cellsLong;a++){if(!r){const d=B(new I({x:l.x+a,y:l.y+e}),f);if(!d)return console.log("Item is out of bounds of any section"),!1;if(d.name!=t.name)return console.log("Item is crossing section boundaries"),!1}if(o[l.y+e][l.x+a].hasItem&&o[l.y+e][l.x+a].itemId!=n.id)return console.log("Something is already here"),!1}return!0}function ze(l,n,o){const s=Array.from(r?O.find(e=>e.sectionName===x).cells:D);if(o!=null){console.log("Removing item");const e=r?f.find(a=>a.name===x):B(o,f);e.items=e.items.filter(a=>a.id!=n.id);for(let a=0;a<n.cellsTall;a++)for(let d=0;d<n.cellsLong;d++)s[o.y+a][o.x+d].hasItem=!1,s[o.y+a][o.x+d].itemId=""}const c=r?f.find(e=>e.name===x):B(l,f),t=new I({x:l.x-c.cellId.x,y:l.y-c.cellId.y});n.sectionCell=t,c.items.push(n);for(let e=0;e<n.cellsTall;e++)for(let a=0;a<n.cellsLong;a++)s[l.y+e][l.x+a].hasItem=!0,s[l.y+e][l.x+a].itemId=n.id;if(console.log(s),r){const e=O.find(a=>a.sectionName===x);e&&(e.cells=s.map(a=>a.map(d=>({...d}))),V([...O]))}else R(s);if(console.log("Removing item from inventory",n.name),!n.hasMoved){const e=_.findIndex(a=>a.item.name==n.name&&!a.item.hasMoved);if(e!==-1){const a=[..._];a[e].quantity-=1,a[e].quantity<=0&&a.splice(e,1),W(a)}else W(_)}k(e=>(console.log("Placing item",n.id),console.log("Updating item",n.id),e.find(a=>a.id==n.id).hasMoved||(e.find(a=>a.id==n.id).hasMoved=!0),e))}function Be(l){J.find(n=>n.name==l.name&&!n.hasMoved&&!n.starterItem)||k(n=>[...n,l])}function Te(l){console.log("Removing item",l.id),k(n=>n.filter(o=>o.id!=l.id))}function _e(l,n){const o=Array.from(D),s=e=>{const a=e%2===1;return{cellsWide:a?l.cellsTall:l.cellsLong,cellsTall:a?l.cellsLong:l.cellsTall}},c=l.rotation||0,t=s(c);for(let e=0;e<t.cellsTall;e++)for(let a=0;a<t.cellsWide;a++)o[n.y+e][n.x+a].hasItem=!1,o[n.y+e][n.x+a].itemId="";R(o),console.log("DELETING ITEM",l.id),k(e=>(console.log(),e.filter(a=>a.id!=l.id))),W(e=>{const a=e.findIndex(d=>d.item.name==l.name&&!d.item.hasMoved);if(a!==-1){const d=[...e];return d[a].quantity+=1,d}else return[...e,new ce({item:new p({id:l.id,name:l.name,cellsLong:t.cellsWide,cellsTall:t.cellsTall,icon:l.icon}),quantity:1})]})}function Ge(l,n){const o=Array.from(r?O.find(e=>e.sectionName===x).cells:D);console.log("DELETING ITEM ROTATE",l.id,l.rotation);const s=e=>{const a=e%2===1;return{cellsWide:a?l.cellsTall:l.cellsLong,cellsTall:a?l.cellsLong:l.cellsTall}},c=l.rotation||0,t=s(c);for(let e=0;e<t.cellsTall;e++)for(let a=0;a<t.cellsWide;a++)console.log("Deleting cell",n.y+e,n.x+a),o[n.y+e][n.x+a].hasItem=!1,o[n.y+e][n.x+a].itemId="";R([...o]),console.log("DELETING ITEM",l.id)}function Ke(l,n){const o=r?O.find(t=>t.sectionName===x).cells:D,s=Array.from(o);if(o[l.y]==null){Le();return}const c=xe(l,n);s.forEach(t=>t.forEach(e=>{e.mouseOver=!1,e.canPlaceItem=!1,e.mouseOverLocation=""}));for(let t=0;t<n.cellsTall;t++)for(let e=0;e<n.cellsLong;e++)l.y+t<s.length&&l.x+e<s[l.y+t].length&&(n.cellsLong===1&&n.cellsTall===1?s[l.y+t][l.x+e].mouseOverLocation="single":n.cellsTall===1?e===0?s[l.y+t][l.x+e].mouseOverLocation="leftFull":e===n.cellsLong-1?s[l.y+t][l.x+e].mouseOverLocation="rightFull":s[l.y+t][l.x+e].mouseOverLocation="middleFull":n.cellsLong===1?t===0?s[l.y+t][l.x+e].mouseOverLocation="topFull":t===n.cellsTall-1?s[l.y+t][l.x+e].mouseOverLocation="bottomFull":s[l.y+t][l.x+e].mouseOverLocation="middleVFull":t===0&&e===0?s[l.y+t][l.x+e].mouseOverLocation="topLeftCorner":t===0&&e===n.cellsLong-1?s[l.y+t][l.x+e].mouseOverLocation="topRightCorner":t===n.cellsTall-1&&e===0?s[l.y+t][l.x+e].mouseOverLocation="bottomLeftCorner":t===n.cellsTall-1&&e===n.cellsLong-1?s[l.y+t][l.x+e].mouseOverLocation="bottomRightCorner":t===0?s[l.y+t][l.x+e].mouseOverLocation="top":t===n.cellsTall-1?s[l.y+t][l.x+e].mouseOverLocation="bottom":e===0?s[l.y+t][l.x+e].mouseOverLocation="left":e===n.cellsLong-1?s[l.y+t][l.x+e].mouseOverLocation="right":s[l.y+t][l.x+e].mouseOverLocation="middle",s[l.y+t][l.x+e].mouseOver=!0,s[l.y+t][l.x+e].canPlaceItem=c);if(r){const t=O.find(e=>e.sectionName===x);t&&(t.cells=s.map(e=>e.map(a=>({...a}))),V([...O])),V(e=>e.map(a=>a.sectionName===x?{...a,cells:s}:a))}else R(s)}function Le(){const l=Array.from(r?O.find(n=>n.sectionName===x).cells:D);l.forEach(n=>n.forEach(o=>{o.mouseOver=!1,o.canPlaceItem=!1,o.mouseOverLocation=""})),R(l)}u.useEffect(()=>{Ye(x,O,f)},[x]),u.useEffect(()=>{const l=()=>{const n=J.find(o=>o.id===M);console.log("Unselecting item",M),Z(null),n&&(U(o=>[...o,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{U(o=>o.filter(s=>s!==n.id))},300))};return document.addEventListener("click",l),()=>document.removeEventListener("click",l)},[M,J]);function Qe(l){Z(null),U(n=>[...n,l]),console.log("Unselecting item",l),setTimeout(()=>{U(n=>n.filter(o=>o!==l))},300)}function Xe(l){const n=J.find(o=>o.id===M);console.log("Unselecting item",M),Z(l),n&&(U(o=>[...o,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{U(o=>o.filter(s=>s!==n.id))},300))}function Ze(l){W(n=>[...n,l])}return g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"App",children:[g.jsx("h1",{className:"title",children:"LayItOut"}),g.jsx("br",{}),(Y||$)&&g.jsxs("div",{className:"template-name-row",children:[g.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),g.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:l=>Ie(l.target.value),value:q})]}),C&&g.jsx("div",{className:"design-name-row",children:g.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",ne]})}),(Y||$)&&g.jsxs("div",{className:"template-creation",children:[g.jsxs("button",{className:"action-btn",onClick:()=>{if(q.trim()==""){alert("Please enter a template name");return}if(G.some(l=>l.name===q&&($?l.id!==ye.id:!0))){alert("Template with this name already exists");return}$?(A(!0),setTimeout(async()=>{const l=window.location.origin+"/LayItOut/Preview/"+window.location.search,n=f.map(o=>new S({name:o.name,cellId:new I({x:N.find(s=>s.name==o.name).cellId.x*20,y:N.find(s=>s.name==o.name).cellId.y*20}),cellsLong:o.cellsLong*10,cellsTall:o.cellsTall*10,startingItems:o.items.map(s=>new E({cell:new I({x:s.sectionCell.x,y:s.sectionCell.y}),item:new p({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))}));localStorage.setItem("screenshotSections",n.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),window.addEventListener("storage",async o=>{if(console.log("Storage event",o),o.key==="screenshot"){const s=G.map(c=>c.id===ye.id?(console.log("SECTION",f),new F({name:q,previewImage:o.newValue,sections:f.map(t=>new S({name:t.name,cellId:new I({x:c.sections.find(e=>e.name==t.name).cellId.x*(r?20:10),y:c.sections.find(e=>e.name==t.name).cellId.y*(r?20:10)}),cellsLong:t.cellsLong*10,cellsTall:t.cellsTall*10,startingItems:t.items.map(e=>new E({cell:new I({x:e.sectionCell.x,y:e.sectionCell.y}),item:new p({id:e.id,name:e.name,cellsLong:e.cellsLong,cellsTall:e.cellsTall,icon:e.icon,starterItem:!0,moveable:e.moveable,rotation:e.rotation})}))})),id:c.id})):new F({name:c.name,previewImage:c.previewImage,sections:c.sections.map(t=>new S({name:t.name,cellId:new I({x:t.cellId.x*(r?20:10),y:t.cellId.y*(r?20:10)}),cellsLong:t.cellsLong*(r?20:10),cellsTall:t.cellsTall*(r?20:10),startingItems:t.startingItems.map(e=>new E({cell:new I({x:e.cell.x*(r?2:1),y:e.cell.y*(r?2:1)}),item:new p({id:e.item.id,name:e.item.name,cellsLong:e.item.cellsLong*2,cellsTall:e.item.cellsTall*2,icon:e.item.icon,starterItem:e.item.starterItem,moveable:e.item.moveable,rotation:e.item.rotation})}))})),id:c.id}));Se(Q,z,s).then(()=>{console.log("Template updated successfully"),A(!1);const c=new URLSearchParams(window.location.search),t=c.get("companyId"),e=c.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${t}&areaId=${e}&type=view-area`})}}),window.open(l,"_blank")},500)):(A(!0),setTimeout(async()=>{const l=window.location.origin+"/LayItOut/Preview/"+window.location.search,n=f.map(o=>new S({name:o.name,cellId:new I({x:N.find(s=>s.name==o.name).cellId.x*20,y:N.find(s=>s.name==o.name).cellId.y*20}),cellsLong:o.cellsLong*10,cellsTall:o.cellsTall*10,startingItems:o.items.map(s=>new E({cell:new I({x:s.sectionCell.x,y:s.sectionCell.y}),item:new p({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))}));localStorage.setItem("screenshotSections",n.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),window.addEventListener("storage",async o=>{if(console.log("Storage event",o),o.key==="screenshot"){const s=new F({name:q,previewImage:o.newValue,sections:f.map(t=>new S({name:t.name,cellId:new I({x:N.find(e=>e.name==t.name).cellId.x*20,y:N.find(e=>e.name==t.name).cellId.y*20}),cellsLong:t.cellsLong*10,cellsTall:t.cellsTall*10,startingItems:t.items.map(e=>new E({cell:new I({x:e.sectionCell.x,y:e.sectionCell.y}),item:new p({id:e.id,name:e.name,cellsLong:e.cellsLong,cellsTall:e.cellsTall,icon:e.icon,starterItem:!0,moveable:e.moveable,rotation:e.rotation})}))})),id:q+(Math.random()*1e4).toString()}),c=[...G.map(t=>new F({name:t.name,previewImage:t.previewImage,sections:t.sections.map(e=>new S({name:e.name,cellId:new I({x:e.cellId.x*(r?20:10),y:e.cellId.y*(r?20:10)}),cellsLong:e.cellsLong*(r?20:10),cellsTall:e.cellsTall*(r?20:10),startingItems:e.startingItems.map(a=>new E({cell:new I({x:a.cell.x*(r?2:1),y:a.cell.y*(r?2:1)}),item:new p({id:a.item.id,name:a.item.name,cellsLong:a.item.cellsLong*2,cellsTall:a.item.cellsTall*2,icon:a.item.icon,starterItem:a.item.starterItem,moveable:a.item.moveable,rotation:a.item.rotation})}))})),id:t.id})),s];Se(Q,z,c).then(()=>{console.log("Template updated successfully"),A(!1);const t=new URLSearchParams(window.location.search),e=t.get("companyId"),a=t.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${e}&areaId=${a}&type=view-area`})}}),window.open(l,"_blank")},500))},children:[Y?"Create":"Save"," Template"]}),g.jsx("button",{className:"action-btn",onClick:()=>{ue(!1),re([]),H([]),P([]),V([]),ge([]),K(null)},children:"Cancel"})]}),Ce&&g.jsxs("div",{className:"template-creation",children:[g.jsx("button",{className:"action-btn",onClick:()=>{A(!0),setTimeout(async()=>{const l=window.location.origin+"/LayItOut/Preview/"+window.location.search,n=f.map(o=>new S({name:o.name,cellId:new I({x:N.find(s=>s.name==o.name).cellId.x*20,y:N.find(s=>s.name==o.name).cellId.y*20}),cellsLong:o.cellsLong*10,cellsTall:o.cellsTall*10,startingItems:o.items.map(s=>new E({cell:new I({x:s.sectionCell.x,y:s.sectionCell.y}),item:new p({id:s.id,name:s.name,cellsLong:s.cellsLong,cellsTall:s.cellsTall,icon:s.icon,starterItem:!0,moveable:s.moveable,rotation:s.rotation})}))}));localStorage.setItem("screenshotSections",n.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",n.map(o=>JSON.stringify(o.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),window.addEventListener("storage",async o=>{if(console.log("Storage event",o),o.key==="screenshot"){const s=new tl({name:ne,previewImage:o.newValue,areaId:z,sections:f.map(c=>new S({name:c.name,cellId:new I({x:N.find(t=>t.name==c.name).cellId.x*20,y:N.find(t=>t.name==c.name).cellId.y*20}),cellsLong:c.cellsLong*10,cellsTall:c.cellsTall*10,startingItems:c.items.map(t=>new E({cell:new I({x:t.sectionCell.x,y:t.sectionCell.y}),item:new p({id:t.id,name:t.name,cellsLong:t.cellsLong,cellsTall:t.cellsTall,icon:t.icon,starterItem:!0,moveable:t.moveable,rotation:t.rotation})}))})),id:fe});ol(Q,z,s).then(()=>{console.log("Design updated successfully"),A(!1)})}}),window.open(l,"_blank")},500)},children:"Save"}),g.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),se&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"loader-backdrop"}),g.jsx("div",{className:"loader"})]})," ",g.jsxs("div",{className:"layout",children:[!C&&g.jsx(cl,{isViewingDesign:C,isEditingTemplate:$,isCreatingTemplate:Y,maxHeight:r?200:X,showAddCustomItem:()=>{ae.current?.showModal()},addDraggingItem:Be,removeItem:Te,inventoryItems:_.map(l=>new ce({item:new p({id:l.item.id,name:l.item.name,cellsLong:l.item.cellsLong,cellsTall:l.item.cellsTall,icon:l.item.icon,displayItem:!0}),quantity:l.quantity}))}),r?g.jsxs("div",{className:"mobile-areas",style:{height:Oe+"px"},children:[g.jsx("img",{src:ve,onClick:()=>{const l=f.findIndex(o=>o.name==x);if(l===-1)return;const n=(l-1+f.length)%f.length;K(f[n].name),console.log("Changing viewing section to",f[n].name)},className:"back-mobile-areas"}),Re.map((l,n)=>g.jsx(he,{width:l.width,height:l.height,cells:pe(O.find(o=>o.sectionName==l.sectionName).cells),id:l.sectionName,visibile:x==null?!0:l.sectionName==x,section:l.sectionName},n)),g.jsx("img",{src:ve,onClick:()=>{const l=f.findIndex(o=>o.name==x);if(l===-1)return;const n=(l+1)%f.length;K(f[n].name),console.log("Changing viewing section to",f[n].name)},className:"forward-mobile-areas"})]}):g.jsx(he,{width:ie,height:X,cells:pe(D)})]}),C&&g.jsx("div",{className:"design-view",children:g.jsx("button",{className:"action-btn",onClick:()=>{window.location.href=`/LayItOut/Print/?companyId=${Q}&areaId=${z}&designName=${ne}&designId=${fe}`},children:"Print"})})]}),g.jsxs("div",{id:we?"capture":"",children:[f.map(l=>g.jsx(ll,{takingPhoto:we,section:l,visible:x==null?!0:l.name==x,cellSize:h},l.cellId.toId())),J.map(l=>g.jsx(nl,{cellSize:h,isViewingDesign:C,removeItem:Te,visible:r?!l.hasMoved&&!l.starterItem?!0:x==null?!1:l.starterItem?f.find(n=>n.name==x)?.startingItems.some(n=>n.item.id===l.id):f.find(n=>n.name==x)?.items.some(n=>n.id===l.id):!0,item:l,canPlaceItem:xe,placeItem:ze,deleteItemRotate:Ge,highlightCells:Ke,unHighlightCells:Le,deleteItem:_e,isSelected:M===l.id,onSelect:Xe,isUnselecting:Ae.includes(l.id),onDeselect:()=>Qe(l.id)},l.id))]}),r&&!se&&g.jsx("div",{className:"layout-icon",onClick:()=>{ee.current?.showModal(),me(!0),console.log("Showing layout dialog")},children:g.jsx("img",{src:il,alt:""})}),!se&&!(Y||$||C)&&g.jsx("div",{className:"template-icon",onClick:()=>{le.current?.showModal(),de(!0),console.log("Showing template dialog")},children:g.jsx("img",{src:ml,alt:""})}),g.jsx(rl,{isViewingArea:Me,dialogRef:le,isOpen:De,closeDialog:()=>{le.current?.close(),de(!1)},templates:G}),g.jsx(dl,{dialogRef:ee,isOpen:je,closeDialog:()=>{ee.current?.close(),me(!1)},layoutSections:N}),g.jsx(gl,{dialogRef:ae,addInventoryItem:Ze,closeDialog:()=>{ae.current?.close()}})]})}
