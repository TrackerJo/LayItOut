import{c as de,j as I,r as a}from"./index-QIV6qY6h.js";import{A as G,S as ge,D as ue}from"./section-Cmi4yfhz.js";import{S as N,C as h,I as w,e as fe,b as Ie}from"./firestore-DmwLrE3V.js";import{F as J}from"./add_custom_item_dialog-DgwAOwWV.js";de.createRoot(document.getElementById("root")).render(I.jsx(ye,{}));function ye(){const[f,xe]=a.useState(!1),[P,Y]=a.useState(0),[k,K]=a.useState(0),[L,S]=a.useState([]),[O,E]=a.useState([]),[Q,he]=a.useState(0),[p,A]=a.useState(null),[X,v]=a.useState([]),y=10,[D,j]=a.useState([]);a.useRef(null);const[Le,Se]=a.useState(!1),[Te,U]=a.useState([]),[d,R]=a.useState([]),[pe,ve]=a.useState([]),[we,Ee]=a.useState(!1);a.useRef(null);const[Z,be]=a.useState([]),[x,M]=a.useState([]),[r,W]=a.useState(null),[Oe,Ne]=a.useState(!1),[Ae,De]=a.useState(!1),[_,je]=a.useState(!1),[Re,Me]=a.useState(!1),[Pe,ke]=a.useState(!1),[Ue,We]=a.useState(!1),[qe,Fe]=a.useState(""),[$e,He]=a.useState(""),[Ve,Be]=a.useState(""),[ze,Ge]=a.useState(""),[Je,Ye]=a.useState(""),[Ke,q]=a.useState(!0),[Qe,Xe]=a.useState(null),[F,$]=a.useState(!1);a.useRef(null);function b(e,n){for(const o of n)if(e.x>=o.cellId.x&&e.x<o.cellId.x+o.cellsLong&&e.y>=o.cellId.y&&e.y<o.cellId.y+o.cellsTall)return o;return null}function C(e){U([...e.map(i=>new N({name:i.name,cellId:new h({x:i.cellId.x/2,y:i.cellId.y/2}),cellsLong:i.cellsLong/2,cellsTall:i.cellsTall/2,startingItems:[]}))]);let n=P,o=k;const s=[];for(const i of e)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",(i.cellsLong+i.cellId.x)*y,"Current width:",n),(i.cellsLong+i.cellId.x)*y>n&&(console.log("Added section Width:",i.cellsLong*y+i.cellId.x),n+=(i.cellsLong+i.cellId.x)*y-n),console.log("Needed section Height:",(i.cellsTall+i.cellId.y)*y,"Current height:",o),(i.cellsTall+i.cellId.y)*y>o&&(console.log("Added section Height:",i.cellsTall*y+i.cellId.y),o+=(i.cellsTall+i.cellId.y)*y-o);Y(n),K(o),[...Array(o/y).keys()].map(i=>{const c=[];[...Array(n/y).keys()].map(l=>{c.push({id:new h({x:l,y:i}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:b(new h({x:l,y:i}),e)!=null,size:y})}),s.push(c)}),S([...s]),setTimeout(()=>{const i=[],c=[...e];for(const l of c)l.cellElement=document.querySelector(`.App #${l.cellId.toId()}.cell:not(.cell-border)`),i.push(...l.startingItems.map(t=>new Ie({cell:new h({x:l.cellId.x+t.cell.x,y:l.cellId.y+t.cell.y}),item:new w({id:t.item.id,name:t.item.name,cellsLong:t.item.cellsLong,cellsTall:t.item.cellsTall,icon:t.item.icon,initialElement:document.querySelector(`.App #${t.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:t.item.moveable,rotation:t.item.rotation||0})})));R([...c]);for(const l of i){const t=g=>{const u=g%2===1;return{cellsLong:u?l.item.cellsTall:l.item.cellsLong,cellsTall:u?l.item.cellsLong:l.item.cellsTall}},m=l.item.rotation||0,T=t(m);for(let g=0;g<T.cellsTall;g++)for(let u=0;u<T.cellsLong;u++)s[l.cell.y+g][l.cell.x+u].hasItem=!0,s[l.cell.y+g][l.cell.x+u].itemId=l.item.id;l.item.initialElement=document.querySelector(`.App #${l.cell.toId()}.cell:not(.cell-border)`),E(g=>[...g,l.item])}S([...s]),setTimeout(()=>{q(!1),ee()},500)},100)}async function ee(e,n){q(!0),$(!0),setTimeout(async()=>{const o=document.getElementById("capture"),s=await domtoimage.toPng(o);$(!1),localStorage.setItem("screenshot",s),window.close()},500)}async function le(){new URLSearchParams(window.location.search);const e=[];let n=localStorage.getItem("screenshotSections");console.log("Screenshot sections from localStorage",n),n=n?.split("LAYOUTSEPARATOR")||"";const o=[];for(const s of n)console.log("Section string",s),o.push(N.fromJSON(s));U([...o]),R([...o.map(s=>new N({name:s.name,cellId:new h({x:s.cellId.x/10,y:s.cellId.y/10}),cellsLong:s.cellsLong/10,cellsTall:s.cellsTall/10,startingItems:s.startingItems,items:s.startingItems.map(i=>new w({id:i.item.id,name:i.item.name,sectionCell:i.cell,cellsLong:i.item.cellsLong,cellsTall:i.item.cellsTall,icon:i.item.icon,moveable:i.item.moveable,starterItem:i.item.starterItem,rotation:i.item.rotation}))}))]),e.push(...o.map(s=>new N({name:s.name,cellId:new h({x:s.cellId.x/10,y:s.cellId.y/10}),cellsLong:s.cellsLong/10,cellsTall:s.cellsTall/10,startingItems:s.startingItems,items:s.startingItems.map(i=>new w({id:i.item.id,name:i.item.name,sectionCell:i.cell,cellsLong:i.item.cellsLong,cellsTall:i.item.cellsTall,icon:i.item.icon,moveable:i.item.moveable,starterItem:i.item.starterItem,rotation:i.item.rotation}))}))),console.log("SECTIONS TO GENERATE",e),C(e)}a.useEffect(()=>{le()},[]);function ne(e,n,o){if(!f||e==null)return;const s=[...o],i=[],c=o.find(l=>l.name==e);console.log("NEW SECTION",c),console.log("Adding section",c.name,c.cellId),console.log("MOBILE CELLS",n),c.cellElement=document.querySelector(`.App #${c.name.split(" ").join("-")} #${c.name.split(" ").join("")}${c.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",c.cellElement);for(const l of c.startingItems){console.log("Placing starting item",l.item.name,l.cell);const t=g=>{const u=g%2===1;return{cellsLong:u?l.item.cellsTall:l.item.cellsLong,cellsTall:u?l.item.cellsLong:l.item.cellsTall}},m=l.item.rotation||0,T=t(m);for(let g=0;g<T.cellsTall;g++)for(let u=0;u<T.cellsLong;u++){const z=n.find(re=>re.sectionName===c.name);z.cells[l.cell.y+g][l.cell.x+u].hasItem=!0,z.cells[l.cell.y+g][l.cell.x+u].itemId=l.item.id}l.item.initialElement=document.querySelector(`.App #${c.name.split(" ").join("-")} #${c.name.split(" ").join("")}${l.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",l.item.initialElement),i.push(new w({id:l.item.id,name:l.item.name,cellsLong:l.item.cellsLong,cellsTall:l.item.cellsTall,icon:l.item.icon,initialElement:l.item.initialElement,starterItem:!0,moveable:l.item.moveable,rotation:l.item.rotation}))}console.log("Setting sections",s),R([...s]),console.log("ITEMS",i),E(l=>[...l.filter(m=>!i.some(T=>T.id===m.id)),...i.map(m=>new w({id:m.id,name:m.name,cellsLong:m.cellsLong,cellsTall:m.cellsTall,icon:m.icon,initialElement:m.initialElement,starterItem:!0,moveable:m.moveable,rotation:m.rotation}))])}function H(e){let n=[];return e.map(o=>n=[...n,...o]),n}function V(e,n){console.log(e);const o=f?x.find(l=>l.sectionName===r).cells:L,s=o[e.y].length,i=o.length;if(console.log(s,i),e.x+n.cellsLong>s||e.y+n.cellsTall>i)return!1;const c=b(e,d);if(!c&&!f)return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<n.cellsTall;l++)for(let t=0;t<n.cellsLong;t++){if(!f){const m=b(new h({x:e.x+t,y:e.y+l}),d);if(!m)return console.log("Item is out of bounds of any section"),!1;if(m.name!=c.name)return console.log("Item is crossing section boundaries"),!1}if(o[e.y+l][e.x+t].hasItem&&o[e.y+l][e.x+t].itemId!=n.id)return console.log("Something is already here"),!1}return!0}function te(e,n,o){const s=Array.from(f?x.find(l=>l.sectionName===r).cells:L);if(o!=null){console.log("Removing item");const l=f?d.find(t=>t.name===r):b(o,d);l.items=l.items.filter(t=>t.id!=n.id);for(let t=0;t<n.cellsTall;t++)for(let m=0;m<n.cellsLong;m++)s[o.y+t][o.x+m].hasItem=!1,s[o.y+t][o.x+m].itemId=""}const i=f?d.find(l=>l.name===r):b(e,d),c=new h({x:e.x-i.cellId.x,y:e.y-i.cellId.y});n.sectionCell=c,i.items.push(n);for(let l=0;l<n.cellsTall;l++)for(let t=0;t<n.cellsLong;t++)s[e.y+l][e.x+t].hasItem=!0,s[e.y+l][e.x+t].itemId=n.id;if(console.log(s),f){const l=x.find(t=>t.sectionName===r);l&&(l.cells=s.map(t=>t.map(m=>({...m}))),M([...x]))}else S(s);if(console.log("Removing item from inventory",n.name),!n.hasMoved){const l=D.findIndex(t=>t.item.name==n.name&&!t.item.hasMoved);if(l!==-1){const t=[...D];t[l].quantity-=1,t[l].quantity<=0&&t.splice(l,1),j(t)}else j(D)}E(l=>(console.log("Placing item",n.id),console.log("Updating item",n.id),l.find(t=>t.id==n.id).hasMoved||(l.find(t=>t.id==n.id).hasMoved=!0),l))}function oe(e){console.log("Removing item",e.id),E(n=>n.filter(o=>o.id!=e.id))}function se(e,n){const o=Array.from(L),s=l=>{const t=l%2===1;return{cellsWide:t?e.cellsTall:e.cellsLong,cellsTall:t?e.cellsLong:e.cellsTall}},i=e.rotation||0,c=s(i);for(let l=0;l<c.cellsTall;l++)for(let t=0;t<c.cellsWide;t++)o[n.y+l][n.x+t].hasItem=!1,o[n.y+l][n.x+t].itemId="";S(o),console.log("DELETING ITEM",e.id),E(l=>(console.log(),l.filter(t=>t.id!=e.id))),j(l=>{const t=l.findIndex(m=>m.item.name==e.name&&!m.item.hasMoved);if(t!==-1){const m=[...l];return m[t].quantity+=1,m}else return[...l,new fe({item:new w({id:e.id,name:e.name,cellsLong:c.cellsWide,cellsTall:c.cellsTall,icon:e.icon}),quantity:1})]})}function ie(e,n){const o=Array.from(f?x.find(l=>l.sectionName===r).cells:L);console.log("DELETING ITEM ROTATE",e.id,e.rotation);const s=l=>{const t=l%2===1;return{cellsWide:t?e.cellsTall:e.cellsLong,cellsTall:t?e.cellsLong:e.cellsTall}},i=e.rotation||0,c=s(i);for(let l=0;l<c.cellsTall;l++)for(let t=0;t<c.cellsWide;t++)console.log("Deleting cell",n.y+l,n.x+t),o[n.y+l][n.x+t].hasItem=!1,o[n.y+l][n.x+t].itemId="";S([...o]),console.log("DELETING ITEM",e.id)}function ce(e,n){const o=f?x.find(c=>c.sectionName===r).cells:L,s=Array.from(o);if(o[e.y]==null){B();return}const i=V(e,n);s.forEach(c=>c.forEach(l=>{l.mouseOver=!1,l.canPlaceItem=!1,l.mouseOverLocation=""}));for(let c=0;c<n.cellsTall;c++)for(let l=0;l<n.cellsLong;l++)e.y+c<s.length&&e.x+l<s[e.y+c].length&&(n.cellsLong===1&&n.cellsTall===1?s[e.y+c][e.x+l].mouseOverLocation="single":n.cellsTall===1?l===0?s[e.y+c][e.x+l].mouseOverLocation="leftFull":l===n.cellsLong-1?s[e.y+c][e.x+l].mouseOverLocation="rightFull":s[e.y+c][e.x+l].mouseOverLocation="middleFull":n.cellsLong===1?c===0?s[e.y+c][e.x+l].mouseOverLocation="topFull":c===n.cellsTall-1?s[e.y+c][e.x+l].mouseOverLocation="bottomFull":s[e.y+c][e.x+l].mouseOverLocation="middleVFull":c===0&&l===0?s[e.y+c][e.x+l].mouseOverLocation="topLeftCorner":c===0&&l===n.cellsLong-1?s[e.y+c][e.x+l].mouseOverLocation="topRightCorner":c===n.cellsTall-1&&l===0?s[e.y+c][e.x+l].mouseOverLocation="bottomLeftCorner":c===n.cellsTall-1&&l===n.cellsLong-1?s[e.y+c][e.x+l].mouseOverLocation="bottomRightCorner":c===0?s[e.y+c][e.x+l].mouseOverLocation="top":c===n.cellsTall-1?s[e.y+c][e.x+l].mouseOverLocation="bottom":l===0?s[e.y+c][e.x+l].mouseOverLocation="left":l===n.cellsLong-1?s[e.y+c][e.x+l].mouseOverLocation="right":s[e.y+c][e.x+l].mouseOverLocation="middle",s[e.y+c][e.x+l].mouseOver=!0,s[e.y+c][e.x+l].canPlaceItem=i);if(f){const c=x.find(l=>l.sectionName===r);c&&(c.cells=s.map(l=>l.map(t=>({...t}))),M([...x])),M(l=>l.map(t=>t.sectionName===r?{...t,cells:s}:t))}else S(s)}function B(){const e=Array.from(f?x.find(n=>n.sectionName===r).cells:L);e.forEach(n=>n.forEach(o=>{o.mouseOver=!1,o.canPlaceItem=!1,o.mouseOverLocation=""})),S(e)}a.useEffect(()=>{ne(r,x,d)},[r]),a.useEffect(()=>{const e=()=>{const n=O.find(o=>o.id===p);console.log("Unselecting item",p),A(null),n&&(v(o=>[...o,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{v(o=>o.filter(s=>s!==n.id))},300))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[p,O]);function ae(e){A(null),v(n=>[...n,e]),console.log("Unselecting item",e),setTimeout(()=>{v(n=>n.filter(o=>o!==e))},300)}function me(e){const n=O.find(o=>o.id===p);console.log("Unselecting item",p),A(e),n&&(v(o=>[...o,n.id]),console.log("Unselecting item",n.id),setTimeout(()=>{v(o=>o.filter(s=>s!==n.id))},300))}return I.jsxs(I.Fragment,{children:[I.jsx("div",{className:"App",children:I.jsx("div",{className:"layout",children:f?I.jsxs("div",{className:"mobile-areas",style:{height:Q+"px"},children:[I.jsx("img",{src:J,onClick:()=>{const e=d.findIndex(o=>o.name==r);if(e===-1)return;const n=(e-1+d.length)%d.length;W(d[n].name),console.log("Changing viewing section to",d[n].name)},className:"back-mobile-areas"}),Z.map((e,n)=>I.jsx(G,{width:e.width,height:e.height,cells:H(x.find(o=>o.sectionName==e.sectionName).cells),id:e.sectionName,visibile:r==null?!0:e.sectionName==r,section:e.sectionName},n)),I.jsx("img",{src:J,onClick:()=>{const e=d.findIndex(o=>o.name==r);if(e===-1)return;const n=(e+1)%d.length;W(d[n].name),console.log("Changing viewing section to",d[n].name)},className:"forward-mobile-areas"})]}):I.jsx(G,{width:P,height:k,cells:H(L)})})}),I.jsx("p",{children:"Empty"}),I.jsxs("div",{id:F?"capture":"",children:[d.map(e=>I.jsx(ge,{takingPhoto:F,section:e,visible:r==null?!0:e.name==r,cellSize:y},e.cellId.toId())),O.map(e=>I.jsx(ue,{cellSize:y,isViewingDesign:_,removeItem:oe,visible:f?!e.hasMoved&&!e.starterItem?!0:r==null?!1:e.starterItem?d.find(n=>n.name==r)?.startingItems.some(n=>n.item.id===e.id):d.find(n=>n.name==r)?.items.some(n=>n.id===e.id):!0,item:e,canPlaceItem:V,placeItem:te,deleteItemRotate:ie,highlightCells:ce,unHighlightCells:B,deleteItem:se,isSelected:p===e.id,onSelect:me,isUnselecting:X.includes(e.id),onDeselect:()=>ae(e.id)},e.id))]})]})}
