import{r as m,j as n,c as wn}from"./index-QIV6qY6h.js";import{A as Rt,S as xn,D as vn}from"./section-ADRdvFWR.js";import{I as x,s as Ue,j as ce,p as Sn,C as h,V as Dt,S as P,k as H,T as we,D as Et,u as kt,B as Ve,l as We,m as He,d as Ln,b as bn,n as Tn,o as pt,q as jn,r as An,t as Nn,A as Cn,v as Mn}from"./firestore-BzzbFXtm.js";import{F as Ke,B as Rn}from"./booth_item-CdXLEtyq.js";import"./auth-Bq188y2_.js";import{L as En,T as kn}from"./link-DQZq8SUn.js";function Dn({inventoryItem:r,addDraggingItem:O,removeItem:F,setSelectedItem:j,tapAndPlaceMode:b}){const E=m.useRef(null),C=m.useRef(null),[A,Y]=m.useState(12),[N,M]=m.useState(r.item);function R(I){const Z=C.current,y=window.getComputedStyle(Z),v=document.createElement("span");v.style.font=y.font,v.style.fontSize=I+"px",v.style.fontFamily=y.fontFamily,v.style.fontWeight=y.fontWeight,v.style.position="absolute",v.style.visibility="hidden",v.style.whiteSpace="nowrap",v.textContent=Z.textContent,document.body.appendChild(v);const J=v.offsetWidth;return document.body.removeChild(v),J}function W(I){if(C.current){const Z=C.current;return R(I-1)>Z.offsetWidth&&I-1>8?W(I-1):I-1}return I}return m.useEffect(()=>{setTimeout(()=>{C.current&&Y(W(A))},100)},[]),n.jsxs("div",{className:"display",children:[n.jsx("div",{ref:E,id:r.item.id,className:r.item.isSectionItem?"display-section":`display-item ${r.item.isSectionModifier?r.item.sectionModifierType.toString():""}`,style:{width:`${r.item.cellsLong*10}px`,height:`${r.item.cellsTall*10}px`},onMouseDown:I=>{b||(I.preventDefault(),I.stopPropagation(),r.item.initialElement=E.current,r.item.id=r.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",r.item.id,"to initialElement",r.item.initialElement),M(new x({...r.item})),O(r.item))},onClick:I=>{b&&(I.preventDefault(),I.stopPropagation(),r.item.initialElement=E.current,r.item.id=r.item.name+(Math.random()*1e4).toString(),j(r.item))},onTouchStart:I=>{b||(I.preventDefault(),I.stopPropagation(),r.item.initialElement=E.current,r.item.id=r.item.name+(Math.random()*1e4).toString(),console.log("ADDING ITEM",r.item.id,"to initialElement",r.item.initialElement),M(new x({...r.item})),O(r.item))},children:r.item.isSectionModifier?null:r.item.icon.includes("custom-")?n.jsx("div",{className:r.item.isSectionItem?"custom-section":"custom-icon",children:n.jsx("div",{children:n.jsx("p",{ref:C,style:{fontSize:`${A}px`},children:r.item.icon.split("custom-")[1]})})}):n.jsx("img",{src:r.item.icon,alt:"icon"})}),n.jsx("p",{children:r.item.name}),r.quantity>0&&n.jsxs("p",{className:"quantity",children:["x",r.quantity]})]})}const Wt="/LayItOut/assets/plus.circle-Ce3xm00a.png";function Wn({inventoryItems:r,addDraggingItem:O,maxHeight:F,removeItem:j,showAddCustomItem:b,isCreatingTemplate:E,isEditingTemplate:C,isViewingDesign:A,tapAndPlaceMode:Y,setSelectedItem:N,isModifyingSections:M}){return n.jsxs("div",{className:"toolbox",style:{maxHeight:F?`${F}px`:"200px"},children:[r.map(R=>n.jsx(Dn,{setSelectedItem:N,tapAndPlaceMode:Y,inventoryItem:R,addDraggingItem:O,removeItem:j})),!(E||C||A||M)&&n.jsx("div",{className:"add-item",onClick:()=>{b()},children:n.jsx("img",{src:Wt,alt:"Add Item"})})]})}function On({dialogRef:r,closeDialog:O,areaPreview:F}){return n.jsx("dialog",{ref:r,className:"layout-dialog",children:n.jsxs("div",{className:"layout-dialog-div",children:[n.jsx("h2",{children:"Layout"}),n.jsx("img",{src:F,alt:"Layout preview",className:"layout-dialog-preview"}),n.jsx("br",{}),n.jsx("button",{className:"layout-dialog-close",onClick:O,children:"Close"})]})})}const Pn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE2mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTAzPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmE2MmM1Y2UxLTIzNTYtNGE3Ny1hNTAwLTViNWJjMjE1MDU3NzwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5VbnRpdGxlZCBkZXNpZ24gLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPlNhcmFoIEtlbW1lTmFzaDwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhIChSZW5kZXJlcikgZG9jPURBR3UyeXVFTlpBIHVzZXI9VUFGakdXNnh0Q1EgYnJhbmQ9W0FSQ0hJVkVEXSBGb3J0IFdheW5lIENvbW11bml0eSBTY2hvb2xzIHRlbXBsYXRlPTwveG1wOkNyZWF0b3JUb29sPgogPC9yZGY6RGVzY3JpcHRpb24+CjwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9J3InPz7fMgZvAAADaElEQVR4nO3dO2gTAQDG8e8ujz6k6FBbUeOjKILV4CAiDgWxLqK4KM4dCuLiIIg6OQgibi5OgjgoDhZB7NIiIr6gCFFThIotaSsVtSJtadI87hykiKSNd/Uu9yX3/cZwyV3yv0fukYth27YNoWEGPQHyNwUhoyBkFISMgpBREDIKQkZByCgImajTAa88XMDTDyU/p8VXjTHg0vEGHNgeCXpSKnK8hNRyDADIFYCXI/zvwfESsujInig6N/i7prv+OO/puO6/LmB82kYtHLRzHSSZMNG9y/XTXFkMsjth4rAH4xpIFzE+XQs5tFGnoyBkFISMgpBREDIKQkZByCgIGQUhoyBkFISMvwelVujU/iiGJy3s3cp9qNwPlEF6D8aDnoTAaJVFRkHIKAgZBSGjIGQUhIyCkFEQMgpCRkHIKAgZymNZfvkxZ+NtpsqXkxrAtnYTqxoMR4OHKsjQaAlDo9W/vndzq4FbvU2Ohg3FKqtzY7CH8TPfnV/GGoolpKcrhp6uWNXHO5Au4tqjvKvnhGIJqSUKQkZByCgIGQUhoyBkFISMgpBREDIKQkZByFAGsSwgm6+N35V7jTLIubs5nLyRxdg3K+hJqTrKIOlJC7kCMDKlIBQW7yRsUk6dv0L4lrkpCBkFIeP6FO67CQslq1j2+I71Jra0qu//ch2kP1VEf6r88XgU6DvbhMa4s8tdZGmezdJrWwxEwvcbTc+5XkIuHIv7fke5MNNKn4yCkFEQMgpCRkHIUH9dujmYx+1nhbLHkwkT5482wKjDXR7qIDNZYCZbfqLqyWwJZ7pttDTVXxHqIMvdanzdGqMuYwDkQby61Xgt0UadTLhmv2XM5Wxc7lvA1E9vL6xYyYUaCgLg4xcLqQzH+XsFAZDcFMHpQzHML3j7up++Wnjh8k9kFARAxARO7PP+N4gD6aLrINqokwlsCUllSrj3qoBihRmoxLFar6rAgjwYKuLNWOVPfHaJvfR6F1iQnq4Ytrcvvca88/z38avVzfW5N15JYEE62kx0tFUOUo8HD/9FG3UyCkJGQcgoCBnPLiX1w/sJC1aVxuWH4c/ud6QM27Ydfdnvvjrv+sXlj8GLzY6Gc7zK2unzHxLXs2TC+WfneAmR6tBsT0ZByCgIGQUhoyBkFISMgpBREDIKQuYX+jTA4JQOFzkAAAAASUVORK5CYII=",Bn="/LayItOut/assets/template-Cjj8EPhc.png";function Gn({dialogRef:r,closeDialog:O,templates:F,isOpen:j,isViewingArea:b,selectTemplate:E,duplicateTemplate:C}){const[A,Y]=m.useState(/Mobi|Android/i.test(navigator.userAgent)),[N,M]=m.useState([]),[R,W]=m.useState(!1),[I,Z]=m.useState([]);return m.useEffect(()=>{Z(F)},[F]),m.useEffect(()=>{if(j&&(console.log("Layout dialog opened, generating cells and sections",I),I.length!==0)){if(I.length==1){M([I[0].name]);return}M(A?[I[0].name]:[I[0].name,I[1].name])}},[j,I]),m.useEffect(()=>{const y=I.filter(v=>N.includes(v.name));console.log("Viewing templates:",N),y.sort((v,J)=>N.indexOf(v.name)-N.indexOf(J.name)),console.log("Generating templates for",y.map(v=>v.name))},[N,I]),n.jsx(n.Fragment,{children:n.jsx("dialog",{ref:r,className:"template-dialog",children:n.jsxs("div",{className:"template-dialog-div",children:[n.jsx("h2",{children:"Templates"}),n.jsxs("div",{className:"templates",children:[I.length>1&&I.filter(y=>!N.includes(y.name)).length>0&&n.jsx("img",{src:Ke,onClick:()=>{if(A){const v=(I.findIndex(J=>J.name===N[0])-1+I.length)%I.length;M([I[v].name])}else M(y=>{const J=(I.findIndex(q=>q.name===y[0])-1+I.length)%I.length;return[I[J].name,y[0]]})},className:"back-mobile-areas"}),N.length===0&&n.jsx("div",{className:"no-templates",children:"No templates available"}),N.map(y=>n.jsxs("div",{className:"template",children:[n.jsx("img",{src:I.find(v=>v.name===y).previewImage,alt:y,className:"template-preview"}),n.jsx("h3",{children:y}),n.jsxs("div",{className:"template-actions",children:[n.jsx("button",{className:"template-select-btn",onClick:()=>{if(b){const v=new URLSearchParams(window.location.search),J=v.get("companyId"),q=v.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${J}&areaId=${q}&type=edit-template&templateId=${I.find(re=>re.name==y).id}`}else O(),E&&E(I.find(v=>v.name===y))},children:b?"Edit":"Select"}),b&&n.jsx("button",{className:"action-btn",onClick:()=>{R||(W(!0),C&&C(I.find(v=>v.name===y)))},children:"Duplicate"}),b&&n.jsx("button",{className:"action-btn",onClick:()=>{if(R)return;W(!0);const v=I.filter(k=>k.name!==y);Z(v),v.length==1?M([v[0].name]):v.length==0?M([]):M(A?[v[0].name]:[v[0].name,v[1].name]);const J=new URLSearchParams(window.location.search),q=J.get("companyId"),re=J.get("areaId");Ue(q,re,v).then(()=>{W(!1)})},children:"Delete"})]})]})),I.length>1&&I.filter(y=>!N.includes(y.name)).length>0&&n.jsx("img",{src:Ke,onClick:()=>{if(A){const v=(I.findIndex(J=>J.name===N[0])+1)%I.length;M([I[v].name])}else M(y=>{const J=(I.findIndex(q=>q.name===y[y.length-1])+1)%I.length;return[y[1],I[J].name]})},className:"forward-mobile-areas"})]}),b&&n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"action-btn",onClick:()=>{const y=new URLSearchParams(window.location.search),v=y.get("companyId"),J=y.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${v}&areaId=${J}&type=create-template`},children:"Create new Template"})," ",n.jsx("br",{})]}),n.jsx("br",{}),n.jsx("button",{className:"action-btn",onClick:O,children:"Close"}),R&&j&&n.jsx(n.Fragment,{children:n.jsx("div",{className:"loader"})})]})})})}function Fn({dialogRef:r,closeDialog:O,addInventoryItem:F,canBeBooth:j}){const[b,E]=m.useState(""),[C,A]=m.useState(1),[Y,N]=m.useState(1),[M,R]=m.useState(1),[W,I]=m.useState(!1);return n.jsx("dialog",{ref:r,className:"custom-item-dialog",children:n.jsxs("div",{className:"custom-item-dialog-div",children:[n.jsx("h2",{children:"Add Custom Item"}),n.jsxs("div",{className:"custom-item-row",children:[n.jsx("label",{htmlFor:"item-name",children:"Name:"}),n.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:Z=>E(Z.target.value??""),value:b})]}),n.jsxs("div",{className:"custom-item-row",children:[n.jsx("label",{htmlFor:"item-icon",children:"Count:"}),n.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:C,onChange:Z=>A(parseInt(Z.target.value)??1)})]}),n.jsxs("div",{className:"custom-item-row custom-item-size",children:[n.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),n.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:Y,onChange:Z=>N(parseFloat(Z.target.value)??1)}),n.jsx("span",{children:" x "}),n.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:M,onChange:Z=>R(parseFloat(Z.target.value)??1)})]}),j?n.jsxs("div",{className:"custom-item-row",children:[n.jsx("label",{htmlFor:"is-booth",children:"Is Booth:"}),n.jsx("input",{type:"checkbox",id:"is-booth",name:"is-booth",checked:W,onChange:Z=>I(Z.target.checked)})]}):null,n.jsx("br",{}),n.jsx("button",{className:"action-btn",onClick:()=>{if(b.trim()===""){alert("Item name cannot be empty");return}const Z=new ce({quantity:C,item:new x({id:b+(Math.random()*1e4).toString(),name:b,icon:`custom-${b}`,cellsLong:Math.ceil(Y),cellsTall:Math.ceil(M),moveable:!0,starterItem:!1,displayItem:!0,isBooth:W})});F(Z),E(""),A(1),N(1),R(1),I(!1),O()},children:"Add Item"}),n.jsx("br",{}),n.jsx("br",{}),n.jsx("button",{className:"action-btn",onClick:()=>{O(),E(""),A(1),N(1),R(1),I(!1)},children:"Close"})]})})}function Zn({dialogRef:r,closeDialog:O,addSection:F}){const[j,b]=m.useState(""),[E,C]=m.useState(1),[A,Y]=m.useState(1);return n.jsx("dialog",{ref:r,className:"section-dialog",children:n.jsxs("div",{className:"section-dialog-div",children:[n.jsx("h2",{children:"Add Section"}),n.jsxs("div",{className:"section-row",children:[n.jsx("label",{htmlFor:"section-name",children:"Name:"}),n.jsx("input",{type:"text",id:"section-name",name:"section-name",onChange:N=>b(N.target.value??""),value:j})]}),n.jsxs("div",{className:"section-row section-size",children:[n.jsx("label",{htmlFor:"section-width",children:"Size (in feet):"}),n.jsx("input",{type:"number",id:"section-width",name:"section-width",min:"1",value:E,onChange:N=>C(parseFloat(N.target.value)??1)}),n.jsx("span",{children:" x "}),n.jsx("input",{type:"number",id:"section-height",name:"section-height",min:"1",value:A,onChange:N=>Y(parseFloat(N.target.value)??1)})]}),n.jsx("br",{}),n.jsx("button",{className:"action-btn",onClick:()=>{if(j.trim()===""){alert("Section name cannot be empty");return}const N=new ce({quantity:1,item:new x({id:j+(Math.random()*1e4).toString(),name:j,icon:`custom-${j}`,cellsLong:Math.ceil(E),cellsTall:Math.ceil(A),moveable:!0,starterItem:!1,displayItem:!0,isSectionItem:!0})});F(N),b(""),C(1),Y(1),O()},children:"Add Section"}),n.jsx("br",{}),n.jsx("br",{}),n.jsx("button",{className:"action-btn",onClick:O,children:"Close"})]})})}function Yn({dialogRef:r,closeDialog:O,addInventoryItem:F}){const[j,b]=m.useState(null),[E,C]=m.useState(""),[A,Y]=m.useState(1),[N,M]=m.useState(1),[R,W]=m.useState(1),[I,Z]=m.useState(!0);return n.jsx("dialog",{ref:r,className:"inventory-item-dialog",children:n.jsxs("div",{className:"inventory-item-dialog-div",children:[n.jsx("h2",{children:"Add Inventory Item"}),j==null?n.jsxs(n.Fragment,{children:["  ",n.jsx("label",{htmlFor:"",children:"Premade Items:"}),n.jsx("div",{className:"inventory-item-list",children:Sn.map(y=>n.jsx("div",{className:"inventory-item",onClick:()=>{const v=new ce({quantity:1,item:new x({id:y.name+(Math.random()*1e4).toString(),name:y.name,icon:y.icon,cellsLong:y.cellsLong,cellsTall:y.cellsTall,moveable:!0,starterItem:!1,displayItem:!0})});b(v)},children:n.jsxs("div",{className:"inventory-item-display",children:[n.jsx("img",{src:y.icon,alt:"icon"}),n.jsx("p",{children:y.name}),n.jsxs("p",{className:"quantity",children:[y.cellsLong,"ft x ",y.cellsTall,"ft"]})]})},y.name))}),n.jsx("label",{htmlFor:"",children:"Or:"}),n.jsx("label",{htmlFor:"",children:"Custom Item:"}),n.jsxs("div",{className:"inventory-item-row",children:[n.jsx("label",{htmlFor:"item-name",children:"Name:"}),n.jsx("input",{type:"text",id:"item-name",name:"item-name",onChange:y=>C(y.target.value??""),value:E})]}),n.jsxs("div",{className:"inventory-item-row",children:[n.jsx("label",{htmlFor:"item-icon",children:"Count:"}),n.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:A,onChange:y=>Y(parseInt(y.target.value)??1)})]}),n.jsxs("div",{className:"inventory-item-row inventory-item-size",children:[n.jsx("label",{htmlFor:"item-width",children:"Size (in feet):"}),n.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:N,onChange:y=>M(parseFloat(y.target.value)??1)}),n.jsx("span",{children:" x "}),n.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:R,onChange:y=>W(parseFloat(y.target.value)??1)})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),n.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:I,onChange:y=>Z(y.target.checked)})]}),n.jsx("br",{})]}):n.jsxs(n.Fragment,{children:[n.jsxs("label",{htmlFor:"",children:["Item: ",j.item.name]}),n.jsxs("div",{className:"inventory-item-row",children:[n.jsx("label",{htmlFor:"item-icon",children:"Count:"}),n.jsx("input",{type:"number",id:"item-count",name:"item-count",min:"1",value:A,onChange:y=>Y(parseInt(y.target.value)??1)})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:"item-moveable",children:"Moveable:"}),n.jsx("input",{type:"checkbox",id:"item-moveable",name:"item-moveable",checked:I,onChange:y=>Z(y.target.checked)})]})]}),n.jsx("br",{}),n.jsx("br",{}),n.jsx("button",{className:"action-btn",onClick:()=>{if(E.trim()===""&&j==null){alert("Item name cannot be empty");return}if(A<=0){alert("Item count must be greater than zero");return}let y=j;y==null?y=new ce({quantity:A,item:new x({id:E+(Math.random()*1e4).toString(),name:E,icon:`inventory-${E}`,cellsLong:Math.ceil(N),cellsTall:Math.ceil(R),moveable:I,starterItem:!1,displayItem:!0})}):(y.quantity=A,y.item.moveable=I),F(y),Z(!0),b(null),C(""),Y(1),M(1),W(1),O()},children:"Add Item"}),n.jsx("button",{className:"action-btn",onClick:O,children:"Close"})]})})}function Jn({item:r,setSelectingItem:O,addHighlightedCell:F,canPlaceItem:j,placeItem:b,highlightCells:E,unHighlightCells:C,cellSize:A,placeMultiItem:Y}){const[N,M]=m.useState(0),[R,W]=m.useState(0),I=m.useRef(null),[Z,y]=m.useState(0),[v,J]=m.useState(0),[q,re]=m.useState(!1),[k,oe]=m.useState(0),[ne,Ne]=m.useState(null),[yt,fe]=m.useState(!0),[je,Xe]=m.useState(12),[Ae,Qe]=m.useState(null),ze=m.useRef(null),[Oe,wt]=m.useState(!0),[Pe,le]=m.useState(!1),[me,L]=m.useState(!1),se=m.useCallback(T=>{const w=T%2===1;return{width:w?r.cellsTall*A:r.cellsLong*A,height:w?r.cellsLong*A:r.cellsTall*A,cellsWide:w?r.cellsTall:r.cellsLong,cellsTall:w?r.cellsLong:r.cellsTall}},[r,A]);function _e(T){const w=I.current,K=window.getComputedStyle(w),B=document.createElement("span");B.style.font=K.font,B.style.fontSize=T+"px",B.style.fontFamily=K.fontFamily,B.style.fontWeight=K.fontWeight,B.style.position="absolute",B.style.visibility="hidden",B.style.whiteSpace="nowrap",B.textContent=w.textContent,document.body.appendChild(B);const ue=B.offsetWidth;return document.body.removeChild(B),ue}function Be(T){if(I.current){const w=I.current;return _e(T-1)>w.offsetWidth&&T-1>8?Be(T-1):T-1}return T}const xe=()=>{le(!0)},Ce=()=>{le(!1)};m.useEffect(()=>(setTimeout(()=>{I.current&&Xe(Be(je))},100),window.addEventListener("mousedown",xe),window.addEventListener("mouseup",Ce),()=>{window.removeEventListener("mousedown",xe),window.removeEventListener("mouseup",Ce)}),[]),m.useEffect(()=>{if(r){re(!0);const T=ze.current?.getBoundingClientRect();Qe({x:T?T.left-N:0,y:T?T.top-R:0})}else console.log("No item to place, stopping dragging"),re(!1),Qe(null),M(0),W(0),y(0),J(0),oe(0),Ne(null),fe(!0),Xe(12),wt(!0)},[r]);const Se=T=>{T.preventDefault()},Le=m.useCallback((T,w,K)=>{if(r==null||!q||!Ae)return;console.log("PLACING MOVE",r);const B=K.target,ue=se(k),U=x.fromDoc(r.toDoc());U.cellsLong=ue.cellsWide,U.cellsTall=ue.cellsTall,U.initialElement=r.initialElement,U.rotation=k,U.hasMoved=r.hasMoved,U.id=r.id;let be=B;if(!be||!be.classList?.contains("cell")){const Ie=document.elementFromPoint(T,w);Ie?.classList?.contains("cell")&&(be=Ie)}be?.classList?.contains("cell")&&!me?E(h.fromString(be.id),U):me||C(),M(T-Ae.x),W(w-Ae.y+5),Pe&&(me||C(),L(!0),F(h.fromString(be.id)))},[r,q,N,R,me,Pe,Ae,j,b,se,k,E,C,ze]),he=m.useCallback(T=>{if(r==null)return;const w=T.clientX,K=T.clientY;console.log("Drag ended"),C(),document.body.removeEventListener("touchmove",Se);const B=document.elementFromPoint(w,K);if(B?.classList?.contains("cell")){const ue=se(k),U={...r,cellsLong:ue.cellsWide,cellsTall:ue.cellsTall};if(me)L(!1),Y(U);else{if(!j(h.fromString(B.id),U))return;b(h.fromString(B.id),U,ne!=null?h.fromString(ne.id):null)}console.log("Placed item at cell:",B)}else{const ue=se(k),U={...r,cellsLong:ue.cellsWide,cellsTall:ue.cellsTall};me?(L(!1),Y(U)):O()}},[r,k,O,me,j,b,ne,C,Z,v]),Ge=m.useCallback(T=>{const w=T.clientX,K=T.clientY;Le(w,K,T)},[Le]),Fe=m.useCallback(T=>{const w=T.touches[0],K=w.clientX,B=w.clientY;Le(K,B,T)},[Le]),G=m.useCallback(T=>{const w=T.changedTouches[0],K=w.clientX,B=w.clientY;he({clientX:K,clientY:B}),document.body.removeEventListener("touchmove",Se)},[he,Se]);return m.useEffect(()=>{if(q)return document.body.addEventListener("touchmove",Se,{passive:!1}),document.addEventListener("mousemove",Ge),document.addEventListener("mouseup",he),document.addEventListener("touchmove",Fe),document.addEventListener("touchend",G),()=>{document.body.removeEventListener("touchmove",Se),document.removeEventListener("mousemove",Ge),document.removeEventListener("mouseup",he),document.removeEventListener("touchmove",Fe),document.removeEventListener("touchend",G)}},[q,Ge,he,Fe,G,Se]),N==0||R==0||!Oe||r==null?n.jsx(n.Fragment,{}):n.jsx(n.Fragment,{children:n.jsx("div",{id:r.id,ref:ze,className:`draggable-item ${r.isSectionModifier&&!r.moveable?"placed-modifier":""} ${r.isSectionModifier?r.sectionModifierType?.toString():""} ${q?"dragging":""} ${r.moveable?"":"not-moveable"}`,style:{top:`${R}px`,left:`${N}px`,width:`${r.cellsLong*(r.isDisplayItem&&!q&&!r.hasMoved?10:A)-(r.sectionModifierType=="LeftWall"||r.sectionModifierType=="RightWall"||r.sectionModifierType?.includes("Corner")?1:0)}px`,height:`${r.cellsTall*(r.isDisplayItem&&!q&&!r.hasMoved?10:A)-(r.sectionModifierType=="TopWall"||r.sectionModifierType=="BottomWall"||r.sectionModifierType?.includes("Corner")?1:0)}px`,rotate:`${k*90}deg`,transformOrigin:"center center",fontSize:`${je}px`,zIndex:q?1e3:1},children:r.isSectionModifier?null:r.icon.includes("custom-")?n.jsx("div",{className:r.isSectionItem?"custom-section":"custom-icon",children:n.jsx("div",{children:n.jsx("p",{ref:I,children:r.icon.split("custom-")[1]})})}):n.jsx("img",{src:r.icon,alt:"icon"})})})}const Vn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAE02lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA4LTE2PC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmRiZTM1YTM5LWE0MDUtNDM2MC04YzRjLWI3NmJmMTY3Mjc1YjwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5hZGQtaXRlbSAtIDc8L3JkZjpsaT4KICAgPC9yZGY6QWx0PgogIDwvZGM6dGl0bGU+CiA8L3JkZjpEZXNjcmlwdGlvbj4KCiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0nJwogIHhtbG5zOnBkZj0naHR0cDovL25zLmFkb2JlLmNvbS9wZGYvMS4zLyc+CiAgPHBkZjpBdXRob3I+U2FyYWggS2VtbWVOYXNoPC9wZGY6QXV0aG9yPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp4bXA9J2h0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8nPgogIDx4bXA6Q3JlYXRvclRvb2w+Q2FudmEgKFJlbmRlcmVyKSBkb2M9REFHdTJ5dUVOWkEgdXNlcj1VQUZqR1c2eHRDUSBicmFuZD1bQVJDSElWRURdIEZvcnQgV2F5bmUgQ29tbXVuaXR5IFNjaG9vbHMgdGVtcGxhdGU9PC94bXA6Q3JlYXRvclRvb2w+CiA8L3JkZjpEZXNjcmlwdGlvbj4KPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0ncic/PupmVZwAAAT8SURBVHic7d1PaBxVHMDxX41Wh6DsE1FcweGltiAUpE7Vanm9BGzGqvGgJ9e/bRSliHrwkIueiif/gShkVFRGLCbR4p8ulSBMEEul7+rJF6jgXqQTFSEiK15m4yTZze7MvJn3m5nf95p9+xv4MLOZycxmB1Co2mF6A6iNEQiyCARZBIIsAkEWgSCLQJBFIMgiEGQRCLIIBFkEgiwCGVCDi7GJydnjbOLQEQC4AQBUqAJfeu6nec4lkD41uLjcmWl/AQBTm38WquAd6bnP5jV7LK83LmsRxucA4Pb7ucXs2xgX13ek/1Ue8wkk1jCMXhaz9zMurutI/2vd20AgUQ0udkaHqW0xekV7yrUd6X+jczsIBNYxFgDgSJJ1Eco1Hemf1rUttQeJYdybZr3F7NsZF1d3pN/WsT21BmlwcZkz016ElBi9LGbfwbhgOlBqDXLwpZ8WAeB+He9lMfsA4+KqjvTPZHmfWoMwLpoWsw/rej+L2XcyLq7MglJrkI70f2Bc/KkZ5S7GxXhH+t+mWV9rEIB1lD80oxxkXFzsSP9c0rW1BwEA6Ej/LOPid4vZWy6VpM1i9oFQLb+2tnrh3yTrLtG1AZhrcLFz8sRfLze4sAa9RnruG6EKXtQ4lrEJsTfposqDROcZ8wDwijPT/rLBxRWDXis99/VQBc9rHP930gWVvto74KTvzPm5qenVleW1QetuPXb6OTZx6M2M439Zmh2/Memiyu4hsT1j80nf3c5M+9SQPeWtUAUvZJmf9vBXyQ/12J5x34CX7Go6rf2hWp5fW73Q7feC6IP+osXskS42xgtV8LT03I+TrgOoIEiCa1M3NZ2WMwTlHOPiN4vZ94w6P1TBU9Jz55Jsc7xKgaS4ULh7BJQfR0UJVXBUeu57SbZ5c5UByXDVdnfTae3LihKq4EnpuR8knL2lSoBkvYQOAHsilIUUKN1QBY9Jz/0o5ewNlR5EA0avNCjdUAWPSs/1M85er9QgGjF67Wk6rVsilL6XPGIoh0MVPKz7tqDSnhjGzjMG/WqbpVPn56YeWl1Z/mfQC/jk7K6VpRM/6x5cSpAc9ox+DUXJo9KdqReEAQAw7cy0Tza4uDTnORsq1WdIgRi9bm46rb2hWl5Mehk9baU5ZEU3JMyDpr+BJ2xhaXb8wSIGleKQFWF8BmYwIFTBd0XNQr+HxDCmTcwPVXBceu7bRc1DDVI3DADEIHXEAEAKUlcMAIQgdcYAQAZSdwwARCAIMJ6RnvuuidnxUIAQxv8ZByGMjRkFIYytGQMhjP4ZASGMwRUOQhjbVygIAoxMN7EVUWEghDFahYAQxujlDkIYycoVhDCSlxsIYaQrFxDCSJ92EAQYx7I+EmAyrSAIMI5Kz33fxGxdaQMhDD1pASEMfWUGIQy9ZQIhDP2lBiGMfEoFggBDywOWGEsM0uBiLLoL/YEctmdooQoel577oYnZRZT47nc2IfaBOYwnqowBAJDm6SAjjzBUfc/oVYrnQ+qCAVACkDphACAHqRsGAF6QbqiCR+qGAZDuQz3vel9X8YnpDTERtj2k1hgAuEBqjwGAB4QwojCAEEYs0yCEsSmTv2V1QxW08v43dGXLFEg3+vKvk4bmo83EIYswtinNHvIrALyadmCogu+l5+byPwCrkPGHPqmNEQiyCARZBIIsAkEWgSCLQJBFIMgiEGQRCLIIBFkEgqz/ADvdpRk/dmKqAAAAAElFTkSuQmCC";function Hn({vendor:r,onDelete:O,onEdit:F,boothMap:j}){return n.jsxs("div",{className:"vendor-display-tile",children:[n.jsxs("div",{className:"vendor-info",children:[n.jsx("h3",{className:"vendor-business-name",children:r.businessName}),n.jsxs("p",{className:"vendor-plot-size",children:[r.plotWidth,"ft x ",r.plotHeight,"ft"]})]}),n.jsxs("div",{className:"vendor-actions",children:[n.jsx("img",{src:En,alt:"Share",className:"vendor-link",onClick:async b=>{b.stopPropagation();const E=localStorage.getItem("companyId"),C=window.location.origin+`/LayItOut/Layout/?companyId=${E}&areaId=${j.areaId}&type=pick-booth&boothMapId=${j.id}&boothMapName=${j.name}&vendorId=${r.id}`;await navigator.clipboard.writeText(C),alert("BoothMap link copied to clipboard!")}}),n.jsx("img",{src:Vn,alt:"Edit",className:"vendor-edit",onClick:b=>{b.stopPropagation(),F(r.id)}}),n.jsx("img",{src:kn,alt:"Delete",className:"vendor-delete",onClick:b=>{b.stopPropagation(),window.confirm("Are you sure you want to delete this vendor?")&&O(r.id)}})]})]})}function Un({maxHeight:r,vendors:O,onAddVendor:F,boothMap:j,onDeleteVendor:b,onEditVendor:E}){return n.jsxs("div",{className:"vendors-tile",style:{maxHeight:r?`${r}px`:"200px"},children:[n.jsx("h2",{children:"Vendors"}),n.jsx("div",{className:"vendors-divider"}),n.jsxs("div",{className:"vendors-tile-content",children:[O.map(C=>n.jsx(Hn,{vendor:C,boothMap:j,onDelete:A=>{b(A)},onEdit:A=>{E(C)}},C.id)),n.jsx("div",{className:"add-vendor",onClick:F,children:n.jsx("img",{src:Wt,alt:"Add vendor"})})]})]})}function Xn({dialogRef:r,closeDialog:O,addVendor:F}){const[j,b]=m.useState(""),[E,C]=m.useState(1),[A,Y]=m.useState(1),[N,M]=m.useState(!1);return n.jsxs("dialog",{ref:r,className:"add-vendor-dialog",children:[n.jsxs("div",{className:"add-vendor-dialog-div",children:[n.jsx("h2",{children:"Add Vendor"}),n.jsxs("div",{className:"add-vendor-row",children:[n.jsx("label",{htmlFor:"business-name",children:"Business Name:"}),n.jsx("input",{type:"text",id:"business-name",name:"business-name",onChange:R=>b(R.target.value??""),value:j})]}),n.jsxs("div",{className:"add-vendor-row add-vendor-size",children:[n.jsx("label",{htmlFor:"item-width",children:"Booth Size (in feet):"}),n.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:E,onChange:R=>C(parseFloat(R.target.value)??1)}),n.jsx("span",{children:" x "}),n.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:A,onChange:R=>Y(parseFloat(R.target.value)??1)})]}),n.jsx("br",{}),n.jsx("button",{className:"action-btn",onClick:async()=>{if(j.trim()===""){alert("Business name cannot be empty");return}const R=new Dt({id:j+(Math.random()*1e4).toString(),businessName:j,plotWidth:Math.ceil(E),plotHeight:Math.ceil(A)});M(!0),await F(R),b(""),C(1),Y(1),M(!1),O()},children:"Add Vendor"}),n.jsx("br",{}),n.jsx("br",{}),n.jsx("button",{className:"action-btn",onClick:()=>{O(),b(""),C(1),Y(1)},children:"Close"})]}),N&&n.jsx(n.Fragment,{children:n.jsx("div",{className:"loader"})})]})}function Qn({dialogRef:r,closeDialog:O,editVendor:F,oldVendor:j}){const[b,E]=m.useState(""),[C,A]=m.useState(1),[Y,N]=m.useState(1),[M,R]=m.useState(!1);return m.useEffect(()=>{j&&(E(j.businessName),A(j.plotWidth),N(j.plotHeight))},[j]),n.jsxs("dialog",{ref:r,className:"edit-vendor-dialog",children:[n.jsxs("div",{className:"edit-vendor-dialog-div",children:[n.jsx("h2",{children:"Edit Vendor"}),n.jsxs("div",{className:"edit-vendor-row",children:[n.jsx("label",{htmlFor:"business-name",children:"Business Name:"}),n.jsx("input",{type:"text",id:"business-name",name:"business-name",onChange:W=>E(W.target.value??""),value:b})]}),n.jsxs("div",{className:"edit-vendor-row edit-vendor-size",children:[n.jsx("label",{htmlFor:"item-width",children:"Booth Size (in feet):"}),n.jsx("input",{type:"number",id:"item-width",name:"item-width",min:"1",value:C,onChange:W=>A(parseFloat(W.target.value)??1)}),n.jsx("span",{children:" x "}),n.jsx("input",{type:"number",id:"item-height",name:"item-height",min:"1",value:Y,onChange:W=>N(parseFloat(W.target.value)??1)})]}),n.jsx("br",{}),n.jsx("button",{className:"action-btn",onClick:async()=>{if(b.trim()===""){alert("Business name cannot be empty");return}const W=new Dt({id:j.id,businessName:b,plotWidth:Math.ceil(C),plotHeight:Math.ceil(Y)});R(!0),await F(W),E(""),A(1),N(1),R(!1),O()},children:"Save Vendor"}),n.jsx("br",{}),n.jsx("br",{}),n.jsx("button",{className:"action-btn",onClick:()=>{O(),E(""),A(1),N(1)},children:"Close"})]}),M&&n.jsx(n.Fragment,{children:n.jsx("div",{className:"loader"})})]})}wn.createRoot(document.getElementById("root")).render(n.jsx(zn,{}));function zn(){const[r,O]=m.useState(/Mobi|Android/i.test(navigator.userAgent)),[F,j]=m.useState(0),[b,E]=m.useState(0),[C,A]=m.useState(0),[Y,N]=m.useState(0),[M,R]=m.useState([]),[W,I]=m.useState([]),[Z,y]=m.useState(0),[v,J]=m.useState(null),[q,re]=m.useState([]),k=/Mobi|Android/i.test(navigator.userAgent)?5:10,[oe,ne]=m.useState([]),[Ne,yt]=m.useState(!1),[fe,je]=m.useState(null),[Xe,Ae]=m.useState(null),[Qe,ze]=m.useState([new x({id:"left-wall",name:"Left Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"LeftWall"}),new x({id:"right-wall",name:"Right Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"RightWall"}),new x({id:"top-wall",name:"Top Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopWall"}),new x({id:"bottom-wall",name:"Bottom Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomWall"}),new x({id:"top-left-corner-wall",name:"Top Left Corner Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopLeftCornerWall"}),new x({id:"top-right-corner-wall",name:"Top Right Corner Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"TopRightCornerWall"}),new x({id:"bottom-left-corner-wall",name:"Bottom Left Corner Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomLeftCornerWall"}),new x({id:"bottom-right-corner-wall",name:"Bottom Right Corner Wall",cellsLong:1,cellsTall:1,icon:"",moveable:!0,starterItem:!1,displayItem:!0,isSectionModifier:!0,sectionModifierType:"BottomRightCornerWall"})]),Oe=m.useRef(null),[wt,Pe]=m.useState(!1),[le,me]=m.useState([]),[L,se]=m.useState([]),[_e,Be]=m.useState([]),[xe,Ce]=m.useState([]),[Se,Le]=m.useState(!1),he=m.useRef(null),[Ge,Fe]=m.useState([]),[G,T]=m.useState([]),[w,K]=m.useState(null),[B,ue]=m.useState(!1),[U,be]=m.useState(!1),[Ie,Ot]=m.useState(!1),[Ze,Pt]=m.useState(!1),[te,Bt]=m.useState(!1),[_,et]=m.useState("placing-sections"),[qn,Gt]=m.useState(!1),[Te,Ft]=m.useState(!1),[qe,Zt]=m.useState(!1),[Ye,Yt]=m.useState(!1),[Jt,Vt]=m.useState(!1),[Je,tt]=m.useState(""),[$e,Ht]=m.useState(null),[Me,xt]=m.useState(""),[V,Ut]=m.useState(""),[X,Xt]=m.useState(""),[nt,Qt]=m.useState(null),[lt,ot]=m.useState(""),[vt,st]=m.useState(""),[de,Re]=m.useState(null),[it,Q]=m.useState(!0),[St,zt]=m.useState(null),[at,pe]=m.useState(!1),[qt,$t]=m.useState(null),[Kt,Lt]=m.useState([]),[_t,Ee]=m.useState(!1),[ve,en]=m.useState(null),[ct,tn]=m.useState(!1),[nn,ln]=m.useState(null),rt=m.useRef(null),mt=m.useRef(null),dt=m.useRef(null),gt=m.useRef(null),ut=m.useRef(null);function ye(t,e){for(const s of e)if(t.x>=s.cellId.x&&t.x<s.cellId.x+s.cellsLong&&t.y>=s.cellId.y&&t.y<s.cellId.y+s.cellsTall)return s;return null}function on(t,e,s,c){me([...t.map(l=>new P({name:l.name,cellId:new h({x:l.cellId.x,y:l.cellId.y}),cellsLong:l.cellsLong,cellsTall:l.cellsTall,modifierItems:l.modifierItems.map(o=>new H({cell:new h({x:o.cell.x,y:o.cell.y}),item:new x({...o.item,starterItem:!0})})),startingItems:[]}))]);let i=F,a=b;if(r){for(const u of t)console.log("Generating cells for section",u.name,"at",u.cellId,"with size",u.cellsLong,"x",u.cellsTall),console.log("Needed section Width:",(u.cellsLong+u.cellId.x)*k,"Current width:",i),(u.cellsLong+u.cellId.x)*k>i&&(console.log("Added section Width:",u.cellsLong*k+u.cellId.x),i+=(u.cellsLong+u.cellId.x)*k-i),console.log("Needed section Height:",(u.cellsTall+u.cellId.y)*k,"Current height:",a),(u.cellsTall+u.cellId.y)*k>a&&(console.log("Added section Height:",u.cellsTall*k+u.cellId.y),a+=(u.cellsTall+u.cellId.y)*k-a);N(a/k*2),A(i/k*2);let l=0;const o=[],g=[];for(const u of t){const f=[],S={width:u.cellsLong*k,height:u.cellsTall*k,sectionName:u.name};S.height>l&&(l=S.height),Fe(D=>[...D,S]),u.cellId.x=0,u.cellId.y=0,[...Array(S.height/k).keys()].map(D=>{const ie=[];[...Array(S.width/k).keys()].map(ee=>{ie.push({id:new h({x:ee,y:D}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:!0,size:k})}),f.push(ie)}),o.push({sectionName:u.name,cells:[...f]}),g.push(u)}T(o),se(g),y(l),K(t[0]?t[0].name:null),setTimeout(()=>{Q(!1)},500)}else{const l=[];for(const o of t)console.log("Generating cells for section",o.name,"at",o.cellId,"with size",o.cellsLong,"x",o.cellsTall),console.log("Needed section Width:",o.cellsLong+o.cellId.x,"Current width:",i),o.cellsLong+o.cellId.x>i&&(console.log("Added section Width:",o.cellsLong+o.cellId.x),i+=o.cellsLong+o.cellId.x-i),console.log("Needed section Height:",o.cellsTall+o.cellId.y,"Current height:",a),o.cellsTall+o.cellId.y>a&&(console.log("Added section Height:",o.cellsTall+o.cellId.y),a+=o.cellsTall+o.cellId.y-a);j(e.width),E(e.height),A(e.width),N(e.height),console.log("Final width:",i,"Final height:",a),[...Array(e.height).keys()].map(o=>{const g=[];[...Array(e.width).keys()].map(u=>{console.log("Creating cell at",u,o,"with size",k,s),g.push({id:new h({x:u,y:o}),hasItem:!1,itemId:"",mouseOver:!1,canPlaceItem:!1,mouseOverLocation:"",inSection:s&&c=="placing-sections"?!0:ye(new h({x:u,y:o}),t)!=null,size:k})}),l.push(g)}),R([...l]),setTimeout(()=>{const o=[],g=[...t],u=[];for(const f of g)f.cellElement=document.querySelector(`.App #${f.cellId.toId()}.cell:not(.cell-border)`),o.push(...f.startingItems.map(S=>new H({cell:new h({x:f.cellId.x+S.cell.x,y:f.cellId.y+S.cell.y}),item:new x({...S.item,initialElement:document.querySelector(`.App #${S.cell.toId()}.cell:not(.cell-border)`),starterItem:!0})}))),o.push(...f.modifierItems.map(S=>new H({cell:new h({x:f.cellId.x+S.cell.x,y:f.cellId.y+S.cell.y}),item:new x({...S.item,initialElement:document.querySelector(`.App #${S.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1})}))),u.push(...f.booths.map(S=>new We({...S,initialElement:document.querySelector(`.App #${S.cell.toId()}.cell:not(.cell-border)`)})));se([...g]);for(const f of o){const S=ee=>{const ae=ee%2===1;return{cellsLong:ae?f.item.cellsTall:f.item.cellsLong,cellsTall:ae?f.item.cellsLong:f.item.cellsTall}},D=f.item.rotation||0,ie=S(D);for(let ee=0;ee<ie.cellsTall;ee++)for(let ae=0;ae<ie.cellsLong;ae++)l[f.cell.y+ee][f.cell.x+ae].hasItem=!0,l[f.cell.y+ee][f.cell.x+ae].itemId=f.item.id;f.item.initialElement=document.querySelector(`.App #${f.cell.toId()}.cell:not(.cell-border)`),I(ee=>[...ee,f.item])}for(const f of u){for(let S=0;S<f.cellsTall;S++)for(let D=0;D<f.cellsLong;D++)l[f.cell.y+S][f.cell.x+D].hasItem=!0,l[f.cell.y+S][f.cell.x+D].itemId=f.id;f.initialElement=document.querySelector(`.App #${f.cell.toId()}.cell:not(.cell-border)`),Be(S=>[...S,f])}R([...l]),setTimeout(()=>{Q(!1)},500)},100)}}async function sn(){const t=new URLSearchParams(window.location.search),e=t.get("companyId"),s=t.get("areaId"),c=t.get("areaId")||"",i=t.get("companyId")||"",a=t.get("templateId")||"",l=await Tn(i,c);if(l===null){window.location.href="/LayItOut/DNF/";return}Qt(l),$t(l.previewImage||null);const o=t.get("type")||"";let g=!1,u=!1,f="modify-sections",S=!1,D=null;if(o==="create-template")ue(!0);else if(o==="edit-template"){be(!0);const d=l.templates.find(p=>p.id===a);d&&(zt(d),xt(d.name))}else if(o==="view-design"){g=!0,Ot(!0);const d=t.get("designName")||"";tt(d);const p=t.get("designId")||"";ot(p)}else if(o==="view-area")Pt(!0);else if(o==="edit-design"){g=!0,Gt(!0);const d=t.get("designName")||"";tt(d);const p=t.get("designId")||"";ot(p)}else if(o==="client-edit-design"){g=!0,Vt(!0);const d=t.get("designName")||"";tt(d);const p=t.get("designId")||"";ot(p)}else if(o==="create-area"){u=!0,Bt(!0);const d=t.get("stage");d==="placing-sections"?(f="placing-sections",et("placing-sections")):d==="modify-sections"?(et("modify-sections"),f="modify-sections",ne(Qe.map(p=>new ce({item:new x({...p,displayItem:!0}),quantity:-1})))):d==="placing-items"&&(et("placing-items"),f="placing-items",ne(l.inventoryItems.map(p=>new ce({item:new x({...p.item,displayItem:!0}),quantity:p.quantity}))))}else if(o==="view-boothMap"){S=!0,Ft(!0);const d=t.get("boothMapId")||"";st(d);const p=await pt(i,c,d);if(p===null){window.location.href="/LayItOut/DNF/";return}Re(p),D=p}else if(o==="pick-booth"){S=!0,Yt(!0);const d=t.get("boothMapId")||"";st(d);const p=await pt(i,c,d);if(p===null){window.location.href="/LayItOut/DNF/";return}Re(p),D=p;const ge=t.get("vendorId")||"";if(ge!==""){const $=p.vendors.find(z=>z.id===ge);if($){en($),console.log("Vendor found",$);let z=!1;D.sections.forEach(pn=>{pn.booths.forEach(yn=>{yn.user?.id===$.id&&(z=!0)})}),tn(z)}else{window.location.href="/LayItOut/DNF/";return}}}else if(o==="create-boothMap"){S=!0,Zt(!0);const d=t.get("boothMapId")||"";st(d);const p=await pt(i,c,d);if(p===null){window.location.href="/LayItOut/DNF/";return}Re(p),D=p}e&&Ut(e),s&&Xt(s),u||ne(l.inventoryItems.map(d=>new ce({item:new x({...d.item,displayItem:!0}),quantity:d.quantity})));const ie=[],ee=[];for(const d of l.templates){const p=[],ge=[];for(const $ of d.sections)p.push(new P({name:$.name,cellId:new h({x:$.cellId.x,y:$.cellId.y}),cellsLong:$.cellsLong,cellsTall:$.cellsTall,modifierItems:$.modifierItems.map(z=>new H({cell:new h({x:z.cell.x,y:z.cell.y}),item:new x({...z.item,starterItem:!0})})),startingItems:$.startingItems.map(z=>new H({cell:new h({x:z.cell.x,y:z.cell.y}),item:new x({...z.item,starterItem:!0})}))})),ge.push(new P({name:$.name,cellId:new h({x:$.cellId.x,y:$.cellId.y}),cellsLong:$.cellsLong,cellsTall:$.cellsTall,modifierItems:$.modifierItems.map(z=>new H({cell:new h({x:z.cell.x,y:z.cell.y}),item:new x({...z.item,starterItem:!0})})),startingItems:$.startingItems.map(z=>new H({cell:new h({x:z.cell.x,y:z.cell.y}),item:new x({...z.item,starterItem:!0})}))}));ie.push(new we({name:d.name,sections:p,inventoryItems:d.inventoryItems,id:d.id,previewImage:d.previewImage})),ee.push(new we({name:d.name,sections:ge,id:d.id,previewImage:d.previewImage,inventoryItems:d.inventoryItems}))}Ce([...ie]);const ae=[],De=a===""?void 0:ee.find(d=>d.id===a);if(console.log("TEMPLATE",De,"AREA",l),S&&D)ne(D.inventoryItems.map(d=>new ce({item:new x({...d.item,displayItem:!0}),quantity:d.quantity}))),me([...D.sections]),se([...D.sections.map(d=>new P({name:d.name,cellId:new h({x:d.cellId.x,y:d.cellId.y}),cellsLong:d.cellsLong,cellsTall:d.cellsTall,startingItems:d.startingItems,booths:d.booths,modifierItems:d.modifierItems,items:d.startingItems.map(p=>new x({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))]),ae.push(...D.sections.map(d=>new P({name:d.name,cellId:new h({x:d.cellId.x,y:d.cellId.y}),cellsLong:d.cellsLong,cellsTall:d.cellsTall,startingItems:d.startingItems,booths:d.booths,modifierItems:d.modifierItems,items:d.startingItems.map(p=>new x({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))})));else if(g){const d=await jn(i,c,t.get("designId")||"");if(d===null){window.location.href="/LayItOut/DNF/";return}Ht(d),ne(d.inventoryItems.map(p=>new ce({item:new x({...p.item,displayItem:!0}),quantity:p.quantity}))),me([...d.sections]),se([...d.sections.map(p=>new P({name:p.name,cellId:new h({x:p.cellId.x,y:p.cellId.y}),cellsLong:p.cellsLong,cellsTall:p.cellsTall,startingItems:p.startingItems,modifierItems:p.modifierItems,items:p.startingItems.map(ge=>new x({...ge.item,sectionCell:new h({x:ge.cell.x,y:ge.cell.y})}))}))]),ae.push(...d.sections.map(p=>new P({name:p.name,cellId:new h({x:p.cellId.x,y:p.cellId.y}),cellsLong:p.cellsLong,cellsTall:p.cellsTall,startingItems:p.startingItems,modifierItems:p.modifierItems,items:p.startingItems.map(ge=>new x({...ge.item,sectionCell:new h({x:ge.cell.x,y:ge.cell.y})}))})))}else De!==void 0?(ne(De.inventoryItems.map(d=>new ce({item:new x({...d.item,displayItem:!0}),quantity:d.quantity}))),me([...De.sections]),se([...De.sections.map(d=>new P({name:d.name,cellId:new h({x:d.cellId.x,y:d.cellId.y}),cellsLong:d.cellsLong,cellsTall:d.cellsTall,startingItems:d.startingItems,modifierItems:d.modifierItems,items:d.startingItems.map(p=>new x({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))]),ae.push(...De.sections.map(d=>new P({name:d.name,cellId:new h({x:d.cellId.x,y:d.cellId.y}),cellsLong:d.cellsLong,cellsTall:d.cellsTall,modifierItems:d.modifierItems,startingItems:d.startingItems,items:d.startingItems.map(p=>new x({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))})))):(me([...l.sections]),se([...l.sections.map(d=>new P({name:d.name,cellId:new h({x:d.cellId.x,y:d.cellId.y}),cellsLong:d.cellsLong,cellsTall:d.cellsTall,modifierItems:d.modifierItems,startingItems:d.startingItems,items:d.startingItems.map(p=>new x({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))]),ae.push(...l.sections.map(d=>new P({name:d.name,cellId:new h({x:d.cellId.x,y:d.cellId.y}),cellsLong:d.cellsLong,cellsTall:d.cellsTall,startingItems:d.startingItems,modifierItems:d.modifierItems,items:d.startingItems.map(p=>new x({...p.item,sectionCell:new h({x:p.cell.x,y:p.cell.y})}))}))));console.log("SECTIONS TO GENERATE",ae),on(ae,l,o==="create-area",f)}m.useEffect(()=>{sn()},[]);function an(t,e,s){if(!r||t==null)return;const c=[...s],i=[],a=[],l=s.find(o=>o.name==t);console.log("NEW SECTION",l),console.log("Adding section",l.name,l.cellId),console.log("MOBILE CELLS",e),l.cellElement=document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${l.cellId.toId()}.cell:not(.cell-border)`),console.log("Section element found",l.cellElement);for(const o of l.startingItems){console.log("Placing starting item",o.item.name,o.cell);const g=S=>{const D=S%2===1;return{cellsLong:D?o.item.cellsTall:o.item.cellsLong,cellsTall:D?o.item.cellsLong:o.item.cellsTall}},u=o.item.rotation||0,f=g(u);for(let S=0;S<f.cellsTall;S++)for(let D=0;D<f.cellsLong;D++){const ie=e.find(ee=>ee.sectionName===l.name);ie.cells[o.cell.y+S][o.cell.x+D].hasItem=!0,ie.cells[o.cell.y+S][o.cell.x+D].itemId=o.item.id}o.item.initialElement=document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${o.cell.toId()}.cell:not(.cell-border)`),console.log("Adding item to items",o.item.initialElement),i.push(new x({...o.item}))}for(const o of l.modifierItems){console.log("Placing starting item",o.item.name,o.cell);const g=S=>{const D=S%2===1;return{cellsLong:D?o.item.cellsTall:o.item.cellsLong,cellsTall:D?o.item.cellsLong:o.item.cellsTall}},u=o.item.rotation||0,f=g(u);for(let S=0;S<f.cellsTall;S++)for(let D=0;D<f.cellsLong;D++){const ie=e.find(ee=>ee.sectionName===l.name);ie.cells[o.cell.y+S][o.cell.x+D].hasItem=!0,ie.cells[o.cell.y+S][o.cell.x+D].itemId=o.item.id}console.log("Adding item to items",document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${o.cell.toId()}.cell:not(.cell-border)`)),i.push(new x({...o.item,initialElement:document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${o.cell.toId()}.cell:not(.cell-border)`),starterItem:!0,moveable:!1}))}console.log("Setting sections",c),se([...c]),console.log("ITEMS",i),I(o=>[...o.filter(u=>!i.some(f=>f.id===u.id)),...i.map(u=>new x({...u,starterItem:!0}))]),a.push(...l.booths.map(o=>new We({...o,initialElement:document.querySelector(`.App #${l.name.split(" ").join("-")} #${l.name.split(" ").join("")}${o.cell.toId()}.cell:not(.cell-border)`)})));for(const o of a){for(let g=0;g<o.cellsTall;g++)for(let u=0;u<o.cellsLong;u++){const f=e.find(S=>S.sectionName===l.name);f.cells[o.cell.y+g][o.cell.x+u].hasItem=!0,f.cells[o.cell.y+g][o.cell.x+u].itemId=o.id}Be(g=>[...g,o])}}function bt(t){let e=[];return t.map(s=>e=[...e,...s]),e}function ft(t,e){console.log(t);const s=r?G.find(l=>l.sectionName===w).cells:M,c=s[t.y].length,i=s.length;if(console.log(c,i),t.x+e.cellsLong>c||t.y+e.cellsTall>i)return!1;const a=ye(t,L);if(!a&&!r&&(_!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<e.cellsTall;l++)for(let o=0;o<e.cellsLong;o++){if(!r){const g=ye(new h({x:t.x+o,y:t.y+l}),L);if(!g&&(_!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;if(g?.name!=a?.name&&(_!=="placing-sections"||!te))return console.log("Item is crossing section boundaries"),!1}if(s[t.y+l][t.x+o].hasItem&&s[t.y+l][t.x+o].itemId!=e.id){console.log("Something is already here");const g=W.find(u=>u.id==s[t.y+l][t.x+o].itemId);if(g&&g.isSectionModifier){if(g.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",l,o,e.cellsTall,e.cellsLong),o==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",l,o,e.cellsTall,e.cellsLong),o==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",l,o,e.cellsTall,e.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",l,o,e.cellsTall,e.cellsLong),l==e.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",l,o,e.cellsTall,e.cellsLong),l==0&&o==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",l,o,e.cellsTall,e.cellsLong),l==0&&o==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",l,o,e.cellsTall,e.cellsLong),l==e.cellsTall-1&&o==e.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",l,o,e.cellsTall,e.cellsLong),l==e.cellsTall-1&&o==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function Tt(t,e,s){console.log(e),console.log("CELLS",t);const c=t[e.y].length,i=t.length;if(console.log(c,i),e.x+s.cellsLong>c||e.y+s.cellsTall>i)return!1;const a=ye(e,L);if(!a&&!r&&(_!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;for(let l=0;l<s.cellsTall;l++)for(let o=0;o<s.cellsLong;o++){if(!r){const g=ye(new h({x:e.x+o,y:e.y+l}),L);if(!g&&(_!=="placing-sections"||!te))return console.log("Item is out of bounds of any section"),!1;if(g?.name!=a?.name&&(_!=="placing-sections"||!te))return console.log("Item is crossing section boundaries"),!1}if(t[e.y+l][e.x+o].hasItem&&t[e.y+l][e.x+o].itemId!=s.id){console.log("Something is already here");const g=W.find(u=>u.id==t[e.y+l][e.x+o].itemId);if(g&&g.isSectionModifier){if(g.sectionModifierType==="RightWall"){if(console.log("Item is on left wall of section modifier, can place item",l,o,s.cellsTall,s.cellsLong),o==s.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="LeftWall"){if(console.log("Item is on right wall of section modifier, can place item",l,o,s.cellsTall,s.cellsLong),o==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopWall"){if(console.log("Item is on bottom wall of section modifier, can place item",l,o,s.cellsTall,s.cellsLong),l==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomWall"){if(console.log("Item is on top wall of section modifier, can place item",l,o,s.cellsTall,s.cellsLong),l==s.cellsTall-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopRightCornerWall"){if(console.log("Item is on bottom left corner of section modifier, can place item",l,o,s.cellsTall,s.cellsLong),l==0&&o==s.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="TopLeftCornerWall"){if(console.log("Item is on bottom right corner of section modifier, can place item",l,o,s.cellsTall,s.cellsLong),l==0&&o==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomRightCornerWall"){if(console.log("Item is on top left corner of section modifier, can place item",l,o,s.cellsTall,s.cellsLong),l==s.cellsTall-1&&o==s.cellsLong-1)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}else if(g.sectionModifierType==="BottomLeftCornerWall"){if(console.log("Item is on top right corner of section modifier, can place item",l,o,s.cellsTall,s.cellsLong),l==s.cellsTall-1&&o==0)continue;return console.log("Item is not on edge of section modifier, cannot place item"),!1}}else return!1}}return!0}function jt(t,e,s){const c=Array.from(r?G.find(a=>a.sectionName===w).cells:M);if(Ee(!0),s!=null){console.log("Removing item");const a=r?L.find(l=>l.name===w):ye(s,L);a.items=a.items.filter(l=>l.id!=e.id);for(let l=0;l<e.cellsTall;l++)for(let o=0;o<e.cellsLong;o++)c[s.y+l][s.x+o].hasItem=!1,c[s.y+l][s.x+o].itemId=""}if(_!=="placing-sections"||!te){const a=r?L.find(o=>o.name===w):ye(t,L),l=new h({x:t.x-a.cellId.x,y:t.y-a.cellId.y});e.sectionCell=l,console.log("Adding item to section",a.name,"at",l,e),a.items.push(e)}else e.sectionCell=new h({x:t.x,y:t.y});for(let a=0;a<e.cellsTall;a++)for(let l=0;l<e.cellsLong;l++)c[t.y+a][t.x+l].hasItem=!0,c[t.y+a][t.x+l].itemId=e.id;if(console.log(c),r){const a=G.find(l=>l.sectionName===w);a&&(a.cells=c.map(l=>l.map(o=>({...o}))),T([...G]))}else R(c);console.log("Removing item from inventory",e.name);let i=!1;if(!e.hasMoved){const a=oe.findIndex(l=>l.item.name==e.name&&!l.item.hasMoved);if(a!==-1){const l=[...oe];l[a].quantity>0&&(l[a].quantity-=1,l[a].quantity<=0&&(i=!0,l.splice(a,1)),ne(l))}else ne(oe)}if(I(a=>(console.log("Placing item",e),console.log("Updating item",e.id),Ne&&fe&&e.id==fe.id?(console.log("Updating placing item",e.id),e.hasMoved=!0,e.starterItem=!0,e.isDisplayItem=!1,e.initialElement=document.querySelector(`.App #${t.toId()}.cell:not(.cell-border)`),[...a,new x({...e,hasMoved:!0,id:e.name+Math.floor(Math.random()*1e5).toString()})]):(a.find(l=>l.id==e.id).hasMoved||(a.find(l=>l.id==e.id).hasMoved=!0,a.find(l=>l.id==e.id).sectionCell=e.sectionCell),a))),Ne&&fe&&i){je(null);return}}function cn(t){W.find(e=>e.name==t.name&&!e.hasMoved&&!e.starterItem)||I(e=>[...e,t])}m.useEffect(()=>{fe?(console.log("Adding placing item",fe.id),Ae(fe.id)):(console.log("Removing placing item",Xe),Ae(""))},[fe]);function At(t){console.log("Removing item",t.id),I(e=>e.filter(s=>s.id!=t.id))}function rn(t,e){const s=Array.from(r?G.find(l=>l.sectionName===w).cells:M);Ee(!0);const c=l=>{const o=l%2===1;return{cellsWide:o?t.cellsTall:t.cellsLong,cellsTall:o?t.cellsLong:t.cellsTall}},i=t.rotation||0,a=c(i);for(let l=0;l<a.cellsTall;l++)for(let o=0;o<a.cellsWide;o++)s[e.y+l][e.x+o].hasItem=!1,s[e.y+l][e.x+o].itemId="";if(r){const l=G.find(o=>o.sectionName===w);l&&(l.cells=s.map(o=>o.map(g=>({...g}))),T([...G])),T(o=>o.map(g=>g.sectionName===w?{...g,cells:s}:g))}else R(s);if(_!=="placing-sections"||!te){const l=r?L.find(o=>o.name===w):ye(e,L);l.items=l.items.filter(o=>o.id!=t.id),console.log("DELETING ITEM",t.id)}I(l=>(console.log(),l.filter(o=>o.id!=t.id))),ne(l=>{const o=l.findIndex(g=>g.item.name==t.name&&!g.item.hasMoved);if(o!==-1){const g=[...l];return g[o].quantity>0&&(g[o].quantity+=1),g}else return[...l,new ce({item:new x({...t}),quantity:1})]})}function mn(t,e){const s=Array.from(r?G.find(g=>g.sectionName===w).cells:M);console.log("DELETING ITEM ROTATE",t.id,t.rotation),Ee(!0);const c=g=>{const u=g%2===1;return{cellsWide:u?t.cellsTall:t.cellsLong,cellsTall:u?t.cellsLong:t.cellsTall}},i=t.rotation||0,a=c(i);for(let g=0;g<a.cellsTall;g++)for(let u=0;u<a.cellsWide;u++)console.log("Deleting cell",e.y+g,e.x+u),s[e.y+g][e.x+u].hasItem=!1,s[e.y+g][e.x+u].itemId="";if(r){const g=G.find(u=>u.sectionName===w);g&&(g.cells=s.map(u=>u.map(f=>({...f}))),T([...G])),T(u=>u.map(f=>f.sectionName===w?{...f,cells:s}:f))}else R(s);console.log("DELETING ITEM",t.id);const l=r?L.find(g=>g.name===w):ye(e,L);l.items=l.items.filter(g=>g.id!=t.id);const o=new h({x:e.x-l.cellId.x,y:e.y-l.cellId.y});t.sectionCell=o,l.items.push(t)}function Nt(t,e){const s=r?G.find(a=>a.sectionName===w).cells:M,c=Array.from(s);if(s[t.y]==null){ht();return}const i=ft(t,e);c.forEach(a=>a.forEach(l=>{l.mouseOver=!1,l.canPlaceItem=!1,l.mouseOverLocation=""}));for(let a=0;a<e.cellsTall;a++)for(let l=0;l<e.cellsLong;l++)t.y+a<c.length&&t.x+l<c[t.y+a].length&&(e.cellsLong===1&&e.cellsTall===1?c[t.y+a][t.x+l].mouseOverLocation="single":e.cellsTall===1?l===0?c[t.y+a][t.x+l].mouseOverLocation="leftFull":l===e.cellsLong-1?c[t.y+a][t.x+l].mouseOverLocation="rightFull":c[t.y+a][t.x+l].mouseOverLocation="middleFull":e.cellsLong===1?a===0?c[t.y+a][t.x+l].mouseOverLocation="topFull":a===e.cellsTall-1?c[t.y+a][t.x+l].mouseOverLocation="bottomFull":c[t.y+a][t.x+l].mouseOverLocation="middleVFull":a===0&&l===0?c[t.y+a][t.x+l].mouseOverLocation="topLeftCorner":a===0&&l===e.cellsLong-1?c[t.y+a][t.x+l].mouseOverLocation="topRightCorner":a===e.cellsTall-1&&l===0?c[t.y+a][t.x+l].mouseOverLocation="bottomLeftCorner":a===e.cellsTall-1&&l===e.cellsLong-1?c[t.y+a][t.x+l].mouseOverLocation="bottomRightCorner":a===0?c[t.y+a][t.x+l].mouseOverLocation="top":a===e.cellsTall-1?c[t.y+a][t.x+l].mouseOverLocation="bottom":l===0?c[t.y+a][t.x+l].mouseOverLocation="left":l===e.cellsLong-1?c[t.y+a][t.x+l].mouseOverLocation="right":c[t.y+a][t.x+l].mouseOverLocation="middle",c[t.y+a][t.x+l].mouseOver=!0,c[t.y+a][t.x+l].canPlaceItem=i);if(r){const a=G.find(l=>l.sectionName===w);a&&(a.cells=c.map(l=>l.map(o=>({...o}))),T([...G])),T(l=>l.map(o=>o.sectionName===w?{...o,cells:c}:o))}else R(c)}function ht(){console.log("Unhighlighting cells");const t=Array.from(r?G.find(e=>e.sectionName===w).cells:M);if(t.forEach(e=>e.forEach(s=>{s.mouseOver=!1,s.canPlaceItem=!1,s.mouseOverLocation=""})),r){const e=G.find(s=>s.sectionName===w);e&&(e.cells=t.map(s=>s.map(c=>({...c}))),T([...G])),T(s=>s.map(c=>c.sectionName===w?{...c,cells:t}:c))}else R(t)}m.useEffect(()=>{an(w,G,L)},[w]),m.useEffect(()=>{const t=()=>{const e=W.find(s=>s.id===v);console.log("Unselecting item",v),J(null),e&&(re(s=>[...s,e.id]),console.log("Unselecting item",e.id),setTimeout(()=>{re(s=>s.filter(c=>c!==e.id))},300))};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[v,W]);function Ct(t){J(null),re(e=>[...e,t]),console.log("Unselecting item",t),setTimeout(()=>{re(e=>e.filter(s=>s!==t))},300)}function Mt(t){const e=W.find(s=>s.id===v);console.log("Unselecting item",v),J(t),e&&(re(s=>[...s,e.id]),console.log("Unselecting item",e.id),setTimeout(()=>{re(s=>s.filter(c=>c!==e.id))},300))}function It(t){ne(e=>[...e,t])}const ke=t=>{console.log("Preventing scroll"),t.preventDefault(),t.stopPropagation(),window.scrollTo(0,0)};m.useEffect(()=>(at?(window.addEventListener("scroll",ke),window.addEventListener("touchmove",ke,{passive:!1})):(window.removeEventListener("scroll",ke),window.removeEventListener("touchmove",ke)),()=>{window.removeEventListener("scroll",ke),window.removeEventListener("touchmove",ke)}),[at]);async function dn(t){const e=[];Q(!0);for(const i of t){const a=i.name,l=new h({x:i.sectionCell.x,y:i.sectionCell.y}),o=new P({name:a,cellId:l,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:[],startingItems:[],items:[]});e.push(o)}let s=0,c=0;for(const i of e)console.log("Generating cells for section",i.name,"at",i.cellId,"with size",i.cellsLong,"x",i.cellsTall),console.log("Needed section Width:",i.cellsLong+i.cellId.x,"Current width:",s),i.cellsLong+i.cellId.x>s&&(console.log("Added section Width:",i.cellsLong+i.cellId.x),s+=i.cellsLong+i.cellId.x-s),console.log("Needed section Height:",i.cellsTall+i.cellId.y,"Current height:",c),i.cellsTall+i.cellId.y>c&&(console.log("Added section Height:",i.cellsTall+i.cellId.y),c+=i.cellsTall+i.cellId.y-c);await An(V,X,e,s,c),window.location.href=`/LayItOut/Layout/?companyId=${V}&areaId=${X}&type=create-area&stage=modify-sections`}async function gn(t,e){const s=[];Q(!0);for(const c of e){const i=c.name,a=new h({x:c.cellId.x,y:c.cellId.y});console.log("Saving section modifier items for section",i,c.items.map(o=>o.name),"at cell",a);const l=new P({name:i,cellId:a,cellsLong:c.cellsLong,cellsTall:c.cellsTall,startingItems:[],items:[],modifierItems:c.items.map(o=>new H({cell:new h({x:o.sectionCell.x,y:o.sectionCell.y}),item:new x({...o,isSectionModifier:!0})}))});s.push(l)}console.log("Saving section modifier items",s),await Nn(V,X,s),console.log("Section modifier items saved successfully"),window.location.href=`/LayItOut/Layout/?companyId=${V}&areaId=${X}&type=create-area&stage=placing-items`}async function un(t,e){Q(!0);const s=[];for(const c of t){const i=c.name,a=new h({x:c.cellId.x,y:c.cellId.y}),l=new P({name:i,cellId:a,cellsLong:c.cellsLong,cellsTall:c.cellsTall,modifierItems:c.modifierItems,startingItems:c.items.map(o=>new H({cell:new h({x:o.sectionCell.x,y:o.sectionCell.y}),item:new x({...o,starterItem:!0})})),items:[]});s.push(l)}console.log("Saving area sections",s),localStorage.setItem("screenshotSections",s.map(c=>JSON.stringify(c.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",s.map(c=>JSON.stringify(c.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),pe(!0),window.addEventListener("storage",async c=>{if(console.log("Storage event",c),c.key==="screenshot"){const i=new Cn({id:X,name:nt.name,sections:s,templates:[],previewImage:c.newValue,width:nt.width,height:nt.height,inventoryItems:e.map(a=>new ce({item:new x({...a.item,starterItem:!0}),quantity:a.quantity}))});await Mn(V,i),console.log("Area saved successfully"),Q(!1),window.location.href=`/LayItOut/Layout/?companyId=${V}&areaId=${X}&type=view-area`}})}function fn(t){const e=Array.from(r?G.find(s=>s.sectionName===w).cells:M);if(e[t.y]!=null)if(e[t.y][t.x].mouseOver=!0,e[t.y][t.x].canPlaceItem=!0,e[t.y][t.x].mouseOverLocation="single",Lt(s=>[...s,t]),r){const s=G.find(c=>c.sectionName===w);s&&(s.cells=e.map(c=>c.map(i=>({...i}))),T([...G])),T(c=>c.map(i=>i.sectionName===w?{...i,cells:e}:i))}else console.log("Adding highlighted cell",t.toId()),R(e)}function hn(t){const e=Array.from(r?G.find(l=>l.sectionName===w).cells:M);Ee(!0);const s=[];Kt.forEach(l=>{s.some(o=>o.toId()===l.toId())||s.push(l)}),Lt([]);const c=[],i=oe.findIndex(l=>l.item.name==t.name&&!l.item.hasMoved);let a=i!==-1?oe[i].quantity:0;s.forEach(l=>{const o=new x({...t});if(o.id=o.name+Math.floor(Math.random()*1e5).toString(),console.log("Placing item",o.name,"at",l.toId(),"CAN PLACE?",Tt(e,l,o)),Tt(e,l,o)&&a!=0){if(i!==-1&&(a-=1),_!=="placing-sections"||!te){const u=r?L.find(S=>S.name===w):ye(l,L);console.log("Adding item to section",u.name,"at",u.cellId,"with cell",l.toId(),l.x-u.cellId.x,l.y-u.cellId.y);const f=new h({x:l.x-u.cellId.x,y:l.y-u.cellId.y});o.sectionCell=f,console.log("Adding item to section",u.name,"at",f,o),u.items.push(o),console.log("SECTION ITEMS",u.items.map(S=>S.name))}else o.sectionCell=new h({x:l.x,y:l.y});for(let u=0;u<t.cellsTall;u++)for(let f=0;f<t.cellsLong;f++)e[l.y+u][l.x+f].hasItem=!0,e[l.y+u][l.x+f].itemId=o.id;o.hasMoved=!0,o.starterItem=!0,o.isDisplayItem=!1,o.initialElement=document.querySelector(`.App #${l.toId()}.cell:not(.cell-border)`);const g=new x({...o});c.push(g)}});for(const l of c)console.log("Adding item to items",l.id),I(o=>[...o,l]);if(i!==-1&&ne(l=>{const o=[...l];return o[i].quantity>0&&(o[i].quantity=a,o[i].quantity==0&&o.splice(i,1)),o}),a==0&&je(null),r){const l=G.find(o=>o.sectionName===w);l&&(l.cells=e.map(o=>o.map(g=>({...g}))),T([...G])),T(o=>o.map(g=>g.sectionName===w?{...g,cells:e}:g))}else R(e);se(L)}function In(t,e,s){Q(!0);const c=[];for(const i of t){const a=i.name,l=new h({x:i.cellId.x,y:i.cellId.y}),o=i.items.filter(f=>f.isBooth),g=i.items.filter(f=>!f.isBooth),u=new P({name:a,cellId:l,cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:g.map(f=>new H({cell:new h({x:f.sectionCell.x,y:f.sectionCell.y}),item:new x({...f,displayItem:!0})})),booths:o.map(f=>new We({id:f.name+Math.floor(Math.random()*1e5).toString(),name:f.name,cell:new h({x:f.sectionCell.x,y:f.sectionCell.y}),cellsLong:f.cellsLong,cellsTall:f.cellsTall,user:f.boothUser})),items:[]});c.push(u)}console.log("Saving area sections",c),localStorage.setItem("screenshotSections",c.map(i=>JSON.stringify(i.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",c.map(i=>JSON.stringify(i.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),pe(!0),window.addEventListener("storage",async i=>{if(console.log("Storage event",i),i.key==="screenshot"){const a=new Ve({id:s.id,name:s.name,sections:c,areaId:X,previewImage:i.newValue,inventoryItems:e.map(l=>new ce({item:new x({...l.item,starterItem:!0}),quantity:l.quantity}))});await He(V,a),console.log("Booth Map saved successfully"),Q(!1),window.location.href=`/LayItOut/Layout/?companyId=${V}&areaId=${X}&type=view-boothMap&boothMapId=${vt}`}})}return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"App",children:[n.jsx("h1",{className:"title",children:"LayItOut"}),n.jsx("br",{}),Ye&&n.jsxs("div",{className:"area-creation",children:[ct?n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"area-creation-title",children:"You have already picked a booth"})," "]}):n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"area-creation-title",children:"Picking Booth"}),n.jsx("label",{htmlFor:"",children:"Tap on an open booth then click on the checkmark to pick a booth"})," "]}),n.jsxs("label",{htmlFor:"",children:["Booth Size: ",ve?.plotWidth,"ft x ",ve?.plotHeight,"ft"]}),n.jsx("br",{})]}),qe&&n.jsxs("div",{className:"area-creation",children:[n.jsx("h2",{className:"area-creation-title",children:"Create Booth Map"}),n.jsx("label",{htmlFor:"",children:"Create a booth map by placing items and then creating and placing booths, same way you create and place items"})]}),te&&n.jsxs("div",{className:"area-creation",children:[n.jsx("h2",{className:"area-creation-title",children:"Create Area"}),n.jsx("label",{htmlFor:"",children:_=="placing-sections"?"Create new sections and place them":_=="modify-sections"?"Add walls and doors to sections":"Add items to the inventory and place items"})]}),(B||U)&&n.jsxs("div",{className:"template-name-row",children:[n.jsx("label",{htmlFor:"template-name",children:"Template Name:"}),n.jsx("input",{type:"text",id:"template-name",name:"template-name",onChange:t=>xt(t.target.value),value:Me})]}),Ie&&n.jsx("div",{className:"design-name-row",children:n.jsxs("label",{htmlFor:"design-name",children:["Design Name: ",Je]})}),(B||U)&&n.jsxs("div",{className:"template-creation",children:[n.jsxs("button",{className:"action-btn",onClick:()=>{if(Me.trim()==""){alert("Please enter a template name");return}if(xe.some(t=>t.name===Me&&(U?t.id!==St.id:!0))){alert("Template with this name already exists");return}U?(Q(!0),setTimeout(async()=>{const t=L.map(e=>new P({name:e.name,cellId:new h({x:le.find(s=>s.name==e.name).cellId.x,y:le.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new H({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new x({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),pe(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){pe(!1);const s=xe.map(c=>c.id===St.id?(console.log("SECTION",L),new we({name:Me,inventoryItems:oe,previewImage:e.newValue,sections:L.map(i=>new P({name:i.name,cellId:new h({x:c.sections.find(a=>a.name==i.name).cellId.x,y:c.sections.find(a=>a.name==i.name).cellId.y}),cellsLong:i.cellsLong,modifierItems:i.modifierItems,cellsTall:i.cellsTall,startingItems:i.items.map(a=>new H({cell:new h({x:a.sectionCell.x,y:a.sectionCell.y}),item:new x({...a,starterItem:!0})}))})),id:c.id})):new we({name:c.name,previewImage:c.previewImage,inventoryItems:c.inventoryItems,sections:c.sections.map(i=>new P({name:i.name,cellId:new h({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(a=>new H({cell:new h({x:a.cell.x,y:a.cell.y}),item:new x({...a.item})}))})),id:c.id}));Ue(V,X,s).then(()=>{console.log("Template updated successfully"),Q(!1);const c=new URLSearchParams(window.location.search),i=c.get("companyId"),a=c.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${i}&areaId=${a}&type=view-area`})}})},500)):(Q(!0),setTimeout(async()=>{const t=L.map(e=>new P({name:e.name,cellId:new h({x:le.find(s=>s.name==e.name).cellId.x,y:le.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new H({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new x({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),pe(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){pe(!1);const s=new we({name:Me,previewImage:e.newValue,inventoryItems:oe,sections:L.map(i=>new P({name:i.name,cellId:new h({x:le.find(a=>a.name==i.name).cellId.x,y:le.find(a=>a.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.items.map(a=>new H({cell:new h({x:a.sectionCell.x,y:a.sectionCell.y}),item:new x({...a,starterItem:!0})}))})),id:Me+(Math.random()*1e4).toString()}),c=[...xe.map(i=>new we({name:i.name,previewImage:i.previewImage,inventoryItems:i.inventoryItems,sections:i.sections.map(a=>new P({name:a.name,cellId:new h({x:a.cellId.x,y:a.cellId.y}),cellsLong:a.cellsLong,cellsTall:a.cellsTall,modifierItems:a.modifierItems,startingItems:a.startingItems.map(l=>new H({cell:new h({x:l.cell.x,y:l.cell.y}),item:new x({...l.item})}))})),id:i.id})),s];Ue(V,X,c).then(()=>{console.log("Template updated successfully"),Q(!1);const i=new URLSearchParams(window.location.search),a=i.get("companyId"),l=i.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${a}&areaId=${l}&type=view-area`})}})},500))},children:[B?"Create":"Save"," Template"]}),n.jsx("button",{className:"action-btn",onClick:()=>{const t=new URLSearchParams(window.location.search),e=t.get("companyId"),s=t.get("areaId");window.location.href=`/LayItOut/Layout/?companyId=${e}&areaId=${s}&type=view-area`},children:"Cancel"})]}),Jt&&n.jsxs("div",{className:"template-creation",children:[_t&&n.jsx("button",{className:"action-btn",onClick:()=>{Q(!0),setTimeout(async()=>{const t=L.map(e=>new P({name:e.name,cellId:new h({x:le.find(s=>s.name==e.name).cellId.x,y:le.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new H({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new x({...s,starterItem:!0})}))}));localStorage.setItem("screenshotSections",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),pe(!0),window.addEventListener("storage",async e=>{if(console.log("Storage event",e),e.key==="screenshot"){pe(!1);const s=new Et({name:Je,previewImage:e.newValue,areaId:X,inventoryItems:oe,sections:L.map(c=>new P({name:c.name,cellId:new h({x:le.find(i=>i.name==c.name).cellId.x,y:le.find(i=>i.name==c.name).cellId.y}),cellsLong:c.cellsLong,cellsTall:c.cellsTall,modifierItems:c.modifierItems,startingItems:c.items.map(i=>new H({cell:new h({x:i.sectionCell.x,y:i.sectionCell.y}),item:new x({...i,starterItem:!0})}))})),id:lt});kt(V,X,s).then(()=>{console.log("Design updated successfully"),Ee(!1),Q(!1)})}})},500)},children:"Save"}),n.jsx("button",{className:"action-btn",onClick:()=>{},children:"Submit"})]}),!Ie&&!Ze&&!Te&&!Ye&&n.jsxs("div",{className:"place-mode-row",children:[n.jsx("label",{htmlFor:"tap-and-place-mode",children:"Place Mode: "}),n.jsxs("select",{id:"tap-and-place-mode",name:"tap-and-place-mode",value:Ne?"tap":"drag",onChange:t=>yt(t.target.value==="tap"),className:"place-mode-select",children:[n.jsx("option",{value:"drag",children:"Drag and Drop"}),n.jsx("option",{value:"tap",children:"Tap and Place"})]})]}),it&&n.jsx(n.Fragment,{children:n.jsx("div",{className:"loader-backdrop",children:n.jsx("div",{className:"loader"})})})," ",n.jsxs("div",{className:"layout",children:[!Ie&&!Ze&&!Te&&!Ye&&n.jsx(Wn,{setSelectedItem:je,tapAndPlaceMode:Ne,isModifyingSections:te&&_=="modify-sections",isViewingDesign:Ie,isEditingTemplate:U,isCreatingTemplate:B,maxHeight:r?200:b*k,showAddCustomItem:()=>{_=="placing-sections"&&te?mt.current?.showModal():_=="placing-items"&&te?dt.current?.showModal():rt.current?.showModal()},addDraggingItem:cn,removeItem:At,inventoryItems:oe.map(t=>new ce({item:new x({...t.item,displayItem:!0}),quantity:t.quantity}))}),Te&&de?n.jsx(Un,{onDeleteVendor:async t=>{Q(!0);const e=new Ve({...de,vendors:de.vendors.filter(s=>s.id!==t),sections:de.sections.map(s=>new P({...s,booths:s.booths.map(c=>c.user?.id===t?new We({...c,user:null,initialElement:c.initialElement??void 0}):c)}))});await He(V,e),Re(e),window.location.reload()},onEditVendor:t=>{ln(t),ut.current?.showModal()},boothMap:de,vendors:de?.vendors??[],maxHeight:r?void 0:b*k,onAddVendor:()=>{gt.current?.showModal()}}):null,r?n.jsxs("div",{className:"mobile-areas",style:{height:Z+"px"},children:[L.length>1&&n.jsx("img",{src:Ke,onClick:()=>{const t=L.findIndex(s=>s.name==w);if(t===-1)return;const e=(t-1+L.length)%L.length;K(L[e].name),console.log("Changing viewing section to",L[e].name)},className:"back-mobile-areas"}),Ge.map((t,e)=>n.jsx(Rt,{width:t.width,height:t.height,cells:bt(G.find(s=>s.sectionName==t.sectionName).cells),id:t.sectionName,visibile:w==null?!0:t.sectionName==w,section:t.sectionName},e)),L.length>1&&n.jsx("img",{src:Ke,onClick:()=>{const t=L.findIndex(s=>s.name==w);if(t===-1)return;const e=(t+1)%L.length;K(L[e].name),console.log("Changing viewing section to",L[e].name)},className:"forward-mobile-areas"})]}):n.jsx(Rt,{width:F*k,height:b*k,cells:bt(M)})]}),Ie&&n.jsxs("div",{className:"design-view",children:[n.jsx("button",{className:"action-btn",onClick:()=>{const t=L.map(e=>new P({name:e.name,cellId:new h({x:le.find(s=>s.name==e.name).cellId.x,y:le.find(s=>s.name==e.name).cellId.y}),cellsLong:e.cellsLong,cellsTall:e.cellsTall,modifierItems:e.modifierItems,startingItems:e.items.map(s=>new H({cell:new h({x:s.sectionCell.x,y:s.sectionCell.y}),item:new x({...s,starterItem:!0})}))}));localStorage.setItem("printSections",t.map(e=>JSON.stringify(e.toJSON())).join("LAYOUTSEPARATOR")),window.open(window.location.origin+`/LayItOut/Print/?companyId=${V}&areaId=${X}&designName=${Je}&designId=${lt}`,"_blank")},children:"Print"}),n.jsx("button",{className:"action-btn",onClick:()=>{const t=new we({name:Je,previewImage:$e.previewImage,inventoryItems:$e.inventoryItems,sections:$e.sections,id:$e.name+(Math.random()*1e4).toString()}),e=[...xe.map(s=>new we({name:s.name,previewImage:s.previewImage,inventoryItems:s.inventoryItems,sections:s.sections.map(c=>new P({name:c.name,cellId:new h({x:c.cellId.x,y:c.cellId.y}),cellsLong:c.cellsLong,cellsTall:c.cellsTall,modifierItems:c.modifierItems,startingItems:c.startingItems.map(i=>new H({cell:new h({x:i.cell.x,y:i.cell.y}),item:new x({...i.item})}))})),id:s.id})),t];Ue(V,X,e).then(()=>{console.log("Template updated successfully"),Ce(e),window.location.href=`/LayItOut/Layout/?companyId=${V}&areaId=${X}&type=edit-template&templateId=${t.id}`})},children:"Turn into a Template"}),n.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=desings"},children:"Back"})]}),Te&&n.jsx("div",{className:"design-view",children:n.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=boothmaps"},children:"Back"})}),Ze&&n.jsx("div",{className:"design-view",children:n.jsx("button",{className:"action-btn",onClick:()=>{window.location.href="/LayItOut/?view=areas"},children:"Back"})}),te&&n.jsxs("div",{className:"design-view",children:[n.jsx("button",{className:"action-btn",onClick:()=>{_=="placing-sections"?dn(W.filter(t=>t.isSectionItem)):_=="modify-sections"?gn(W.filter(t=>t.isSectionModifier),L):_=="placing-items"&&un(L,oe)},children:_=="placing-items"?"Create Area":"Next"}),n.jsx("button",{className:"action-btn",onClick:async()=>{Q(!0),await Ln(V,X),window.location.href="/LayItOut/"},children:"Cancel"})]}),qe&&n.jsxs("div",{className:"design-view",children:[n.jsx("button",{className:"action-btn",onClick:()=>{console.log("Creating booth map with sections",L,"and inventory items",oe,"and boothMap",de),In(L,oe,de)},children:"Create Booth Map"}),n.jsx("button",{className:"action-btn",onClick:async()=>{Q(!0),await bn(V,X,vt),window.location.href="/LayItOut/?view=boothmaps"},children:"Cancel"})]})]}),n.jsxs("div",{children:[L.map(t=>n.jsx(xn,{takingPhoto:!1,section:t,visible:w==null?!0:t.name==w,cellSize:k},t.cellId.toId())),W.map(t=>n.jsx(vn,{isCreatingArea:te,isCreatingTemplate:B||U,cellSize:k,isViewingDesign:Ie||Ze||Te||Ye,removeItem:At,visible:r?!t.hasMoved&&!t.starterItem?!0:w==null?!1:t.isSectionModifier?L.find(e=>e.name==w)?.modifierItems.some(e=>e.item.id===t.id):t.starterItem?L.find(e=>e.name==w)?.startingItems.some(e=>e.item.id===t.id):L.find(e=>e.name==w)?.items.some(e=>e.id===t.id):!0,item:t,canPlaceItem:ft,placeItem:jt,deleteItemRotate:mn,highlightCells:Nt,unHighlightCells:ht,deleteItem:rn,isSelected:v===t.id,onSelect:Mt,isUnselecting:q.includes(t.id),onDeselect:()=>Ct(t.id)},t.id)),_e.map(t=>(console.log("CAN PICK BOOTH",t.cellsLong==ve?.plotWidth&&t.cellsTall==ve.plotHeight,"BOOTH",t,"VENDOR",ve),n.jsx(Rn,{canPick:Te||ct||t.cellsLong==ve?.plotWidth&&t.cellsTall==ve.plotHeight,visible:r?w==null?!1:L.find(e=>e.name==w)?.booths.some(e=>e.id===t.id)??!1:!0,booth:t,isViewingBooth:Te||ct,isSelected:v==t.id,cellSize:k,onSelect:Mt,isUnselecting:q.includes(t.id),onDeselect:()=>Ct(t.id),onPickBooth:async e=>{Q(!0);const s=L.map(i=>i.name===w?new P({...i,booths:i.booths.map(a=>a.id===e?new We({...a,user:ve,initialElement:a.initialElement??void 0}):a)}):i.booths.some(a=>a.id===e)?new P({...i,booths:i.booths.map(a=>a.id===e?new We({...a,user:ve,initialElement:a.initialElement??void 0}):a)}):i);console.log("Updated sections",s),se(s);const c=new Ve({...de,sections:s});await He(V,c),window.location.reload(),Q(!1)}},t.id)))]}),r&&!it&&n.jsx("div",{className:"layout-icon",onClick:()=>{Oe.current?.showModal(),Pe(!0),console.log("Showing layout dialog")},children:n.jsx("img",{src:Pn,alt:""})}),!it&&!(B||U||Ie||qe||te||Te||Ye)&&n.jsx("div",{className:"template-icon",onClick:()=>{he.current?.showModal(),Le(!0),console.log("Showing template dialog")},children:n.jsx("img",{src:Bn,alt:""})}),n.jsx(Gn,{isViewingArea:Ze,dialogRef:he,isOpen:Se,closeDialog:()=>{he.current?.close(),Le(!1)},duplicateTemplate:t=>{const e=new we({name:t.name+" Copy",previewImage:t.previewImage,inventoryItems:t.inventoryItems,sections:t.sections,id:t.name+"Copy"+(Math.random()*1e4).toString()}),s=[...xe.map(c=>new we({name:c.name,previewImage:c.previewImage,inventoryItems:c.inventoryItems,sections:c.sections.map(i=>new P({name:i.name,cellId:new h({x:i.cellId.x,y:i.cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(a=>new H({cell:new h({x:a.cell.x,y:a.cell.y}),item:new x({...a.item})}))})),id:c.id})),e];Ue(V,X,s).then(()=>{he.current?.close(),console.log("Template updated successfully"),Ce(s),Le(!1),window.location.href=`/LayItOut/Layout/?companyId=${V}&areaId=${X}&type=edit-template&templateId=${e.id}`})},templates:xe,selectTemplate:t=>{Q(!0),setTimeout(async()=>{const e=t.sections.map(s=>new P({name:s.name,cellId:new h({x:t.sections.find(c=>c.name==s.name).cellId.x,y:t.sections.find(c=>c.name==s.name).cellId.y}),cellsLong:s.cellsLong,cellsTall:s.cellsTall,modifierItems:s.modifierItems,startingItems:s.startingItems.map(c=>new H({cell:new h({x:c.cell.x,y:c.cell.y}),item:new x({...c.item,starterItem:!0})}))}));localStorage.setItem("screenshotSections",e.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),console.log("Screenshot sections saved to localStorage",e.map(s=>JSON.stringify(s.toJSON())).join("LAYOUTSEPARATOR")),localStorage.setItem("screenshot",""),pe(!0),window.addEventListener("storage",async s=>{if(console.log("Storage event",s),s.key==="screenshot"){pe(!1);const c=new Et({name:Je,previewImage:s.newValue,areaId:X,inventoryItems:t.inventoryItems,sections:t.sections.map(i=>new P({name:i.name,cellId:new h({x:t.sections.find(a=>a.name==i.name).cellId.x,y:t.sections.find(a=>a.name==i.name).cellId.y}),cellsLong:i.cellsLong,cellsTall:i.cellsTall,modifierItems:i.modifierItems,startingItems:i.startingItems.map(a=>new H({cell:new h({x:a.cell.x,y:a.cell.y}),item:new x({...a.item,starterItem:!0})}))})),id:lt});console.log("UPDATED DESIGN",c),kt(V,X,c).then(()=>{console.log("Design updated successfully"),Ee(!1),Q(!1),window.location.reload()})}})},500)}}),n.jsx(On,{dialogRef:Oe,closeDialog:()=>{Oe.current?.close(),Pe(!1)},areaPreview:qt||""}),n.jsx(Fn,{canBeBooth:qe,dialogRef:rt,addInventoryItem:It,closeDialog:()=>{rt.current?.close()}}),n.jsx(Zn,{dialogRef:mt,closeDialog:()=>{mt.current?.close()},addSection:It}),n.jsx(Yn,{dialogRef:dt,closeDialog:()=>{dt.current?.close()},addInventoryItem:It}),n.jsx(Jn,{placeMultiItem:hn,addHighlightedCell:fn,item:fe,setSelectingItem:()=>{je(null)},canPlaceItem:ft,placeItem:jt,highlightCells:Nt,unHighlightCells:ht,cellSize:k}),n.jsx(Xn,{dialogRef:gt,closeDialog:()=>{gt.current?.close()},addVendor:async t=>{const e=new Ve({...de,vendors:[...de.vendors,t]});Re(e),await He(V,e)}}),n.jsx(Qn,{oldVendor:nn,dialogRef:ut,closeDialog:()=>{ut.current?.close()},editVendor:async t=>{const e=new Ve({...de,vendors:de.vendors.map(s=>s.id===t.id?t:s)});Re(e),await He(V,e)}}),at&&n.jsx("iframe",{id:"screenshot-iframe",title:"Screenshot Iframe",src:window.location.origin+"/LayItOut/Preview/",width:C*k+20,height:Y*k+20})]})}
